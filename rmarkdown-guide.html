<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>R Markdown 指南</title>
  <meta name="description" content="R Markdown 指南" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="R Markdown 指南" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R Markdown 指南" />
  <meta name="github-repo" content="cosname/rmarkdown-guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R Markdown 指南" />
  
  <meta name="twitter:description" content="R Markdown 指南" />
  

<meta name="author" content="王祎帆" />
<meta name="author" content="闫求识" />
<meta name="author" content="高春辉" />
<meta name="author" content="庄亮亮" />


<meta name="date" content="2021-08-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/leaflet/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet/leaflet.js"></script>
<link href="libs/leafletfix/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4/proj4.min.js"></script>
<script src="libs/Proj4Leaflet/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding/leaflet.js"></script>
<script src="libs/viz/viz.js"></script>
<link href="libs/DiagrammeR-styles/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">R Markdown 指南</h1>
<p class="author"><em>王祎帆</em></p>
<p class="author"><em>闫求识</em></p>
<p class="author"><em>高春辉</em></p>
<p class="author"><em>庄亮亮</em></p>
<p class="date"><em>2021-08-28</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#前言">前言</a></li>
<li><a href="#part-基础">(PART) 基础</a></li>
<li><a href="#know-rmarkdown"><span class="toc-section-number">1</span> 认识 R Markdown</a>
<ul>
<li><a href="#数据分析报告"><span class="toc-section-number">1.1</span> 数据分析报告</a></li>
<li><a href="#rmd-notebook"><span class="toc-section-number">1.2</span> 交互笔记本</a></li>
<li><a href="#个人简历"><span class="toc-section-number">1.3</span> 个人简历</a></li>
<li><a href="#网站"><span class="toc-section-number">1.4</span> 网站</a></li>
<li><a href="#幻灯片"><span class="toc-section-number">1.5</span> 幻灯片</a></li>
<li><a href="#交互报表"><span class="toc-section-number">1.6</span> 交互报表</a></li>
<li><a href="#动态文档"><span class="toc-section-number">1.7</span> 动态文档</a></li>
<li><a href="#r-markdown-的渊源与历史"><span class="toc-section-number">1.8</span> R Markdown 的渊源与历史</a></li>
</ul></li>
<li><a href="#installation"><span class="toc-section-number">2</span> 安装</a>
<ul>
<li><a href="#安装-r-markdown"><span class="toc-section-number">2.1</span> 安装 R Markdown</a></li>
<li><a href="#create-first-rmd"><span class="toc-section-number">2.2</span> 创建第一个 R Markdown 文档</a>
<ul>
<li><a href="#发布"><span class="toc-section-number">2.2.1</span> 发布</a></li>
</ul></li>
<li><a href="#安装-tinytex"><span class="toc-section-number">2.3</span> 安装 Tinytex</a></li>
<li><a href="#使用-rstudio-项目文件"><span class="toc-section-number">2.4</span> 使用 RStudio 项目文件</a></li>
</ul></li>
<li><a href="#rmarkdown-basics"><span class="toc-section-number">3</span> 基础知识</a>
<ul>
<li><a href="#r-markdown-的编译过程"><span class="toc-section-number">3.1</span> R Markdown 的编译过程</a></li>
<li><a href="#r-markdown-的基本元素"><span class="toc-section-number">3.2</span> R Markdown 的基本元素</a></li>
<li><a href="#yaml-头部"><span class="toc-section-number">3.3</span> YAML 头部</a>
<ul>
<li><a href="#输出格式"><span class="toc-section-number">3.3.1</span> 输出格式</a></li>
<li><a href="#总结"><span class="toc-section-number">3.3.2</span> 总结</a></li>
</ul></li>
<li><a href="#markdown-syntax"><span class="toc-section-number">3.4</span> Markdown 语法</a>
<ul>
<li><a href="#简单段内格式"><span class="toc-section-number">3.4.1</span> 简单段内格式</a></li>
<li><a href="#换行"><span class="toc-section-number">3.4.2</span> 换行</a></li>
<li><a href="#段落格式"><span class="toc-section-number">3.4.3</span> 段落格式</a></li>
<li><a href="#代码块"><span class="toc-section-number">3.4.4</span> 代码块</a></li>
<li><a href="#链接"><span class="toc-section-number">3.4.5</span> 链接</a></li>
<li><a href="#图片"><span class="toc-section-number">3.4.6</span> 图片</a></li>
<li><a href="#表格"><span class="toc-section-number">3.4.7</span> 表格</a></li>
<li><a href="#总结-1"><span class="toc-section-number">3.4.8</span> 总结</a></li>
</ul></li>
<li><a href="#r-code"><span class="toc-section-number">3.5</span> 使用 R 代码</a></li>
<li><a href="#basic-other-languages"><span class="toc-section-number">3.6</span> 在 R Markdown 中使用其他语言</a></li>
<li><a href="#案例同时使用-sql-r-和-python-做数据分析"><span class="toc-section-number">3.7</span> 案例：同时使用 SQL, R 和 Python 做数据分析</a></li>
<li><a href="#使用-rstudio-图形化编辑器"><span class="toc-section-number">3.8</span> 使用 RStudio 图形化编辑器</a></li>
</ul></li>
<li><a href="#document-elements"><span class="toc-section-number">4</span> 文档元素</a>
<ul>
<li><a href="#el-figures"><span class="toc-section-number">4.1</span> 图片</a>
<ul>
<li><a href="#用-knitr-选项操作图片"><span class="toc-section-number">4.1.1</span> 用 knitr 选项操作图片</a></li>
<li><a href="#插入非代码生成图片"><span class="toc-section-number">4.1.2</span> 插入非代码生成图片</a></li>
</ul></li>
<li><a href="#表格-1"><span class="toc-section-number">4.2</span> 表格</a></li>
<li><a href="#公式"><span class="toc-section-number">4.3</span> 公式</a></li>
<li><a href="#theme-templates"><span class="toc-section-number">4.4</span> 主题和模板</a></li>
<li><a href="#目录"><span class="toc-section-number">4.5</span> 目录</a></li>
<li><a href="#cross-reference"><span class="toc-section-number">4.6</span> 交叉引用</a></li>
<li><a href="#章节编号"><span class="toc-section-number">4.7</span> 章节编号</a></li>
<li><a href="#参考文献和引用"><span class="toc-section-number">4.8</span> 参考文献和引用</a>
<ul>
<li><a href="#引用-r-包"><span class="toc-section-number">4.8.1</span> 引用 R 包</a></li>
</ul></li>
<li><a href="#interactive-documents"><span class="toc-section-number">4.9</span> 交互文档</a>
<ul>
<li><a href="#html-组件"><span class="toc-section-number">4.9.1</span> HTML 组件</a></li>
<li><a href="#shiny-文档"><span class="toc-section-number">4.9.2</span> Shiny 文档</a></li>
</ul></li>
<li><a href="#diagrams"><span class="toc-section-number">4.10</span> 插入流程图和网络图</a></li>
<li><a href="#插入分页符和分割线"><span class="toc-section-number">4.11</span> 插入分页符和分割线</a></li>
</ul></li>
<li><a href="#typesetting"><span class="toc-section-number">5</span> 排版</a>
<ul>
<li><a href="#通用方案"><span class="toc-section-number">5.1</span> 通用方案</a>
<ul>
<li><a href="#html"><span class="toc-section-number">5.1.1</span> HTML</a></li>
<li><a href="#latex"><span class="toc-section-number">5.1.2</span> LaTeX</a></li>
</ul></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Markdown 指南</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="前言" class="section level1 unnumbered">
<h1 class="unnumbered">前言</h1>
<!--chapter:end:index.Rmd-->
</div>
<div id="part-基础" class="section level1 unnumbered">
<h1 class="unnumbered">(PART) 基础</h1>
</div>
<div id="know-rmarkdown" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> 认识 R Markdown</h1>
<p><strong>rmarkdown</strong> <span class="citation">(<a href="#ref-R-rmarkdown" role="doc-biblioref">Allaire, Xie, McPherson, et al. 2021</a>)</span> 一个是 R 语言的扩展包，提供了以 <code>.Rmd</code> 文件格式为中心的数据科学写作框架。它的核心思想是创作包含文本和代码的动态文档，让数据与叙事并进，最终提供易重复，易共享的数据分析环境。</p>
<p>本章从 R Markdown 的应用开始，遴选了不同场合 R Markdown 的用例和解决的问题。包括撰写数据分析报告，发表电子书，设计数据驱动的个人简历，建立个人网站，创作演示文档和交互报表。最后回顾了 R Markdown 渊源的历史发展。话不多说，我们在以下各小节中快速浏览一些 R Markdown 文档的用例，它们有些直接基于原生的 R Markdown 包，有些来自 R Markdown 的扩展包。越来越多的扩展为 R Markdown 文档增加了新的输出格式，为生态体系提供了更丰富的功能覆盖。读者可以挑选自己最感兴趣的使用场合深入后面对应章节的阅读，也可以在 <a href="https://github.com">Github</a> 上以 R Markdown 为关键词探索各式各样的输出格式。</p>
<div id="数据分析报告" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> 数据分析报告</h2>
<p>从诞生开始，R 便是一门致力于交互式数据分析的语言，R 的用户便时常有着制作数据分析报告的需求，这也是 R Markdown 最常见基础的用途。它支持 HTML, PDF, Word, EPUB 等多种输出格式以及与之配套开箱即用的主题系统。用户可以将创作重心放在内容上，写作完成后一键输出不同格式，让 R Markdown 的自动化的编译机制代劳形式上的调整。例如，以下 HTML，PDF 和 Word 三种格式的文档是用同一个 R Markdown 生成的。</p>
<p><img src="images/01-html-output.png" width="30%" style="display: block; margin: auto;" /><img src="images/01-pdf-output.png" width="30%" style="display: block; margin: auto;" /><img src="images/01-word-output.png" width="30%" style="display: block; margin: auto;" /></p>
<p>除了多样的输出格式外，R Markdown 驱动的数据分析报告还解决了很多数据分析报告写作中的痛点：</p>
<ul>
<li><p>之前在使用 R 或者其他数据分析工具时，经常需要在 Word 里写结论，在脚本里敲代码，在图表区生成图，将它们复制粘贴到一起后，还要操心格式问题，有没有什么自动化的方法？</p></li>
<li><p>我的工作需要日常性的数据产出，如何创作一篇参数化、可复用的文档模板，从此可以在更新数据的同时同步结论和图表？</p></li>
<li><p>如何确保分析过程和结论是可重复的，别人是否能利用同样的数据得到我的结论？</p></li>
<li><p>我不了解网页开发，如何在报告中插入可交互的图表和网页元素？</p></li>
</ul>
<p>同时，R Markdown 还为 R 语言之外的几十种编程语言提供了一定程度的支持，例如 Python，C++，Julia，Bash，SQL 等，这意味着我们可以在一篇报告中混用多个工具。Python 作为数据分析师的另一大利器，在 <strong>reticulate</strong> 包 <span class="citation">(<a href="#ref-R-reticulate" role="doc-biblioref">Ushey, Allaire, and Tang 2021</a>)</span> 的帮助下可以流畅地与 R 代码在 R Markdown 文档中并用。下面的例子中，我们先用 R 导入数据并作数据预处理，随后将 R 中的数据传递框到 Python 环境中，生成 <strong>pandas</strong> 格式的 <code>DataFrame</code>, 并用 <strong>seaborn</strong> 包作可视化。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R 部分: 导入和预处理美国各州犯罪数据</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>arrests <span class="ot">&lt;-</span> datasets<span class="sc">::</span>USArrests</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>arrests<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="fu">rownames</span>(arrests)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Python 部分，导入 R 数据，提取谋杀率最高的 10 个州，并用 seaborn 包作柱形图</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>top_states <span class="op">=</span> r.arrests<span class="op">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  .sort_values([<span class="st">&quot;Murder&quot;</span>], ascending <span class="op">=</span> <span class="va">False</span>)<span class="op">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  .head(<span class="dv">10</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>sns.barplot(x <span class="op">=</span> <span class="st">&quot;Murder&quot;</span>, y <span class="op">=</span> <span class="st">&quot;State&quot;</span>,  data <span class="op">=</span> top_states)</span></code></pre></div>
<p><img src="rmarkdown-guide_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>我们在 @ref(basic-other-languages) 节给出了在数据分析项目中混用 SQL，R 和 Python 的例子，并在 @ref(other-languages) 中详细讨论了如何在 R Markdown 中结合其他编程语言。</p>
<p>当读者需要创作更大篇幅的文档甚至书籍时，我们可能不希望仅使用一篇 R Markdown 文档组织全部内容。<strong>bookdown</strong> 包 <span class="citation">(<a href="#ref-R-bookdown" role="doc-biblioref">Xie 2021a</a>)</span> 可以让用户将内容分散到多个 R Markdown 文档中，在编译时合成各文档便提供更适于书籍和在线文档的输出格式。此外，bookdown 对 R Markdown 的扩展还包括支持交叉引用，定理公式环境，文献引用等。bookdown 的输出结果非常适合用于制作在线教材与讲义，例如北京大学李东风老师的<a href="https://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html">《R 语言教程》</a>，本书的在线版本也是用 bookdown 生成的。<a href="https://bookdown.org/home/">bookdown.org</a> 列出了更多 bookdown 制作的在线书籍。</p>
<div class="figure" style="text-align: center">
<img src="images/01-bookdown-chinese.png" alt="使用 bookdown 制作的中文图书范例, 一个章节对应一个 R Markdown 文档" width="960" />
<p class="caption">
(#fig:bookdown-chinese-demo)使用 bookdown 制作的中文图书范例, 一个章节对应一个 R Markdown 文档
</p>
</div>
<p>在学术报告或论文的撰写中，用户可能对格式有更细致的要求。越来越多的包提供了易用的 R Markdown 模板，为我们免去了繁杂的手动格式调整，编译后即可直接投稿。<strong>rticles</strong> 包 <span class="citation">(<a href="#ref-R-rticles" role="doc-biblioref">Allaire, Xie, R Foundation, et al. 2021</a>)</span> 提供了很多期刊和出版商的模板文档，例如 R Journals 和 Journals of Statistical Software。中文用户可能较常用 rticles 提供的 CTeX 输出格式，它让 R Markdown 输出的 PDF 可以正常显示中文字符。</p>
</div>
<div id="rmd-notebook" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> 交互笔记本</h2>
<p>R Markdown 及 bookdown 文档可运行代码，格式化长篇文本，插入 LaTeX 数学环境，支持交叉引用，特别适合统计，数据科学，计算机科学等领域的学生，研究人员和爱好者们作为首选的笔记本格式。</p>
<div class="figure" style="text-align: center">
<img src="images/01-notebook-preview.png" alt="RStudio 支持实时预览 R Markdown 笔记本格式" width="510" />
<p class="caption">
(#fig:notebook-preview)RStudio 支持实时预览 R Markdown 笔记本格式
</p>
</div>
<p>如图 @ref(fig:notebook-preview) 所示，R Markdown 笔记本支持插入代码，保存它们的运行结果，添加格式化文本和批注等功能。R Markdown 的交互特性让学习记录变得十分自然：我们添加一段代码，运行后得到预料之中/意想不到的图片，或许随后在下面的多个代码段中反复调整某个参数，直至得到想要的结果。在此过程中我们发现了更多相关的包/模组，写下对不同模组的总结，并链接网络上其他人的用例，甚至开始撰写自动化脚本。最后，我们可以一键生成包含了这一系列思考和学习过程的 HTML，PDF 精美文档。图 @ref(fig:notebook-preview) 是一个 PDF 笔记文档示例。</p>
<div class="figure" style="text-align: center">
<img src="images/01-notebook-preview2.jpg" alt="用 R Markdown 生成 PDF 学习笔记"  />
<p class="caption">
(#fig:notebook-preview2)用 R Markdown 生成 PDF 学习笔记
</p>
</div>
<p>即便我们的工作不涉及数据处理或运行代码，使用 R Markdown 作为笔记软件也有许多好处。我们可以流畅的使用版本控制工具，管理笔记依赖的数据，图片的资源。我们可以将长篇笔记拆分为多个源文档，用纯文本文件管理输出设置，形成清晰的项目结构。<a href="https://rpubs.com/">RPubs</a> 和 <a href="https://bookdown.org/">bookdown</a> 等平台提供了免费的 R Markdown 文档发布服务，我们可以发布自己的笔记与心得，便利他人和未来的自己。</p>
</div>
<div id="个人简历" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> 个人简历</h2>
<p>一些 R Markdown 扩展包提供了适用于个人简历和 CV 的输出格式。例如基于 <strong>pagedown</strong> 包 <span class="citation">(<a href="#ref-R-pagedown" role="doc-biblioref">Xie et al. 2021</a>)</span> 的<a href="https://pagedown.rbind.io/html-resume">简历模板</a>，和 <a href="https://pkg.mitchelloharawild.com/vitae/">vitae</a> 下多种 CV 模板。</p>
<p>除了使用模板外， R Markdown 还能让你的简历变得更加“数据驱动”。<a href="http://nickstrayer.me/datadrivencv/">datadrivencv</a> 包把简历中的各项教育背景，工作经历和项目经验等视作电子表格中的一条记录，我们可以仅维护这张数据表，R Markdown 负责简历的格式。除此之外，还可以插入 R 代码生成的交互图表，让我们的简历动起来。图 @ref(ns-cv) 是 datadrivencv 包的作者 Nick Strayer 结合 <strong>pagedown</strong> 包 <span class="citation">(<a href="#ref-R-pagedown" role="doc-biblioref">Xie et al. 2021</a>)</span> 制作的个人简历。</p>
<div class="figure" style="text-align: center">
<img src="images/01-resume.png" alt="(ref:ns-cv)" width="408" />
<p class="caption">
(#fig:ns-cv)(ref:ns-cv)
</p>
</div>
<p>(ref:ns-cv) <a href="http://nickstrayer.me/">Nick Strayer</a>用 datadrivencv 和 pagedown 包制作的 CV 示意</p>
</div>
<div id="网站" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> 网站</h2>
<p>原生的 R Markdown 包内置了生成简单静态网站的功能。简单来说，我们在一个 <code>yaml</code> 文件通过键值对定义网站的标题，导航栏，页面结构等元数据，而后创建几个 R Markdown 文档在其中填充内容，内置的站点生成器将每个 R Markdown 文档渲染为一个 HTML 页面输出。</p>
<div class="figure" style="text-align: center">
<img src="images/01-rmarkdown-wbesite.png" alt="用 R Markdown 创建网站" width="960" />
<p class="caption">
(#fig:unnamed-chunk-6)用 R Markdown 创建网站
</p>
</div>
<p>为满足创建更加复杂且精美的网站的需求，<strong>blogdown</strong> 包使用了第三方的开源静态网站生成器：Hugo。Hugo 是目前最快，最受欢迎的静态网站生成器之一，一般用户通常需要用命令行的方式与之交互。作为幸福的 R 用户，我们可以在 R Markdown 文档中写作，随后调用 blogdown 中封装好的函数操作 Hugo 的编译功能，最后生成网站。</p>
<div class="figure" style="text-align: center">
<img src="images/01-hugo-themes.png" alt="blogdown 包可以使用 Hugo 主题" width="960" />
<p class="caption">
(#fig:hugo-themes)blogdown 包可以使用 Hugo 主题
</p>
</div>
<p>包如其名，对个人用户来说，blogdown 特别适合制作博客类的个人网站。借用免费的域名，读者可以展示个人项目，存放简历和 CV，归档学习笔记和心得，求职时为自己添加一份切实的筹码。除此之外，我们还可以用 blogdown 。Hugo 的<a href="https://themes.gohugo.io/">主题列表</a> 列出了丰富的网站模板，其中大部分均可以在 blogdown 中一键生成。最后，我们给出几个不同主题的 blogdown 网站的样例</p>
<ul>
<li><p>Rob J Hyndman 的<a href="https://robjhyndman.com/">个人网站</a></p></li>
<li><p>Alison Hill 的<a href="https://alison.rbind.io/">个人网站</a></p></li>
<li><p>《现代统计图形》的<a href="https://msg2020.pzhao.org/">图书主页</a></p></li>
</ul>
</div>
<div id="幻灯片" class="section level2" number="1.5">
<h2 number="1.5"><span class="header-section-number">1.5</span> 幻灯片</h2>
<p>R Markdown 和扩展包支持输出多种常见的幻灯片格式，例如 PowerPoint，Beamer，isoslides 和 Slidy 等。除此之外，我们特别推荐读者关注 <strong>xaringan</strong> <span class="citation">(<a href="#ref-R-xaringan" role="doc-biblioref">Xie 2021c</a>)</span> 包，它基于 JavaScript 中的 remark.js 库设计了灵活的输出方案。默认的模板，了解 css 和一定 JavaScript 的读者还可以在此基础上设计出炫酷的演示文档。<strong>xaringanExtra</strong> 包在此基础上提供了更多有趣的增强插件。读者可以在 <a href="https://slides.yihui.org/xaringan/#1" class="uri">https://slides.yihui.org/xaringan/#1</a> 和 <a href="https://pkg.garrickadenbuie.com/xaringanExtra/#/" class="uri">https://pkg.garrickadenbuie.com/xaringanExtra/#/</a> 看到更多例子。</p>
<div class="figure" style="text-align: center">
<img src="images/01-xaringan1.png" alt="xaringan 提供的幻灯片模板示意" width="49%" /><img src="images/01-xaringan2.png" alt="xaringan 提供的幻灯片模板示意" width="49%" />
<p class="caption">
(#fig:xaringan)xaringan 提供的幻灯片模板示意
</p>
</div>
</div>
<div id="交互报表" class="section level2" number="1.6">
<h2 number="1.6"><span class="header-section-number">1.6</span> 交互报表</h2>
<p>报表是一种常见的商业报告形式，用 R Markdown 开发报表不仅能将分析过程与商业结论天然结合地在一起，还能利用 R 语言强大的图表功能。<strong>flexdashboard</strong> <span class="citation">(<a href="#ref-R-flexdashboard" role="doc-biblioref">Iannone, Allaire, and Borges 2020</a>)</span> 包基于 HTML 格式提供了这类报表的模板，还内置了一些 HTML 组件作为常见报表元素， 例如指标盒，增长仪表，导航栏等。</p>
<div class="figure" style="text-align: center">
<img src="images/01-flexdashboard.png" alt="用 flexdashboard 包制作的仪表板" width="582" />
<p class="caption">
(#fig:flexdashboard)用 flexdashboard 包制作的仪表板
</p>
</div>
<p>除初次开发上的简便外，R Markdown 生态系统还提供了丰富的测试，部署，自动化和持续集成功能，确保我们的数据产品可以快速投入生产。</p>
</div>
<div id="动态文档" class="section level2" number="1.7">
<h2 number="1.7"><span class="header-section-number">1.7</span> 动态文档</h2>
<p>除了直接的界面写作外，我们还可以调用输出 API <code>rmarkdown::render</code> 生成结果文档，并可以控制 R Markdown 输出时使用的数据源。这让 R Markdown 的自动化批量生产成为可能。一个典型场景是：数据库每日更新全国销售数据，而数据分析师用自动化脚本控制 R Markdown 分地区，分职务地生成多个针对各负责人的报表。这样的动态文档是通过参数实现的，我们在源文档中使用参数的名字，而不是具体的数据。随后在脚本中用 <code>rmarkdown::render</code> 动态传入当日的数据。</p>
<div class="figure" style="text-align: center">
<img src="images/01-dynamic-document.jpg" alt="根据 Shiny 输入动态生成 R Markdown 文档"  />
<p class="caption">
(#fig:dynamic-document)根据 Shiny 输入动态生成 R Markdown 文档
</p>
</div>
<p>图 @ref(fig:dynamic-document) 是一个结合 Shiny 动态生成 R Markdown 输出文档的例子。我们允许用户上传某个数据集，挑选需要数据清理的维度，随后把清理结果动态地传递给 <code>rmarkdonw::render</code>，生成右侧截图所示的输出文档。</p>
</div>
<div id="r-markdown-的渊源与历史" class="section level2" number="1.8">
<h2 number="1.8"><span class="header-section-number">1.8</span> R Markdown 的渊源与历史</h2>
<p>本节回顾了 R Markdown 在技术工具层面的渊源和它的发展历史。喜欢直接进入实际操作部分的读者可以跳过本节，从第 @ref(installation) 章开始。如果读者已经掌握了 R Markdown 的基础知识，书写过一些 R Markdown 的文档, 也可以直接开始阅读第 @ref(document) 章，了解定制不同输出格式的细节。</p>
<!--chapter:end:01-intro.Rmd-->
</div>
</div>
<div id="installation" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> 安装</h1>
<p>本章介绍安装 R Markdown 相关依赖包的方法，并编译第一个 R Markdown 源文档，输出为 HTML 和 PDF 两种格式。</p>
<div id="安装-r-markdown" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> 安装 R Markdown</h2>
<p>编译 R Markdown 文档需要安装 <strong>rmarkdown</strong> <span class="citation">(<a href="#ref-R-rmarkdown" role="doc-biblioref">Allaire, Xie, McPherson, et al. 2021</a>)</span> 包，在 RStudio 的控制台中运行</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>)</span></code></pre></div>
<p>后文经常谈到的 “R Markdown 如何如何” 泛指 rmarkdown 包及一系列相关工具的功能与使用，如果特指 <code>rmarkdown</code> 包的功能或函数，则用小写字母。</p>
<p>中国大陆的读者可能有下载速度过慢的问题，这时可以在 RStudio 的 <code>Tools --&gt; Global Options --&gt; Packages</code> 将 Primary Cran Repository 更改为国内的镜像。也可以在 <code>install.packages</code> 中设置 <code>repos</code> 参数。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>, <span class="at">repos =</span> <span class="sc">&lt;</span>镜像网址<span class="sc">&gt;</span>)</span></code></pre></div>
</div>
<div id="create-first-rmd" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> 创建第一个 R Markdown 文档</h2>
<p>安装完成后，我们可以开始创建第一个 R Markdown 文档。在 RStudio 中选择 <code>File --&gt; New File --&gt; R Markdown</code>, 弹出图 @ref(fig:rmd-prompt) 所示的提示框。</p>
<div class="figure" style="text-align: center">
<img src="images/02-first-rmd-prompt.png" alt="RStudio 创建 R Markdown 文档时的提示框" width="332" />
<p class="caption">
(#fig:rmd-prompt)RStudio 创建 R Markdown 文档时的提示框
</p>
</div>
<p>我们在窗口中可以提前设定输出文档的标题，作者和格式。这里，我们保留默认设置，点击 OK 即可。</p>
<p>随后，RStudio 编辑器内生成了如下内容：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;Untitled&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(echo = TRUE)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">## R Markdown</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <span class="ot">&lt;http://rmarkdown.rstudio.com&gt;</span>.</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cars}</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="in">summary(cars)</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Including Plots</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>You can also embed plots, for example:</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pressure, echo=FALSE}</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="in">plot(pressure)</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>Note that the <span class="in">`echo = FALSE`</span> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</span></code></pre></div>
<p>在编辑器内保存该文件，我们可以发现根目录下增加了 <code>first-rmd.Rmd</code> 文件，这种后缀为 <code>.Rmd</code> 的文件即是 R Markdown 的源文档。在源文件中，我们定义了 R Markdown 输出文件的形式和内容。本书后续章节对文本和代码的编辑以及日常使用均是围绕类似这样的源文档展开的。</p>
<p>点击源文档顶部的 <strong>Knit</strong> 按钮，RStudio 首先提示应保存源文档，读者可以在不更改 <code>.Rmd</code> 文件后缀的情况下任意选择保存名称, 但最好不要包含中文。保存后，R Markdown 包开始将源文档编译为输出。几秒后弹出以下界面说明编译成功，同时 R Markdown 包安装无误，可以开始快乐的写作了。</p>
<div class="figure" style="text-align: center">
<img src="examples/first-rmd.png" alt="first-rmd.Rmd 文件输出的 HTML 文档" width="350" />
<p class="caption">
(#fig:first-rmarkdown)first-rmd.Rmd 文件输出的 HTML 文档
</p>
</div>
<p>图 @ref(fig:first-rmarkdown) 为我们新创建的 <code>first-rmd.Rmd</code> 文件的 HTML 格式输出结果。此时，与该 R Markdown 源文件同级目录下也应该出现一个 <code>first-rmd.html</code> 文件，读者可以用浏览器打开该 HTML 验证是否与 RStudio 面板中输出的结果一致。</p>
<p>一些读者可能会疑惑，之前点击 Knit 时，为什么我们没有用 <code>library(rmarkdown)</code> 导入 <code>rmarkdown</code> 包，也没有在源文档中运行相关的函数，编译仍能成功呢？当我们点击 Knit 的时候，RStudio 自行调用了 rmarkdown 包中的 <code>render()</code> 函数。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一个参数为你保存的文件名</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">render</span>(<span class="st">&quot;first-rmd.Rmd&quot;</span>, <span class="at">output_format =</span> <span class="st">&quot;html_document&quot;</span>)</span></code></pre></div>
<p>读者不妨自己在控制台内运行一遍以上代码，看结果与点击 Knit 是否相同。<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div id="发布" class="section level3" number="2.2.1">
<h3 number="2.2.1"><span class="header-section-number">2.2.1</span> 发布</h3>
<p>我们在 @ref(rmd-notebook) 中提到了 RPubs, bookdown 等免费发布 R Markdown 文档的服务。得到 <code>fist-rmd.html</code> 后，我们就可以把它上传到这些平台上。以 RPubs 为例，首先需要在 <a href="https://rpubs.com/users/new" class="uri">https://rpubs.com/users/new</a> 注册账号。</p>
<p>在 RPubs 上创建好账号后，我们重新编译 <code>first.rmd</code> 源文档，点击源文档上方的 Knit 按钮，在编译成功后弹出窗口的右上角可以看到 <strong>Publish</strong> 按钮，点击后如图 @ref(fig:publish-button) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/02-publish-button.jpg" alt="编译成功后，点击弹出窗口右上角的 Publish 按钮"  />
<p class="caption">
(#fig:publish-button)编译成功后，点击弹出窗口右上角的 Publish 按钮
</p>
</div>
<p>对于 RPubs，我们无需在 RStudio 中额外关联账户，直接点击 Publish Document，随后选择 RPubs，浏览器弹出图 @ref(fig:rpubs-signin) 所示的登录界面。</p>
<div class="figure" style="text-align: center">
<img src="images/02-rpubs-signin.jpg" alt="点击发布后弹出 RPubs 登录界面"  />
<p class="caption">
(#fig:rpubs-signin)点击发布后弹出 RPubs 登录界面
</p>
</div>
<p>确认登陆后，我们可以选择发布文档的标题，描述和网址。随后，RPubs 部署 <code>first.html</code> 并生成指定的网址，例如 <a href="https://rpubs.com/Maxine/802744" class="uri">https://rpubs.com/Maxine/802744</a>。以上便是发布 R Markdown 输出文档的全过程，读者可以尝试类比发布到 bookdown 网站上。</p>
<p>除了在输出文档点击 Publish 外，我们还可以用 <strong>rsconnect</strong> 包提供的 API。源文档右上角也有一个发布按钮，如图 @ref(fig:src-publish) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/02-src-publish.png" alt="源文档中的发布按钮" width="326" />
<p class="caption">
(#fig:src-publish)源文档中的发布按钮
</p>
</div>
</div>
</div>
<div id="安装-tinytex" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> 安装 Tinytex</h2>
<p>对于需要生成 PDF 文档的读者，还需要安装 <strong>tinytex</strong> 包：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装 tinytex 包</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tinytex&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装 TinyTex 套件</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>tinytex<span class="sc">::</span><span class="fu">install_tinytex</span>()</span></code></pre></div>
<p>安装完成后，在 RStudio 中打开之前保存的 R Markdown 源文档，将第三行 <code>output_format: html_document</code> 更改为 <code>output_format: pdf_document</code>。点击 Knit 后，生成如下两页 PDF 文档，说明安装成功。</p>
<p><img src="images/02-first-rmd-pdf1.png" width="49%" /><img src="images/02-first-rmd-pdf2.png" width="49%" /></p>
<p>如果 TinyTeX 下载速度较慢或者下载失败，读者可以先在 <a href="https://github.com/yihui/tinytex-releases/releases">Github</a> 上下载对应的压缩包，然后用 <code>install_prebuilt</code> 安装该文件，例如：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tinytex<span class="sc">:::</span><span class="fu">install_prebuilt</span>(<span class="st">&#39;~/Downloads/TinyTeX-v2021.01.zip&#39;</span>)</span></code></pre></div>
<p>熟悉 LaTeX 的用户可能会好奇 TinyTeX 的工作机制。TinyTeX 是一个基于 TeX Live 的自定义轻量级 LaTeX 套件，特别为 R Markdown 用户设计了许多定制化的 PDF 编译功能。例如，它可以自动安装编译过程中缺少的宏包。大部分情况下，我们不需要直接使用 TinyTeX 包，R Markdown 已经与之高度集成。此外，建议在安装 TinyTeX 之前卸载系统中已有的 LaTeX 套件，例如 Tex Live，MiKTeX，Mac—TeX 等，否则可能产生冲突。更多信息请参照<a href="https://yihui.org/tinytex/cn/">文档</a>。</p>
</div>
<div id="使用-rstudio-项目文件" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> 使用 RStudio 项目文件</h2>
<p>最后，我们暂且从 R Markdown 的内容脱离出来，讨论一个学习 R 的 “最佳实践”。它不是必需的，但在大多数情况下可以为我们自己和他人带来更多便利。</p>
<p>读者学习 R Markdown 的过程中，可能会用到许多文件记录学习过程，例如 R Markdown 自己的文档，R 的代码脚本，图片和其他笔记文件等等。我们推荐使用 RStudio 自带的项目功能管理相关的文件。可以通过菜单栏中的 <code>File --&gt; New Project</code> 创建新项目，此时 RStudio 会在选定的根目录下生成一个后缀为 <code>.Rproj</code> 的文件，我们可以在该目录创建不同的文件夹记录学习过程。下次启动项目时，只需要通过 RStudio 编辑器右上角下拉菜单内的 Open Project 选项加载该 <code>.Rproj</code> 文件，或者直接双击该文件并使用 RStudio 打开。一个使用项目文件的好处是，我们可以在一个固定的根目录内使用相对路径引用各种文件资源。例如，我们可能有下面的文件结构：</p>
<pre><code>ch1
  - first-rmd.Rmd
  - second-rmd.Rmd
ch2
  - third-rmd.Rmd
scripts
  - utils.R
images
  - my-picture.png
...
learn-rmarkdown.Rproj</code></pre>
<p>此时，如果需要在 <code>ch1</code> 文件夹中的 <code>first-rmd.Rmd</code> 中引用 <code>images</code> 文件夹中的 my-picture.png ，可以使用相对路径 <code>../images/my-picture.png</code>。无论后续我们在 images 中添加多少文件，都只需要在相对路径中改变图片的名称。同理，读写数据等的 I/O 操作也只需要使用相对于 <code>.Rproj</code> 根目录的相对路径。一些读者可能习惯使用 <code>setwd()</code> 解决类似的问题，但它往往导致他人难以重复使用的绝对路径。</p>
<p>除易于启动和路径引用上的好处外，RStudio 项目内还有更好的快捷键支持，读者可用 Alt+Shift+K 浏览全部项目快捷键。博客 <a href="https://www.tidyverse.org/blog/2017/12/workflow-vs-script/">Project-oriented workflow</a>更深入讨论了使用项目或脚本方式的优劣。</p>
<!--chapter:end:02-installation.Rmd-->
</div>
</div>
<div id="rmarkdown-basics" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> 基础知识</h1>
<p>本章介绍使用 R Markdown 写作的必要基础知识。首先，我们简要介绍 R Markdown 的编译过程，了解 Knit 按钮为我们代劳的细节。随后，重点讲述了 R Markdown 文档的三种基本元素，包括：</p>
<ul>
<li><p>用 YAML 头部设定输出格式和其他文档选项</p></li>
<li><p>用 Markdown 标记语言为纯文本赋予格式</p></li>
<li><p>插入并运行不同编程语言的代码块</p></li>
</ul>
<p>最后。我们用案例研究展示了如何运用 R Markdown 作为 SQL，Python 和 R 共存的数据分析环境。</p>
<div id="r-markdown-的编译过程" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> R Markdown 的编译过程</h2>
<p>在 @ref(create-first-rmd) 节中，我们编译了 <code>first-rmd.Rmd</code> 源文档，生成了对应的网页输出结果。点击 <code>Knit</code> 按钮后，R 启动一个新的进程，依次执行需要运行的代码块，对源文档添加适当的格式，最终生成指定格式的输出文档，这便是 R Markdown 的编译过程。 我们提到，<code>Knit</code> 是对 rmarkdown 包中 <code>render()</code> 函数的封装。因此，理解 R Markdown 的编译就是理解 <code>render()</code> 调用了什么方法工具完成文档格式的转换。</p>
<p>直接给出答案之前，我们不妨先观察 <code>first-rmd.Rmd</code> 和 <code>first-rmd.html</code> HTML 文件的差异 (图 @ref(fig:first-rmarkdown))，看看 <code>render()</code> 需要为我们做怎样的转换工作。</p>
<p>首先，我们再次观察源文档 <code>first-rmd.Rmd</code> 最顶部由 <code>---</code> 包围的部分:</p>
<pre><code>---
title: &quot;Untitled&quot;
output: html_document
---</code></pre>
<p>这样的部分在 R Markdown 中称为 YAML 头部。YAML 是一种简单的标记语言，可以用键值对 (key-value pairs) 表示配置文件。读者可能会猜到，YAML 头部以元数据的形式参与到了 R Markdown 的编译中。最直接地，<code>title</code> 的对应值 <code>"Untitled"</code> 是 <code>first-rmd.html</code> 的第一行对应的标题。类似的键包括 <code>author</code> (作者), <code>date</code> (日期), <code>subtitle</code> (副标题), <code>abstract</code> (摘要) 等，添加这些键后，R Markdown 会将它们对应的值添加到文档中。</p>
<p><code>output</code> 的对应值 <code>html_document</code> 则告诉 R Markdown 我们希望源文档转换至的格式是 HTML。举一反三，如果第二行更改为 <code>output: pdf_document</code>，R Markdown 就会生成对应的 PDF 文档。</p>
<p>这样看来，YAML 头部就是设置了一些 R Markdown 编译的全局参数，每一行控制一个编译中的参数设定。</p>
<p>下面，我们观察输出文档中的文本格式。读者可以用任意文本编辑器打开<code>first-rmd.html</code>，略过一大段 <code>script</code> 脚本引用后，可以发现如下所示的代码片段，即该 HTML 文件的文本主体。由于文件内代码较多，建议直接搜索 <code>This is an R Markdown document</code> 定位到相应片段。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;r-markdown&quot;</span><span class="ot"> class=</span><span class="st">&quot;section level2&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;h2&gt;</span>R Markdown<span class="kw">&lt;/h2&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://rmarkdown.rstudio.com&quot;</span><span class="ot"> class=</span><span class="st">&quot;uri&quot;</span><span class="kw">&gt;</span>http://rmarkdown.rstudio.com<span class="kw">&lt;/a&gt;</span>.<span class="kw">&lt;/p&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>When you click the <span class="kw">&lt;strong&gt;</span>Knit<span class="kw">&lt;/strong&gt;</span> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:<span class="kw">&lt;/p&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span><span class="ot"> class=</span><span class="st">&quot;r&quot;</span><span class="kw">&gt;&lt;code&gt;</span>summary(cars)<span class="kw">&lt;/code&gt;&lt;/pre&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre&gt;&lt;code&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>##      speed           dist       </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>##  Min.   : 4.0   Min.   :  2.00  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>##  1st Qu.:12.0   1st Qu.: 26.00  </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>##  Median :15.0   Median : 36.00  </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>##  Mean   :15.4   Mean   : 42.98  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>##  3rd Qu.:19.0   3rd Qu.: 56.00  </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>##  Max.   :25.0   Max.   :120.00</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/code&gt;&lt;/pre&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;including-plots&quot;</span><span class="ot"> class=</span><span class="st">&quot;section level2&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;h2&gt;</span>Including Plots<span class="kw">&lt;/h2&gt;</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>You can also embed plots, for example:<span class="kw">&lt;/p&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;&lt;img</span><span class="ot"> src=</span><span class="st">&quot;某个很长的路径&quot;</span><span class="ot"> width=</span><span class="st">&quot;672&quot;</span> <span class="kw">/&gt;&lt;/p&gt;</span> </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>Note that the <span class="kw">&lt;code&gt;</span>echo = FALSE<span class="kw">&lt;/code&gt;</span> parameter was added to the code chunk to prevent printing of the R code that generated the plot.<span class="kw">&lt;/p&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>不难发现，上面的代码块与源文档 <code>first-rmd.Rmd</code> 之间存在明确的文本对应关系。例如，在 R Markdown 文档 <code>## R Markdown</code> 后的前两个段落中，我们有：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <span class="ot">&lt;http://rmarkdown.rstudio.com&gt;</span>.</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</span></code></pre></div>
<p>在 HTML 文件中对应的段落为：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://rmarkdown.rstudio.com&quot;</span><span class="ot"> class=</span><span class="st">&quot;uri&quot;</span><span class="kw">&gt;</span>http://rmarkdown.rstudio.com<span class="kw">&lt;/a&gt;</span>.<span class="kw">&lt;/p&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;p&gt;</span>When you click the <span class="kw">&lt;strong&gt;</span>Knit<span class="kw">&lt;/strong&gt;</span> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:<span class="kw">&lt;/p&gt;</span></span></code></pre></div>
<p>我们注意到，HTML 文件中的文本并不是照搬 R Markdown 文件，而是做了相应的替换。最显著的变化是，HTML 文件在两个段落的前后分别添加了 <code>&lt;p&gt;</code> 标签，这在 HTML 语法中表示一个单独的段落，而 R Markdown 文件中只在两个段落之间添加了空行，没有做其他额外标识。再例如， R Markdown 中的 <code>**Knit**</code> 在 HTML 中变成了 <code>&lt;strong&gt;Knit&lt;/strong&gt;</code>, <code>*</code> 号变为在 HTML 中标识粗体的 <code>&lt;strong&gt;</code> 标签。对 PDF 编译感兴趣的读者如果查看输出的 <code>.tex</code> 文件，会发现 <code>**Knit**</code> 被转换为了 <code>\textbf{Knit}</code>，即 TeX 中粗体的表示方法。</p>
<p>这说明，R Markdown 的编译机制中存在某个对纯文本的解析过程，它能将源文档中的特殊符号翻译为输出文档中对应格式的表达方法。正是因为我们可以选择如此多样的输出选择，我们才需要在源文档中使用一个统一格式表达方法作为中介，在源文档中告诉 R Markdown “这里需要一个粗体，这里添加下划线，这里是一段引用”，至于这些格式具体在未知的输出格式中如何表现，就由 R Markdown 在最终的编译中决定了。</p>
<p>最后，我们研究 R Markdown 中代码的运行。以第一段代码 <code>summary(cars)</code> 为例，在 R Markdown 源文档中，插入该段代码的语法为：</p>
<pre><code>```{r}
summary(cars)
```</code></pre>
<p>其中，开头的<code>```{r}</code> 和末尾的三个 <code>```</code> 反引号是特殊的标识符，让 R Markdown 在编译时能区分哪段是文本，哪段是需要运行的代码。读者可能在源文档中注意到 RStudio 为这样的代码块提供了高亮支持，这说明 ```<code>{r}</code> 对 R Markdown 而言有特殊意义，不是一般的文本符号。当 R Markdown 发现了这样符号定义的代码之后，编译机制就能在适当时候调用相应编程语言的引擎（例如 R）并保存它们的输出结果，转换为相应的格式，最终在 HTML 中体现为：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre&gt;&lt;code&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>##      speed           dist       </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>##  Min.   : 4.0   Min.   :  2.00  </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>##  1st Qu.:12.0   1st Qu.: 26.00  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>##  Median :15.0   Median : 36.00  </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>##  Mean   :15.4   Mean   : 42.98  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>##  3rd Qu.:19.0   3rd Qu.: 56.00  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>##  Max.   :25.0   Max.   :120.00</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/code&gt;&lt;/pre&gt;</span></span></code></pre></div>
<p>同理，当下一个代码块 <code>plot(pressure)</code> 的输出结果是图片时，R Markdown 也能自动地运用 HTML 标准中对应的 <code>&lt;img&gt;</code> 标签。读者还可能发现该段代码没有出现在 HTML 网页中，只有生成的图片被留了下来。这是因为我们在 <code>```{r}</code> 中制定了 <code>echo = FALSE</code> 选项，它告诉 R Markdown 仅保留该段代码的输出结果，而隐藏代码本身。本书的后续章节将介绍更多类似的代码块选项，进一步定制 R Markdown 文档的输出。</p>
<p>通过以上观察，我们可以总结出 R Markdown 编译中的三个主要工作：</p>
<ul>
<li><p>读取 YAML 头部，统领编译的全局设定</p></li>
<li><p>解析源文档中的符号标记，翻译为输出文档中的格式表达方法</p></li>
<li><p>提取并运行代码块，将代码的运行结果按顺序插入到正常文档流中</p></li>
</ul>
<p>图 @ref(fig:knit-process) 概括了 R Markdown 完成以上工作的流程。</p>
<div class="figure" style="text-align: center">
<img src="images/03-knit-process.png" alt="R Markdown 的编译过程 https://bookdown.org/yihui/rmarkdown-cookbook/rmarkdown-process.html" width="777" />
<p class="caption">
(#fig:knit-process)R Markdown 的编译过程 <a href="https://bookdown.org/yihui/rmarkdown-cookbook/rmarkdown-process.html" class="uri">https://bookdown.org/yihui/rmarkdown-cookbook/rmarkdown-process.html</a>
</p>
</div>
<p>首先，<strong>knitr</strong> 包 <span class="citation">(<a href="#ref-R-knitr" role="doc-biblioref">Xie 2021b</a>)</span> 将 <code>.Rmd</code> 源文档转换为 <code>.md</code> 文件。早在 R Markdown 诞生之前，knitr 包就承担了自动化生成 R 语言报告的功能。在 R Markdown 的编译中，knitr 的最主要工作是提取和运行 <code>.Rmd</code> 中的代码，并将返还的文字或图片等结果置于合适的位置。我们之前笼统说的 “R Markdown 运行代码” 实质上就是 knitr 的工作。同时，knitr 还会读取部分 YAML 头部数据，并确保我们在源文档中使用的标记符号适于下一步的格式转换。这一步结束后，knitr 生成了临时性的 <code>.md</code> 文件。例如，<code>first-rmd.Rmd</code> 被转换为 <code>first-rmd.md</code>。<code>.md</code> 被称为 Markdown 文件，我们在 <code>.Rmd</code> 中的格式标记即是 Markdown 标记语言确定的标准，在 @ref(markdown-syntax) 中作进一步介绍。</p>
<p>随后，<strong>Pandoc</strong> 软件负责下一步的转换。Pandoc 是一个开源的命令行程序，可以完成多种文档格式之间的互相转换，已经随 RStudio 下载安装好。这里，R Markdown 将 <code>.md</code> 文件 转换为 YAML 头部中 <code>output</code> 对应的输出格式。Pandoc 还读取了其他 YAML 头部中的设定，一些被插入文档内容 (如 <code>title</code>)，另一些选项则作为命令行参数，对转换过程做特定的控制。我们可以验证 Pandoc 的存在和版本：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">pandoc_available</span>()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] TRUE</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>rmarkdown<span class="sc">::</span><span class="fu">pandoc_version</span>()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &#39;2.11.4&#39;</span></span></code></pre></div>
<p>作为总结，对于 HTML 格式，<code>rmarkdown::render</code> = <code>knitr + Pandoc</code>。 PDF 输出格式还有额外的一步： tinytex 包或其他 LaTeX 发行版编译 Pandoc 生成的 <code>.tex</code> 文件，生成 PDF 文档。</p>
<p>本节对编译过程的简介意在让读者对 knitr 和 Pandoc 工具有基础认识。实际写作中，我们几乎从不需要在底层与 knitr 或 Pandoc 做直接交互，而是 <code>.Rmd</code> 文档中发出这些指令。但理解它们在 R Markdown 编译中的角色有利于在编译失败时排错，和掌握更进阶的排版技巧。</p>
</div>
<div id="r-markdown-的基本元素" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> R Markdown 的基本元素</h2>
<p>上一节中，我们接触到 R Markdown 编译过程中的三个主要工作，它们分别对应了 R Markdown 的三个基本元素：</p>
<ul>
<li><p>YAML 头部: 控制 Pandoc 的格式转换参数</p></li>
<li><p>Markdown 文本: 添加排版格式</p></li>
<li><p>代码: 运行并保存输出结果</p></li>
</ul>
<p>我们可以把 R Markdown 文档想象为从上到下的一系列章节，如图 @ref(fig:document-flow)。YAML 元数据位于头部，确定了文档的输出和元数据。标题之后是正文的各个章节，每个章节包含任意 Markdown 文字和代码块，还可能有类似的子章节。</p>
<div class="figure" style="text-align: center">
<img src="images/03-document-flow.png" alt="R Markdown 文档示例" width="254" />
<p class="caption">
(#fig:document-flow)R Markdown 文档示例
</p>
</div>
<p>下面，我们对它们做逐一介绍。</p>
</div>
<div id="yaml-头部" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> YAML 头部</h2>
<p>YAML 元数据一般位于 R Markdown 文档的开头，前后各用三个减号作为分隔标志。最重要的一个域是 <code>output</code> 所指定的输出格式，我们在下一个小节集中介绍相关知识。这里介绍除输出格式之外的三个常见选项，<code>title</code>, <code>author</code> 和 <code>date</code>，它们的值将直接被插入输出为文档。</p>
<p><code>title</code> 设定了输出文档的顶级标题。标题一般不宜过长，更多的描述文字可以考虑放在 <code>subtitle</code>, <code>abstract</code> 等中。还要注意的是，YAML 不要求为字符串添加引号。但如果字符串中包含空格或特殊字符，就需要放在双引号或单引号中。推荐涉及中文字符时总是使用引号，例如：</p>
<pre><code>title: &#39;bookdown: 用 R Markdown 撰写书籍和技术文档&#39;</code></pre>
<p><code>author</code> 设定文档的作者信息。需要插入多个作者时，我们可以使用 YAML 中的复合结构，如：</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> 张三</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> 李四</span></span></code></pre></div>
<p>YAML 中，我们用两个空格表示层级关系，<code>-</code> 是数组元素的标记。上面的标记表明 <code>author</code> 的值是一个有两个元素的数组，分别为“张三”和“李四”。在 R 中可以表示为：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>, <span class="st">&quot;李四&quot;</span>)</span></code></pre></div>
<p><code>date</code>: 设定文档的日期信息。在 @ref(r-code) 中，我们将学习如何自动更新日期为源文档的编译时间。</p>
<p>除了字符串和数组外，YAML 还支持数值型, 布尔 (<code>true</code> 和 <code>false</code>) 以及更复杂的数据结构。例如，在 <strong>distill</strong> <span class="citation">(<a href="#ref-R-distill" role="doc-biblioref">Allaire, Iannone, et al. 2021</a>)</span> 包的 <code>distill_article</code> 输出格式中，<code>author</code> 支持 YAML 里的字典结构，与 R 中的列表类似，可以为作者添加更多个人信息：</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">author</span><span class="kw">:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;张三&quot;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://zhangsan.com</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">affiliation</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;某大学&quot;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">affiliation_url</span><span class="kw">:</span><span class="at"> https://example.com</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;李四&quot;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">url</span><span class="kw">:</span><span class="at"> https://lisi.com</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">affiliation</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;某公司&quot;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">affilication_url</span><span class="kw">:</span><span class="at"> https://example.com</span></span></code></pre></div>
<p>上面的表达式等价于 R 中的：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;张三&quot;</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">&quot;https://zhangsan.com&quot;</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">affilication =</span> <span class="st">&quot;某大学&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">affilication_url =</span> <span class="st">&quot;https://example.com&quot;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  ), </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;李四&quot;</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">url =</span> <span class="st">&quot;https://lisi.com&quot;</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">affilication =</span> <span class="st">&quot;某公司&quot;</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">affilication_url =</span> <span class="st">&quot;https://example.com&quot;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>读者对 YAML 语法不熟悉时，可以安装 <a href="https://github.com/r-lib/ymlthis">ymlthis</a> 包，它会提供一个在 R Markdown 中插入 YAML 数据的图形化界面，可以在 RStudio 的 <code>Tools --&gt; Addins --&gt; Browse Addins</code> 中找到。启动后如图 @ref(fig:ymlthis) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/03-ymlthis.jpg" alt="ymlthis 包提供图形化输入 YAML 元数据的插件"  />
<p class="caption">
(#fig:ymlthis)ymlthis 包提供图形化输入 YAML 元数据的插件
</p>
</div>
<div id="输出格式" class="section level3" number="3.3.1">
<h3 number="3.3.1"><span class="header-section-number">3.3.1</span> 输出格式</h3>
<p>输出格式 <code>output</code> 是 YAML 中最重要的元数据之一，它决定了 Pandoc 如何转换 knitr 生成的 <code>.md</code> 文档，默认为 <code>html_document</code>。我们可以用相同的缩进设置多个输出格式，每个输出格式后还可以继续设置该格式的参数，例如：</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc_float</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">code_folding</span><span class="kw">:</span><span class="at"> hide</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">pdf_document</span><span class="kw">:</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">toc</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">number_sections</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">keep_tex</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">latex_engine</span><span class="kw">:</span><span class="at"> xelatex</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="at">  tufte:</span><span class="fu">:tufte_handout</span><span class="kw">:</span><span class="at"> default</span></span></code></pre></div>
<p>上面的文档有三种可选的输出格式，<code>html_document</code>，<code>pdf_document</code> 和 <code>tufte_html</code>。</p>
<p>在 <code>html_document</code> 格式中，我们用 <code>toc: true</code> 指定自动生成目录, <code>toc_float: true</code> 设置目录的显示方式为浮动侧边栏 (默认标题会固定在正式文字内容之前), <code>code_folding: hide</code> 可以折叠所有代码块，但读者可以在每个代码块右上角的选项卡展开内容，这是一个 HTML 输出格式特有的选项。<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>在 <code>pdf_document</code> 格式中，我们同样设置了生成目录，<code>number_sections: true</code> 自动生成章节编号，<code>keep_tex: true</code> 保留 Pandoc 生成的 <code>.tex</code> 文件。<code>latex_engine: xelatex</code> 设置编译引擎为 XeLaTeX (默认为 pdflatex), 引擎设置对正确显示中文字体非常重要。</p>
<p>第三种格式 <code>tufte::tufte_handout</code> 在一般 PDF 输出中定义了更多格式，模仿了统计学家 Edward Tufte 以及物理学家费曼的教科书的风格，它的一个显著特点就是边栏的使用，例如脚注和边栏注解，以及放在边栏里的小型插图。在 <code>output</code> 中，它的应用方式与前两种不同。这是因为 <code>html_document</code> 和 <code>pdf_document</code>是 rmarkdown 包内的输出格式，而 <code>tufte_html</code> 是 tufte 包提供的。这样不在 rmarkdown 包的输出格式需要在前面加上 <code>::</code> 表明它们的来源。例如我们想使用 bookdown 包提供的 <code>html_document2</code> 输出格式，引用方法为 <code>output: bookdown::html_document2</code>。<code>default</code> 表示该输出格式完全使用默认设置。应用多个输出格式时， 即便没有细节设置也必须有 default 指定。</p>
<p>有多个输出格式时，我们可以点击 Knit 的下拉按钮选择任意一种格式编译 (图 @ref(fig:multi-outputs))。编译快捷键 <code>Ctrl+Shift+K</code> 会使用最近一次编译的输出格式。</p>
<div class="figure" style="text-align: center">
<img src="images/03-multi-outputs.jpg" alt="Knit 选项提供多个输出格式"  />
<p class="caption">
(#fig:multi-outputs)Knit 选项提供多个输出格式
</p>
</div>
<p>图 @ref(fig:tufte-handout) 截取了部分 <code>tufte::tufte_handout</code> 的 PDF 输出文档。</p>
<div class="figure" style="text-align: center">
<img src="images/03-tufte.jpg" alt="tufte_handout 输出的 PDF 文档"  />
<p class="caption">
(#fig:tufte-handout)tufte_handout 输出的 PDF 文档
</p>
</div>
<p>R Markdown 也支持输出 MS Word 文档，在输出中指定 <code>output: word_document</code>，读者可以在第 @ref(word) 章了解更多输出 Word 文档的知识。</p>
</div>
<div id="总结" class="section level3" number="3.3.2">
<h3 number="3.3.2"><span class="header-section-number">3.3.2</span> 总结</h3>
<p>最后，我们再用一个例子总结并扩展 YAML 元数据的相关知识。源文档为</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &#39;常用 YAML 选项&#39;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> &quot;2020-08-16&quot;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">  - 张三</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">  - 李四</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">  rticles::ctex:</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> &#39;以 PDF 输出为例&#39;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="an">keywords:</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">  - 中文</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - R Markdown</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> &gt;</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">  统计之都（Capital of Statistics, COS）论坛是一个自由探讨统计学和数据科学的平台。</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">  欢迎对统计学、机器学习、数据分析、统计软件、可视化等领域感兴趣的朋友在此交流切磋。</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">  首次使用论坛请阅读新手须知。</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="an">fontsize:</span><span class="co"> &quot;10pt&quot;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="an">papersize:</span><span class="co"> &quot;a5&quot;</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="an">geometry:</span><span class="co"> &quot;margin=1in&quot;</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="an">biblio-title:</span><span class="co"> 参考文献</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> skeleton.bib</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="an">link-citations:</span><span class="co"> yes</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="an">documentclass:</span><span class="co"> ctexart</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第一部分</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>张三写的。</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第二部分</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>李四写的。</span></code></pre></div>
<ul>
<li><p><code>title</code>, <code>author</code>, <code>date</code> 是三项基础元数据，建议在任何 R Markdown 文档中都添加它们。<code>subtitle</code>, <code>abstract</code>, <code>keywords</code> (关键字) 等选项在文档中插入对应的文字内容。这里的 <code>&gt;</code> 可以让多行的字符穿在输出中按一行输出，起到相反作用的是 <code>|</code> 号，它保留字符穿中的换行符。</p></li>
<li><p>我们可以用 <code>-</code> 使用数组乃至更复杂的 YAML 数据结构。</p></li>
<li><p><code>output</code> 可以接受一个数组指定多种输出格式，rmarkdown 包之外的输出格式需要 <code>::</code> 引用。这里我们只有 <code>rticles::ctex</code> 一种格式，并进一步设置了它的目录选项 <code>toc</code>。</p></li>
<li><p><code>fontsize</code>, <code>papersize</code>, <code>geometry</code>, <code>biblio-title</code>, <code>bibliography</code>,<code>link-citations</code>, <code>documentclass</code> 等是所有涉及 PDF 输出格式的通用选项，所以它们不是写在某个输出格式下面，而是顶级的元数据。类似这样的选项还有很多，读者可以在需要时自行搜索他们的用法。非 PDF 输出格式则会无视它们。</p></li>
</ul>
<p>输出结果如 @ref(fig:yaml-review) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/03-yaml-test.jpg" alt="YAML 元数据对应的 PDF 输出"  />
<p class="caption">
(#fig:yaml-review)YAML 元数据对应的 PDF 输出
</p>
</div>
</div>
</div>
<div id="markdown-syntax" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Markdown 语法</h2>
<p>Markdown 由 John Gruber 于 2004 年创建，以易读，可移植，跨平台等优势成为技术写作中最受欢迎的标记语言之一。在 R Markdown 之外，我们能发现 Markdown 更广泛的应用，例如记笔记，撰写技术文档，创作演示文稿，设计网站主题等。</p>
<p>R Markdown 输出文档中的文字排版是通过 Markdown 标记语言实现的。借助 Markdown，我们可以在纯文本文档中用特殊的标记符号表示格式，例如用井号表示标题，用星号表示加粗等。这样的统一中介使我们不必为某一个特定的输出格式设置格式。</p>
<div id="简单段内格式" class="section level3" number="3.4.1">
<h3 number="3.4.1"><span class="header-section-number">3.4.1</span> 简单段内格式</h3>
<p>Markdown 提供了很多简单的段内格式化 (inline formatting) 方法，一些基础的格式列举如下：</p>
<ul>
<li><p>粗体: 前后各添加两个星号 <code>**</code>。如 <code>**加粗**</code> 在输出文档中变为 <strong>加粗</strong></p></li>
<li><p>斜体：前后各添加一个星号 <code>*</code>。如 <code>*斜体*</code> 变为 <em>斜体</em></p></li>
<li><p>代码样式: 前后各添加一个反引号 <code>`</code>。如 <code>`代码`</code> 变为 <code>代码</code>。如果内容本身有反引号，可以在两边添加同等数量的反引号，如 <code>``x``</code> 变为 <code>`x`</code></p></li>
</ul>
</div>
<div id="换行" class="section level3" number="3.4.2">
<h3 number="3.4.2"><span class="header-section-number">3.4.2</span> 换行</h3>
<p>控制换行经常是 Markdown 中最容易困惑新手的部分。作为纯文本格式，Markdown 并非“所见即所得”的，我们可以在源文档中用回车换行，但无法在输出中看到两个段落。例如：</p>
<pre><code>文王拘而演《周易》,
仲尼厄而作《春秋》</code></pre>
<p>生成：</p>
<p>文王拘而演《周易》,
仲尼厄而作《春秋》</p>
<p>要在 Markdown 中换行，需在上一段的末尾添加两个或以上空格。例如：</p>
<pre><code>R is a free software environment for statistical computing and graphics.  
It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS. </code></pre>
<p>生成:</p>
<p>R is a free software environment for statistical computing and graphics.<br />
It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS.</p>
<p>更简单的办法是在两行间添加一个空行：</p>
<pre><code>R is a free software environment for statistical computing and graphics.

It compiles and runs on a wide variety of UNIX platforms, Windows and MacOS. </code></pre>
</div>
<div id="段落格式" class="section level3" number="3.4.3">
<h3 number="3.4.3"><span class="header-section-number">3.4.3</span> 段落格式</h3>
<p>段落级别 (block-level) 的格式用于创建具有特定格式的整个段落。除了常规文本外，常见的段落元素包括标题，列表，块引用，代码块等。</p>
<div id="标题" class="section level4" number="3.4.3.1">
<h4 number="3.4.3.1"><span class="header-section-number">3.4.3.1</span> 标题</h4>
<p>用引号 <code>#</code> 创建不同层级的标题，引号的数量表示标题的层级。如 <code># 一级标题</code> 创建一级标题，<code>## 二级标题</code> 创建二级标题，<code>### 三级标题</code> 创建三级标题等。注意在井号和标题文字之间要保留一个空格。</p>
</div>
<div id="列表" class="section level4" number="3.4.3.2">
<h4 number="3.4.3.2"><span class="header-section-number">3.4.3.2</span> 列表</h4>
<p>在列表项之前添加减号 <code>-</code> 或星号 <code>*</code> 以创建列表，同样注意文字前的空格。缩进一个或多个列表项可创建嵌套列表。</p>
<pre><code>- First 
- Second
- Third 
    - Indented
    - Indented
- Fourth item</code></pre>
<p>显示为：</p>
<ul>
<li>First</li>
<li>Second</li>
<li>Third
<ul>
<li>Indented</li>
<li>Indented</li>
</ul></li>
<li>Fourth item</li>
</ul>
<p>我们还可以用数字编号创建有序列表，与上面的无序列表结合使用，如：</p>
<pre><code>1. 第一
2. 第二
  - 首先
  - 其次
3. 第三</code></pre>
<p>显示为</p>
<ol style="list-style-type: decimal">
<li>第一</li>
<li>第二</li>
</ol>
<ul>
<li>首先</li>
<li>其次</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>第三</li>
</ol>
</div>
<div id="块引用" class="section level4" number="3.4.3.3">
<h4 number="3.4.3.3"><span class="header-section-number">3.4.3.3</span> 块引用</h4>
<p>用大于号 <code>&gt;</code> 创建一个块引用 (blockquote)</p>
<pre><code>&gt; 生活是很枯燥的。我的一生就是力求不要在平庸中虚度光阴。这些小小的案件让我遂了心愿。</code></pre>
<p>在输出文档中渲染为：</p>
<blockquote>
<p>生活是很枯燥的。我的一生就是力求不要在平庸中虚度光阴。这些小小的案件让我遂了心愿。</p>
</blockquote>
</div>
</div>
<div id="代码块" class="section level3" number="3.4.4">
<h3 number="3.4.4"><span class="header-section-number">3.4.4</span> 代码块</h3>
<p>在文字前后各添加三个反引号 <code>```</code> 可以创建一个代码块，如：</p>
<pre><code>```
x &lt;- list(a = 1:10, 
          beta = exp(-3:3), 
          logic = c(TRUE,FALSE,FALSE,TRUE))
          
# 计算每个列表元素的均值
lapply(x, mean)
```</code></pre>
<p>显示为：</p>
<pre><code>x &lt;- list(a = 1:10, 
          beta = exp(-3:3), 
          logic = c(TRUE,FALSE,FALSE,TRUE))
          
# 计算每个列表元素的均值
lapply(x, mean)</code></pre>
<p>在一些语法高亮库的支持下，我们可以在反引号后注明代码块的语言，提供更好的代码高亮支持，以相同的代码块为例：</p>
<pre><code>```r
x &lt;- list(a = 1:10, 
          beta = exp(-3:3), 
          logic = c(TRUE,FALSE,FALSE,TRUE))
          
# 计算每个列表元素的均值
lapply(x, mean)
```</code></pre>
<p>显示为：</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">beta =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">3</span>), </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">logic =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>,<span class="cn">FALSE</span>,<span class="cn">FALSE</span>,<span class="cn">TRUE</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算每个列表元素的均值</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(x, mean)</span></code></pre></div>
<p>请注意这里的代码块只是有特殊格式的文字块，不同于 @ref(r-code) 节中用 <code>```{r}</code> 和 <code>```</code> 插入的真正可运行的代码，我们也无法在输出文档中得到它们的运行结果。</p>
</div>
<div id="链接" class="section level3" number="3.4.5">
<h3 number="3.4.5"><span class="header-section-number">3.4.5</span> 链接</h3>
<p>用 <code>&lt;链接地址&gt;</code> 插入一个可点击的链接，如 <code>&lt;https://example.com&gt;</code> 显示为 <a href="https://example.com" class="uri">https://example.com</a>。</p>
<p>我们还可以创建一个带显示文字的行内链接，方括号内插入描述性文字，圆括号内插入链接目的地，格式为：</p>
<pre><code>[显示文字](网页链接)</code></pre>
<p>例如，<code>[R Markdown 权威指南](https://bookdown.org/yihui/rmarkdown/)</code> 显示为 <a href="https://bookdown.org/yihui/rmarkdown/">R Markdown 权威指南</a>。</p>
</div>
<div id="图片" class="section level3" number="3.4.6">
<h3 number="3.4.6"><span class="header-section-number">3.4.6</span> 图片</h3>
<p>插入图片的语法与行内链接近似，只需要在前面多添加一个感叹号, 如<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<pre><code>![替代文字](图片链接)</code></pre>
<p>例如, 我们用 <code>![R logo](https://www.r-project.org/Rlogo.png)</code> 插入以下图片：</p>
<div class="center-container">
<div class="figure">
<img src="https://www.r-project.org/Rlogo.png" alt="" />
<p class="caption">R logo</p>
</div>
</div>
</div>
<div id="表格" class="section level3" number="3.4.7">
<h3 number="3.4.7"><span class="header-section-number">3.4.7</span> 表格</h3>
<p>Markdown 还支持插入表格，语法如下</p>
<pre><code>| 元素 | Markdown |
| - | - | 
| 块引用 | `&gt; some quotes` |
| 代码块 | ``` some code  ```  |</code></pre>
<p>渲染为</p>
<table>
<thead>
<tr class="header">
<th>元素</th>
<th>Markdown</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>块引用</td>
<td><code>&gt; some quotes</code></td>
</tr>
<tr class="even">
<td>代码块</td>
<td><code>some code</code></td>
</tr>
</tbody>
</table>
<p>不过对于 R Markdown 用户，直接使用表格语法通常是不必要的。knitr 中的 <code>kable()</code> 函数提供了更完善的表格功能，如表 @ref(kable-example) 所示。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(iris))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
<th align="right">Petal.Length</th>
<th align="right">Petal.Width</th>
<th align="left">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">5.1</td>
<td align="right">3.5</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">3.0</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">4.7</td>
<td align="right">3.2</td>
<td align="right">1.3</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">4.6</td>
<td align="right">3.1</td>
<td align="right">1.5</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="odd">
<td align="right">5.0</td>
<td align="right">3.6</td>
<td align="right">1.4</td>
<td align="right">0.2</td>
<td align="left">setosa</td>
</tr>
<tr class="even">
<td align="right">5.4</td>
<td align="right">3.9</td>
<td align="right">1.7</td>
<td align="right">0.4</td>
<td align="left">setosa</td>
</tr>
</tbody>
</table>
</div>
<div id="总结-1" class="section level3" number="3.4.8">
<h3 number="3.4.8"><span class="header-section-number">3.4.8</span> 总结</h3>
<p>表 @ref(tab:markdown-summary) 总结了常见的 Markdown 语法以及他们的效果。</p>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:markdown-summary">
<caption style="caption-side: top; text-align: center;">(#tab:markdown-summary) Markdown 常见语法总结</caption><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>元素</p>
</th><th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>Markdown</p>
</th><th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>输出</p>
</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>标题</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code># 一级标题</code> <br> <code># 二级标题</code> <br> <code># 三级标题</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><h1>一级标题  <br> 二级标题  <br> 三级标题</h1>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>段落</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>(在段落间插入空白行) <br> I really like using Markdown. <br> <br> I think I'll use it to format all of my documents from now on.</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>I really like using Markdown. <br> <br> I think I'll use it to format all of my documents from now on.</p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>换行</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>(在行末尾添加两个空格) <br>床前明月光<br>疑是地上霜</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>床前明月光<br>疑是地上霜</p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>粗体</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>**粗体**</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><strong>粗体</strong></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>斜体</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>*斜体*</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><em>斜体</em></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>等宽字体</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code></code>代码<code></code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>代码</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>块引用</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>&gt; We study statistics with the main aim of solving problems in other disciplines.</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><blockquote>
<p>We study statistics with the main aim of solving problems in other disciplines.</p>
</blockquote>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>代码块</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>```some code```</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>some code</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>列表</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>- 一件事</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><ul>
<li>一件事</li>
</ul>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>链接</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>[R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/)</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><a href="https://bookdown.org/yihui/rmarkdown-cookbook/">R Markdown Cookbook</a></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>图片</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>![图片](https://bookdown.org/yihui/rmarkdown/images/cover.png)</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><img src="https://bookdown.org/yihui/rmarkdown/images/cover.png" alt="图片" /></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>脚注</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>请看脚注 ^[这是一条脚注]</code></p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>请看脚注 ^[这是一条脚注]</p>
</td></tr>
</table>

<p>要显示 Markdown 中的特殊字符时 (#, *, -, ` 等)，可以在前面使用转义符 <code>\</code></p>
<pre><code>\- 这一行不会显示为列表</code></pre>
<p>乍一看，Markdown 似乎是一项额外的学习任务，带来了繁多的记忆要求。但如前文所言，Markdown 是对复杂多样格式的简单替代，可以极大地便利我们的写作。在日常的文档书写中，用到的 Markdown 语法也是相对单一和简单的，且 R Markdown 也提供了很多工具降低记忆门槛。</p>
<p>值得一提的是， 虽然 Markdown 本身是一种统一的标准，独立开发者们逐渐添加了不同的功能扩展，一些组织和公司在此基础上加以规范化，形成了不同的 Markdown 变体 (flavor)。 我们在 R Markdown 中使用的是 Pandoc 式的 Markdown，即 Pandoc 支持的 Markdown 语法。一些读者可能还会接触到 ExtraMark Markdown, Github Markdown 等变体。但在大多数情况下，Pandoc Markdown 已经支持了足够多的文本元素，相同元素在不同变体中对应的标记也是一致的。</p>
<p>一些 Markdown 编辑器提供了即时预览功能，方便读者进行交互性的练习。图 @ref(fig:dillinger) 是一个在线编辑器的例子。</p>
<div class="figure" style="text-align: center">
<img src="images/03-dillinger.jpg" alt="支持实时预览的 Markdown 编辑器 https://dillinger.io/"  />
<p class="caption">
(#fig:dillinger)支持实时预览的 Markdown 编辑器 <a href="https://dillinger.io/" class="uri">https://dillinger.io/</a>
</p>
</div>
</div>
</div>
<div id="r-code" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> 使用 R 代码</h2>
<p>在 R Markdown 中，有两种使用 R 代码的形式: 代码块和行内代码。</p>
<p>代码块是一系列可运行代码形成的段落。例如，在本书创建的第一个 R Markdown 文档 <code>first-rmd.Rmd</code> 中，第一个代码块是：</p>
<pre><code>```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```</code></pre>
<p>我们已经知道 <code>```{r}</code> 和 <code>```</code> 是插入 R 代码的格式，但没有解释 <code>setup</code> 和 <code>include=FALSE</code> 的含义。这里的 <code>setup</code> 是设置代码块标签的简写，上面的代码块等价于：</p>
<pre><code>```{r, label = &quot;setup&quot;, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```</code></pre>
<p><code>label</code> 和 <code>include</code> 被称为该代码块的 knitr 选项。knitr 选项可以定制 knitr 包运行代码块时的相关行为。<code>label</code> 为代码块设置了唯一的标签，利于后续引用。而 <code>include=FALSE</code> 使 knitr 仅在转换过程中运行该段代码，不在输出中显示代码块内容和相关的输出结果。 <code>include=TRUE</code> 是所有代码块的默认设置。</p>
<p>读者可以在 <a href="https://yihui.org/knitr/options/" class="uri">https://yihui.org/knitr/options/</a> 查看所有 knitr 选项和它们的含义，这里列出一些常见选项：</p>
<ul>
<li><p><code>eval</code>: 是否运行该代码块</p></li>
<li><p><code>echo</code>: 是否显示代码块内容</p></li>
<li><p><code>results</code>：如何处理代码块和生成结果</p>
<ul>
<li><code>'hide'</code>: 隐藏代码块的输出结果。<code>results='hide'</code> 加上 <code>echo=FALSE</code> 等价于 <code>include = FALSE</code></li>
<li><code>'asis'</code>: 按原样输出结果。默认情况下，knitr 在生成 <code>.md</code> 文件时会将代码的文字输出在放在 Markdown 的代码块中</li>
<li><code>'markup'</code> 默认设置</li>
</ul></li>
<li><p><code>error</code>：是否允许代码块包含错误代码。默认情况下，只要一个代码块运行失败，整个 R Markdown 文档就无法编译成功。当我们想要展示错误的代码写法时，可以用 <code>error = TRUE</code> 或 <code>eval = FALSE</code></p></li>
<li><p><code>message</code> 和 <code>warning</code>： 是否显示代码块可能输出的提示和警告</p></li>
<li><p><code>collapse</code>: 为 <code>true</code> 时，在输出文档中将代码块和结果放到同一个块中</p></li>
<li><p><code>fig.width</code> 和 <code>fig.height</code>: 调整代码块生成图形时图形设备 (graphical device)的大小。这是因为 kntir 首先通过图形设备将图片存储为文件 (例如 png, jpg)，随后在输出文档中引用这些文件。默认情况下 <code>fig.width=7, fig.height=5</code>, 我们不需要知道操作图形设备的底层细节，按照需要调整大小即可。两个类似的选项是 <code>out.width</code> 和 <code>out.height</code>, 通常取值为百分比，表示图片占据一页的比例。例如, <code>out.height = '80%'</code> 表示图片占据页面高度的 80%。</p></li>
<li><p><code>fig.cap</code>: 代码块生成图片的标题</p></li>
<li><p><code>fig.align</code>: 代码块图片的对齐方式，有三种取值</p>
<ul>
<li><code>"left"</code>: 靠左对齐</li>
<li><code>"center"</code> 居中对齐 (本书的设置)</li>
<li><code>"right"</code>: 靠右对齐</li>
</ul></li>
<li><p><code>cache</code>: 是否缓存代码块的运行结果。如果代码块涉及复杂，耗时长的计算，<code>cache = TRUE</code> 可以让 knitr 把运行结果保存为 <code>.rds</code> 文件，并在下次编译时略过计算过程，直接读取 <code>.rds</code> 节省时间。只有代码块的内容发生变化时，knitr 才会重新计算。有时 knitr 的缓存机制会让人难以预测代码是否重新运行，只推荐对确有需要的代码块设置它。</p></li>
</ul>
<p>我们可以用 <code>knitr::opts_chunk</code> 对象设置整篇 R Markdown 文档所有代码块的 knitr 选项，如：</p>
<pre><code>---
title: &quot;全局设置 knitr 选项&quot;
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  error = TRUE,
  message = TRUE,
  warning = FALSE,
  fig.width = 8,
  out.width = &#39;95%&#39;
)
```

以下的全部代码块继承了上面的全局设置，必要时也可以把它们覆盖掉

```{r}
# 应用上面的五个选项
plot(mtcars)
```


```{r, fig.width = 7}
# 更改 fig.width 为 7，其他选项不变
plot(mtcars)
```</code></pre>
<p>之前的例子没有涉及行内代码 (inline expression)，但它是另外一种插入 R 代码的重要方式。行内代码直接把 R 代码的运行结果插入至文本中，语法是 <code>`r `</code>。例如：</p>
<pre><code>半径为 5 的圆面积为 `r pi*5^2`</code></pre>
<p>显示为: 半径为 5 的圆面积为 78.5398163。</p>
<p>行内代码通常用于动态地生成报告，节省手动更新文字内容的时间。例如，数据源 <code>data</code> 改变时，下面的文档重新编译后能自动得出新的结果：</p>
<pre><code>
```{r}
mod &lt;- lm(y ~ x, data = data)
```

线性模型的 R^2 值为 `r summary(mod)$r.squared`</code></pre>
<p>另一个行内代码经常出现的地方是 YAML 元数据，下面的 YAML 设置可以自动更新文档的日期为最近一次编译的日期。</p>
<pre><code>---
title: “自动更新日期”
date: `r Sys.Date()`
---

正常文档内容
...</code></pre>
</div>
<div id="basic-other-languages" class="section level2" number="3.6">
<h2 number="3.6"><span class="header-section-number">3.6</span> 在 R Markdown 中使用其他语言</h2>
<p>R Markdown 脱胎于 R 语言的生态体系，但不熟悉的 R 的读者也不必因此感到束缚。一些包在 R 中提供了对其他语言的接口，我们可以轻松在 R Markdown 种使用其他编程语言。例如, <strong>reticulate</strong> <span class="citation">(<a href="#ref-R-reticulate" role="doc-biblioref">Ushey, Allaire, and Tang 2021</a>)</span> 包提供了 R 对 Python 的接口。首先安装 reticulate 包。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;reticulate&quot;</span>)</span></code></pre></div>
<p>安装完成后，我们插入一段 Python 代码</p>
<pre><code>```{python}`
print(&quot;I&#39;m Python, how R you?&quot;)
```</code></pre>
<p>输出为</p>
<pre><code>## I&#39;m Python, how R you?</code></pre>
<p>我们也可以使用任何 Python 的库，例如 seaborn：</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用 reticulate 包管理 Python 环境</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>reticulate<span class="sc">::</span><span class="fu">py_install</span>(<span class="st">&quot;seaborn&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用 seaborn 在 R Markdown 中作图</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">&quot;ticks&quot;</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">&quot;penguins&quot;</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>sns.pairplot(df, hue<span class="op">=</span><span class="st">&quot;species&quot;</span>)</span></code></pre></div>
<p><img src="images/03-searborn.png" width="1076" style="display: block; margin: auto;" /></p>
<p>如上所示，在代码块选项 <code>```{}</code> 中用 <code>python</code> 代替 <code>r</code> 后, 我们就得到了一个 Python 代码块。当然，R 的解释器或者 RStudio 本身没有运行其他语言代码的功能，类似 reticulate 的包把实际的执行工作转交给了对应语言的解释器或编译器。上面的例子中, reticulate 把代码块 <code>print("I'm Python, how R you?")</code> 传递给了我们电脑中已有 Python 解释器。这样的传递过程是通过 knitr 提供的“引擎” (engine) 机制实现的。</p>
<p>用户可以用包设计自定义引擎，为 R Markdown 提供更多的语言支持。目前，R Markdown 支持的引擎有 56 种，如下所示</p>
<pre><code>##  [1] &quot;awk&quot;         &quot;bash&quot;        &quot;coffee&quot;      &quot;gawk&quot;        &quot;groovy&quot;     
##  [6] &quot;haskell&quot;     &quot;lein&quot;        &quot;mysql&quot;       &quot;node&quot;        &quot;octave&quot;     
## [11] &quot;perl&quot;        &quot;psql&quot;        &quot;Rscript&quot;     &quot;ruby&quot;        &quot;sas&quot;        
## [16] &quot;scala&quot;       &quot;sed&quot;         &quot;sh&quot;          &quot;stata&quot;       &quot;zsh&quot;        
## [21] &quot;highlight&quot;   &quot;Rcpp&quot;        &quot;tikz&quot;        &quot;dot&quot;         &quot;c&quot;          
## [26] &quot;cc&quot;          &quot;fortran&quot;     &quot;fortran95&quot;   &quot;asy&quot;         &quot;cat&quot;        
## [31] &quot;asis&quot;        &quot;stan&quot;        &quot;block&quot;       &quot;block2&quot;      &quot;js&quot;         
## [36] &quot;css&quot;         &quot;sql&quot;         &quot;go&quot;          &quot;python&quot;      &quot;julia&quot;      
## [41] &quot;sass&quot;        &quot;scss&quot;        &quot;R&quot;           &quot;bslib&quot;       &quot;theorem&quot;    
## [46] &quot;lemma&quot;       &quot;corollary&quot;   &quot;proposition&quot; &quot;conjecture&quot;  &quot;definition&quot; 
## [51] &quot;example&quot;     &quot;exercise&quot;    &quot;hypothesis&quot;  &quot;proof&quot;       &quot;remark&quot;     
## [56] &quot;solution&quot;</code></pre>
<p>上面列出的一些引擎不是对某个编程语言的接口，而是提供一些设置了预定格式的文字环境，例如的 <code>theorem</code>, <code>lemma</code>, <code>corollary</code> 等。</p>
</div>
<div id="案例同时使用-sql-r-和-python-做数据分析" class="section level2" number="3.7">
<h2 number="3.7"><span class="header-section-number">3.7</span> 案例：同时使用 SQL, R 和 Python 做数据分析</h2>
<p>本章的最后，我们给出一个简单的 R Markdown 数据分析项目例子。简便起见，对于 R 和 Python 代码块，本节不再写出 <code>```{r}</code> 的格式，而是直接运行代码块得出结果 (本书的一章就是一个 R Markdown 文档)。</p>
<p>真实世界的数据分析项目往往是从查询数据库开始的。我们提前在 SQLite 数据库中存储了一张表 <code>babynames</code>，它是 <strong>babynames</strong> 包 <span class="citation">(<a href="#ref-R-babynames" role="doc-biblioref">Wickham 2021</a>)</span> 提供的 1880 - 2017 历年美国新生儿姓名数据。经过简化后，仅包含每年男女中占比最高的 100 个名字。</p>
<pre><code>```{sql, connection=con, output.var = &quot;babynames&quot;}r&#39;&#39;
SELECT year, sex, name, prop 
FROM babynames
WHERE year &gt;= 1900 
```</code></pre>
<p>上面的 SQL 代码从 SQLite 数据库的 <code>babynames</code> 表提取了 <code>year</code> (年份), <code>sex</code> (性别), <code>name</code> (), 限定年份为 1900 年之前，把查询结果存储的 R 变量 <code>babynames</code> 中。在你的项目中，数据库可能是 MySQL, PostgreSQL, Hive 等的任意一种，都可以用类似的 SQL 代码块直接查询。</p>
<p>现在，我们可以在 R 环境访问到这个数据：</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(babynames)</span></code></pre></div>
<pre><code>## Rows: 23,604
## Columns: 4
## $ year &lt;dbl&gt; 1900, 1900, 1900, 1900, 1900, 1900, 1900, 1900, 1900, 1900, 1900,~
## $ sex  &lt;chr&gt; &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, &quot;F&quot;, ~
## $ name &lt;chr&gt; &quot;Mary&quot;, &quot;Helen&quot;, &quot;Anna&quot;, &quot;Margaret&quot;, &quot;Ruth&quot;, &quot;Elizabeth&quot;, &quot;Floren~
## $ prop &lt;dbl&gt; 0.05257559, 0.01996211, 0.01924142, 0.01669226, 0.01499597, 0.012~</code></pre>
<p>一个问题是: 哪些名字是一直流行的？可以从两个方面考虑：</p>
<ul>
<li><p>进入前 100 名的次数尽可能多</p></li>
<li><p>进入前 100 名时，平均占比更大</p></li>
</ul>
<p>我们可以关注两个统计量，每个名字历年的平均排名 (我们预先截取了每年前 100 名的名字，未出现的名字按最后一名处理) 和平均占比。用 R 中的 <strong>dplyr</strong> <span class="citation">(<a href="#ref-R-ggplot2" role="doc-biblioref">Wickham et al. 2021</a>)</span> 和 <strong>ggplot2</strong> <span class="citation">(<a href="#ref-R-ggplot2" role="doc-biblioref">Wickham et al. 2021</a>)</span> 作数据处理和可视化。当然这里的重点不是代码写法，而是展示 R Markdown 中数据分析的流程。</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> babynames <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, sex, name, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">prop =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co"># 未进入前 10 时把比例赋值为 0</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_rank =</span> <span class="fu">min_rank</span>(<span class="sc">-</span>prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_prop =</span> <span class="fu">mean</span>(prop),</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_prop_rank =</span> <span class="fu">mean</span>(prop_rank))</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>plot_df <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(mean_prop, mean_prop_rank, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> name),</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(mean_prop_rank <span class="sc">&gt;=</span> <span class="dv">10</span> <span class="sc">|</span> mean_prop <span class="sc">&gt;=</span> <span class="fl">0.001</span>)) <span class="sc">+</span> </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rmarkdown-guide_files/figure-html/babynames-plot-1.png" alt="x: 平均占比；y: 平均排名" width="960" />
<p class="caption">
(#fig:babynames-plot)x: 平均占比；y: 平均排名
</p>
</div>
<p>我们在图 @ref(fig:babynames-plot) 中标出了男女中平均排名较高 (&gt;= 10) 或平均占比较高 (&gt; 0.1%) 的姓名。</p>
<p>另一个分析角度时研究某个名字的时间序列趋势，以 “Margaret” 为例，我们希望探究该名字的出现比例趋势。我们选择使用 Python 中 pandas 库丰富的时序功能。首先在 R 中获得对应数据，随后利用 reticulate 包在 Python 中提供的 <code>r</code> 对象将数据传入 Python 环境。这个过程伴随着数据结构的映射，例如 R 中的 <code>data.frame</code> 被转换为 Python 中 pandas 库的 <code>DataFrame</code>。得以在 R 和 Python 之间的共享数据意义重大，我们可以充分发挥两个社区各自的优点。</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在 R 中选取 Margaret 对应的全部数据</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>marg <span class="ot">&lt;-</span> babynames<span class="sc">::</span>babynames <span class="sc">%&gt;%</span><span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Margaret&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> autocorrelation_plot</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 将 R 获得的数据传入 Python 环境</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>marg <span class="op">=</span> r.marg</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> pd.Series(marg[<span class="st">&quot;prop&quot;</span>])</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>ts.index <span class="op">=</span> marg[<span class="st">&quot;year&quot;</span>]</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>ts.plot()</span></code></pre></div>
<p><img src="rmarkdown-guide_files/figure-html/unnamed-chunk-5-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>我们还可以查看 Margaret 出现比例以 5 年为窗口的移动平均：</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ts.rolling(<span class="dv">5</span>).mean().plot()</span></code></pre></div>
<div class="figure" style="text-align: left">
<img src="rmarkdown-guide_files/figure-html/unnamed-chunk-5-3.png" alt="以 5 年为窗口的移动平均" width="672" />
<p class="caption">
(#fig:unnamed-chunk-27)以 5 年为窗口的移动平均
</p>
</div>
<p>其他语言的运行同样是在 knitr 生成 <code>.md</code> 的阶段完成的，这意味着我们同样可以对其他语言的代码块应用某些 knitr 选项。上面的 Python 代码设置了 <code>fig.cap</code>, <code>fig.align = 'left'</code>。</p>
<p>本节对应的 R Markdown 源文档如下：</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;案例研究：同时使用 Python 和 R 和 SQL 做数据分析&quot;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># 准备工作</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="in">`babynames`</span> 数据来自同名 R 包，这里作简单处理后写入 csv 文件。</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prepare-data}</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="in">library(babynames)</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="in">library(readr)</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="in">babynames::babynames %&gt;% </span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year, sex) %&gt;% </span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a><span class="in">  slice_max(order_by = prop, n = 100) %&gt;%</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="in">  write_csv(&quot;data/babynames.csv&quot;)</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>加载提供 Python 接口的 reticulate 包</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="in">library(reticulate)</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="in"># reticulate::py_install(c(&quot;seaborn&quot;, &quot;pandas&quot;))</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>将数据存入 SQLite 数据库中</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a><span class="in">```{r write-db}</span></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="in">library(DBI)</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a><span class="in">raw &lt;- read_csv(&quot;data/babynames.csv&quot;)</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a><span class="in">con &lt;- dbConnect(RSQLite::SQLite(), &quot;:memory:&quot;)</span></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a><span class="in">dbWriteTable(con, &quot;babynames&quot;, raw)</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r read-db}</span></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="in">library(DBI)</span></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="in">library(reticulate)</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="in">raw &lt;- read_csv(&quot;data/babynames.csv&quot;)</span></span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a><span class="in">con &lt;- dbConnect(RSQLite::SQLite(), &quot;:memory:&quot;)</span></span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a><span class="in">dbWriteTable(con, &quot;babynames&quot;, raw)</span></span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>运行 SQL 代码块，查询 1900 年后的所有数据, <span class="in">`output.var`</span> 把结果存到 R 变量中。</span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{sql, connection=con, output.var = &quot;babynames&quot;}</span></span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a><span class="in">SELECT year, sex, name, prop </span></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a><span class="in">FROM babynames</span></span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a><span class="in">WHERE year &gt;= 1900 </span></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>dplyr 数据处理</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a><span class="in">glimpse(babynames)</span></span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-df}</span></span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyr)</span></span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a><span class="in">plot_df &lt;- babynames %&gt;%</span></span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a><span class="in">  complete(year, sex, name, fill = list(prop = 0)) %&gt;% # 未进入前 10 时按最后一名处理</span></span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(year, sex) %&gt;% </span></span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a><span class="in">  mutate(prop_rank = min_rank(-prop)) %&gt;% </span></span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(name, sex) %&gt;% </span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(mean_prop = mean(prop),</span></span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a><span class="in">            mean_prop_rank = mean(prop_rank))</span></span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a><span class="in">```{r babynames-plot, fig.width = 10, fig.cap = &quot;x: 平均占比；y: 平均排名&quot;}</span></span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a><span class="in">plot_df %&gt;% </span></span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(aes(mean_prop, mean_prop_rank, </span></span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a><span class="in">             color = sex)) +</span></span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(shape = 21, size = 3.5) +</span></span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a><span class="in">  ggrepel::geom_text_repel(aes(label = name),</span></span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a><span class="in">                           data = . %&gt;% filter(mean_prop_rank &gt;= 10 | mean_prop &gt;= 0.001)) + </span></span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ sex, scales = &quot;free&quot;) + </span></span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_log10() +</span></span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = &quot;none&quot;) +</span></span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal()</span></span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r marg}</span></span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a><span class="in"># 在 R 中选取 Margaret 对应的全部数据</span></span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a><span class="in">marg &lt;- babynames::babynames %&gt;%filter(name == &quot;Margaret&quot;)</span></span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a>Python 部分</span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-98"><a href="#cb59-98" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb59-99"><a href="#cb59-99" aria-hidden="true" tabindex="-1"></a><span class="in">import pandas as pd </span></span>
<span id="cb59-100"><a href="#cb59-100" aria-hidden="true" tabindex="-1"></a><span class="in">from pandas.plotting import autocorrelation_plot</span></span>
<span id="cb59-101"><a href="#cb59-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-102"><a href="#cb59-102" aria-hidden="true" tabindex="-1"></a><span class="in"># 将 R 获得的数据传入 Python 环境</span></span>
<span id="cb59-103"><a href="#cb59-103" aria-hidden="true" tabindex="-1"></a><span class="in">marg = r.marg</span></span>
<span id="cb59-104"><a href="#cb59-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-105"><a href="#cb59-105" aria-hidden="true" tabindex="-1"></a><span class="in">ts = pd.Series(marg[&quot;prop&quot;])</span></span>
<span id="cb59-106"><a href="#cb59-106" aria-hidden="true" tabindex="-1"></a><span class="in">ts.index = marg[&quot;year&quot;]</span></span>
<span id="cb59-107"><a href="#cb59-107" aria-hidden="true" tabindex="-1"></a><span class="in">ts.plot()</span></span>
<span id="cb59-108"><a href="#cb59-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb59-109"><a href="#cb59-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-110"><a href="#cb59-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-111"><a href="#cb59-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{python, fig.cap = &quot;以 5 年为窗口的移动平均&quot;, fig.align = &#39;left&#39;}</span></span>
<span id="cb59-112"><a href="#cb59-112" aria-hidden="true" tabindex="-1"></a><span class="in">ts.rolling(5).mean().plot()</span></span>
<span id="cb59-113"><a href="#cb59-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div id="使用-rstudio-图形化编辑器" class="section level2" number="3.8">
<h2 number="3.8"><span class="header-section-number">3.8</span> 使用 RStudio 图形化编辑器</h2>
<p><a href="https://blog.rstudio.com/2021/04/06/rstudio-1-4-a-quick-tour/">RStudio 1.4</a> 版本及以上为 R Markdown 文档添加了图形编辑模式。在源文档的上方最右侧点击类似 “A” 的按钮进入可视化编辑器，如图 @ref(fig:visual-editing) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/04-visual-editing.png" alt="R Markdown 图形编辑模式" width="698" />
<p class="caption">
(#fig:visual-editing)R Markdown 图形编辑模式
</p>
</div>
<p>图形化编辑器还提供了丰富的菜单栏选项，用于插入常见文档元素。如图 @ref(visual-editing-insert-menu) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/04-visual-editing-insert-menu.png" alt="图形化编辑器提供了很多菜单栏选项" width="520" />
<p class="caption">
(#fig:visual-editing-insert-menu)图形化编辑器提供了很多菜单栏选项
</p>
</div>
<p>读者可以在 <a href="https://rstudio.github.io/visual-markdown-editing/" class="uri">https://rstudio.github.io/visual-markdown-editing/</a> 了解更多知识。</p>
<!--chapter:end:03-basics.Rmd-->
</div>
</div>
<div id="document-elements" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> 文档元素</h1>
<p>学习过 R Markdown 的基础知识后，本章进一步介绍如何创建和自定义常见的文档元素，包括：</p>
<ul>
<li><p>处理文档中的图片，表格和数学公式</p></li>
<li><p>用主题和模板定制文档外观</p></li>
<li><p>插入目录</p></li>
<li><p>创建交叉引用</p></li>
<li><p>设置章节编号</p></li>
<li><p>插入文献参考和引用</p></li>
<li><p>创作可交互文档</p></li>
<li><p>创建流程图和网络图</p></li>
<li><p>插入分页符和分割线</p></li>
</ul>
<div id="el-figures" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> 图片</h2>
<div id="用-knitr-选项操作图片" class="section level3" number="4.1.1">
<h3 number="4.1.1"><span class="header-section-number">4.1.1</span> 用 knitr 选项操作图片</h3>
<p>默认设置下，代码块产生的图片被直接插入到输出文档中该段代码的后面，靠左对齐，没有标题, 尺寸默认大小。我们可以用 <code>fig.align</code>, <code>fig.cap</code>, <code>fig.width</code>, <code>fig.height</code>, <code>out.width</code>, <code>out.height</code> 等 knitr 选项操作图片。例如：</p>
<pre><code>```{r, out.width = &#39;70%&#39;, fig.align = &#39;center&#39;, fig.cap = &#39;cars 散点图&#39;}
plot(cars)
```</code></pre>
<p>生成：</p>
<div class="figure" style="text-align: center">
<img src="rmarkdown-guide_files/figure-html/unnamed-chunk-29-1.png" alt="cars 散点图" width="672" />
<p class="caption">
(#fig:unnamed-chunk-29)cars 散点图
</p>
</div>
<p><code>fig.cap</code> 是图片的重要属性，它不仅为图片设置了标题，还确保图片被置于独立的环境中。对 HTML 输出，图片对应的 <code>&lt;img&gt;</code> 标签被放在一个 <code>.figure</code> 类 div 容器中。对 PDF 输出，Pandoc 会创建 <code>\begin{figure}</code> 环境，而不是仅插入 <code>\includegraphics{}</code> 指令。添加标题可以让我们的文档更有组织性，并支持交叉引用 (见 @ref(cross-reference) 节)</p>
<p>我们可以把多个图片放置在同一个环境中。knitr 选项 <code>fig.show = 'hold'</code> 把同一个代码块生成的多个图片放到同一个图片环境中。我们可以进一步设置 <code>out.wdith</code> 使多个图片并排放置。例如，<code>out.width = '50%'</code> 可以让一个代码块生成的两张图片位于一行。类似的，如果想并排 3 张图片，可以设置 <code>out.width = '33%'</code>。图 @ref(fig:plots-side-by-side) 是用 <code>fig.show = "hold"</code> 和 <code>out.width = '50%'</code> 并排两张图片的例子。</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pressure, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">type =</span> <span class="st">&quot;b&quot;</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars, <span class="at">pch =</span> <span class="dv">19</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="rmarkdown-guide_files/figure-html/plots-side-by-side-1.png" alt="用 fig.show 和 out.width 并排摆放多个图片" width="50%" /><img src="rmarkdown-guide_files/figure-html/plots-side-by-side-2.png" alt="用 fig.show 和 out.width 并排摆放多个图片" width="50%" />
<p class="caption">
(#fig:plots-side-by-side)用 fig.show 和 out.width 并排摆放多个图片
</p>
</div>
<p>我们在第 @ref(r-code) 节提到过 <code>fig.width</code>, <code>fig.height</code> 和 <code>out.width</code>, <code>out.height</code> 的区别。前两者控制了 R 用图形设备创建图片时的大小，而后两者控制了图片 (按照 <code>fig.width</code> 和 <code>fig.height</code>生成后) 插入输出文档时的比例。例如，<code>out.width = '70%'</code> 时, HTML 输出中的 <code>&lt;img&gt;</code> 标签添加了属性 <code>width = '70%'</code>，而 PDF 输出设置了 <code>.7\linewidth</code>。<code>fig.dim</code> 是同时设置 <code>fig.width</code> 和 <code>fig.height</code> 的快捷选项，如 <code>fig.dim = c(8, 6)</code> 等同于 <code>fig.width = 8</code> 和 <code>fig.height = 6</code>。</p>
<p>另一个和图片大小有关的 knitr 选项是 <code>dpi</code>。当我们不设置 <code>out.width</code> 时，<code>dpi</code> 是图片的像素与宽度 (英寸) 之比。 默认情况下。knitr 会自动计算 dpi 值，我们可以用 <code>include_graphics(dpi = NA)</code>取消自动计算。</p>
</div>
<div id="插入非代码生成图片" class="section level3" number="4.1.2">
<h3 number="4.1.2"><span class="header-section-number">4.1.2</span> 插入非代码生成图片</h3>
<p>对于已有的，非代码块生成的图片，有两种插入方法:</p>
<ul>
<li>使用 <code>knitr::include_graphics()</code> 函数，例如</li>
</ul>
<pre><code>```{r, fig.cap = &quot;加载非代码块生成的图片&quot;, out.width = &#39;90%&#39;}
# &lt;image-path&gt; 为图片的存储路径
knitr::include_graphics(&quot;&lt;image-path&gt;&quot;)
```</code></pre>
<ul>
<li>使用 Markdown 语法 <code>![文字](图片链接)</code>，</li>
</ul>
<p>我们推荐总是用 <code>knitr::include_graphics()</code> 插入图片，它有几点好处：</p>
<ul>
<li><p>提供独立于输出格式的统一图片语法</p></li>
<li><p>我们可以像控制 R 代码生成的图片那样控制外部图片，<code>fig.cap</code>, <code>out.width</code>, <code>dpi</code>, <code>fig.show</code> 等图片相关的 knitr 选项均适用于 <code>include_graphics</code> 加载的图片。在后面的章节中，我们会学习如何用钩子函数自动裁剪图片，优化图片体积等，而这一切都要求图片必须在代码段生成。</p></li>
<li><p>对于 PDF 输出，<code>include_graphics</code> 能自动采用质量更高的 PDF 格式图片，例如用 <code>foo/bar.pdf</code> 取代 <code>foo/bar.png</code>。knitr 选项 <code>auto_pdf = TRUE</code> 可以启动这项功能，或设置全局选项 <code>options(knitr.graphics.auto_pdf = TRUE)。</code></p></li>
</ul>
<p><code>include_graphics</code> 可以一次插入多个图片，下面的代码块插入了三张图片，并设置 <code>out.width = '30%'</code> 和 <code>fig.show = "hold"</code>：</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="fu">rep</span>(<span class="st">&quot;images/knit-logo.png&quot;</span>, <span class="dv">3</span>))</span></code></pre></div>
<p><img src="images/knit-logo.png" width="30%" style="display: block; margin: auto;" /><img src="images/knit-logo.png" width="30%" style="display: block; margin: auto;" /><img src="images/knit-logo.png" width="30%" style="display: block; margin: auto;" /></p>
<p>用 Markdown 语法插入图片时，也可在图片路径后设置输出宽度，例如：</p>
<pre><code>![一个图片](foo/bar.png){width=50%}</code></pre>
</div>
</div>
<div id="表格-1" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> 表格</h2>
<p>使用 <code>knitr::kable</code> 是在 R Markdown 中插入表格的最简单方式，它提供了一些修饰表格的参数：</p>
<ul>
<li><p><code>caption</code>: 标题</p></li>
<li><p><code>row.names</code> 和 <code>col.names</code>: 覆盖原有的行/列名</p></li>
<li><p><code>digits</code>: 数值类型列的取整小数位</p></li>
<li><p><code>booktabs</code>: 应用 booktabs 样式 (PDF)</p></li>
<li><p><code>longtable</code>: 把较长的表格拆分至多页 (PDF, 需要 LaTeX 包 <code>longtable</code>)</p></li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(mtcars[, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="dv">10</span>),</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;mtcars 数据的前 10 行&quot;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<caption>(#tab:unnamed-chunk-31)mtcars 数据的前 10 行</caption>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160.0</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108.0</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258.0</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Hornet Sportabout</td>
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">175</td>
<td align="right">3.15</td>
<td align="right">3.440</td>
<td align="right">17.02</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Valiant</td>
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225.0</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.460</td>
<td align="right">20.22</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Duster 360</td>
<td align="right">14.3</td>
<td align="right">8</td>
<td align="right">360.0</td>
<td align="right">245</td>
<td align="right">3.21</td>
<td align="right">3.570</td>
<td align="right">15.84</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Merc 240D</td>
<td align="right">24.4</td>
<td align="right">4</td>
<td align="right">146.7</td>
<td align="right">62</td>
<td align="right">3.69</td>
<td align="right">3.190</td>
<td align="right">20.00</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Merc 230</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">140.8</td>
<td align="right">95</td>
<td align="right">3.92</td>
<td align="right">3.150</td>
<td align="right">22.90</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Merc 280</td>
<td align="right">19.2</td>
<td align="right">6</td>
<td align="right">167.6</td>
<td align="right">123</td>
<td align="right">3.92</td>
<td align="right">3.440</td>
<td align="right">18.30</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>与图片类似，带标题的表格将获得独立的环境。我们可以把多个表格放入同一个环境，如表 @ref(tab:two-tables-same-env) 所示。</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="dv">3</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(mtcars[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">5</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;A Tale of Two Tables.&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
(#tab:two-tables-same-env)A Tale of Two Tables.
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="right">Sepal.Length</th>
<th align="right">Sepal.Width</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">5.1</td>
<td align="right">3.5</td>
</tr>
<tr class="even">
<td align="right">4.9</td>
<td align="right">3.0</td>
</tr>
<tr class="odd">
<td align="right">4.7</td>
<td align="right">3.2</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Mazda RX4</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
</tr>
<tr class="even">
<td align="left">Mazda RX4 Wag</td>
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
</tr>
<tr class="odd">
<td align="left">Datsun 710</td>
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108</td>
</tr>
<tr class="even">
<td align="left">Hornet 4 Drive</td>
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258</td>
</tr>
<tr class="odd">
<td align="left">Hornet Sportabout</td>
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p><a href="https://github.com/haozhu233/kableExtra">kableExtra</a> 包 <span class="citation">(<a href="#ref-R-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span> 在 <code>knitr::kable</code> 基础上提供了 <code>kableExtra::kbl</code> 函数作为 <code>kable</code> 的升级版，带有更多定制表格外观的参数, 。我们可以用很少的代码创作出外形美观，意义丰富的表格。</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_paper</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">color =</span> <span class="fu">spec_color</span>(mtcars<span class="sc">$</span>mpg[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]),</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">link =</span> <span class="st">&quot;https://haozhu233.github.io/kableExtra/&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">6</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">background =</span> <span class="fu">spec_color</span>(mtcars<span class="sc">$</span>drat[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="at">end =</span> <span class="fl">0.7</span>),</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">popover =</span> <span class="fu">paste</span>(<span class="st">&quot;am:&quot;</span>, mtcars<span class="sc">$</span>am[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]))</span></code></pre></div>
<table class=" lightable-paper" style="font-family: &quot;Arial Narrow&quot;, arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mpg
</th>
<th style="text-align:right;">
cyl
</th>
<th style="text-align:right;">
disp
</th>
<th style="text-align:right;">
hp
</th>
<th style="text-align:right;">
drat
</th>
<th style="text-align:right;">
wt
</th>
<th style="text-align:right;">
qsec
</th>
<th style="text-align:right;">
vs
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mazda RX4
</td>
<td style="text-align:right;color: rgba(52, 182, 121, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(52, 182, 121, 1) !important;"> 21.0 </a>
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160.0
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;color: white !important;background-color: rgba(67, 191, 113, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 1">
3.90
</td>
<td style="text-align:right;">
2.620
</td>
<td style="text-align:right;">
16.46
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Mazda RX4 Wag
</td>
<td style="text-align:right;color: rgba(52, 182, 121, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(52, 182, 121, 1) !important;"> 21.0 </a>
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160.0
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;color: white !important;background-color: rgba(67, 191, 113, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 1">
3.90
</td>
<td style="text-align:right;">
2.875
</td>
<td style="text-align:right;">
17.02
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Datsun 710
</td>
<td style="text-align:right;color: rgba(149, 216, 64, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(149, 216, 64, 1) !important;"> 22.8 </a>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
108.0
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;color: white !important;background-color: rgba(55, 184, 120, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 1">
3.85
</td>
<td style="text-align:right;">
2.320
</td>
<td style="text-align:right;">
18.61
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet 4 Drive
</td>
<td style="text-align:right;color: rgba(68, 191, 112, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(68, 191, 112, 1) !important;"> 21.4 </a>
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
258.0
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;color: white !important;background-color: rgba(65, 67, 135, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 0">
3.08
</td>
<td style="text-align:right;">
3.215
</td>
<td style="text-align:right;">
19.44
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet Sportabout
</td>
<td style="text-align:right;color: rgba(38, 129, 142, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(38, 129, 142, 1) !important;"> 18.7 </a>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
360.0
</td>
<td style="text-align:right;">
175
</td>
<td style="text-align:right;color: white !important;background-color: rgba(60, 79, 138, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 0">
3.15
</td>
<td style="text-align:right;">
3.440
</td>
<td style="text-align:right;">
17.02
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Valiant
</td>
<td style="text-align:right;color: rgba(44, 114, 142, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(44, 114, 142, 1) !important;"> 18.1 </a>
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
225.0
</td>
<td style="text-align:right;">
105
</td>
<td style="text-align:right;color: white !important;background-color: rgba(68, 1, 84, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 0">
2.76
</td>
<td style="text-align:right;">
3.460
</td>
<td style="text-align:right;">
20.22
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Duster 360
</td>
<td style="text-align:right;color: rgba(68, 1, 84, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(68, 1, 84, 1) !important;"> 14.3 </a>
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
360.0
</td>
<td style="text-align:right;">
245
</td>
<td style="text-align:right;color: white !important;background-color: rgba(55, 90, 140, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 0">
3.21
</td>
<td style="text-align:right;">
3.570
</td>
<td style="text-align:right;">
15.84
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
Merc 240D
</td>
<td style="text-align:right;color: rgba(253, 231, 37, 1) !important;">
<a href="https://haozhu233.github.io/kableExtra/" style="color: rgba(253, 231, 37, 1) !important;"> 24.4 </a>
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
146.7
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;color: white !important;background-color: rgba(31, 161, 135, 1) !important;" data-toggle="popover" data-container="body" data-trigger="hover" data-placement="right" data-content="am: 0">
3.69
</td>
<td style="text-align:right;">
3.190
</td>
<td style="text-align:right;">
20.00
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>读者还可以查看 <a href="https://github.com/rstudio/gt">gt</a>， <a href="https://github.com/hughjonesd/huxtable">huxtable</a>， <a href="https://github.com/glin/reactable">reactable</a>。RStudio 举办的<a href="https://blog.rstudio.com/2020/12/23/winners-of-the-2020-rstudio-table-contest/">表格创作比赛</a> (Table Contest) 有很多优秀的获奖作品。</p>
</div>
<div id="公式" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> 公式</h2>
<p>我们可以用一对 <code>$</code> 插入行内数学公式，例如 <code>$f(k) = {n \choose k} p^{k} (1-p)^{n-k}$</code> 渲染为 <span class="math inline">\(f(k) = {n \choose k} p^{k} (1-p)^{n-k}\)</span>。</p>
<p>前后各两个 <code>$$</code> 会创建块状公式，例如：</p>
<pre><code>$$
f(k) = {n \choose k} p^{k} (1-p)^{n-k}
$$</code></pre>
<p>输出为：</p>
<p><span class="math display">\[
f(k) = {n \choose k} p^{k} (1-p)^{n-k}
\]</span></p>
<p>我们可以使用 LaTeX 默认的数学环境，如：</p>
<pre><code>$$\begin{array}{ccc}
x_{11} &amp; x_{12} &amp; x_{13}\\
x_{21} &amp; x_{22} &amp; x_{23}
\end{array}$$</code></pre>
<p><span class="math display">\[\begin{array}{ccc}
x_{11} &amp; x_{12} &amp; x_{13}\\
x_{21} &amp; x_{22} &amp; x_{23}
\end{array}\]</span></p>
<pre><code>$$X = \begin{bmatrix}1 &amp; x_{1}\\
1 &amp; x_{2}\\
1 &amp; x_{3}
\end{bmatrix}$$</code></pre>
<p><span class="math display">\[X = \begin{bmatrix}1 &amp; x_{1}\\
1 &amp; x_{2}\\
1 &amp; x_{3}
\end{bmatrix}\]</span></p>
</div>
<div id="theme-templates" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> 主题和模板</h2>
<p>对于 rmarkdown 包提供的 HTML 输出格式，我们可以用 YAML 元数据中的 <code>theme</code> 选项设置输出的外观主题。</p>
<pre><code>---
output:
  html_document:
    toc: true
    theme: united
---</code></pre>
<p>一个主题包含了一系列配色，字体，布局等设置。图 @ref(fig:theme-united) 展示了 united 主题。</p>
<div class="figure" style="text-align: center">
<img src="examples/theme-united.png" alt="使用 html_document 的 united 主题" width="350" />
<p class="caption">
(#fig:theme-united)使用 html_document 的 united 主题
</p>
</div>
<p><code>html_document</code> 中 <code>theme</code> 的取值包括 <code>united</code>, <code>journal</code>, <code>flatly</code> 等 。这些名字来自 UI 框架 bootstrap 的主题扩展 <a href="https://bootswatch.com/">bootswatch</a>。rmarkdown 的 HTML 输出格式基于 bootstrap 框架，而 bootswatch 为 bootstrap 提供了一系列扩展主题。读者可以在 bootswatch 网站上看到每个主题的效果。Andrew Zieffler 在<a href="https://www.datadreaming.org/post/r-markdown-theme-gallery/">博客</a>中同样列举了所有主题的效果。</p>
<div class="figure" style="text-align: center">
<img src="images/04-bootswatch.jpg" alt="bootswatch 网站"  />
<p class="caption">
(#fig:boots-theme)bootswatch 网站
</p>
</div>
<p>除了 <code>theme</code> 提供的主题选择外，读者还可以使用其他包提供的 R Markdown 模板。一个例子是 <a href="https://github.com/yixuan/prettydoc">prettydoc</a> 包 <span class="citation">(<a href="#ref-R-prettydoc" role="doc-biblioref">Qiu 2021</a>)</span>。prettydoc 为 R Markdown 文档提供了额外的输出格式 <code>html_pretty</code>, 我们可以在该格式对应的 <code>theme</code> 选项设置主题，例如：</p>
<pre><code>---
output:
  prettydoc::html_pretty:
    theme: cayman
---</code></pre>
<p>输出效果如图 @ref(fig:prettydoc-example) 所示。</p>
<div class="figure" style="text-align: center">
<img src="examples/prettydoc.png" alt="prettydoc 包的 cayman 主题" width="350" />
<p class="caption">
(#fig:prettydoc-example)prettydoc 包的 cayman 主题
</p>
</div>
<p><code>html_pretty</code> 可选的主题包括：</p>
<ul>
<li><p><code>cayman</code>: 修改自 <a href="https://github.com/jasonlong/cayman-theme">Cayman</a> 主题</p></li>
<li><p><code>tactile</code>: 修改自 <a href="https://github.com/jasonlong/tactile-theme">Tactile</a> 主题</p></li>
<li><p><code>architect</code>: 修改自 <a href="https://github.com/jasonlong/architect-theme">Architect</a> 主题</p></li>
<li><p><code>leonids</code>: 修改自 <a href="https://github.com/renyuanz/leonids">Leonids</a> 主题</p></li>
<li><p><code>hpstr</code>: 修改自 <a href="https://github.com/mmistakes/jekyll-theme-hpstr">HPSTR</a> 主题</p></li>
</ul>
<p>我们还可以提供其他 YAML 选项：</p>
<ul>
<li><p><code>highlight</code>: 高亮方案，取值为 <code>github</code> 或 <code>vignette</code></p></li>
<li><p><code>math</code>: LaTeX 数学公式的渲染方式，取值为 <code>mathjax</code> 或 <code>katex</code>，后者可以在没有网络连接时显示公式</p></li>
</ul>
<p>使用 <code>html_pretty</code> 格式也有一定限制，它不支持 <code>toc_float</code>, <code>code_folding</code>, <code>code_download</code> 等选项。</p>
<p>一些类似的提供 R Markdown 模板的包包括 <a href="https://github.com/juba/rmdformats">rmdformats</a>，<a href="https://github.com/rstudio/tufte">tufte</a>，<a href="https://github.com/rstudio/rticles">rtciles</a> (PDF) 等。</p>
</div>
<div id="目录" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> 目录</h2>
<p>我们可以设置任意输出格式的 <code>toc: true</code> 以自动生成目录，<code>toc_depth</code> 控制显示深度。如：</p>
<pre><code>---
title: &quot;插入目录&quot;
output:
  html_document:
    toc: true
    toc_depth: 2
---</code></pre>
<p>此时目录只会显示一级标题和二级标题，略过级别更低的标题。</p>
<p><code>html_document</code> 和 <code>bookdown::html_document2</code> 等输出格式支持 <code>toc_float</code> 属性，为 <code>true</code> 时，目录变为侧边栏，并固定在屏幕左侧。我们可以展开 <code>toc_float</code> 为一个字典，包括</p>
<ul>
<li><p><code>collapsed</code> (默认为 <code>true</code>)：是否折叠二级标题以下的标题</p></li>
<li><p><code>smooth_scroll</code> (默认为 <code>true</code>)：是否在鼠标点击目录时添加平滑滚动</p></li>
</ul>
<p>设置样例如下：</p>
<pre><code>---
title: &quot;插入目录&quot;
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
---</code></pre>
</div>
<div id="cross-reference" class="section level2" number="4.6">
<h2 number="4.6"><span class="header-section-number">4.6</span> 交叉引用</h2>
<p>交叉引用 (cross-reference) 可以为读者提供锚点链接，便于他们快速浏览文档中相关部分。为了使用这项功能，我们需要使用支持交叉引用的输出格式，并提供跳转部分的标签。</p>
<p>rmarkdown 包提供的 <code>html_document</code>, <code>pdf_document</code> 等基础格式不支持交叉引用。我们可以转而使用 <strong>bookdown</strong> <span class="citation">(<a href="#ref-R-bookdown" role="doc-biblioref">Xie 2021a</a>)</span> 包中的“增强版本”：<code>bookdown::html_document2</code> 和 <code>bookdown::pdf_document2</code> 等格式。</p>
<p>随后，我们需要为链接跳转的锚点设置一个标签，这样引用的时候才有地放矢。我们可以引用章节标题，图片和表格三种元素，元素类型不同，引用方式也稍有差异。</p>
<p>Pandoc 会自动为章节标题设置标签。例如 <code># Hello World</code> 对应的标签为 <code>hello-world</code>。随后我们可以用 <code>\@ref(hello-world)</code> 引用该标题，它会生成该章节对应的编号。对中文标题，Pandoc 生成的标签相对难以预测。我们可以用 <code># 标题 {#header}</code> 为该节添加自定义标签 <code>header</code>，随后用 <code>\@ref(header)</code> 引用该节。例如本节标题设置了 <code>## 交叉引用 {#cross-reference}</code>，<code>\@ref(cross-reference)</code> 生成为 @ref(cross-reference)。建议总是给中文标题设置一个简介的英文标签，仅包含字母和连词符，例如：</p>
<pre><code>---
output: bookdown::pdf_document2
---

# 简介 {#introdcution}

# 方法 {#methods}

我们可以分别用 \@ref(introduction) 和 \@ref(methods) 引用前两章的标题。</code></pre>
<p>与章节标题不同，图片和表格的标签是它们所属代码块的标签。我们在第 @ref(r-code) 节中谈到可以用 <code>```{r label}</code> 或 <code>```{r, label = "label"}</code> 为代码块设置标签。当该代码块的输出包含图片或表格时，这个标签就可用于交叉引用。但仅有该标签还不够，交叉引用需要元素有自己的独立环境。因此，我们还需要为图片和表格设置标题。图片可以用<code>fig.cap</code> 选项，设置表格标题的方法取决于生成的函数，例如 <code>knitr::kable</code> 使用 <code>caption</code> 参数。
随后，我们可以用 <code>\@ref(fig:label)</code> 引用图片，用 <code>\@ref(tab:label)</code> 引用表格。下面是一个例子：</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &#39;交叉引用图片和表格&#39;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">  bookdown::html_document2: default </span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># 引用图片</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r cars-plot, fig.cap = &quot;一张散点图&quot;}</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>引用图片需要为代码块设置标签，并有标题 <span class="in">`fig.cap`</span>, 如图 \@ref(fig:cars-plot) 所示。</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>下面的图片虽然设置了代码块标签，但没有 <span class="in">`fig.cap`</span>，无法创建单独的图表环境，引用 \@ref(fig:iris-plot) 失效。</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iris-plot}</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a><span class="in">plot(iris)</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## 引用表格</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>引用表格与图片类似，如表 \@ref(tab:iris-table) 所示。</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="in">```{r iris-table}</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(head(iris), caption = &quot;一个表格&quot;)</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出如图 @ref(fig:cr-example) 所示。</p>
<div class="figure" style="text-align: center">
<img src="examples/cross-reference.png" alt="交叉引用图片和表格" width="350" />
<p class="caption">
(#fig:cr-example)交叉引用图片和表格
</p>
</div>
<p>读者如果跟随编译了上述文档，可以点开生成的 HTML 文档，会发现标签元素的容器有对应的 <code>id</code> 属性。同理，PDF 输出的 <code>.tex</code> 文件会插入对应的 <code>\label{}</code> 指令，这也是交叉引用的跳转基础。</p>
</div>
<div id="章节编号" class="section level2" number="4.7">
<h2 number="4.7"><span class="header-section-number">4.7</span> 章节编号</h2>
<p>绝大多数输出格式在 YAML 元数据中支持 <code>number_sections</code> 属性，值为 <code>true</code> 时，各章节标题按照层级自动编号。</p>
<p>我们可以用 Pandoc 的标题属性 <code>.unnumbered</code> 省略某个章节的编号，细节见 <a href="https://pandoc.org/MANUAL.html#extension-header_attributes" class="uri">https://pandoc.org/MANUAL.html#extension-header_attributes</a>。例如：</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;使用 Pandoc 标题属性&quot;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">  bookdown::html_document2: default</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># 前言 {.unnumbered}</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>前言。</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第一节 {#first}</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>现在，我们可以用 \@ref(first) 引用第一章。</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第二节</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># 第三节 {-}</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="in">`{-}`</span> 是 <span class="in">`{.unnumbered}`</span> 的简写。</span></code></pre></div>
<p>输出如 @ref(fig:pandoc-attributes) 所示。</p>
<div class="figure" style="text-align: center">
<img src="examples/pandoc-attributes.png" alt="使用 number_sections 和 Pandoc 标题属性控制章节编号" width="350" />
<p class="caption">
(#fig:pandoc-attributes)使用 number_sections 和 Pandoc 标题属性控制章节编号
</p>
</div>
<p>读者还需注意，对没有编号的标题使用交叉引用时，只能用 Markdown 链接 <code>[文字](#label)</code>, 而不能用 <code>\@ref(label)</code>，后者是基于编号的引用。</p>
</div>
<div id="参考文献和引用" class="section level2" number="4.8">
<h2 number="4.8"><span class="header-section-number">4.8</span> 参考文献和引用</h2>
<blockquote>
<p>TODO：这一部分以后应当结合 Zotero 和 EndNote 等常用文献管理软件做适当扩展。</p>
</blockquote>
<p>R Markdown 支持在输出文档末尾自动生成参考文献，并提供了很方便的引用格式。这项功能是通过 Pandoc 实现的，它有两种管理引用和参考文献的方式</p>
<ol style="list-style-type: decimal">
<li><p>默认情况下，Pandoc 会使用 <code>[pandoc-citeproc](https://github.com/jgm/pandoc-citeproc)</code> 程序按照 CSL (Citation Style Language) 语言的标准和特定的 CSL 风格文件组织参考文献和引用的格式。</p></li>
<li><p>读者还可以使用 <a href="https://ctan.org/pkg/natbib">natbib</a> 包 (基于 LaTeX 的 <code>bibtex</code>包) 或 <a href="https://ctan.org/pkg/biblatex">biblatex</a> 包提供的格式。此时我们需要参考的数据文件符合 <code>bibtex</code> 或 <code>biblatex</code> 格式。</p></li>
</ol>
<p>我们可以用 YAML 元数据中的 <code>citation_package</code> 选项选择 <code>natlib</code> 或 <code>biblatex</code>：</p>
<pre><code>---
output:
  pdf_document:
    citation_package: natbib
  bookdown::pdf_book:
    citation_package: biblatex
---</code></pre>
<p>读者需注意，<code>citation_package</code> 仅限于 PDF 输出格式。对其他输出格式，我们只能依靠 <code>pandoc-citeproc</code>，如果需要保持 PDF 格式和其他格式的一致性，就应该始终使用 <code>pandoc-citeproc</code>。</p>
<p>设置好格式后，我们需要知道如何从数据上表达参考文献的各个条目。我们在这里以 BibTeX 数据库的方法为例。一个 BibTeX 数据库是一种用于存储参考文献数据的纯文本文件，后缀为 <code>bib</code>，每一个条目都至少包含名称，作者和时间等信息，格式形如：</p>
<pre><code>@Manual{R-base,
  title = {R: A Language and Environment for Statistical
    Computing},
  author = {{R Core Team}},
  organization = {R Foundation for Statistical Computing},
  address = {Vienna, Austria},
  year = {2016},
  url = {https://www.R-project.org/},
}</code></pre>
<p>一个条目以 <code>@type{</code> 开始，<code>type</code> 表示该条参考的类型，可以识 <code>article</code>, <code>book</code>, <code>manual</code> 等。在类型之后的是引用标签，如 <code>R-base</code>，其他项包含参考的作者，组织，地址，日期和链接等信息。为了使用 <code>.bib</code> 文件中的条目，我们需要用 YAML 元数据中的 <code>bibliography</code> 加载一个或多个 <code>.bib</code> 文件：</p>
<pre><code>---
output: pdf_document
bibliography: [&quot;one.bib&quot;, &quot;another.bib&quot;, &quot;yet-another.bib&quot;]
biblio-style: &quot;apalike&quot;
link-citations: true
---</code></pre>
<p>在上面的例子中，我们引入了 <code>one.bib</code>，<code>another.bib</code>，<code>yet-another.bib</code> 三个 <code>.bib</code> 文件中的参考数据，<code>biblio-style: 'apalike'</code> 设置参考样式为美国心理学学会期刊样式 (American Psychology Association, APA)，<code>link-cations: true</code> 为引用添加指向参考文献的跳转链接。</p>
<p>用 <code>bibliography</code> 引入 <code>.bib</code> 后，我们可以在文档中引用其中包含的任意条目，语法为 <code>@key</code> 或 <code>[@key]</code>，其中 <code>key</code> 为该参考条目类型之后的标签。如 <code>@R-base</code> 生成为 <span class="citation"><a href="#ref-R-base" role="doc-biblioref">R Core Team</a> (<a href="#ref-R-base" role="doc-biblioref">2021</a>)</span>，而 <code>[@R-base]</code> 生成 <span class="citation">(<a href="#ref-R-base" role="doc-biblioref">R Core Team 2021</a>)</span>。</p>
<p>对 PDF 输出，Pandoc 会在最后一个章节后额外生成一节放置参考文献。对其他输出格式，我们可以用行内代码自动创建一节参考文献。例如，在源文档的最后插入：</p>
<pre><code>`r if (knitr::is_html_output()) &#39;# 参考文献 {-}&#39;`</code></pre>
<p>被 <code>@key</code> 引用的参考条目会自动出现在最后的参考文献索引中，如果想在最后添加 <code>.bib</code> 中的全部条目，不论是否引用，可以设置 YAML 中的 <code>notice</code> 属性。例如：</p>
<pre><code>---
nocite: &#39;@*&#39;
---</code></pre>
<div id="引用-r-包" class="section level3" number="4.8.1">
<h3 number="4.8.1"><span class="header-section-number">4.8.1</span> 引用 R 包</h3>
<p>参考“文献”还可以包括文章使用的软件包。knitr 提供了 <code>write_bib</code> 函数为 R 包生成 <code>.bib</code> 格式的参考条目：</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 第二个参数可以是任意 .bib 文件</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">write_bib</span>(<span class="fu">c</span>(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;knitr&quot;</span>), <span class="st">&quot;&quot;</span>, <span class="at">width =</span> <span class="dv">60</span>)</span></code></pre></div>
<pre><code>## @Manual{R-base,
##   title = {R: A Language and Environment for Statistical
##     Computing},
##   author = {{R Core Team}},
##   organization = {R Foundation for Statistical Computing},
##   address = {Vienna, Austria},
##   year = {2021},
##   url = {https://www.R-project.org/},
## }
## 
## @Manual{R-knitr,
##   title = {knitr: A General-Purpose Package for Dynamic
##     Report Generation in R},
##   author = {Yihui Xie},
##   year = {2021},
##   note = {R package version 1.33},
##   url = {https://yihui.org/knitr/},
## }
## 
## @Book{knitr2015,
##   title = {Dynamic Documents with {R} and knitr},
##   author = {Yihui Xie},
##   publisher = {Chapman and Hall/CRC},
##   address = {Boca Raton, Florida},
##   year = {2015},
##   edition = {2nd},
##   note = {ISBN 978-1498716963},
##   url = {https://yihui.org/knitr/},
## }
## 
## @InCollection{knitr2014,
##   booktitle = {Implementing Reproducible Computational
##     Research},
##   editor = {Victoria Stodden and Friedrich Leisch and Roger
##     D. Peng},
##   title = {knitr: A Comprehensive Tool for Reproducible
##     Research in {R}},
##   author = {Yihui Xie},
##   publisher = {Chapman and Hall/CRC},
##   year = {2014},
##   note = {ISBN 978-1466561595},
##   url = {http://www.crcpress.com/product/isbn/
##     9781466561595},
## }</code></pre>
<p>不提供第一个参数时。<code>write_bib</code> 会导出当前进程加载的全部 R 包的引用数据。我们可以在文档末尾插入如下代码段自动化生成 R 包对应的 <code>.bib</code> 文件：</p>
<pre><code>---
bibliography: [packages.bib, references.bib]
---


# 总结

最后，...


```{r, include=FALSE}
knitr::write_bib(file = &#39;packages.bib&#39;)
```

`r if (knitr::is_html_output()) &#39;# References {-}&#39;`</code></pre>
</div>
</div>
<div id="interactive-documents" class="section level2" number="4.9">
<h2 number="4.9"><span class="header-section-number">4.9</span> 交互文档</h2>
<p>使用 HTML 输出格式的优势之一是可交互性。我们可以用两种方式构建交互文档：</p>
<ul>
<li><p>使用 htmlwidgets 包提供的 HTML 组件框架</p></li>
<li><p>使用 shiny 包</p></li>
</ul>
<div id="html-组件" class="section level3" number="4.9.1">
<h3 number="4.9.1"><span class="header-section-number">4.9.1</span> HTML 组件</h3>
<p><strong>htmlwidgets</strong> 包 <span class="citation">(<a href="#ref-R-htmlwidgets" role="doc-biblioref">Vaidyanathan et al. 2020</a>)</span> 实现了一套插入 HTML 组件的框架，让其他开发者可以轻松地在 R
中实现对 JavaScript 库的接口。在此框架上开发的 R 包如 <strong>DT</strong> <span class="citation">(<a href="#ref-R-DT" role="doc-biblioref">Xie, Cheng, and Tan 2021</a>)</span> (表格)，<strong>leaflet</strong> <span class="citation">(<a href="#ref-R-leaflet" role="doc-biblioref">Cheng, Karambelkar, and Xie 2021</a>)</span> (地图) 和 ，<strong>dygraphs</strong> <span class="citation">(<a href="#ref-R-dygraphs" role="doc-biblioref">Vanderkam et al. 2018</a>)</span> (时间序列图) 为 HTML 输出格式提供了丰富的交互组件。读者可以在 <a href="https://www.htmlwidgets.org" class="uri">https://www.htmlwidgets.org</a> 了解更多使用和开发 HTML 组件的更多细节。</p>
<p>图 @ref(fig:leaflet-example) 是一个使用 leaflet 包插入交互地图的例子。</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setView</span>(<span class="fl">174.768</span>, <span class="sc">-</span><span class="fl">36.852</span>, <span class="at">zoom =</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addPopups</span>(<span class="at">lng =</span> <span class="fl">174.768</span>, <span class="at">lat =</span> <span class="sc">-</span><span class="fl">36.852</span>, <span class="at">popup=</span><span class="st">&quot;&lt;b&gt;R&lt;/b&gt; 的诞生地&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<div id="htmlwidget-120febe1647e69fdf52b" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-120febe1647e69fdf52b">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"http://openstreetmap.org\">OpenStreetMap<\/a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA<\/a>"}]},{"method":"addPopups","args":[-36.852,174.768,"<b>R<\/b> 的诞生地",null,null,{"maxWidth":300,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"className":""}]}],"setView":[[-36.852,174.768],16,[]],"limits":{"lat":[-36.852,-36.852],"lng":[174.768,174.768]}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:leaflet-example)用 leaflet 包插入交互地图
</p>
</div>
</div>
<div id="shiny-文档" class="section level3" number="4.9.2">
<h3 number="4.9.2"><span class="header-section-number">4.9.2</span> Shiny 文档</h3>
<p><strong>Shiny</strong> <span class="citation">(<a href="#ref-R-shiny" role="doc-biblioref">Chang et al. 2021</a>)</span> 包是一套用 R 语言开发网页应用的框架。在 R Markdown 中应用 Shiny 代码需要 YAML 设置 <code>runtime: shiny</code>。例如：</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;Shiny 文档&quot;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="an">runtime:</span><span class="co"> shiny</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>我们可以用 shiny 包中的 <span class="in">`renderPlot`</span> 函数为图形添加交互性。<span class="in">`selectInput()`</span> 插入一个可调节直方图区间的交互组件</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r eruptions, echo=FALSE}</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="in">selectInput(</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="in">  &#39;breaks&#39;, label = &#39;Number of bins:&#39;,</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="in">  choices = c(10, 20, 35, 50), selected = 20</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="in">renderPlot({</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="in">  par(mar = c(4, 4, .1, .5))</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="in">  hist(</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a><span class="in">    faithful$eruptions, as.numeric(input$breaks),</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="in">    col = &#39;gray&#39;, border = &#39;white&#39;,</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="in">    xlab = &#39;Duration (minutes)&#39;, main = &#39;&#39;</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出为图 @ref(fig:shiny-document) 所示的文档。</p>
<div class="figure" style="text-align: center">
<img src="images/04-shiny-document.jpg" alt="在 R Markdown 中使用 shiny 运行环境"  />
<p class="caption">
(#fig:shiny-document)在 R Markdown 中使用 shiny 运行环境
</p>
</div>
<p>读者可以在 @ref(shiny-started) 了解更多 shiny 文档的知识。</p>
</div>
</div>
<div id="diagrams" class="section level2" number="4.10">
<h2 number="4.10"><span class="header-section-number">4.10</span> 插入流程图和网络图</h2>
<p>Graphviz 和 mermaid 是两个常用于流程和网络图的软件包。<a href="https://rich-iannone.github.io/DiagrammeR/">DiagrammeR</a> 包让我们可以用 R 代码生成 Graphviz 或 mermaid 图。以 Graphviz 为例，一个图文件包含对图 (graph)，节点 (node) 和边 (edge) 的定义，RStudio 提供了对 Graphviz (<code>.gv</code>) 和 mermaid (<code>.mmd</code>) 的原生支持，如图 @ref(fig:rstudio-gv) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/04-graphviz-rstudio.png" alt="RStudio 提供对 Graphviz 和 mermaid 的原生支持" width="394" />
<p class="caption">
(#fig:rstudio-gv)RStudio 提供对 Graphviz 和 mermaid 的原生支持
</p>
</div>
<p>我们也可以直接使用 Graphviz 格式的字符串，如图 @ref(fig:gv-diagram) 所示。</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DiagrammeR)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">grViz</span>(<span class="st">&quot;digraph {</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [layout = dot, rankdir = TB]</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = rectangle]</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="st">  rec1 [label = &#39;Step 1. 起床&#39;]</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="st">  rec2 [label = &#39;Step 2. 写代码&#39;]</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="st">  rec3 [label =  &#39;Step 3. ???&#39;]</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="st">  rec4 [label = &#39;Step 4. 赚钱&#39;]</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="st">  # edge definitions with the node IDs</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="st">  rec1 -&gt; rec2 -&gt; rec3 -&gt; rec4</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a><span class="st">  }&quot;</span>,</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">500</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<div id="htmlwidget-1525771a2b0c20ad9472" style="width:672px;height:500px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1525771a2b0c20ad9472">{"x":{"diagram":"digraph {\n  graph [layout = dot, rankdir = TB]\n\n  node [shape = rectangle]\n  rec1 [label = \"Step 1. 起床\"]\n  rec2 [label = \"Step 2. 写代码\"]\n  rec3 [label =  \"Step 3. ???\"]\n  rec4 [label = \"Step 4. 赚钱\"]\n\n  # edge definitions with the node IDs\n  rec1 -> rec2 -> rec3 -> rec4\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:gv-diagram)用 DiagrammeR 创建 Graphviz 流程图
</p>
</div>
<p>我们可以在 <code>grViz</code> 函数用 <code>@@</code> 插入 R 变量的的值，如图 @ref(fig:gv-rvar) 所示。</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>DiagrammeR<span class="sc">::</span><span class="fu">grViz</span>(<span class="st">&quot;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="st">  digraph graph2 {</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="st">  graph [layout = dot, rankdir = LR]</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="st">  # node definitions with substituted label text</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="st">  node [shape = oval]</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="st">  a [label = &#39;@@1&#39;]</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="st">  b [label = &#39;@@2&#39;]</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="st">  c [label = &#39;@@3&#39;]</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="st">  d [label = &#39;@@4&#39;]</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="st">  a -&gt; b -&gt; c -&gt; d</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="st">  [1]: names(iris)[1]</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="st">  [2]: names(iris)[2]</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a><span class="st">  [3]: names(iris)[3]</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="st">  [4]: names(iris)[4]</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="st">  &quot;</span>,</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">100</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<div id="htmlwidget-585eac4a8816ead5a35d" style="width:672px;height:100px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-585eac4a8816ead5a35d">{"x":{"diagram":"\n  digraph graph2 {\n\n  graph [layout = dot, rankdir = LR]\n\n  # node definitions with substituted label text\n  node [shape = oval]\n  a [label = \"Sepal.Length\"]\n  b [label = \"Sepal.Width\"]\n  c [label = \"Petal.Length\"]\n  d [label = \"Petal.Width\"]\n\n  a -> b -> c -> d\n  }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:gv-rvar)在 DiagrammeR::grviz 中使用 R 变量的值
</p>
</div>
<p>除了流程图外，DiagrammeR 可以创建复杂的网络关系可视化，如图 @ref(fig:gr-network) 所示。</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>example_graph <span class="ot">&lt;-</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_graph</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_pa_graph</span>(</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">50</span>, <span class="at">m =</span> <span class="dv">1</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">set_seed =</span> <span class="dv">23</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_gnp_graph</span>(</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="dv">50</span>, <span class="at">p =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">set_seed =</span> <span class="dv">23</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">join_node_attrs</span>(<span class="at">df =</span> <span class="fu">get_betweenness</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">join_node_attrs</span>(<span class="at">df =</span> <span class="fu">get_degree_total</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colorize_node_attrs</span>(</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">node_attr_from =</span> total_degree,</span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">node_attr_to =</span> fillcolor,</span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">palette =</span> <span class="st">&quot;Greens&quot;</span>,</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">90</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rescale_node_attrs</span>(</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">node_attr_from =</span> betweenness,</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_lower_bound =</span> <span class="fl">0.5</span>,</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">to_upper_bound =</span> <span class="fl">1.0</span>,</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">node_attr_to =</span> height</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_nodes_by_id</span>(<span class="at">nodes =</span> <span class="fu">get_articulation_points</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_node_attrs_ws</span>(<span class="at">node_attr =</span> peripheries, <span class="at">value =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_node_attrs_ws</span>(<span class="at">node_attr =</span> penwidth, <span class="at">value =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clear_selection</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_node_attr_to_display</span>(<span class="at">attr =</span> <span class="cn">NULL</span>)</span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a><span class="fu">render_graph</span>(example_graph, <span class="at">layout =</span> <span class="st">&quot;nicely&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<div id="htmlwidget-2daf061c80926c70a37d" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-2daf061c80926c70a37d">{"x":{"diagram":"digraph {\n\ngraph [layout = \"neato\",\n       outputorder = \"edgesfirst\",\n       bgcolor = \"white\"]\n\nnode [fontname = \"Helvetica\",\n      fontsize = \"10\",\n      shape = \"circle\",\n      fixedsize = \"true\",\n      width = \"0.5\",\n      style = \"filled\",\n      fillcolor = \"aliceblue\",\n      color = \"gray70\",\n      fontcolor = \"gray50\"]\n\nedge [fontname = \"Helvetica\",\n     fontsize = \"8\",\n     len = \"1.5\",\n     color = \"gray80\",\n     arrowsize = \"0.5\"]\n\n  \"1\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#41AB5D90\", fontcolor = \"#FFFFFF\", pos = \"17.1953649479398,13.7664235815497!\"] \n  \"2\" [label = \"\", height = \"0.793\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#41AB5D90\", fontcolor = \"#FFFFFF\", pos = \"16.6097450881233,11.5592448711932!\"] \n  \"3\" [label = \"\", height = \"0.522\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"17.7692682111849,15.399572802934!\"] \n  \"4\" [label = \"\", height = \"0.511\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"18.5055910938995,14.3009285049666!\"] \n  \"5\" [label = \"\", height = \"0.62\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#238B4590\", fontcolor = \"#FFFFFF\", pos = \"15.2470738650458,15.0162974507718!\"] \n  \"6\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"17.7462737716732,16.6470020537213!\"] \n  \"7\" [label = \"\", height = \"0.587\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#74C47690\", fontcolor = \"#FFFFFF\", pos = \"15.3098290430855,16.9568362073364!\"] \n  \"8\" [label = \"\", height = \"1\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#005A3290\", fontcolor = \"#FFFFFF\", pos = \"16.5600344815405,9.16979989178174!\"] \n  \"9\" [label = \"\", height = \"0.924\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#41AB5D90\", fontcolor = \"#FFFFFF\", pos = \"18.3532744879252,7.670433329326!\"] \n  \"10\" [label = \"\", height = \"0.674\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#74C47690\", fontcolor = \"#FFFFFF\", pos = \"19.9171714134644,8.5090360386458!\"] \n  \"11\" [label = \"\", height = \"0.598\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"14.9591251748168,8.84490215092126!\"] \n  \"12\" [label = \"\", height = \"0.587\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"13.7364937347119,9.22041414087542!\"] \n  \"13\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"20.84227655505,9.39559790130762!\"] \n  \"14\" [label = \"\", height = \"0.674\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"19.7709986412955,6.62187273230929!\"] \n  \"15\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"14.474100465984,15.8326416278819!\"] \n  \"16\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"19.7100962123276,14.8541506104671!\"] \n  \"17\" [label = \"\", height = \"0.554\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"13.0739178213858,10.2260175971717!\"] \n  \"18\" [label = \"\", height = \"0.533\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"18.9994216059369,13.02013436431!\"] \n  \"19\" [label = \"\", height = \"0.533\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"15.5029861292064,9.92401289656034!\"] \n  \"20\" [label = \"\", height = \"0.543\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"18.3192895108832,6.29394356997325!\"] \n  \"21\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"20.1925613939205,13.3974599844701!\"] \n  \"22\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"19.7090925152239,9.55518055291756!\"] \n  \"23\" [label = \"\", height = \"0.554\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"21.3371623692363,8.33709540965666!\"] \n  \"24\" [label = \"\", height = \"0.522\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"14.1154641958843,13.9874915740414!\"] \n  \"25\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"17.643400975452,11.3407359597014!\"] \n  \"26\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"12.7585531963733,11.2715209688113!\"] \n  \"27\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"15.7463832452721,7.94173349926164!\"] \n  \"28\" [label = \"\", height = \"0.522\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"20.2796024704333,12.2343289117072!\"] \n  \"29\" [label = \"\", height = \"0.609\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"21.2066366522153,6.32422974365489!\"] \n  \"30\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"22.5536497743152,8.0712974913378!\"] \n  \"31\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"15.3409716358524,11.8459228842396!\"] \n  \"32\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"14.561828419528,10.534781710353!\"] \n  \"33\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"20.082060406683,5.48725155808898!\"] \n  \"34\" [label = \"\", height = \"0.522\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"13.7223593314039,15.1691883780268!\"] \n  \"35\" [label = \"\", height = \"0.533\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"14.3800253992162,17.8477696529455!\"] \n  \"36\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"17.5737435530133,9.44257057376601!\"] \n  \"37\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"16.6897082220572,8.07822316807421!\"] \n  \"38\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"13.0960215352337,13.4419529579541!\"] \n  \"39\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"15.5331010395898,18.2537122027896!\"] \n  \"40\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"14.3425071990943,18.866976574049!\"] \n  \"41\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"12.71749437822,15.5308813875762!\"] \n  \"42\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"15.9515070607656,15.5370625493096!\"] \n  \"43\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"21.4141658458669,11.9135238339992!\"] \n  \"44\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"16.1512914353594,12.5023303289582!\"] \n  \"45\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"16.3059640700906,17.6861006580137!\"] \n  \"46\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"18.2994625919886,5.28698584873081!\"] \n  \"47\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"21.9664707728549,5.51279876249922!\"] \n  \"48\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"21.9099966843372,7.25742173113069!\"] \n  \"49\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"18.7615528614153,16.2184884252637!\"] \n  \"50\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"17.3907888372073,6.85014377869301!\"] \n  \"51\" [label = \"\", height = \"0.522\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"25.5901318309259,10.5093138697511!\"] \n  \"52\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"17.3792407160206,20.9779831361543!\"] \n  \"53\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"27.8229373702696,18.0584485832019!\"] \n  \"54\" [label = \"\", height = \"0.543\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"18.9784660522095,19.2637773624552!\"] \n  \"55\" [label = \"\", height = \"0.565\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"20.0856836150866,19.2796827391705!\"] \n  \"56\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"24.2375895538157,8.58018595813116!\"] \n  \"57\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"24.5694243967611,10.2245310068302!\"] \n  \"58\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"24.3684889162273,21.1545770167423!\"] \n  \"59\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"28.5301516235366,11.9179736899166!\"] \n  \"60\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"25.8400547855067,17.2081551316103!\"] \n  \"61\" [label = \"\", height = \"0.511\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"23.817943329745,15.5987706393957!\"] \n  \"62\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"24.7448078170955,6.0245247276997!\"] \n  \"63\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"26.4562895545427,10.007885988831!\"] \n  \"64\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"24.7634626379037,7.85300107590984!\"] \n  \"65\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"18.0266392939644,19.4164718199156!\"] \n  \"66\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"25.5944411226464,7.53645823485464!\"] \n  \"67\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"23.2063500070292,14.8866814743902!\"] \n  \"68\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"25.3796169076064,11.5539120169925!\"] \n  \"69\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"27.4139272425542,8.47989923404495!\"] \n  \"70\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"22.1245739773245,21.5784430622607!\"] \n  \"71\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"23.618183685161,12.4070750649692!\"] \n  \"72\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"24.4950093425028,19.8498931816647!\"] \n  \"73\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"24.9620964968931,18.4292593900331!\"] \n  \"74\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"23.9278719808693,5.76294573999471!\"] \n  \"75\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"16.6411025870442,20.4695688373012!\"] \n  \"76\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"21.2709775309893,17.449361322959!\"] \n  \"77\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"20.713471208932,21.9057427137106!\"] \n  \"78\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"26.9303745437935,16.2931543201963!\"] \n  \"79\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"20.7335858764717,18.3821809772875!\"] \n  \"80\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"23.2199480707022,18.3264508290954!\"] \n  \"81\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"28.8106557550163,15.4604992503617!\"] \n  \"82\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"24.372623102594,16.3486610508802!\"] \n  \"83\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"25.9157897929034,14.9313823005478!\"] \n  \"84\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"28.9257156377277,12.7100650716826!\"] \n  \"85\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"21.7547975341397,16.5890520167424!\"] \n  \"86\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"19.5024826721798,21.1100429263739!\"] \n  \"87\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"27.0481908947475,12.991721649572!\"] \n  \"88\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"27.4385882127456,14.5744780150039!\"] \n  \"89\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"22.8425398376424,20.6327531910344!\"] \n  \"90\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"26.6555181605102,18.680650870543!\"] \n  \"91\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"22.7809188549013,19.0823652622618!\"] \n  \"92\" [label = \"\", height = \"0.533\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"20.1404998640758,20.344799511278!\"] \n  \"93\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#C7E9C090\", fontcolor = \"#FFFFFF\", pos = \"28.2559417812069,11.020429605858!\"] \n  \"94\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"29.04032710494,14.0970571291133!\"] \n  \"95\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"28.3337327618447,16.7323201786231!\"] \n  \"96\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#F7FCF590\", fontcolor = \"#FFFFFF\", pos = \"26.0762073149206,19.9579185005276!\"] \n  \"97\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"28.3096436158873,10.1224464056111!\"] \n  \"98\" [label = \"\", height = \"0.5\", peripheries = \"2\", penwidth = \"3\", fillcolor = \"#A1D99B90\", fontcolor = \"#FFFFFF\", pos = \"24.6728919285276,12.4239621556797!\"] \n  \"99\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"27.0371240606205,7.69401570439979!\"] \n  \"100\" [label = \"\", height = \"0.5\", peripheries = \"\", penwidth = \"\", fillcolor = \"#E5F5E090\", fontcolor = \"#FFFFFF\", pos = \"24.9995253162449,13.3706161917643!\"] \n  \"2\"->\"1\" \n  \"3\"->\"1\" \n  \"4\"->\"1\" \n  \"5\"->\"1\" \n  \"6\"->\"3\" \n  \"7\"->\"5\" \n  \"8\"->\"2\" \n  \"9\"->\"8\" \n  \"10\"->\"9\" \n  \"11\"->\"8\" \n  \"12\"->\"11\" \n  \"13\"->\"10\" \n  \"14\"->\"9\" \n  \"15\"->\"5\" \n  \"16\"->\"4\" \n  \"17\"->\"12\" \n  \"18\"->\"1\" \n  \"19\"->\"8\" \n  \"20\"->\"9\" \n  \"21\"->\"18\" \n  \"22\"->\"10\" \n  \"23\"->\"10\" \n  \"24\"->\"5\" \n  \"25\"->\"2\" \n  \"26\"->\"17\" \n  \"27\"->\"8\" \n  \"28\"->\"18\" \n  \"29\"->\"14\" \n  \"30\"->\"23\" \n  \"31\"->\"2\" \n  \"32\"->\"19\" \n  \"33\"->\"14\" \n  \"34\"->\"5\" \n  \"35\"->\"7\" \n  \"36\"->\"8\" \n  \"37\"->\"8\" \n  \"38\"->\"24\" \n  \"39\"->\"7\" \n  \"40\"->\"35\" \n  \"41\"->\"34\" \n  \"42\"->\"5\" \n  \"43\"->\"28\" \n  \"44\"->\"2\" \n  \"45\"->\"7\" \n  \"46\"->\"20\" \n  \"47\"->\"29\" \n  \"48\"->\"29\" \n  \"49\"->\"3\" \n  \"50\"->\"9\" \n  \"63\"->\"51\" \n  \"75\"->\"52\" \n  \"65\"->\"54\" \n  \"54\"->\"55\" \n  \"64\"->\"56\" \n  \"51\"->\"57\" \n  \"84\"->\"59\" \n  \"93\"->\"59\" \n  \"67\"->\"61\" \n  \"74\"->\"62\" \n  \"64\"->\"66\" \n  \"51\"->\"68\" \n  \"98\"->\"68\" \n  \"99\"->\"69\" \n  \"98\"->\"71\" \n  \"55\"->\"79\" \n  \"76\"->\"79\" \n  \"61\"->\"82\" \n  \"76\"->\"85\" \n  \"92\"->\"86\" \n  \"80\"->\"91\" \n  \"55\"->\"92\" \n  \"93\"->\"97\" \n  \"98\"->\"100\" \n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:gr-network)DiagrammeR 创作的网络可视化图
</p>
</div>
<p>生成网络和流程图的 R 包还有其他选择：<a href="https://github.com/rstudio/nomnoml">nomnoml</a>，diagram，<a href="https://github.com/jtextor/dagitty">dagitty</a>，<a href="https://github.com/malcolmbarrett/ggdag">ggdadg</a> 和 <a href="https://github.com/rkrug/plantuml">plantuml</a> 等。</p>
</div>
<div id="插入分页符和分割线" class="section level2" number="4.11">
<h2 number="4.11"><span class="header-section-number">4.11</span> 插入分页符和分割线</h2>
<p>我们可以用 <code>\newpage</code> 在各类输出文档中插入分页符。这是一个 LaTeX 命令，但 R Markdown 会帮我们翻译为其他格式理解的语法。同时，可以用 Markdown 语法 <code>___</code> 插入一条水平分割线。</p>
<pre><code>```{r}
---
title: 插入分页符和分割线
output:
  pdf_document: default
  word_document: default
  html_document: default
  odt_document: default
---

# The first section

\newpage

___

# The second section
```</code></pre>
<!--chapter:end:04-document-elements.Rmd-->
</div>
</div>
<div id="typesetting" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> 排版</h1>
<p>迄今为止，我们在 R Markdown 中的排版效果都是通过 Markdown 实现的。Markdown 的核心设计原则是用简洁的标记表示必需的格式，让新手也能快速上手。正如 Markdown 的作者 John Gruber 所言：</p>
<blockquote>
<p>一个 Markdown 文档应该作为纯文本原样发布，而不需要添加各种样式标签和排版指令。</p>
</blockquote>
<p>由此见得，Markdown 并不希望成为某个完备的排版解决方案。我们不是想用 <code>#</code>, <code>*</code>, <code>-</code> 等表示可穷尽的样式，而是用简单易记的语法满足最常见的格式需要，仅此而已。这意味着 Markdown 不能满足较为复杂的排版需求，例如：</p>
<ul>
<li><p>改变某个段落的字体大小</p></li>
<li><p>设置字体颜色</p></li>
<li><p>调整段落对齐</p></li>
<li><p>设置复杂的文字和图片布局</p></li>
</ul>
<p>本章介绍了突破 Markdown 排版限制的解决办法。我们首先介绍 HTML 和 PDF 格式下通用的排版解决策略，随后探讨如何应对一些常见的具体问题。但在追求复杂排版效果之前，读者应首先考虑它们是否是必需的，以及达成的效果是否值得花费额外时间。</p>
<div id="通用方案" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> 通用方案</h2>
<div id="html" class="section level3" number="5.1.1">
<h3 number="5.1.1"><span class="header-section-number">5.1.1</span> HTML</h3>
<div id="css-基础" class="section level4" number="5.1.1.1">
<h4 number="5.1.1.1"><span class="header-section-number">5.1.1.1</span> CSS 基础</h4>
<p>CSS (层叠样式表) 是一种设置 HTML 网页的布局与样式的语言，以 <code>.css</code> 文件存储。一个 CSS 文件包含了针对不同网页元素的排版规则，例如下面的 CSS 样式表</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>h1 {</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span>: <span class="cn">red</span><span class="op">;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-size</span>: <span class="dv">5</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>p span {</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span>: <span class="cn">blue</span><span class="op">;</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>上面的 CSS 包含两条规则，每个规则均由一条选择器 (selector) 开头，它定义了规则应用的网页元素。选择器后跟着一对大括号 <code>{ }</code>，其中包含了规则的具体内容。我们可以这样解读这两条规则：</p>
<pre><code>1. 对所有 &lt;h1&gt; 元素，设置它们的字体颜色为红色 (red)，大小为 5 倍默认字体的大小

2. 对所有 &lt;p&gt; 元素包含的 &lt;span&gt; 元素，设置它们的字体颜色为蓝色 (blue)
</code></pre>
<p>除了颜色，大小，对齐等等简单属性外，CSS 还可用于设计复杂的布局，假设有如下网页结构：</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;container&quot;</span><span class="kw">&gt;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;sub-container&quot;</span><span class="kw">&gt;</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;one&quot;</span><span class="kw">&gt;</span>text<span class="kw">&lt;/div&gt;</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;two&quot;</span><span class="kw">&gt;</span>text<span class="kw">&lt;/div&gt;</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;three&quot;</span><span class="kw">&gt;</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>      text</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>添加基础样式 (边框，间距) 后，网页效果如图 @ref(fig:without-flexbox) 所示，各容器从上到下顺序排列，每个容器单独一行。这也是 Markdown 支持的布局。</p>
<div class="figure" style="text-align: center">
<img src="images/05-without-flexbox.jpg" alt="添加 CSS 布局前"  />
<p class="caption">
(#fig:without-flexbox)添加 CSS 布局前
</p>
</div>
<p>我们可以用 CSS 调整 <code>.container</code> 和 <code>.sub-container</code> 中各元素的排布，添加 CSS：</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.container</span> {</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span>: flex<span class="op">;</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">justify-content</span>: space-around<span class="op">;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">align-items</span>: <span class="dv">center</span><span class="op">;</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">row-gap</span>: <span class="dv">20</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="fu">.sub-container</span> {</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">display</span>: flex<span class="op">;</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">flex-direction</span>: column<span class="op">;</span></span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">justify-content</span>: space-between<span class="op">;</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>display: flex</code> 为容器设置了 flexbox 布局, 突破了常规文档流的默认布局限制。<code>justify-content</code> 和 <code>align-items</code> 等属性进一步自定义了 flexbox 布局的效果，如图 @ref(fig:flexbox) 所示。</p>
<div class="figure" style="text-align: center">
<img src="images/05-flexbox.jpg" alt="添加 CSS 布局后"  />
<p class="caption">
(#fig:flexbox)添加 CSS 布局后
</p>
</div>
<p>我们不再深入 CSS 选择器的语法和属性设置。读者可以在 <a href="https://developer.mozilla.org/zh-CN/docs/Learn/CSS">MDN 文档</a> 学习更多 CSS 知识。</p>
</div>
<div id="在-r-markdown-中使用-css" class="section level4" number="5.1.1.2">
<h4 number="5.1.1.2"><span class="header-section-number">5.1.1.2</span> 在 R Markdown 中使用 CSS</h4>
<p>我们可以在 HTML 输出格式的 YAML 选项中引用根目录下 CSS 文件，例如：</p>
<pre><code>---
output:
  html_document:
    css: style.css
  bookdown::gitbook::
    css: [&quot;style.css&quot;, &quot;toc.css&quot;]
---</code></pre>
<p>随后，我们可以在对应的 CSS 文件中添加规则，这需要知道想控制元素对应的 CSS 选择器，常见文档元素对应的选择器如表 @ref(tab:selectors) 所示。</p>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:selectors">
<caption style="caption-side: top; text-align: center;">(#tab:selectors) </caption><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>元素</p>
</th><th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>CSS 选择器</p>
</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>文档标题</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>#title</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>章节标题</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>.section h1</code>，<code>.section h2</code>，<code>.section h3</code>，...</p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>段落</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>p</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>代码块和文字输出</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>pre code</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>粗体</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>p strong</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>斜体</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>p em</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>图片</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>img</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>链接</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>a</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>表格</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>table</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>浮动目录</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>#TOC</code></p>
</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p>符动目录链接</p>
</td><td style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"><p><code>#TOC li</code></p>
</td></tr>
</table>

<p>假设我们要设置段落的行高，已经知道段落对应的 CSS 选择器为 <code>p</code>。下面在网络上搜索行高对应 CSS 的属性名称，例如 “MDN CSS 行高” 会告诉我们该属性为 <code>line-height</code>, 那么可以在 <code>style.css</code> 中设置：</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>p {</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">line-height</span>: <span class="dv">120</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>除了引用 CSS 文件外，我们还可以直接在 R Markdown 中运行 CSS 代码块，改变当前文档的 CSS 样式，例如下面的源文档：</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &#39;运行 CSS 代码块&#39;</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>在文档开始应用 CSS 样式：</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, echo = FALSE}</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="in">@import url(&#39;https://fonts.googleapis.com/css2?family=Fira+Code:wght@300&amp;family=Noto+Sans+SC:wght@300&amp;display=swap&#39;);</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="in">body {</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="in">  background-color: #DEE4E7</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="in">.section h1, .section h2 {</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #0462a1;</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="in">p {</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: &quot;Noto Sans&quot;, serif</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="in">code, pre{</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="in">  font-family: &#39;Fira Code&#39;, monospace;</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="in">p.caption {</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #777;</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a><span class="in">  margin-top: 10px;</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="in">p code {</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a><span class="in">  white-space: inherit;</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a><span class="in">pre {</span></span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a><span class="in">  word-break: normal;</span></span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a><span class="in">  word-wrap: normal;</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a><span class="in">  -webkit-box-shadow: 0px 8px 5px -8px rgba(0,0,0,0.75);</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a><span class="in">  -moz-box-shadow: 0px 8px 5px -8px rgba(0,0,0,0.75);</span></span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a><span class="in">  box-shadow: 0px 8px 5px -8px rgba(0,0,0,0.75);</span></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a><span class="in">pre code {</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a><span class="in">  white-space: inherit;</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a><span class="in">section.normal strong {</span></span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a><span class="in">  color: #0462a1;</span></span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a><span class="fu"># 一级标题</span></span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a>**注意**：CSS 代码块只适合规则较少时使用。</span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-54"><a href="#cb98-54" aria-hidden="true" tabindex="-1"></a><span class="in">`代码`</span> 段样式：</span>
<span id="cb98-55"><a href="#cb98-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-56"><a href="#cb98-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb98-57"><a href="#cb98-57" aria-hidden="true" tabindex="-1"></a><span class="in">print(&quot;hello world&quot;)</span></span>
<span id="cb98-58"><a href="#cb98-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-59"><a href="#cb98-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-60"><a href="#cb98-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-61"><a href="#cb98-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb98-62"><a href="#cb98-62" aria-hidden="true" tabindex="-1"></a><span class="in">function_that_does_nothing &lt;- function() {</span></span>
<span id="cb98-63"><a href="#cb98-63" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 1 </span></span>
<span id="cb98-64"><a href="#cb98-64" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 1</span></span>
<span id="cb98-65"><a href="#cb98-65" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 2</span></span>
<span id="cb98-66"><a href="#cb98-66" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 3</span></span>
<span id="cb98-67"><a href="#cb98-67" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 5</span></span>
<span id="cb98-68"><a href="#cb98-68" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 8</span></span>
<span id="cb98-69"><a href="#cb98-69" aria-hidden="true" tabindex="-1"></a><span class="in">  x</span></span>
<span id="cb98-70"><a href="#cb98-70" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb98-71"><a href="#cb98-71" aria-hidden="true" tabindex="-1"></a><span class="in">function_that_does_nothing()</span></span>
<span id="cb98-72"><a href="#cb98-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb98-73"><a href="#cb98-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-74"><a href="#cb98-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## 二级标题一</span></span>
<span id="cb98-75"><a href="#cb98-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-76"><a href="#cb98-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## 二级标题二</span></span>
<span id="cb98-77"><a href="#cb98-77" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>
<p>效果如图 @ref(fig:css-chunk) 所示。</p>
<div class="figure" style="text-align: center">
<img src="examples/css-chunk.png" alt="在 R Markdown 中直接运行 CSS 代码块" width="350" />
<p class="caption">
(#fig:css-chunk)在 R Markdown 中直接运行 CSS 代码块
</p>
</div>
<p>如果仅想设定少量元素的 CSS 属性，可以直接在 R Markdown 源文档中插入 HTML 标签，如 <code>&lt;span style = "background-color: yellow"&gt;&lt;strong&gt;这是一段高亮&lt;/strong&gt;&lt;/span&gt;</code> 会变为 <span style="background-color: yellow"><strong>这是一段高亮</strong></span>。</p>
<p>有时我们需要自己创造 CSS 选择器，手动插入大量 HTML 标签稍嫌麻烦，这时可以运用 Pandoc 的 “fenced div” 特性。用前后一对 <code>:::</code> 表示一个 div 容器，嵌套 div 时需在外层 div 添加一对 <code>:</code>，例如：</p>
<pre><code>::: {#special}
这是第一个 div
:::

:::: {.special}
这是第二个 div

:::
这是第三个 div
:::

::::</code></pre>
<p>Pandoc 将以上语法渲染为 HTML 元素：</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;special&quot;</span><span class="kw">&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    这是一个 div</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;special&quot;</span><span class="kw">&gt;</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    这是第二个 div</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;div&gt;</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>        这是第三个 div</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>随后我们可以在 CSS 中使用 <code>#special</code>, <code>.special</code> 和 <code>.special div</code> 等选择器选择以上三个 div 元素，应用 CSS 样式。</p>
</div>
<div id="用-bslib-包自定义-bootstrap-主题" class="section level4" number="5.1.1.3">
<h4 number="5.1.1.3"><span class="header-section-number">5.1.1.3</span> 用 bslib 包自定义 bootstrap 主题</h4>
<p>我们在第 @ref(theme-templates) 节提到 R Markdown 的 HTML 输出基于 bootstrap 框架，采用了 bootstrap 提供的大量 CSS 样式。对于这样的大型前端框架，样式往往是通过 SCSS 变量的方式实现的。SCSS 是 CSS 的一种扩展，增加了变量，嵌套，导入等特性。例如，我们在下面用 SCSS 变量定义了一套配色方案：</p>
<pre class="scss"><code>$white:    #fff !default;
$gray-100: #f8f9fa !default;
$gray-200: #e9ecef !default;
...
$gray-900: #212529 !default;
$black:    #000 !default;

$primary:       $blue !default;
$secondary:     $gray-600 !default;
$success:       $green !default;
$info:          $cyan !default;
$warning:       $yellow !default;
$danger:        $red !default;</code></pre>
<p>随后，在 CSS/SCSS 中使用 <code>primary</code>, <code>secondary</code>, <code>success</code> 等变量，就可以应用该主题到网页上。如果想要应用另一套配色方案/主题，更改这些变量的值即可。每个基于 bootstrap 生成的网页由类似如下的颜色设置：</p>
<pre class="scss"><code>selector-1 {
  color: $secondary;
  background-color: $primary；
}
selector-1:hover {
  background-color: $primary;
}

selector-2 {
  border-color: $info;
}</code></pre>
<p>因此，我们可以通过改变 bootstrap 的 SCSS 变量值来定义 R Markdown HTML 输出的样式。这些变量不限于颜色，还包括大小，间距，字体等。<strong>bslib</strong> 包 <span class="citation">(<a href="#ref-R-bslib" role="doc-biblioref">Sievert and Cheng 2021</a>)</span> 允许直接在 R Markdown 的 YAML 选项中定义 bootstrap 变量，例如：</p>
<pre><code>---
output:
  html_document:
    theme:
      bg: &quot;#101010&quot;
      fg: &quot;#FDF7F7&quot;
      primary: &quot;#ED79F9&quot;
      base_font:
        google: &quot;Prompt&quot;
      code_font:
        google: &quot;JetBrains Mono&quot;
---</code></pre>
<p>效果如图 @ref(fig:bslib-demo) 所示。读者还可以用 <a href="https://rstudio.github.io/thematic/">thematic</a> 包让 R 生成的图片自适应当前主题的配色。</p>
<div class="figure" style="text-align: center">
<img src="examples/bslib-demo.png" alt="用 bslib 定义 bootstrap Sass 变量" width="350" />
<p class="caption">
(#fig:bslib-demo)用 bslib 定义 bootstrap Sass 变量
</p>
</div>
<p>我们还可以直接选择 bootswatch 主题：</p>
<pre><code>---
output:
  html_document:
    theme:
      bootswatch: minty
---</code></pre>
</div>
</div>
<div id="latex" class="section level3" number="5.1.2">
<h3 number="5.1.2"><span class="header-section-number">5.1.2</span> LaTeX</h3>
<p>对基于 LaTeX 的 PDF 输出格式，进阶的排版设置稍复杂些。但大部分问题都可通过 “搜索 + 引入 LaTeX 包” 解决。</p>
<p>例如，默认生成的 PDF 中链接与其他文字颜色相同，不易区分。我们希望自定义各类链接的颜色，在搜索引擎中搜索 “latex href color”，可以在 stackoverflow 上看到问题 <a href="https://tex.stackexchange.com/questions/61015/how-to-use-different-colors-for-different-href-commands" class="uri">https://tex.stackexchange.com/questions/61015/how-to-use-different-colors-for-different-href-commands</a>，第一个回答给出了 LaTeX 命令：</p>
<pre><code>\documentclass{article}
\usepackage[colorlinks = true,
            linkcolor = blue,
            urlcolor  = blue,
            citecolor = blue,
            anchorcolor = blue]{hyperref}
\begin{document}
Here is \href{http://www.google.com}{Google} and \href{http://www.yahoo.com}{Yahoo!}.
\end{document}</code></pre>
R Markdown 用户需要在上面的答案中截取颜色设置的部分。LaTeX 中，<code>\documentclass{article}</code> 定义了文档类型
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-distill" class="csl-entry">
Allaire, JJ, Rich Iannone, Alison Presmanes Hill, and Yihui Xie. 2021. <em>Distill: R Markdown Format for Scientific and Technical Writing</em>. <a href="https://CRAN.R-project.org/package=distill">https://CRAN.R-project.org/package=distill</a>.
</div>
<div id="ref-R-rmarkdown" class="csl-entry">
Allaire, JJ, Yihui Xie, Jonathan McPherson, Javier Luraschi, Kevin Ushey, Aron Atkins, Hadley Wickham, Joe Cheng, Winston Chang, and Richard Iannone. 2021. <em>Rmarkdown: Dynamic Documents for r</em>.
</div>
<div id="ref-R-rticles" class="csl-entry">
Allaire, JJ, Yihui Xie, R Foundation, Hadley Wickham, Journal of Statistical Software, Ramnath Vaidyanathan, Association for Computing Machinery, et al. 2021. <em>Rticles: Article Formats for r Markdown</em>. <a href="https://github.com/rstudio/rticles">https://github.com/rstudio/rticles</a>.
</div>
<div id="ref-R-shiny" class="csl-entry">
Chang, Winston, Joe Cheng, JJ Allaire, Carson Sievert, Barret Schloerke, Yihui Xie, Jeff Allen, Jonathan McPherson, Alan Dipert, and Barbara Borges. 2021. <em>Shiny: Web Application Framework for r</em>. <a href="https://shiny.rstudio.com/">https://shiny.rstudio.com/</a>.
</div>
<div id="ref-R-leaflet" class="csl-entry">
Cheng, Joe, Bhaskar Karambelkar, and Yihui Xie. 2021. <em>Leaflet: Create Interactive Web Maps with the JavaScript Leaflet Library</em>. <a href="https://rstudio.github.io/leaflet/">https://rstudio.github.io/leaflet/</a>.
</div>
<div id="ref-R-flexdashboard" class="csl-entry">
Iannone, Richard, JJ Allaire, and Barbara Borges. 2020. <em>Flexdashboard: R Markdown Format for Flexible Dashboards</em>. <a href="http://rmarkdown.rstudio.com/flexdashboard">http://rmarkdown.rstudio.com/flexdashboard</a>.
</div>
<div id="ref-R-prettydoc" class="csl-entry">
Qiu, Yixuan. 2021. <em>Prettydoc: Creating Pretty Documents from r Markdown</em>. <a href="https://github.com/yixuan/prettydoc">https://github.com/yixuan/prettydoc</a>.
</div>
<div id="ref-R-base" class="csl-entry">
R Core Team. 2021. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-R-bslib" class="csl-entry">
Sievert, Carson, and Joe Cheng. 2021. <em>Bslib: Custom Bootstrap ’Sass’ Themes for Shiny and Rmarkdown</em>. <a href="https://CRAN.R-project.org/package=bslib">https://CRAN.R-project.org/package=bslib</a>.
</div>
<div id="ref-R-reticulate" class="csl-entry">
Ushey, Kevin, JJ Allaire, and Yuan Tang. 2021. <em>Reticulate: Interface to Python</em>. <a href="https://github.com/rstudio/reticulate">https://github.com/rstudio/reticulate</a>.
</div>
<div id="ref-R-htmlwidgets" class="csl-entry">
Vaidyanathan, Ramnath, Yihui Xie, JJ Allaire, Joe Cheng, Carson Sievert, and Kenton Russell. 2020. <em>Htmlwidgets: HTML Widgets for r</em>. <a href="https://github.com/ramnathv/htmlwidgets">https://github.com/ramnathv/htmlwidgets</a>.
</div>
<div id="ref-R-dygraphs" class="csl-entry">
Vanderkam, Dan, JJ Allaire, Jonathan Owen, Daniel Gromer, and Benoit Thieurmel. 2018. <em>Dygraphs: Interface to Dygraphs Interactive Time Series Charting Library</em>. <a href="https://github.com/rstudio/dygraphs">https://github.com/rstudio/dygraphs</a>.
</div>
<div id="ref-R-babynames" class="csl-entry">
Wickham, Hadley. 2021. <em>Babynames: US Baby Names 1880-2017</em>. <a href="https://github.com/hadley/babynames">https://github.com/hadley/babynames</a>.
</div>
<div id="ref-R-ggplot2" class="csl-entry">
Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2021. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2">https://CRAN.R-project.org/package=ggplot2</a>.
</div>
<div id="ref-R-bookdown" class="csl-entry">
Xie, Yihui. 2021a. <em>Bookdown: Authoring Books and Technical Documents with r Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown">https://CRAN.R-project.org/package=bookdown</a>.
</div>
<div id="ref-R-knitr" class="csl-entry">
———. 2021b. <em>Knitr: A General-Purpose Package for Dynamic Report Generation in r</em>. <a href="https://yihui.org/knitr/">https://yihui.org/knitr/</a>.
</div>
<div id="ref-R-xaringan" class="csl-entry">
———. 2021c. <em>Xaringan: Presentation Ninja</em>. <a href="https://github.com/yihui/xaringan">https://github.com/yihui/xaringan</a>.
</div>
<div id="ref-R-DT" class="csl-entry">
Xie, Yihui, Joe Cheng, and Xianying Tan. 2021. <em>DT: A Wrapper of the JavaScript Library DataTables</em>. <a href="https://github.com/rstudio/DT">https://github.com/rstudio/DT</a>.
</div>
<div id="ref-R-pagedown" class="csl-entry">
Xie, Yihui, Romain Lesur, Brent Thorne, and Xianying Tan. 2021. <em>Pagedown: Paginate the HTML Output of r Markdown with CSS for Print</em>. <a href="https://github.com/rstudio/pagedown">https://github.com/rstudio/pagedown</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>在控制台中调用 <code>render()</code> 时，R 会在当前进程运行源文档的代码，而 Knit 按钮会新建一个空白的环境完成编译。为了确保当前 R 进程不对 R Markdown 造成干扰，最好清空当前环境或重启 R 后使用 <code>render()</code>。<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>注意，YAML 中的布尔变量 <code>true</code> 和 <code>false</code> 均是小写<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Markdown 不要求我们添加替代文字，例如 <code>![](图片链接)</code> 也可以正常显示图片。但是替代文字可以提供许多好处，例如它可以在图片显示错误的时候代替图片显示，增强网页的可达性，帮助搜索引擎优化等。<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://rmarkdown-guide.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
