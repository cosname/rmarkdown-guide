<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 6 章 R Markdown 的操作技巧 | R Markdown 指南</title>
  <meta name="description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta name="github-repo" content="cosname/rmarkdown-guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  
  <meta name="twitter:description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  

<meta name="author" content="王祎帆" />
<meta name="author" content="闫求识" />
<meta name="author" content="高春辉" />
<meta name="author" content="庄亮亮" />
<meta name="author" content="杨晓龙" />


<meta name="date" content="2022-04-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rmarkdown-interaction.html"/>
<link rel="next" href="rmarkdown-project.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Markdown 中文指南</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a></li>
<li class="part"><span><b>I 初识 R Markdown</b></span></li>
<li class="chapter" data-level="1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html"><i class="fa fa-check"></i><b>1</b> R Markdown概述</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#rmarkdown-source"><i class="fa fa-check"></i><b>1.1</b> R Markdown 的渊源</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#knitr-sweave"><i class="fa fa-check"></i><b>1.1.1</b> knitr 和 Sweave</a></li>
<li class="chapter" data-level="1.1.2" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#mark-pandoc"><i class="fa fa-check"></i><b>1.1.2</b> 标记语言和 Pandoc 转换器</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#rmarkdown-example"><i class="fa fa-check"></i><b>1.2</b> 以案例形式初识 R Markdown</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-report"><i class="fa fa-check"></i><b>1.2.1</b> 数据分析报告</a></li>
<li class="chapter" data-level="1.2.2" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-note"><i class="fa fa-check"></i><b>1.2.2</b> 交互笔记本</a></li>
<li class="chapter" data-level="1.2.3" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-cv"><i class="fa fa-check"></i><b>1.2.3</b> 个人简历</a></li>
<li class="chapter" data-level="1.2.4" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-resume"><i class="fa fa-check"></i><b>1.2.4</b> 网站</a></li>
<li class="chapter" data-level="1.2.5" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-ppt"><i class="fa fa-check"></i><b>1.2.5</b> 幻灯片</a></li>
<li class="chapter" data-level="1.2.6" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-forms"><i class="fa fa-check"></i><b>1.2.6</b> 交互报表</a></li>
<li class="chapter" data-level="1.2.7" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-dynamic"><i class="fa fa-check"></i><b>1.2.7</b> 动态文档</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html"><i class="fa fa-check"></i><b>2</b> R Markdown 的基础知识</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rstudio-config"><i class="fa fa-check"></i><b>2.1</b> R Studio 相关的配置</a></li>
<li class="chapter" data-level="2.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rmarkdown-install"><i class="fa fa-check"></i><b>2.2</b> R Markdown 的安装</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-rmd"><i class="fa fa-check"></i><b>2.2.1</b> 安装 R Markdown</a></li>
<li class="chapter" data-level="2.2.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-tinytex"><i class="fa fa-check"></i><b>2.2.2</b> 安装 Tinytex</a></li>
<li class="chapter" data-level="2.2.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-git"><i class="fa fa-check"></i><b>2.2.3</b> 安装 Git (*)</a></li>
<li class="chapter" data-level="2.2.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-graph"><i class="fa fa-check"></i><b>2.2.4</b> 安装 RStudio 图形化编辑器</a></li>
<li class="chapter" data-level="2.2.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#create-rmd"><i class="fa fa-check"></i><b>2.2.5</b> 创建第一个 R Markdown 文档</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rmarkdown-compile"><i class="fa fa-check"></i><b>2.3</b> R Markdown 的编译过程</a></li>
<li class="chapter" data-level="2.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rmarkdown-element"><i class="fa fa-check"></i><b>2.4</b> R Markdown 的基本元素</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#yaml"><i class="fa fa-check"></i><b>2.4.1</b> YAML 头部</a></li>
<li class="chapter" data-level="2.4.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#markdown"><i class="fa fa-check"></i><b>2.4.2</b> Markdown 语法</a></li>
<li class="chapter" data-level="2.4.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#block-inline"><i class="fa fa-check"></i><b>2.4.3</b> 代码区块和行内代码</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#page-layout"><i class="fa fa-check"></i><b>2.5</b> 页面设置和布局</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#output-width"><i class="fa fa-check"></i><b>2.5.1</b> 控制输出宽度</a></li>
<li class="chapter" data-level="2.5.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#line-break"><i class="fa fa-check"></i><b>2.5.2</b> 换行符号</a></li>
<li class="chapter" data-level="2.5.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#page-break"><i class="fa fa-check"></i><b>2.5.3</b> 分页符和分割线</a></li>
<li class="chapter" data-level="2.5.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#catalog"><i class="fa fa-check"></i><b>2.5.4</b> 目录</a></li>
<li class="chapter" data-level="2.5.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#chapter-number"><i class="fa fa-check"></i><b>2.5.5</b> 章节编号</a></li>
<li class="chapter" data-level="2.5.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#plottable-index"><i class="fa fa-check"></i><b>2.5.6</b> 图表的索引</a></li>
<li class="chapter" data-level="2.5.7" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#reference-index"><i class="fa fa-check"></i><b>2.5.7</b> 参考文献</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#document-element"><i class="fa fa-check"></i><b>2.6</b> R Markdown 的文档元素</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-plot"><i class="fa fa-check"></i><b>2.6.1</b> 图片</a></li>
<li class="chapter" data-level="2.6.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-table"><i class="fa fa-check"></i><b>2.6.2</b> 表格</a></li>
<li class="chapter" data-level="2.6.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-equation"><i class="fa fa-check"></i><b>2.6.3</b> 公式</a></li>
<li class="chapter" data-level="2.6.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-quote"><i class="fa fa-check"></i><b>2.6.4</b> 引用</a></li>
<li class="chapter" data-level="2.6.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-textcol"><i class="fa fa-check"></i><b>2.6.5</b> 字体颜色</a></li>
<li class="chapter" data-level="2.6.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-dynamic"><i class="fa fa-check"></i><b>2.6.6</b> 动态交互元件</a></li>
<li class="chapter" data-level="2.6.7" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-video"><i class="fa fa-check"></i><b>2.6.7</b> 音频和视频</a></li>
<li class="chapter" data-level="2.6.8" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-flow"><i class="fa fa-check"></i><b>2.6.8</b> 流程图</a></li>
<li class="chapter" data-level="2.6.9" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-gantt"><i class="fa fa-check"></i><b>2.6.9</b> 甘特图</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 基于R Markdown的应用</b></span></li>
<li class="chapter" data-level="3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html"><i class="fa fa-check"></i><b>3</b> 使用 R Markdown 创建常用文档</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-html"><i class="fa fa-check"></i><b>3.1</b> HTML 文档</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-title"><i class="fa fa-check"></i><b>3.1.1</b> 目录和标题</a></li>
<li class="chapter" data-level="3.1.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-theme"><i class="fa fa-check"></i><b>3.1.2</b> 主题和样式</a></li>
<li class="chapter" data-level="3.1.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-pic"><i class="fa fa-check"></i><b>3.1.3</b> 图片和数据框</a></li>
<li class="chapter" data-level="3.1.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-module"><i class="fa fa-check"></i><b>3.1.4</b> 组件和内容</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-pdf"><i class="fa fa-check"></i><b>3.2</b> PDF 文档</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-rmd"><i class="fa fa-check"></i><b>3.2.1</b> 从 R Markdown 到 PDF 文档</a></li>
<li class="chapter" data-level="3.2.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-chinese"><i class="fa fa-check"></i><b>3.2.2</b> 在 PDF 文档中使用中文的注意事项</a></li>
<li class="chapter" data-level="3.2.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-general-setting"><i class="fa fa-check"></i><b>3.2.3</b> 与 HTML 文档中相通的一些设置</a></li>
<li class="chapter" data-level="3.2.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex"><i class="fa fa-check"></i><b>3.2.4</b> LaTeX 选项</a></li>
<li class="chapter" data-level="3.2.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex-citation"><i class="fa fa-check"></i><b>3.2.5</b> 使用 LaTeX 包处理参考文献</a></li>
<li class="chapter" data-level="3.2.6" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex-engine"><i class="fa fa-check"></i><b>3.2.6</b> LaTeX 的渲染引擎</a></li>
<li class="chapter" data-level="3.2.7" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-keep-tex"><i class="fa fa-check"></i><b>3.2.7</b> 保留生成的 TeX 中间文件</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-ppt"><i class="fa fa-check"></i><b>3.3</b> PPT 幻灯片</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#ioslides-presentation"><i class="fa fa-check"></i><b>3.3.1</b> ioslides 幻灯片</a></li>
<li class="chapter" data-level="3.3.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#slidy-presentation"><i class="fa fa-check"></i><b>3.3.2</b> Slidy 幻灯片</a></li>
<li class="chapter" data-level="3.3.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#beamer-presentation"><i class="fa fa-check"></i><b>3.3.3</b> Beamer 幻灯片</a></li>
<li class="chapter" data-level="3.3.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#powerpoint-presentation"><i class="fa fa-check"></i><b>3.3.4</b> PowerPoint 幻灯片</a></li>
<li class="chapter" data-level="3.3.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#ppt-xaringan"><i class="fa fa-check"></i><b>3.3.5</b> Xaringan 幻灯片</a></li>
<li class="chapter" data-level="3.3.6" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#xaringan-extension"><i class="fa fa-check"></i><b>3.3.6</b> Xaringan 幻灯片的扩展包</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-word"><i class="fa fa-check"></i><b>3.4</b> Word 文档</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-template"><i class="fa fa-check"></i><b>3.4.1</b> 创建 word 模板</a></li>
<li class="chapter" data-level="3.4.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-custom-template"><i class="fa fa-check"></i><b>3.4.2</b> 自定义 Word 模板</a></li>
<li class="chapter" data-level="3.4.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-rmd"><i class="fa fa-check"></i><b>3.4.3</b> R Markdown 和 Word 之间的双向工作流程</a></li>
<li class="chapter" data-level="3.4.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-style"><i class="fa fa-check"></i><b>3.4.4</b> 个人风格元素</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-new"><i class="fa fa-check"></i><b>3.5</b> 创建新的文档格式</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-existing"><i class="fa fa-check"></i><b>3.5.1</b> 从现有文档格式衍生新格式</a></li>
<li class="chapter" data-level="3.5.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-new"><i class="fa fa-check"></i><b>3.5.2</b> 完全的自定义输出格式</a></li>
<li class="chapter" data-level="3.5.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-using"><i class="fa fa-check"></i><b>3.5.3</b> 使用新的文档输出格式</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html"><i class="fa fa-check"></i><b>4</b> 基于 R Markdown 工作与学习</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-email"><i class="fa fa-check"></i><b>4.1</b> 发邮件：blastula</a></li>
<li class="chapter" data-level="4.2" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-package"><i class="fa fa-check"></i><b>4.2</b> 制作 R 包：fusen</a></li>
<li class="chapter" data-level="4.3" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-cv"><i class="fa fa-check"></i><b>4.3</b> 制作简历：datadrivencv</a></li>
<li class="chapter" data-level="4.4" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-bookdown"><i class="fa fa-check"></i><b>4.4</b> 写书和记学习笔记：bookdown</a></li>
<li class="chapter" data-level="4.5" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-blogdown"><i class="fa fa-check"></i><b>4.5</b> 制作网站：blogdown</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#blogdown-intro"><i class="fa fa-check"></i><b>4.5.1</b> blogdown 简介</a></li>
<li class="chapter" data-level="4.5.2" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#blogdown-steps"><i class="fa fa-check"></i><b>4.5.2</b> 具体操作</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-paper"><i class="fa fa-check"></i><b>4.6</b> 制作科技论文的支撑材料</a></li>
</ul></li>
<li class="part"><span><b>III R Markdown 进阶操作</b></span></li>
<li class="chapter" data-level="5" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html"><i class="fa fa-check"></i><b>5</b> 使用 R Markdown 创建动态交互文档</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmarkdown-shiny"><i class="fa fa-check"></i><b>5.1</b> Web 交互界面：Shiny 小程序</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-start"><i class="fa fa-check"></i><b>5.1.1</b> 入门指南</a></li>
<li class="chapter" data-level="5.1.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-deploy"><i class="fa fa-check"></i><b>5.1.2</b> Shiny 部署</a></li>
<li class="chapter" data-level="5.1.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-app"><i class="fa fa-check"></i><b>5.1.3</b> 嵌入 Shiny 应用程序</a></li>
<li class="chapter" data-level="5.1.4" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-widget"><i class="fa fa-check"></i><b>5.1.4</b> Shiny 小部件</a></li>
<li class="chapter" data-level="5.1.5" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-link"><i class="fa fa-check"></i><b>5.1.5</b> Shiny 文档间的链接</a></li>
<li class="chapter" data-level="5.1.6" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-render"><i class="fa fa-check"></i><b>5.1.6</b> Shiny 文档的渲染</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmarkdown-dashboards"><i class="fa fa-check"></i><b>5.2</b> 交互式仪表盘：Dashboards</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-intro"><i class="fa fa-check"></i><b>5.2.1</b> Dashboards 入门</a></li>
<li class="chapter" data-level="5.2.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-layout"><i class="fa fa-check"></i><b>5.2.2</b> Dashboards 排版</a></li>
<li class="chapter" data-level="5.2.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-module"><i class="fa fa-check"></i><b>5.2.3</b> Dashboards 组件</a></li>
<li class="chapter" data-level="5.2.4" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-shiny"><i class="fa fa-check"></i><b>5.2.4</b> Dashboards 与 Shiny</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#package-rmd"><i class="fa fa-check"></i><b>5.3</b> 在 R package 中使用 R Markdown</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmd-vignettes"><i class="fa fa-check"></i><b>5.3.1</b> 写软件包的文档</a></li>
<li class="chapter" data-level="5.3.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmd-auto"><i class="fa fa-check"></i><b>5.3.2</b> 定义一个自动化报告函数</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html"><i class="fa fa-check"></i><b>6</b> R Markdown 的操作技巧</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#table-advanced"><i class="fa fa-check"></i><b>6.1</b> 表格操作进阶</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#table-complex"><i class="fa fa-check"></i><b>6.1.1</b> 利用函数 <code>knitr::kable()</code> 生成复杂的表格</a></li>
<li class="chapter" data-level="6.1.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#kable-extra"><i class="fa fa-check"></i><b>6.1.2</b> 利用 <strong>kableExtra</strong> 美化表格</a></li>
<li class="chapter" data-level="6.1.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#else-table"><i class="fa fa-check"></i><b>6.1.3</b> 其它生成表格的包及功能介绍</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-options"><i class="fa fa-check"></i><b>6.2</b> 块选项</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-variable"><i class="fa fa-check"></i><b>6.2.1</b> 在块选项中使用变量</a></li>
<li class="chapter" data-level="6.2.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-error"><i class="fa fa-check"></i><b>6.2.2</b> 如何在遇到 error 的时候继续编译</a></li>
<li class="chapter" data-level="6.2.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-output"><i class="fa fa-check"></i><b>6.2.3</b> 控制输出</a></li>
<li class="chapter" data-level="6.2.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-reformat"><i class="fa fa-check"></i><b>6.2.4</b> 重新格式化源代码</a></li>
<li class="chapter" data-level="6.2.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-leading"><i class="fa fa-check"></i><b>6.2.5</b> 调整文本输出中的前导符号</a></li>
<li class="chapter" data-level="6.2.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-property"><i class="fa fa-check"></i><b>6.2.6</b> 为文本输出块添加属性 (*)</a></li>
<li class="chapter" data-level="6.2.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-multiplot"><i class="fa fa-check"></i><b>6.2.7</b> 同一张图的多种图像输出格式</a></li>
<li class="chapter" data-level="6.2.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-process"><i class="fa fa-check"></i><b>6.2.8</b> 图像的后期加工 (*)</a></li>
<li class="chapter" data-level="6.2.9" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-highquality"><i class="fa fa-check"></i><b>6.2.9</b> 输出高质量的图像 (*)</a></li>
<li class="chapter" data-level="6.2.10" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-step-plot"><i class="fa fa-check"></i><b>6.2.10</b> 带有低级绘图功能的逐步绘图 (*)</a></li>
<li class="chapter" data-level="6.2.11" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-print"><i class="fa fa-check"></i><b>6.2.11</b> 在代码块中自定义对象的打印格式 (*)</a></li>
<li class="chapter" data-level="6.2.12" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#option-hook"><i class="fa fa-check"></i><b>6.2.12</b> 选项钩子 (*)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#other-language"><i class="fa fa-check"></i><b>6.3</b> 与其他语言的结合</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#register-language"><i class="fa fa-check"></i><b>6.3.1</b> 注册自定义语言引擎 (*)</a></li>
<li class="chapter" data-level="6.3.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#python-rmd"><i class="fa fa-check"></i><b>6.3.2</b> 运行 Python 代码并与 Python 交互</a></li>
<li class="chapter" data-level="6.3.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-property"><i class="fa fa-check"></i><b>6.3.3</b> 为文本输出块添加属性 (*)</a></li>
<li class="chapter" data-level="6.3.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-multiplot"><i class="fa fa-check"></i><b>6.3.4</b> 同一张图的多种图像输出格式</a></li>
<li class="chapter" data-level="6.3.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-process"><i class="fa fa-check"></i><b>6.3.5</b> 图像的后期加工 (*)</a></li>
<li class="chapter" data-level="6.3.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-highquality"><i class="fa fa-check"></i><b>6.3.6</b> 输出高质量的图像 (*)</a></li>
<li class="chapter" data-level="6.3.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-step-plot"><i class="fa fa-check"></i><b>6.3.7</b> 带有低级绘图功能的逐步绘图 (*)</a></li>
<li class="chapter" data-level="6.3.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-print"><i class="fa fa-check"></i><b>6.3.8</b> 在代码块中自定义对象的打印格式 (*)</a></li>
<li class="chapter" data-level="6.3.9" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#option-hook"><i class="fa fa-check"></i><b>6.3.9</b> 选项钩子 (*)</a></li>
<li class="chapter" data-level="6.3.10" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#python-rmd"><i class="fa fa-check"></i><b>6.3.10</b> 运行 Python 代码并与 Python 交互</a></li>
<li class="chapter" data-level="6.3.11" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-asis"><i class="fa fa-check"></i><b>6.3.11</b> 通过 <code>asis</code> 引擎有条件地执行内容</a></li>
<li class="chapter" data-level="6.3.12" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-shell"><i class="fa fa-check"></i><b>6.3.12</b> 执行 Shell 脚本</a></li>
<li class="chapter" data-level="6.3.13" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cat-file"><i class="fa fa-check"></i><b>6.3.13</b> 通过 cat 引擎将块内容写入文件</a></li>
<li class="chapter" data-level="6.3.14" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#sas-rmd"><i class="fa fa-check"></i><b>6.3.14</b> 运行 SAS 代码</a></li>
<li class="chapter" data-level="6.3.15" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#stata-rmd"><i class="fa fa-check"></i><b>6.3.15</b> 运行 Stata 代码</a></li>
<li class="chapter" data-level="6.3.16" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#asymptote-plot"><i class="fa fa-check"></i><b>6.3.16</b> 用渐近线 Asymptote 创建图形</a></li>
<li class="chapter" data-level="6.3.17" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#sass-scss"><i class="fa fa-check"></i><b>6.3.17</b> 使用 Sass/SCSS 构建 HTML 页面</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#output-hook"><i class="fa fa-check"></i><b>6.4</b> 输出钩子 (*)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#edit-source"><i class="fa fa-check"></i><b>6.4.1</b> 编辑源代码</a></li>
<li class="chapter" data-level="6.4.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#source-index"><i class="fa fa-check"></i><b>6.4.2</b> 向源代码中添加行号</a></li>
<li class="chapter" data-level="6.4.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#scrollable-output"><i class="fa fa-check"></i><b>6.4.3</b> 可滚动的文本输出</a></li>
<li class="chapter" data-level="6.4.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#truncated-output"><i class="fa fa-check"></i><b>6.4.4</b> 截断文本输出</a></li>
<li class="chapter" data-level="6.4.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#html5-plot"><i class="fa fa-check"></i><b>6.4.5</b> 以HTML5格式输出图像</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache"><i class="fa fa-check"></i><b>6.5</b> 缓存 (*)</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-cache"><i class="fa fa-check"></i><b>6.5.1</b> 缓存耗时的代码块</a></li>
<li class="chapter" data-level="6.5.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-path"><i class="fa fa-check"></i><b>6.5.2</b> 为多种输出格式缓存代码块</a></li>
<li class="chapter" data-level="6.5.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-lazy"><i class="fa fa-check"></i><b>6.5.3</b> 缓存大型的对象</a></li>
<li class="chapter" data-level="6.5.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-rds"><i class="fa fa-check"></i><b>6.5.4</b> 一个更透明的缓存机制</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#other-trick"><i class="fa fa-check"></i><b>6.6</b> 其它使用 knitr 的小技巧 (*)</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#reuse-chunk"><i class="fa fa-check"></i><b>6.6.1</b> 重复使用代码块</a></li>
<li class="chapter" data-level="6.6.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#use-creat"><i class="fa fa-check"></i><b>6.6.2</b> 在创建对象之前使用它 (*)</a></li>
<li class="chapter" data-level="6.6.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#compile-exit"><i class="fa fa-check"></i><b>6.6.3</b> 提前退出编译</a></li>
<li class="chapter" data-level="6.6.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#plot-show-else"><i class="fa fa-check"></i><b>6.6.4</b> 生成一个图像并在其他地方显示</a></li>
<li class="chapter" data-level="6.6.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#modify-before"><i class="fa fa-check"></i><b>6.6.5</b> 修改之前代码块中的图像</a></li>
<li class="chapter" data-level="6.6.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#reuse-option"><i class="fa fa-check"></i><b>6.6.6</b> 保存一组块选项并重复使用它们 (*)</a></li>
<li class="chapter" data-level="6.6.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#knit-expand"><i class="fa fa-check"></i><b>6.6.7</b> 使用 knitr::knit_expand() 来生成 Rmd 源代码</a></li>
<li class="chapter" data-level="6.6.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#repeat-label"><i class="fa fa-check"></i><b>6.6.8</b> 允许代码块中的标签重复 (*)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html"><i class="fa fa-check"></i><b>7</b> 使用R Markdown开展项目工作</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#project-manage"><i class="fa fa-check"></i><b>7.1</b> 使用 R Markdown 在工作中管理项目</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-r"><i class="fa fa-check"></i><b>7.1.1</b> 来自外部的 R 脚本</a></li>
<li class="chapter" data-level="7.1.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-read"><i class="fa fa-check"></i><b>7.1.2</b> 将外部脚本读取到一个块中</a></li>
<li class="chapter" data-level="7.1.3" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-multi"><i class="fa fa-check"></i><b>7.1.3</b> 从外部脚本读取多个代码块 (*)</a></li>
<li class="chapter" data-level="7.1.4" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#child-document"><i class="fa fa-check"></i><b>7.1.4</b> 子文档 (*)</a></li>
<li class="chapter" data-level="7.1.5" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#keep-plot"><i class="fa fa-check"></i><b>7.1.5</b> 保留图像文件</a></li>
<li class="chapter" data-level="7.1.6" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#chunk-directory"><i class="fa fa-check"></i><b>7.1.6</b> R 代码块的工作目录</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#work-flow"><i class="fa fa-check"></i><b>7.2</b> 使用 R Markdown 实现工作流</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#rstudio-shortcut"><i class="fa fa-check"></i><b>7.2.1</b> 使用 RStudio 键盘快捷键</a></li>
<li class="chapter" data-level="7.2.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#spell-check"><i class="fa fa-check"></i><b>7.2.2</b> R Markdown 的拼写检查</a></li>
<li class="chapter" data-level="7.2.3" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#render-rmd"><i class="fa fa-check"></i><b>7.2.3</b> 用 rmarkdown::render() 呈现 R Markdown</a></li>
<li class="chapter" data-level="7.2.4" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#parameterized-reports"><i class="fa fa-check"></i><b>7.2.4</b> 参数化的报告</a></li>
<li class="chapter" data-level="7.2.5" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#customize-button"><i class="fa fa-check"></i><b>7.2.5</b> 自定义 Knit 按钮 (*)</a></li>
<li class="chapter" data-level="7.2.6" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#google-drive"><i class="fa fa-check"></i><b>7.2.6</b> 通过 Google Drive 对 Rmd 文档进行协作</a></li>
<li class="chapter" data-level="7.2.7" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#workflowr-web"><i class="fa fa-check"></i><b>7.2.7</b> 用 workflowr 将R Markdown项目组织到一个研究网站上</a></li>
<li class="chapter" data-level="7.2.8" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#github-actions"><i class="fa fa-check"></i><b>7.2.8</b> 使用 GitHub Actions 实现自动化部署</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Markdown 指南</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rmarkdown-operation" class="section level1" number="6">
<h1><span class="header-section-number">第 6 章</span> R Markdown 的操作技巧</h1>
<div id="table-advanced" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> 表格操作进阶</h2>
<p>在日常报告中，表格是展示结果的主要方式之一，例如下表展示了某中学某次考试的学生成绩：</p>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>然而，该成绩表并不美观，例如有些人习惯将内容居中，一般情况下给表格添加标题会更容易让人读懂，即得到表 <a href="rmarkdown-operation.html#tab:target-table">6.1</a> 的结果：</p>
<table>
<caption><span id="tab:target-table">表 6.1: </span>考试成绩</caption>
<thead>
<tr class="header">
<th align="center">姓名</th>
<th align="center">语文</th>
<th align="center">数学</th>
<th align="center">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">张三</td>
<td align="center">89</td>
<td align="center">93</td>
<td align="center">92</td>
</tr>
<tr class="even">
<td align="center">李四</td>
<td align="center">90</td>
<td align="center">97</td>
<td align="center">85</td>
</tr>
<tr class="odd">
<td align="center">王五</td>
<td align="center">85</td>
<td align="center">91</td>
<td align="center">97</td>
</tr>
</tbody>
</table>
<p>除了居中操作以及添加标题外，在制作表格时还会产生各种各样的特定需求，例如合并单元格、添加底色等。本节将系统地介绍在 R Markdown 中生成表格和进一步对其个性化的方法，主要包括下列内容：</p>
<ul>
<li><p>介绍表格生成函数 <code>knitr::kable()</code> 的所有特征；</p></li>
<li><p>使用 <strong>kableExtra</strong> <span class="citation">(<a href="#ref-R-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span> 包来展现更高级的个性化制作方法；</p></li>
<li><p>提供其它生成表格的 R 包以供读者参考。</p></li>
</ul>
<div id="table-complex" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> 利用函数 <code>knitr::kable()</code> 生成复杂的表格</h3>
<p>在 R Markdown 中，通常使用 <strong>knitr</strong> 包中的函数 <code>kable()</code> 来快速创建一个表格。<code>kable()</code> 可以处理数据框、矩阵等“矩形数据”，快速生成表格，而表格的外观则可以通过修改函数参数来自定义，下面将对这些参数进行介绍：</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="rmarkdown-operation.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(x, format, <span class="at">digits =</span> <span class="fu">getOption</span>(<span class="st">&quot;digits&quot;</span>),</span>
<span id="cb188-2"><a href="rmarkdown-operation.html#cb188-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NA</span>, <span class="at">col.names =</span> <span class="cn">NA</span>, align, <span class="at">caption =</span> <span class="cn">NULL</span>,</span>
<span id="cb188-3"><a href="rmarkdown-operation.html#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="cn">NULL</span>, <span class="at">format.args =</span> <span class="fu">list</span>(), <span class="at">escape =</span> <span class="cn">TRUE</span>,</span>
<span id="cb188-4"><a href="rmarkdown-operation.html#cb188-4" aria-hidden="true" tabindex="-1"></a>    ...)</span></code></pre></div>
<div id="kable-formats" class="section level4" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> 目前已支持的表的格式</h4>
<p>在大多数情况下，如果只需要制作一个简单表格，<code>knitr::kable(x)</code> 就足够了。其中 <code>format</code> 参数会根据 <strong>knitr</strong> 源文档自动设置。它可能的取值是 <code>pipe</code> （列与列之间由短的竖线分隔的表），<code>simple</code> （仅包含横向分割线 的简单表格），<code>latex</code> （LaTex 表格），<code>html</code> （HTML 表格），和 <code>rst</code> （reStructuredText 表格）。为了展示各个取值的不同，这里直接给出了各个取值在不同编程语言中的原始代码。</p>
<p>对于 R Markdown 文档，<code>kable()</code> 默认使用 <code>pipe</code> 格式的表格，输出结果如下所示：</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="rmarkdown-operation.html#cb189-1" aria-hidden="true" tabindex="-1"></a>grade <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb189-2"><a href="rmarkdown-operation.html#cb189-2" aria-hidden="true" tabindex="-1"></a>                    语文 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">89</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb189-3"><a href="rmarkdown-operation.html#cb189-3" aria-hidden="true" tabindex="-1"></a>                    数学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="dv">91</span>),</span>
<span id="cb189-4"><a href="rmarkdown-operation.html#cb189-4" aria-hidden="true" tabindex="-1"></a>                    英语 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">85</span>,<span class="dv">97</span>))</span>
<span id="cb189-5"><a href="rmarkdown-operation.html#cb189-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;pipe&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb190"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb190-1"><a href="rmarkdown-operation.html#cb190-1" aria-hidden="true" tabindex="-1"></a>|姓名 | 语文| 数学| 英语|</span>
<span id="cb190-2"><a href="rmarkdown-operation.html#cb190-2" aria-hidden="true" tabindex="-1"></a>|:----|----:|----:|----:|</span>
<span id="cb190-3"><a href="rmarkdown-operation.html#cb190-3" aria-hidden="true" tabindex="-1"></a>|张三 |   89|   93|   92|</span>
<span id="cb190-4"><a href="rmarkdown-operation.html#cb190-4" aria-hidden="true" tabindex="-1"></a>|李四 |   90|   97|   85|</span>
<span id="cb190-5"><a href="rmarkdown-operation.html#cb190-5" aria-hidden="true" tabindex="-1"></a>|王五 |   85|   91|   97|</span></code></pre></div>
<p>也可以生成一个（基于 Pandoc 的）简单的表格，或 HMTL、LaTex 以及 reStructuredText 格式的表格：</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="rmarkdown-operation.html#cb191-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;simple&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb192-1"><a href="rmarkdown-operation.html#cb192-1" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb192-2"><a href="rmarkdown-operation.html#cb192-2" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb192-3"><a href="rmarkdown-operation.html#cb192-3" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb192-4"><a href="rmarkdown-operation.html#cb192-4" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb192-5"><a href="rmarkdown-operation.html#cb192-5" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="rmarkdown-operation.html#cb193-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;html&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb194"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb194-1"><a href="rmarkdown-operation.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table&gt;</span></span>
<span id="cb194-2"><a href="rmarkdown-operation.html#cb194-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;thead&gt;</span></span>
<span id="cb194-3"><a href="rmarkdown-operation.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb194-4"><a href="rmarkdown-operation.html#cb194-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 姓名 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb194-5"><a href="rmarkdown-operation.html#cb194-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 语文 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb194-6"><a href="rmarkdown-operation.html#cb194-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 数学 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb194-7"><a href="rmarkdown-operation.html#cb194-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 英语 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb194-8"><a href="rmarkdown-operation.html#cb194-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb194-9"><a href="rmarkdown-operation.html#cb194-9" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;/thead&gt;</span></span>
<span id="cb194-10"><a href="rmarkdown-operation.html#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tbody&gt;</span></span>
<span id="cb194-11"><a href="rmarkdown-operation.html#cb194-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb194-12"><a href="rmarkdown-operation.html#cb194-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 张三 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-13"><a href="rmarkdown-operation.html#cb194-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 89 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-14"><a href="rmarkdown-operation.html#cb194-14" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 93 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-15"><a href="rmarkdown-operation.html#cb194-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 92 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-16"><a href="rmarkdown-operation.html#cb194-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb194-17"><a href="rmarkdown-operation.html#cb194-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb194-18"><a href="rmarkdown-operation.html#cb194-18" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 李四 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-19"><a href="rmarkdown-operation.html#cb194-19" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 90 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-20"><a href="rmarkdown-operation.html#cb194-20" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-21"><a href="rmarkdown-operation.html#cb194-21" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-22"><a href="rmarkdown-operation.html#cb194-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb194-23"><a href="rmarkdown-operation.html#cb194-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb194-24"><a href="rmarkdown-operation.html#cb194-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 王五 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-25"><a href="rmarkdown-operation.html#cb194-25" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-26"><a href="rmarkdown-operation.html#cb194-26" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 91 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-27"><a href="rmarkdown-operation.html#cb194-27" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb194-28"><a href="rmarkdown-operation.html#cb194-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb194-29"><a href="rmarkdown-operation.html#cb194-29" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/tbody&gt;</span></span>
<span id="cb194-30"><a href="rmarkdown-operation.html#cb194-30" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/table&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="rmarkdown-operation.html#cb195-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;latex&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb196"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb196-1"><a href="rmarkdown-operation.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb196-2"><a href="rmarkdown-operation.html#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb196-3"><a href="rmarkdown-operation.html#cb196-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb196-4"><a href="rmarkdown-operation.html#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb196-5"><a href="rmarkdown-operation.html#cb196-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb196-6"><a href="rmarkdown-operation.html#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb196-7"><a href="rmarkdown-operation.html#cb196-7" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb196-8"><a href="rmarkdown-operation.html#cb196-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb196-9"><a href="rmarkdown-operation.html#cb196-9" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb196-10"><a href="rmarkdown-operation.html#cb196-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb196-11"><a href="rmarkdown-operation.html#cb196-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="rmarkdown-operation.html#cb197-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;rst&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb198"><pre class="sourceCode rst"><code class="sourceCode rest"><span id="cb198-1"><a href="rmarkdown-operation.html#cb198-1" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span>
<span id="cb198-2"><a href="rmarkdown-operation.html#cb198-2" aria-hidden="true" tabindex="-1"></a>姓名  语文  数学  英语</span>
<span id="cb198-3"><a href="rmarkdown-operation.html#cb198-3" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span>
<span id="cb198-4"><a href="rmarkdown-operation.html#cb198-4" aria-hidden="true" tabindex="-1"></a>张三    89    93    92</span>
<span id="cb198-5"><a href="rmarkdown-operation.html#cb198-5" aria-hidden="true" tabindex="-1"></a>李四    90    97    85</span>
<span id="cb198-6"><a href="rmarkdown-operation.html#cb198-6" aria-hidden="true" tabindex="-1"></a>王五    85    91    97</span>
<span id="cb198-7"><a href="rmarkdown-operation.html#cb198-7" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span></code></pre></div>
<p>需要注意的是，只有 <code>pipe</code> 和 <code>simple</code> 格式是“可移植”的，也就是说，它们适用于任何输出文档的格式，而其他格式则只适用于特定的输出格式，例如，<code>format = 'latex'</code> 只适用于 LaTex 输出文档。使用特定的表格格式可以带来更多的自主控制能力，但代价是牺牲了可移植性。</p>
<p>如果在一个报告中，只需要一种非默认的表格格式，可以直接设置全局的 R 选项 <code>knitr.table.format</code>。例如若只需要 LaTex 格式的表格，则可以设置：</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="rmarkdown-operation.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.table.format =</span> <span class="st">&#39;latex&#39;</span>)</span></code></pre></div>
<p>这一选项也可以是一个返回格式字符串或 <code>NULL</code> 的函数。在 <code>NULL</code> 的情况下，<strong>knitr</strong> 将自动决定适当的格式。例如，可以只在输出格式为 LaTeX 时使用 <code>latex</code> 格式:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="rmarkdown-operation.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.table.format =</span> <span class="cf">function</span>() {</span>
<span id="cb200-2"><a href="rmarkdown-operation.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) <span class="st">&#39;latex&#39;</span> <span class="cf">else</span> <span class="st">&#39;pipe&#39;</span></span>
<span id="cb200-3"><a href="rmarkdown-operation.html#cb200-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="修改表的列名" class="section level4" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> 修改表的列名</h4>
<!-- https://stackoverflow.com/questions/51432502/replace-column-names-in-kable-r-markdown/51444998#51444998 -->
<p>在一些情况下，在数据框（data frame）中定义的列的名称可能与想要显示给读者的内容不同，需要进行修改。在使用英文时，数据的列名通常不使用空格来分隔单词，而是使用点、下划线以及大小写来进行分隔。而在制作表格时，这样的变量名会显得有些不自然。在中文环境下，虽然空格的问题较少，但也存在变量名过长的情况，在 R 中也往往使用简化的名词或对应的英文简写来代替。在这种情况下，可以使用 <code>col.names</code> 参数将列名替换为一个包含新名称的向量，即 <code>col.names = c(...)</code>。例如，可以在上文成绩表的列名中提供更多信息：</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="rmarkdown-operation.html#cb201-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, </span>
<span id="cb201-2"><a href="rmarkdown-operation.html#cb201-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">&#39;第1组&#39;</span>, <span class="fu">colnames</span>(grade))))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">第1组姓名</th>
<th align="right">第1组语文</th>
<th align="right">第1组数学</th>
<th align="right">第1组英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p><code>col.names</code> 参数可以接受任意的字符向量（不一定是通过 <code>paste0()</code> 等函数修改的列名），只要向量的长度等于数据对象的列数即可，例如可以把列名换成英文：</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="rmarkdown-operation.html#cb202-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade,</span>
<span id="cb202-2"><a href="rmarkdown-operation.html#cb202-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;Chinese&#39;</span>, <span class="st">&#39;Math&#39;</span>, <span class="st">&#39;English&#39;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="right">Chinese</th>
<th align="right">Math</th>
<th align="right">English</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</div>
<div id="指定列的对齐方式" class="section level4" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> 指定列的对齐方式</h4>
<p>如果想要改变表格中列的对齐方式，可以使用由字符 <code>l</code> （left，左对齐）、<code>c</code> （center，居中）以及 <code>r</code> （right，右对齐）组成的值向量或一个多字符的字符串来进行对齐，即 <code>kable(..., align = c('c', 'l'))</code> 和 <code>kable(..., align = 'cl')</code> 是等价的。在默认情况下，数字列是右对齐的，其他列是左对齐的。例如可以对成绩表进行调整，使得前两列右对齐，后两列左对齐：</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="rmarkdown-operation.html#cb203-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;rrll&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">姓名</th>
<th align="right">语文</th>
<th align="left">数学</th>
<th align="left">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">张三</td>
<td align="right">89</td>
<td align="left">93</td>
<td align="left">92</td>
</tr>
<tr class="even">
<td align="right">李四</td>
<td align="right">90</td>
<td align="left">97</td>
<td align="left">85</td>
</tr>
<tr class="odd">
<td align="right">王五</td>
<td align="right">85</td>
<td align="left">91</td>
<td align="left">97</td>
</tr>
</tbody>
</table>
<p>而当对齐方式统一时，也可以用一个字母来代替，例如可以把成绩表所有列都居中表示：</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="rmarkdown-operation.html#cb204-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">姓名</th>
<th align="center">语文</th>
<th align="center">数学</th>
<th align="center">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">张三</td>
<td align="center">89</td>
<td align="center">93</td>
<td align="center">92</td>
</tr>
<tr class="even">
<td align="center">李四</td>
<td align="center">90</td>
<td align="center">97</td>
<td align="center">85</td>
</tr>
<tr class="odd">
<td align="center">王五</td>
<td align="center">85</td>
<td align="center">91</td>
<td align="center">97</td>
</tr>
</tbody>
</table>
</div>
<div id="kable-caption" class="section level4" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> 添加表格标题</h4>
<p>给表格添加标题需要用到 <code>caption</code> 参数，如表 <a href="rmarkdown-operation.html#tab:kable-cap">6.2</a> 所示：</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="rmarkdown-operation.html#cb205-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&#39;考试成绩&#39;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:kable-cap">表 6.2: </span>考试成绩</caption>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>正如本书<a href="rmarkdown-base.html#element-quote">2.6.4</a>节所提到的那样，当一个表格有标题并且以 <strong>bookdown</strong> 来输出格式时，它可以被交叉引用，而在基础的 <code>html_document</code> 和 <code>pdf_document</code> 中则不行。</p>
</div>
<div id="调整数字格式" class="section level4" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> 调整数字格式</h4>
<p>有的时候，表格中的数字位数很长，展示的时候需要缩短，这时可以通过 <code>digits</code> 参数（会被传递给 <code>round()</code> 函数）来设置最大的小数位数，以及通过 <code>format.args</code>（会被传递给 R 中的 <code>format()</code> 函数）来设置其他格式化参数。</p>
<p>首先是几个简单的 <code>round()</code> 和 <code>format()</code> 的例子，从而可以更好地理解之后的 <code>kable()</code> 中 <code>digits</code> 参数是如何工作的:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="rmarkdown-operation.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="dv">0</span>)</span>
<span id="cb206-2"><a href="rmarkdown-operation.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb206-3"><a href="rmarkdown-operation.html#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb206-4"><a href="rmarkdown-operation.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.2</span></span>
<span id="cb206-5"><a href="rmarkdown-operation.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb206-6"><a href="rmarkdown-operation.html#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.235</span></span>
<span id="cb206-7"><a href="rmarkdown-operation.html#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="dv">1000</span>, <span class="at">scientific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb206-8"><a href="rmarkdown-operation.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;1e+03&quot;</span></span>
<span id="cb206-9"><a href="rmarkdown-operation.html#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fl">10000.123</span>, <span class="at">big.mark =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb206-10"><a href="rmarkdown-operation.html#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;10,000.12&quot;</span></span></code></pre></div>
<p>可以将数字四舍五入并格式化成表格：</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="rmarkdown-operation.html#cb207-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">X1 =</span> <span class="fu">runif</span>(<span class="dv">3</span>), </span>
<span id="cb207-2"><a href="rmarkdown-operation.html#cb207-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">X2 =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>), </span>
<span id="cb207-3"><a href="rmarkdown-operation.html#cb207-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">X3 =</span> <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb207-4"><a href="rmarkdown-operation.html#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 保留最多四位小数</span></span>
<span id="cb207-5"><a href="rmarkdown-operation.html#cb207-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4513</td>
<td align="right">1e+03</td>
<td align="right">-300.9029</td>
</tr>
<tr class="even">
<td align="right">0.7838</td>
<td align="right">1e+05</td>
<td align="right">528.2758</td>
</tr>
<tr class="odd">
<td align="right">0.7097</td>
<td align="right">1e+07</td>
<td align="right">-622.8860</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="rmarkdown-operation.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 每列分别设置</span></span>
<span id="cb208-2"><a href="rmarkdown-operation.html#cb208-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.45127</td>
<td align="right">1e+03</td>
<td align="right">-300.90</td>
</tr>
<tr class="even">
<td align="right">0.78378</td>
<td align="right">1e+05</td>
<td align="right">528.28</td>
</tr>
<tr class="odd">
<td align="right">0.70968</td>
<td align="right">1e+07</td>
<td align="right">-622.89</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="rmarkdown-operation.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 不使用科学计数法</span></span>
<span id="cb209-2"><a href="rmarkdown-operation.html#cb209-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb209-3"><a href="rmarkdown-operation.html#cb209-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">scientific =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.451</td>
<td align="right">1000</td>
<td align="right">-300.903</td>
</tr>
<tr class="even">
<td align="right">0.784</td>
<td align="right">100000</td>
<td align="right">528.276</td>
</tr>
<tr class="odd">
<td align="right">0.710</td>
<td align="right">10000000</td>
<td align="right">-622.886</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="rmarkdown-operation.html#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 给 big numbers 添加逗号</span></span>
<span id="cb210-2"><a href="rmarkdown-operation.html#cb210-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">3</span>, </span>
<span id="cb210-3"><a href="rmarkdown-operation.html#cb210-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">&#39;,&#39;</span>, </span>
<span id="cb210-4"><a href="rmarkdown-operation.html#cb210-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.451</td>
<td align="right">1,000</td>
<td align="right">-300.903</td>
</tr>
<tr class="even">
<td align="right">0.784</td>
<td align="right">100,000</td>
<td align="right">528.276</td>
</tr>
<tr class="odd">
<td align="right">0.710</td>
<td align="right">10,000,000</td>
<td align="right">-622.886</td>
</tr>
</tbody>
</table>
</div>
<div id="显示缺失值" class="section level4" number="6.1.1.6">
<h4><span class="header-section-number">6.1.1.6</span> 显示缺失值</h4>
<p>有的时候，表中可能会存在缺失值，如该学生没有缺考或没有选修某个课。在默认情况下，R 中缺失值（如<code>NA</code>）在表格中显示为字符串<code>NA</code>，如：</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="rmarkdown-operation.html#cb211-1" aria-hidden="true" tabindex="-1"></a>grade2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb211-2"><a href="rmarkdown-operation.html#cb211-2" aria-hidden="true" tabindex="-1"></a>                     物理 <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb211-3"><a href="rmarkdown-operation.html#cb211-3" aria-hidden="true" tabindex="-1"></a>                     政治 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="cn">NA</span>),</span>
<span id="cb211-4"><a href="rmarkdown-operation.html#cb211-4" aria-hidden="true" tabindex="-1"></a>                     计算机 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="cn">NA</span>,<span class="dv">97</span>))</span>
<span id="cb211-5"><a href="rmarkdown-operation.html#cb211-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)  <span class="co"># 默认显示 NA</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">NA</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">NA</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>为了表格美观，也可以使用其他的值来替换它们，或者通过使用全局 R 选项 <code>knitr.kable.NA</code>来调整显示的内容（例如使<code>NA</code>对应的单元格为空）。例如，可以将下面第一个表中的<code>NA</code>单元格设为空，然后在第二个表中显示<code>**</code>：</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="rmarkdown-operation.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用空值代替 NA</span></span>
<span id="cb212-2"><a href="rmarkdown-operation.html#cb212-2" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">=</span> <span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb212-3"><a href="rmarkdown-operation.html#cb212-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right"></td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right"></td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="rmarkdown-operation.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用指定字符（**） 代替 NA</span></span>
<span id="cb213-2"><a href="rmarkdown-operation.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;**&#39;</span>)</span>
<span id="cb213-3"><a href="rmarkdown-operation.html#cb213-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">**</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">**</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">**</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="rmarkdown-operation.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(opts)  <span class="co"># 恢复全局 R 选项</span></span></code></pre></div>
</div>
<div id="特殊字符的转义" class="section level4" number="6.1.1.7">
<h4><span class="header-section-number">6.1.1.7</span> 特殊字符的转义</h4>
<p>HTML 或者 LaTeX 对应的编程语言之中包含了一些特殊的字符，例如在 LaTeX 中输入公式可能需要的 <code>$</code> 等。为了使结果能够正常输出，<code>kable()</code> 将默认通过参数 <code>escape = TRUE</code> 来“转义”这些特殊字符，即令这些特殊字符失去其特殊含义，使得所有的字符可以逐字生成，而不会生成特殊符号（如 <code>\beta</code> 将不会自动显示为 <span class="math inline">\(\beta\)</span>）。例如对于 HTML 格式的表格，<code>&gt;</code> 将被替换为 <code>&amp;gt;</code>；而对于 LaTeX 格式的表格，<code>_</code> 将被转义为 <code>\_</code> <a href="references.html#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>。</p>
<p>如果接触过这些字符，并且知道如何正确使用它们，那么可以通过 <code>escape = FALSE</code> 来禁用这个参数，但要注意必须确保特殊字符不会在 LaTeX 或 HTML 中触发语法错误。表 <a href="rmarkdown-operation.html#tab:latex-math-escape">6.3</a> 展示了转义之后的结果，表 <a href="rmarkdown-operation.html#tab:latex-math">6.4</a> 则展示了一些包含特殊字符（<code>$</code>、<code>\</code> 以及 <code>_</code>）的 LaTeX 数学表达式：</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="rmarkdown-operation.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加数学表达式</span></span>
<span id="cb215-2"><a href="rmarkdown-operation.html#cb215-2" aria-hidden="true" tabindex="-1"></a>g_range <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(成绩范围 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 90$&quot;</span>,<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 80$&quot;</span>,</span>
<span id="cb215-3"><a href="rmarkdown-operation.html#cb215-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 70$&quot;</span>),</span>
<span id="cb215-4"><a href="rmarkdown-operation.html#cb215-4" aria-hidden="true" tabindex="-1"></a>                    语文 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb215-5"><a href="rmarkdown-operation.html#cb215-5" aria-hidden="true" tabindex="-1"></a>                    数学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">16</span>),</span>
<span id="cb215-6"><a href="rmarkdown-operation.html#cb215-6" aria-hidden="true" tabindex="-1"></a>                    英语 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">20</span>))</span>
<span id="cb215-7"><a href="rmarkdown-operation.html#cb215-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(g_range) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;成绩范围&quot;</span>,</span>
<span id="cb215-8"><a href="rmarkdown-operation.html#cb215-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$Chinese_{Jan}$&quot;</span>,</span>
<span id="cb215-9"><a href="rmarkdown-operation.html#cb215-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$Math_{Jan}$&quot;</span>,</span>
<span id="cb215-10"><a href="rmarkdown-operation.html#cb215-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$English_{Jan}$&quot;</span>)</span>
<span id="cb215-11"><a href="rmarkdown-operation.html#cb215-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range, <span class="at">escape =</span> <span class="cn">TRUE</span>,</span>
<span id="cb215-12"><a href="rmarkdown-operation.html#cb215-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;escape = TRUE 生成的表&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:latex-math-escape">表 6.3: </span>escape = TRUE 生成的表</caption>
<thead>
<tr class="header">
<th align="left">成绩范围</th>
<th align="right"><span class="math inline">\(Chinese_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(Math_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(English_{Jan}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 90\)</span></td>
<td align="right">6</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\ge 80\)</span></td>
<td align="right">10</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 70\)</span></td>
<td align="right">20</td>
<td align="right">16</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="rmarkdown-operation.html#cb216-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range, <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb216-2"><a href="rmarkdown-operation.html#cb216-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;escape = FALSE 生成的表&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:latex-math">表 6.4: </span>escape = FALSE 生成的表</caption>
<thead>
<tr class="header">
<th align="left">成绩范围</th>
<th align="right"><span class="math inline">\(Chinese_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(Math_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(English_{Jan}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 90\)</span></td>
<td align="right">6</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\ge 80\)</span></td>
<td align="right">10</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 70\)</span></td>
<td align="right">20</td>
<td align="right">16</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>如表 <a href="rmarkdown-operation.html#tab:latex-math-escape">6.3</a> 所示，如果设置 <code>escape = TRUE</code>，特殊字符将被转义或替换。例如，在 LaTeX 格式的表格中，<code>$</code> 会被转义为 <code>\$</code>、<code>_</code> 被转义为 <code>\_</code> 以及 <code>\</code> 被替换为 <code>\textbackslash{}</code>：</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="rmarkdown-operation.html#cb217-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">escape =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb218-1"><a href="rmarkdown-operation.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r}</span>
<span id="cb218-2"><a href="rmarkdown-operation.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb218-3"><a href="rmarkdown-operation.html#cb218-3" aria-hidden="true" tabindex="-1"></a>成绩范围 <span class="op">&amp;</span> <span class="fu">\$</span>Chinese<span class="fu">\_\{</span>Jan<span class="fu">\}\$\\</span></span>
<span id="cb218-4"><a href="rmarkdown-operation.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb218-5"><a href="rmarkdown-operation.html#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 90<span class="fu">\$</span> <span class="op">&amp;</span> 6<span class="fu">\\</span></span>
<span id="cb218-6"><a href="rmarkdown-operation.html#cb218-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb218-7"><a href="rmarkdown-operation.html#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 80<span class="fu">\$</span> <span class="op">&amp;</span> 10<span class="fu">\\</span></span>
<span id="cb218-8"><a href="rmarkdown-operation.html#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb218-9"><a href="rmarkdown-operation.html#cb218-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 70<span class="fu">\$</span> <span class="op">&amp;</span> 20<span class="fu">\\</span></span>
<span id="cb218-10"><a href="rmarkdown-operation.html#cb218-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb218-11"><a href="rmarkdown-operation.html#cb218-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>其他 LaTeX 中常见的特殊字符包括<code>#</code>、<code>%</code>、<code>&amp;</code>、<code>{</code> 以及 <code>}</code>；HTML 中常见的特殊字符包括<code>&amp;</code>、<code>&lt;</code>、 <code>&gt;</code> 以及 <code>"</code>。在生成带有 <code>escape = FALSE</code> 的表格时，需要格外小心并确保正确地使用了特殊字符。一个常见的错误是在使用 <code>escape = FALSE</code> 时，在 LaTeX 表格的列名或标题中包含 <code>%</code> 或 <code>_</code> 等字符，而没有意识到它们是特殊的字符。</p>
<p>如果想知道 <code>escape = TRUE</code> 参数会如何转义特殊字符，可以通过 <strong>knitr</strong> 中两个内部辅助函数 <code>escape_latex</code> 和 <code>escape_html</code> 来分别查询在 LaTeX 和 HTML 格式的表格中的转义结果：。下面是一些例子：</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="rmarkdown-operation.html#cb219-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">:::</span><span class="fu">escape_latex</span>(<span class="fu">c</span>(<span class="st">&#39;100%&#39;</span>, <span class="st">&#39;# 一个观点&#39;</span>, <span class="st">&#39;文字_1&#39;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;100\\%&quot;       &quot;\\# 一个观点&quot; &quot;文字\\_1&quot;</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="rmarkdown-operation.html#cb221-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">:::</span><span class="fu">escape_html</span>(<span class="fu">c</span>(<span class="st">&#39;&lt;address&gt;&#39;</span>, <span class="st">&#39;x = &quot;字符&quot;&#39;</span>, <span class="st">&#39;a &amp; b&#39;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;&amp;lt;address&amp;gt;&quot;      &quot;x = &amp;quot;字符&amp;quot;&quot; &quot;a &amp;amp; b&quot;</code></pre>
</div>
<div id="多张表格并排" class="section level4" number="6.1.1.8">
<h4><span class="header-section-number">6.1.1.8</span> 多张表格并排</h4>
<p>有的时候，将多张表格并排放置可以便于比较，将数据框或矩阵以列表的形式传递给 <code>kable()</code> 就可以实现这一功能。例如，表 <a href="rmarkdown-operation.html#tab:two-tables">6.5</a> 包含了之前展示过的两张表：</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="rmarkdown-operation.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据对象 grade 和 grade2 由之前的代码块生成</span></span>
<span id="cb223-2"><a href="rmarkdown-operation.html#cb223-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb223-3"><a href="rmarkdown-operation.html#cb223-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(grade, grade2),</span>
<span id="cb223-4"><a href="rmarkdown-operation.html#cb223-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;两张表并排放置&#39;</span>,</span>
<span id="cb223-5"><a href="rmarkdown-operation.html#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">valign =</span> <span class="st">&#39;t&#39;</span></span>
<span id="cb223-6"><a href="rmarkdown-operation.html#cb223-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
<span id="tab:two-tables">表 6.5: </span>两张表并排放置
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">NA</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">NA</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>需要注意的是，此功能仅适用于 HTML 和 PDF 格式的输出。</p>
<p>另外，如果在并排放置各个表的时候，想能够分别自定义它们，可以使用 <code>kables()</code> 函数（即 <code>kable()</code> 的复数形式），并将一个对象为 <code>kable()</code> 的列表传递给它。例如，在表 <a href="rmarkdown-operation.html#tab:kables">6.6</a> 中，可以更改左表中的列名，并将右表中的小数点位数设置为 4：</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="rmarkdown-operation.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据对象 grade 和 d 由之前的代码块生成</span></span>
<span id="cb224-2"><a href="rmarkdown-operation.html#cb224-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kables</span>(</span>
<span id="cb224-3"><a href="rmarkdown-operation.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb224-4"><a href="rmarkdown-operation.html#cb224-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 第一个 kable()：修改列名</span></span>
<span id="cb224-5"><a href="rmarkdown-operation.html#cb224-5" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb224-6"><a href="rmarkdown-operation.html#cb224-6" aria-hidden="true" tabindex="-1"></a>      grade, </span>
<span id="cb224-7"><a href="rmarkdown-operation.html#cb224-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;Chinese&#39;</span>, <span class="st">&#39;Math&#39;</span>, <span class="st">&#39;English&#39;</span>), </span>
<span id="cb224-8"><a href="rmarkdown-operation.html#cb224-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">valign =</span> <span class="st">&#39;t&#39;</span></span>
<span id="cb224-9"><a href="rmarkdown-operation.html#cb224-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb224-10"><a href="rmarkdown-operation.html#cb224-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 第二个 kable()：设置 digits 选项</span></span>
<span id="cb224-11"><a href="rmarkdown-operation.html#cb224-11" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">valign =</span> <span class="st">&#39;t&#39;</span>)</span>
<span id="cb224-12"><a href="rmarkdown-operation.html#cb224-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb224-13"><a href="rmarkdown-operation.html#cb224-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;由 knitr::kables() 生成的两张表&#39;</span></span>
<span id="cb224-14"><a href="rmarkdown-operation.html#cb224-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
<span id="tab:kables">表 6.6: </span>由 knitr::kables() 生成的两张表
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="right">Chinese</th>
<th align="right">Math</th>
<th align="right">English</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4513</td>
<td align="right">1e+03</td>
<td align="right">-300.9029</td>
</tr>
<tr class="even">
<td align="right">0.7838</td>
<td align="right">1e+05</td>
<td align="right">528.2758</td>
</tr>
<tr class="odd">
<td align="right">0.7097</td>
<td align="right">1e+07</td>
<td align="right">-622.8860</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div id="利用for循环生成多个表" class="section level4" number="6.1.1.9">
<h4><span class="header-section-number">6.1.1.9</span> 利用<code>for</code>循环生成多个表 (*)</h4>
<p>对于 <code>kable()</code>，有一个常见的错误认识是它不能在 <code>for</code> 循环中工作。这个问题并不特定于 <code>kable()</code>，同时也存在于许多其他的 R 包中。其背后原因较为复杂,对技术细节感兴趣的读者可以参考博文 <a href="https://yihui.org/en/2017/06/top-level-r-expressions/">“The Ghost Printer behind Top-level R Expressions.”</a>。</p>
<p>例如，直观上下面的代码块可能可以生成三个表，但事实上它并不会：</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb225-1"><a href="rmarkdown-operation.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb225-2"><a href="rmarkdown-operation.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) {</span></span>
<span id="cb225-3"><a href="rmarkdown-operation.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::kable(grade)</span></span>
<span id="cb225-4"><a href="rmarkdown-operation.html#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb225-5"><a href="rmarkdown-operation.html#cb225-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>若想要实现生成多个表的目的，则必须显式打印 <code>kable()</code> 结果，并应用块选项 <code>results = 'asis'</code>，例如：</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb226-1"><a href="rmarkdown-operation.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results=&#39;asis&#39;}</span></span>
<span id="cb226-2"><a href="rmarkdown-operation.html#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) {</span></span>
<span id="cb226-3"><a href="rmarkdown-operation.html#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="in">  print(knitr::kable(grade))</span></span>
<span id="cb226-4"><a href="rmarkdown-operation.html#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb226-5"><a href="rmarkdown-operation.html#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>通常情况下，在利用 <code>for</code> 循环输出结果时，最好添加一些换行符（<code>\n</code>）或 HTML 注释（<code>&lt;!-- --&gt;</code>），从而清晰地分隔所有输出的元素，例如：</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb227-1"><a href="rmarkdown-operation.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results=&#39;asis&#39;}</span></span>
<span id="cb227-2"><a href="rmarkdown-operation.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:3) {</span></span>
<span id="cb227-3"><a href="rmarkdown-operation.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="in">  print(knitr::kable(grade, caption = &#39;标题&#39;))</span></span>
<span id="cb227-4"><a href="rmarkdown-operation.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(&#39;\n\n&lt;!-- --&gt;\n\n&#39;)</span></span>
<span id="cb227-5"><a href="rmarkdown-operation.html#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb227-6"><a href="rmarkdown-operation.html#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>如果没有这些分隔符，Pandoc 可能无法检测到单个元素。例如，当一个图片之后面紧跟着一个表格时，这个表格并不会被识别到：</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb228-1"><a href="rmarkdown-operation.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb228-2"><a href="rmarkdown-operation.html#cb228-2" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb228-3"><a href="rmarkdown-operation.html#cb228-3" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb228-4"><a href="rmarkdown-operation.html#cb228-4" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb228-5"><a href="rmarkdown-operation.html#cb228-5" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb228-6"><a href="rmarkdown-operation.html#cb228-6" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<p>但如果像这样有一个清晰的分隔（注意，在图像下面添加了一个空行），它将变成：</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb229-1"><a href="rmarkdown-operation.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb229-2"><a href="rmarkdown-operation.html#cb229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-3"><a href="rmarkdown-operation.html#cb229-3" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb229-4"><a href="rmarkdown-operation.html#cb229-4" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb229-5"><a href="rmarkdown-operation.html#cb229-5" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb229-6"><a href="rmarkdown-operation.html#cb229-6" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb229-7"><a href="rmarkdown-operation.html#cb229-7" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<p>或者</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb230-1"><a href="rmarkdown-operation.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb230-2"><a href="rmarkdown-operation.html#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="rmarkdown-operation.html#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb230-4"><a href="rmarkdown-operation.html#cb230-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-5"><a href="rmarkdown-operation.html#cb230-5" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb230-6"><a href="rmarkdown-operation.html#cb230-6" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb230-7"><a href="rmarkdown-operation.html#cb230-7" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb230-8"><a href="rmarkdown-operation.html#cb230-8" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb230-9"><a href="rmarkdown-operation.html#cb230-9" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
</div>
<div id="自定义-latex-表格" class="section level4" number="6.1.1.10">
<h4><span class="header-section-number">6.1.1.10</span> 自定义 LaTeX 表格 (*)</h4>
<p>如果只需要 LaTeX 格式的输出时，可以在 <code>kable()</code> 中使用一些额外的选项。注意在其他类型的输出中（如 HTML），这些选项将被忽略。除非已经设置了全局的表格格式选项（见本书 <a href="rmarkdown-operation.html#kable-formats">6.1.1.1</a> 节），否则必须像本节的例子那样使用 <code>kable()</code> 的 <code>format</code> 参数，例如：</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="rmarkdown-operation.html#cb231-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>当给一个表格分配一个标题时（见本书 <a href="rmarkdown-operation.html#kable-caption">6.1.1.4</a> 节）， <code>kable()</code> 将使用 <code>table</code> 环境来纳入这个表，即：</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb232-1"><a href="rmarkdown-operation.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">table</span>}</span>
<span id="cb232-2"><a href="rmarkdown-operation.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="co">% 表格 (通常为 tabular 环境)</span></span>
<span id="cb232-3"><a href="rmarkdown-operation.html#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">table</span>}</span></code></pre></div>
<p>不同的环境具有不同的性质，例如熟悉 LaTeX 的读者可能了解浮动体，即某些环境下图表的位置会在页面的底部或顶部“浮动”，如 <code>table</code> 及 <code>figure</code> 等环境。可以通过 <code>table.envir</code> 参数来对环境进行调整：</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="rmarkdown-operation.html#cb233-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">table.envir =</span> <span class="st">&#39;Table&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb234"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb234-1"><a href="rmarkdown-operation.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">Table</span>}</span>
<span id="cb234-2"><a href="rmarkdown-operation.html#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb234-3"><a href="rmarkdown-operation.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb234-4"><a href="rmarkdown-operation.html#cb234-4" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb234-5"><a href="rmarkdown-operation.html#cb234-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb234-6"><a href="rmarkdown-operation.html#cb234-6" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb234-7"><a href="rmarkdown-operation.html#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb234-8"><a href="rmarkdown-operation.html#cb234-8" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb234-9"><a href="rmarkdown-operation.html#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb234-10"><a href="rmarkdown-operation.html#cb234-10" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb234-11"><a href="rmarkdown-operation.html#cb234-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb234-12"><a href="rmarkdown-operation.html#cb234-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span>
<span id="cb234-13"><a href="rmarkdown-operation.html#cb234-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">Table</span>}</span></code></pre></div>
<p>表格的位置由参数 <code>position</code> 来控制。例如，可以通过 <code>position = "!b"</code> 来强制将表格固定到页面的底部：</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="rmarkdown-operation.html#cb235-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>,</span>
<span id="cb235-2"><a href="rmarkdown-operation.html#cb235-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">table.envir =</span> <span class="st">&#39;table&#39;</span>, <span class="at">position =</span> <span class="st">&#39;!b&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb236"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb236-1"><a href="rmarkdown-operation.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">table</span>}[!b]</span>
<span id="cb236-2"><a href="rmarkdown-operation.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb236-3"><a href="rmarkdown-operation.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb236-4"><a href="rmarkdown-operation.html#cb236-4" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb236-5"><a href="rmarkdown-operation.html#cb236-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb236-6"><a href="rmarkdown-operation.html#cb236-6" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb236-7"><a href="rmarkdown-operation.html#cb236-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb236-8"><a href="rmarkdown-operation.html#cb236-8" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb236-9"><a href="rmarkdown-operation.html#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb236-10"><a href="rmarkdown-operation.html#cb236-10" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb236-11"><a href="rmarkdown-operation.html#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb236-12"><a href="rmarkdown-operation.html#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span>
<span id="cb236-13"><a href="rmarkdown-operation.html#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">table</span>}</span></code></pre></div>
<p>当表格有标题时，也可以通过 <code>caption.short</code> 参数给它分配一个短的标题，例如：</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="rmarkdown-operation.html#cb237-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&#39;一个很长很长的标题！&#39;</span>,</span>
<span id="cb237-2"><a href="rmarkdown-operation.html#cb237-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption.short =</span> <span class="st">&#39;短标题&#39;</span>)</span></code></pre></div>
<p>短标题将会进入 LaTeX 中 <code>\caption[]{}</code> 命令的方括号中，经常在 PDF 输出文档的表格目录中使用（如果不提供短标题，那里则会显示完整的标题）。</p>
<p>如果熟悉用于生成可供发布（即高质量）表格的 LaTeX 包 <a href="https://ctan.org/pkg/booktabs"><strong>booktabs</strong></a>{LaTeX package!booktabs}，则可以设置<code>booktabs = TRUE</code>。</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="rmarkdown-operation.html#cb238-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb239"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb239-1"><a href="rmarkdown-operation.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{lrrr}</span>
<span id="cb239-2"><a href="rmarkdown-operation.html#cb239-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\toprule</span></span>
<span id="cb239-3"><a href="rmarkdown-operation.html#cb239-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb239-4"><a href="rmarkdown-operation.html#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\midrule</span></span>
<span id="cb239-5"><a href="rmarkdown-operation.html#cb239-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb239-6"><a href="rmarkdown-operation.html#cb239-6" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb239-7"><a href="rmarkdown-operation.html#cb239-7" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb239-8"><a href="rmarkdown-operation.html#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\bottomrule</span></span>
<span id="cb239-9"><a href="rmarkdown-operation.html#cb239-9" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>需要注意的是，当在 R Markdown 文档中需要额外的 LaTeX 包时（如 <strong>booktabs</strong>），必须在 YAML 中声明这些包（请参阅第 <a href="rmarkdown-document.html#pdf-latex">3.2.4</a> 节了解如何声明）。<strong>【！！！现有目录需要补充】</strong></p>
<p>参数 <code>booktabs</code> 取 <code>FALSE</code> （默认值）或 <code>TRUE</code> 时，表的外观是不同的，见表 <a href="#tab:booktabs-false"><strong>??</strong></a> 和表 <a href="#tab:booktabs-true"><strong>??</strong></a> 。</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="rmarkdown-operation.html#cb240-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, </span>
<span id="cb240-2"><a href="rmarkdown-operation.html#cb240-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">booktabs =</span> <span class="cn">FALSE</span>, </span>
<span id="cb240-3"><a href="rmarkdown-operation.html#cb240-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&#39;booktabs = FALSE 时的表格&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="rmarkdown-operation.html#cb241-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, </span>
<span id="cb241-2"><a href="rmarkdown-operation.html#cb241-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb241-3"><a href="rmarkdown-operation.html#cb241-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&#39;booktabs = TRUE 时的表格&#39;</span>)</span></code></pre></div>
<p>对于 <code>booktabs = FALSE</code>：</p>
<ul>
<li><p>表的列由垂直线分隔。可以通过 <code>vline</code> 参数来删除垂直线，例如 <code>knitr::kable(grade, vline = "")</code> （默认值是<code>vline = "|"</code>）。也可以将这个选项设置为一个全局的R选项，这样就不需要为每个表设置它，例如 <code>options(knitr.table.vline = "")</code>。</p></li>
<li><p>水平线可以通过参数 <code>toprule</code>、<code>midrule</code>、<code>linesep</code> 以及 <code>bottomrule</code> 来定义，它们的默认值都是<code>\hline</code>。</p></li>
</ul>
<p>对于 <code>booktabs = TRUE</code>：</p>
<ul>
<li><p>表格中没有垂直线，但可以通过 <code>vline</code> 参数来添加。</p></li>
<li><p>表格只有标题和底部行有水平线。默认参数值是 <code>toprule = "\\toprule"</code>、<code>midrule = "\\midrule"</code> 以及 <code>bottomrule = "\\bottomrule"</code>。默认情况下，每 5 行加一个行间距（<code>\addlinespace</code>），这是由参数 <code>linesep</code> 控制的，默认值为 <code>c("", "", "", "", "\\addlinespace")</code>。如果想每 1 行加一个 <code>\addlinespace</code>，则可以这样做：</p></li>
</ul>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="rmarkdown-operation.html#cb242-1" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, </span>
<span id="cb242-2"><a href="rmarkdown-operation.html#cb242-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">linesep =</span> <span class="fu">c</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">addlinespace&#39;</span>), </span>
<span id="cb242-3"><a href="rmarkdown-operation.html#cb242-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb243"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb243-1"><a href="rmarkdown-operation.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{lrrr}</span>
<span id="cb243-2"><a href="rmarkdown-operation.html#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\toprule</span></span>
<span id="cb243-3"><a href="rmarkdown-operation.html#cb243-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb243-4"><a href="rmarkdown-operation.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\midrule</span></span>
<span id="cb243-5"><a href="rmarkdown-operation.html#cb243-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb243-6"><a href="rmarkdown-operation.html#cb243-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\addlinespace</span></span>
<span id="cb243-7"><a href="rmarkdown-operation.html#cb243-7" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb243-8"><a href="rmarkdown-operation.html#cb243-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\addlinespace</span></span>
<span id="cb243-9"><a href="rmarkdown-operation.html#cb243-9" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb243-10"><a href="rmarkdown-operation.html#cb243-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\bottomrule</span></span>
<span id="cb243-11"><a href="rmarkdown-operation.html#cb243-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>如果想删除所有的行间距，可以使用<code>linesep = ''</code>。</p>
<p>有的时候，表可能比一页还长。可以使用参数 <code>longtable = TRUE</code>，该参数使用 LaTeX 包 <a href="https://ctan.org/pkg/longtable"><strong>longtable</strong></a> 将表跨到多个页面。</p>
<p>另外，当表格被包含在 <code>table</code> 环境中时（例如，当表有标题时），表格默认居中对齐。如果不想让表格居中，可以使用参数 <code>centering = FALSE</code>。</p>
</div>
<div id="自定义-html-表格" class="section level4" number="6.1.1.11">
<h4><span class="header-section-number">6.1.1.11</span> 自定义 HTML 表格 (*)</h4>
<!-- https://stackoverflow.com/questions/24254552/knitr-style-table-with-css -->
<p>如果想自定义通过 <code>knitr::kable(format = "html")</code> 生成的表，除了前面提到的常见参数外，只有一个额外的参数需要注意：<code>table.attr</code>。这个参数允许用户向 <code>&lt;table&gt;</code> 标签添加任意属性。例如可以向表格中添加一个类<code>striped</code>：</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="rmarkdown-operation.html#cb244-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">table.attr =</span> <span class="st">&#39;class=&quot;striped&quot;&#39;</span>,</span>
<span id="cb244-2"><a href="rmarkdown-operation.html#cb244-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb245"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb245-1"><a href="rmarkdown-operation.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;striped&quot;</span><span class="kw">&gt;</span></span>
<span id="cb245-2"><a href="rmarkdown-operation.html#cb245-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;thead&gt;</span></span>
<span id="cb245-3"><a href="rmarkdown-operation.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb245-4"><a href="rmarkdown-operation.html#cb245-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 姓名 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb245-5"><a href="rmarkdown-operation.html#cb245-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 语文 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb245-6"><a href="rmarkdown-operation.html#cb245-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 数学 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb245-7"><a href="rmarkdown-operation.html#cb245-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 英语 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb245-8"><a href="rmarkdown-operation.html#cb245-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb245-9"><a href="rmarkdown-operation.html#cb245-9" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;/thead&gt;</span></span>
<span id="cb245-10"><a href="rmarkdown-operation.html#cb245-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tbody&gt;</span></span>
<span id="cb245-11"><a href="rmarkdown-operation.html#cb245-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb245-12"><a href="rmarkdown-operation.html#cb245-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 张三 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-13"><a href="rmarkdown-operation.html#cb245-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 89 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-14"><a href="rmarkdown-operation.html#cb245-14" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 93 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-15"><a href="rmarkdown-operation.html#cb245-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 92 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-16"><a href="rmarkdown-operation.html#cb245-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb245-17"><a href="rmarkdown-operation.html#cb245-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb245-18"><a href="rmarkdown-operation.html#cb245-18" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 李四 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-19"><a href="rmarkdown-operation.html#cb245-19" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 90 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-20"><a href="rmarkdown-operation.html#cb245-20" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-21"><a href="rmarkdown-operation.html#cb245-21" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-22"><a href="rmarkdown-operation.html#cb245-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb245-23"><a href="rmarkdown-operation.html#cb245-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb245-24"><a href="rmarkdown-operation.html#cb245-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 王五 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-25"><a href="rmarkdown-operation.html#cb245-25" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-26"><a href="rmarkdown-operation.html#cb245-26" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 91 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-27"><a href="rmarkdown-operation.html#cb245-27" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb245-28"><a href="rmarkdown-operation.html#cb245-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb245-29"><a href="rmarkdown-operation.html#cb245-29" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/tbody&gt;</span></span>
<span id="cb245-30"><a href="rmarkdown-operation.html#cb245-30" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/table&gt;</span></span></code></pre></div>
<p>然而，类的名称不足以改变表的外观，必须定义 CSS<a href="references.html#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a> 类的规则。例如，要制作奇数行和偶数行有不同颜色的条纹表，可以为偶数行或奇数行添加浅灰色背景：</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb246-1"><a href="rmarkdown-operation.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.striped</span> tr<span class="in">:nth-child(even)</span> { <span class="kw">background</span>: <span class="cn">#eee</span><span class="op">;</span> }</span></code></pre></div>
<p>上面的 CSS 规则意味着所有 <code>striped</code> 类的元素的子元素，且具有偶数行号（<code>:nth-child(even)</code>）的行（即 <code>&lt;tr&gt;</code> 标签），将它们的背景颜色设置为 <code>#eee</code>。</p>
<p>使用一点 CSS 可以使一个普通的 HTML 表看起来好看很多。图 <a href="rmarkdown-operation.html#fig:striped-table">6.1</a> 是一个 HTML 表格的截图，其中应用了以下 CSS 规则：</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb247-1"><a href="rmarkdown-operation.html#cb247-1" aria-hidden="true" tabindex="-1"></a>table {</span>
<span id="cb247-2"><a href="rmarkdown-operation.html#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span>: <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb247-3"><a href="rmarkdown-operation.html#cb247-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-top</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#666</span><span class="op">;</span></span>
<span id="cb247-4"><a href="rmarkdown-operation.html#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-bottom</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#666</span><span class="op">;</span></span>
<span id="cb247-5"><a href="rmarkdown-operation.html#cb247-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb247-6"><a href="rmarkdown-operation.html#cb247-6" aria-hidden="true" tabindex="-1"></a>table thead th { <span class="kw">border-bottom</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ddd</span><span class="op">;</span> }</span>
<span id="cb247-7"><a href="rmarkdown-operation.html#cb247-7" aria-hidden="true" tabindex="-1"></a>th<span class="op">,</span> td { <span class="kw">padding</span>: <span class="dv">5</span><span class="dt">px</span><span class="op">;</span> }</span>
<span id="cb247-8"><a href="rmarkdown-operation.html#cb247-8" aria-hidden="true" tabindex="-1"></a>thead<span class="op">,</span> tfoot<span class="op">,</span> tr<span class="in">:nth-child(even)</span> { <span class="kw">background</span>: <span class="cn">#eee</span><span class="op">;</span> }</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:striped-table"></span>
<img src="images/striped-table.png" alt="利用 HTML 和 CSS 创建的条纹表"  />
<p class="caption">
图 6.1: 利用 HTML 和 CSS 创建的条纹表
</p>
</div>
</div>
</div>
<div id="kable-extra" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> 利用 <strong>kableExtra</strong> 美化表格</h3>
<p><strong>kableExtra</strong> 包<span class="citation">(<a href="#ref-R-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span> 设计的目的为扩展 <code>knitr::kable()</code> 生成表格的基本功能（见第 <a href="rmarkdown-operation.html#table-complex">6.1.1</a> 节）。由于 <code>knitr::kable()</code> 的设计很简单，就像很多其他的 R 包一样，它肯定有很多缺失的功能，而 <strong>kableExtra</strong> 完美地填补了空白，可以配合 <code>knitr::kable()</code> 生成更好看的表格。最令人惊讶的是，<strong>kableExtra</strong> 的大多数表格的特性都适用于 HTML 和 PDF 格式，例如，借助 <strong>kableExtra</strong> 包可以绘制如图 <a href="rmarkdown-operation.html#fig:striped-table">6.1</a> 的条纹表。</p>
<p>一般情况下，<strong>kableExtra</strong> 包可以通过 CRAN 安装，也可以尝试 GitHub 上的开发版本 (<a href="https://github.com/haozhu233/kableExtra" class="uri">https://github.com/haozhu233/kableExtra</a>)：</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="rmarkdown-operation.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 通过 CRAN 安装</span></span>
<span id="cb248-2"><a href="rmarkdown-operation.html#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;kableExtra&quot;</span>)</span>
<span id="cb248-3"><a href="rmarkdown-operation.html#cb248-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装开发版本</span></span>
<span id="cb248-4"><a href="rmarkdown-operation.html#cb248-4" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;haozhu233/kableExtra&quot;</span>)</span></code></pre></div>
<p><a href="https://haozhu233.github.io/kableExtra/" class="uri">https://haozhu233.github.io/kableExtra/</a> 提供了大量的文档，介绍了很多关于如何自定义 <code>kable()</code> 的 HTML 或 LaTeX 输出结果的例子。本节只提供几个示例，更多内容可参见该文档。</p>
<p>另外，<strong>kableExtra</strong> 包支持使用管道操作符 <code>%&gt;%</code>，可以将 <code>kable()</code> 的输出结果连到 <strong>kableExtra</strong> 的样式函数上，例如表 <a href="rmarkdown-operation.html#tab:striped-table-extra">6.7</a>：</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="rmarkdown-operation.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb249-2"><a href="rmarkdown-operation.html#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb249-3"><a href="rmarkdown-operation.html#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&quot;条纹表&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-4"><a href="rmarkdown-operation.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:striped-table-extra">表 6.7: </span>条纹表
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
</tr>
</tbody>
</table>
<div id="设定字体尺寸" class="section level4" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> 设定字体尺寸</h4>
<p>有的时候，在展示一些表格时，需要设定字体的尺寸，如放大或缩小某些特定问题。<strong>kableExtra</strong> 包中的 <code>kable_styling()</code> 函数可以帮助用户对整个表进行样式化。例如，可以指定页面上表格的对齐方式、表格的宽度和字体大小。表 <a href="rmarkdown-operation.html#tab:little-size">6.8</a> 展示了一个使用小字体的例子：</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="rmarkdown-operation.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb250-2"><a href="rmarkdown-operation.html#cb250-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;字体较小的表格&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb250-3"><a href="rmarkdown-operation.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">8</span>)</span></code></pre></div>
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:little-size">表 6.8: </span>字体较小的表格
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
</tr>
</tbody>
</table>
</div>
<div id="特定的行或列的样式" class="section level4" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> 特定的行或列的样式</h4>
<p>有时还需要对表格的行或列的具体样式进行调整，如加粗某行等。函数 <code>row_spec()</code> 和 <code>column_spec()</code> 可分别用于样式化单独的行和列。表 <a href="rmarkdown-operation.html#tab:style-col-row">6.9</a> 将第一行文字加粗并设为斜体，将第二行添加黑色背景，同时更改字体颜色为白色并旋转，给第三行文字加下划线并更改其字体，并给第四列加删除线：</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="rmarkdown-operation.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;c&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb251-2"><a href="rmarkdown-operation.html#cb251-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;更改特定行或列的样式&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-3"><a href="rmarkdown-operation.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb251-4"><a href="rmarkdown-operation.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;white&#39;</span>, </span>
<span id="cb251-5"><a href="rmarkdown-operation.html#cb251-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">background =</span> <span class="st">&#39;black&#39;</span>, <span class="at">angle =</span> <span class="dv">45</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-6"><a href="rmarkdown-operation.html#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">underline =</span> <span class="cn">TRUE</span>, <span class="at">monospace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-7"><a href="rmarkdown-operation.html#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">strikeout =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:style-col-row">表 6.9: </span>更改特定行或列的样式
</caption>
<thead>
<tr>
<th style="text-align:center;">
姓名
</th>
<th style="text-align:center;">
语文
</th>
<th style="text-align:center;">
数学
</th>
<th style="text-align:center;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;font-weight: bold;font-style: italic;">
张三
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;">
89
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;">
93
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;text-decoration: line-through;">
92
</td>
</tr>
<tr>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
李四
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
90
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
97
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);text-decoration: line-through;">
85
</td>
</tr>
<tr>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
王五
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
85
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
91
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;text-decoration: line-through;">
97
</td>
</tr>
</tbody>
</table>
<p>类似地，也可以使用 <code>cell_spec()</code> 函数来给单个单元格设定样式。</p>
</div>
<div id="给行或列分组" class="section level4" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> 给行或列分组</h4>
<p>回想 Excel 里的操作，对单元格进行合并的操作可以给行或列进行分组。在 R Markdown 中，行和列可以分别通过函数 <code>pack_rows()</code> 和 <code>add_header_above()</code> 来进行分组。另外，也可以通过 <code>collapse_rows()</code> 来折叠行，这样一个单元格可以跨越多个行。表 <a href="rmarkdown-operation.html#tab:group-col-row">6.10</a> 展示了一个给标题列分组后的表格：</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="rmarkdown-operation.html#cb252-1" aria-hidden="true" tabindex="-1"></a>grade3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb252-2"><a href="rmarkdown-operation.html#cb252-2" aria-hidden="true" tabindex="-1"></a>                     物理 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb252-3"><a href="rmarkdown-operation.html#cb252-3" aria-hidden="true" tabindex="-1"></a>                     化学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">86</span>,<span class="dv">92</span>,<span class="dv">80</span>),</span>
<span id="cb252-4"><a href="rmarkdown-operation.html#cb252-4" aria-hidden="true" tabindex="-1"></a>                     生物 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">94</span>,<span class="dv">85</span>,<span class="dv">90</span>),</span>
<span id="cb252-5"><a href="rmarkdown-operation.html#cb252-5" aria-hidden="true" tabindex="-1"></a>                     政治 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="dv">95</span>),</span>
<span id="cb252-6"><a href="rmarkdown-operation.html#cb252-6" aria-hidden="true" tabindex="-1"></a>                     历史 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">84</span>,<span class="dv">80</span>),</span>
<span id="cb252-7"><a href="rmarkdown-operation.html#cb252-7" aria-hidden="true" tabindex="-1"></a>                     地理 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">99</span>,<span class="dv">89</span>,<span class="dv">95</span>),</span>
<span id="cb252-8"><a href="rmarkdown-operation.html#cb252-8" aria-hidden="true" tabindex="-1"></a>                     计算机 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">95</span>,<span class="dv">97</span>),</span>
<span id="cb252-9"><a href="rmarkdown-operation.html#cb252-9" aria-hidden="true" tabindex="-1"></a>                     体育 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">85</span>,<span class="dv">99</span>,<span class="dv">95</span>))</span>
<span id="cb252-10"><a href="rmarkdown-operation.html#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade3, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb252-11"><a href="rmarkdown-operation.html#cb252-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;对标题列进行分组&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb252-12"><a href="rmarkdown-operation.html#cb252-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;理科&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, </span>
<span id="cb252-13"><a href="rmarkdown-operation.html#cb252-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;文科&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;其它&quot;</span> <span class="ot">=</span> <span class="dv">2</span>))</span></code></pre></div>
<table>
<caption>
<span id="tab:group-col-row">表 6.10: </span>对标题列进行分组
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
理科
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
文科
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
其它
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>对于 <code>add_header_above()</code> 中的命名向量，其名称是显示在表头中的文本，向量的整数值表示一个名称应该跨越多少列，例如，<code>"理科" = 3</code> 表示 <code>理科</code> 应该跨越三列。</p>
<p>表 <a href="rmarkdown-operation.html#tab:pack-rows">6.11</a> 提供了 <code>pack_rows()</code> 的示例，其中 <code>index</code> 参数的含义类似于之前解释过的 <code>add_header_above()</code> 参数：</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="rmarkdown-operation.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade3, <span class="at">booktabs =</span> <span class="cn">TRUE</span>, </span>
<span id="cb253-2"><a href="rmarkdown-operation.html#cb253-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;对行进行折叠&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb253-3"><a href="rmarkdown-operation.html#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(</span>
<span id="cb253-4"><a href="rmarkdown-operation.html#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;一班&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;二班&quot;</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb253-5"><a href="rmarkdown-operation.html#cb253-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:pack-rows">表 6.11: </span>对行进行折叠
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr grouplength="1">
<td colspan="9" style="border-bottom: 1px solid;">
<strong>一班</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
张三
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr grouplength="2">
<td colspan="9" style="border-bottom: 1px solid;">
<strong>二班</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
</div>
<div id="按比例缩小latex中的表格" class="section level4" number="6.1.2.4">
<h4><span class="header-section-number">6.1.2.4</span> 按比例缩小LaTex中的表格</h4>
<p>有一些特性是 HTML 或 LaTeX 输出格式特有的。例如，横向打印格式只在 LaTeX 中有意义，所以 <strong>kableExtra</strong> 中的 <code>landscape()</code> 函数只对 LaTeX 格式的输出有效。对于一个比较宽的表格（表 <a href="rmarkdown-operation.html#tab:no-scale-down">6.12</a>），（表 <a href="rmarkdown-operation.html#tab:scale-down">6.13</a>）展现了如何将表格按比例缩小以适应页面的宽度（否则该表格会太宽）：</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="rmarkdown-operation.html#cb254-1" aria-hidden="true" tabindex="-1"></a>grade4 <span class="ot">&lt;-</span> <span class="fu">merge</span>(grade, grade3, <span class="at">by =</span> <span class="st">&quot;姓名&quot;</span>)</span>
<span id="cb254-2"><a href="rmarkdown-operation.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade4, </span>
<span id="cb254-3"><a href="rmarkdown-operation.html#cb254-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb254-4"><a href="rmarkdown-operation.html#cb254-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;原始表格（太宽）&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:no-scale-down">表 6.12: </span>原始表格（太宽）
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="rmarkdown-operation.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade4, </span>
<span id="cb255-2"><a href="rmarkdown-operation.html#cb255-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb255-3"><a href="rmarkdown-operation.html#cb255-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;缩小后的表格&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb255-4"><a href="rmarkdown-operation.html#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;scale_down&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:scale-down">表 6.13: </span>缩小后的表格
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>注意如果在浏览 HTML 版本的话，表 <a href="rmarkdown-operation.html#tab:no-scale-down">6.12</a> 和表 <a href="rmarkdown-operation.html#tab:scale-down">6.13</a> 表格是没有差异的。</p>
</div>
</div>
<div id="else-table" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> 其它生成表格的包及功能介绍</h3>
<p>还有很多其他的R包可以用来生成表格。本节引入 <code>kable()</code> （见第 <a href="rmarkdown-operation.html#table-complex">6.1.1</a> 节）和 <strong>kableExtra</strong> （见第 <a href="rmarkdown-operation.html#kable-extra">6.1.2</a> 节）的主要原因不是它们比其他包更好，而是因为作者们只熟悉它们，而且它们的功能可以涵盖大部分的日常使用需求。接下来本节将列出一些已知的其它软件包，感兴趣的读者可以去尝试并决定哪一个最适合自己。</p>
<ul>
<li><p><strong>flextable</strong> <span class="citation">(<a href="#ref-R-flextable" role="doc-biblioref"><strong>R-flextable?</strong></a>)</span> 和 <strong>huxtable</strong> <span class="citation">(<a href="#ref-R-huxtable" role="doc-biblioref">Hugh-Jones 2021</a>)</span>：<strong>flextable</strong> 和 <strong>huxtable</strong> 支持多种表格输出格式的包。它们都支持 HTML、LaTeX 以及 Office 格式，并且包含最常见的表格特性（例如条件格式化）。更多关于 <strong>flextable</strong> 的信息可参见：<a href="https://davidgohel.github.io/flextable/" class="uri">https://davidgohel.github.io/flextable/</a>，<strong>huxtable</strong> 的说明文档则在：<a href="https://hughjonesd.github.io/huxtable/" class="uri">https://hughjonesd.github.io/huxtable/</a>。</p></li>
<li><p><strong>gt</strong> <span class="citation">(<a href="#ref-R-gt" role="doc-biblioref"><strong>R-gt?</strong></a>)</span>：这个 R 包允许用户将表格的不同部分组合在一起，例如表头（标题和副标题）、列标签、表格主体、行组标签以及表格的脚注，从而组成一个完整的表格，其中有些部分是可选择性添加的。还可以格式化数字，并为单元格添加背景阴影。目前 <strong>gt</strong> 主要支持 HTML 输出。<a href="references.html#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a>更多关于 <strong>gt</strong> 的信息可参见：<a href="https://gt.rstudio.com" class="uri">https://gt.rstudio.com</a>。</p></li>
<li><p><strong>formattable</strong> <span class="citation">(<a href="#ref-R-formattable" role="doc-biblioref"><strong>R-formattable?</strong></a>)</span>：这个 R 包提供了一些格式化数字的工具函数（如 <code>percent()</code> 和 <code>accounting()</code>），以及对列进行样式化的函数（如格式化文本，用背景阴影或颜色条注释数字，或在单元格中添加图标等等）。和 <strong>gt</strong> 相同，<strong>formattable</strong> 包也主要支持HTML格式。更多信息可参见GitHub项目：<a href="https://github.com/renkun-ken/formattable/" class="uri">https://github.com/renkun-ken/formattable/</a>。</p></li>
<li><p><strong>DT</strong> <span class="citation">(<a href="#ref-R-DT" role="doc-biblioref"><strong>R-DT?</strong></a>)</span>：它只支持 HTML 格式。<strong>DT</strong> 构建在 JavaScript 库 <strong>DataTables</strong> 之上，它可以将静态表转换为HTML页面上的交互式表。你可以对表进行排序、搜索和分页。<strong>DT</strong> 还支持格式化单元格，与 Shiny 一起构建交互式应用程序，并包含了大量的 <strong>DataTables</strong> 扩展（例如，可以将表格导出到Excel，或交互式重新排列表格的列）。更多信息可参见：<a href="https://github.com/rstudio/DT/" class="uri">https://github.com/rstudio/DT/</a>。</p></li>
<li><p><strong>reactable</strong> <span class="citation">(<a href="#ref-R-reactable" role="doc-biblioref"><strong>R-reactable?</strong></a>)</span>：与 <strong>DT</strong> 类似，这个包也基于 JavaScript 库创建交互式表。它在某些方面比 <strong>DT</strong> 更好（比如行分组和聚合操作，以及嵌入HTML小部件），但 <strong>reactable</strong> 并不包含 <strong>DT</strong> 全部的特性。更多信息可参见：<a href="https://glin.github.io/reactable/" class="uri">https://glin.github.io/reactable/</a>。</p></li>
<li><p><strong>rhandsontable</strong><span class="citation">(<a href="#ref-R-rhandsontable" role="doc-biblioref"><strong>R-rhandsontable?</strong></a>)</span>：这个包也类似于 <strong>DT</strong>，并且和 Excel 比较像（例如，可以直接在表中编辑数据）。更多信息可参见：<a href="https://jrowen.github.io/rhandsontable/" class="uri">https://jrowen.github.io/rhandsontable/</a>。</p></li>
<li><p><strong>pixiedust</strong> <span class="citation">(<a href="#ref-R-pixiedust" role="doc-biblioref"><strong>R-pixiedust?</strong></a>)</span>：这个包通过 <strong>broom</strong> 包<span class="citation">(<a href="#ref-R-broom" role="doc-biblioref"><strong>R-broom?</strong></a>)</span>来为为模型结果（如线性模型）创建表格，它支持 Markdown、HTML 以及 LaTeX 输出格式。更多信息可参见：<a href="https://github.com/nutterb/pixiedust/" class="uri">https://github.com/nutterb/pixiedust/</a>。</p></li>
<li><p><strong>stargazer</strong> <span class="citation">(<a href="#ref-R-stargazer" role="doc-biblioref"><strong>R-stargazer?</strong></a>)</span>：格式化回归模型和汇总统计表。更多信息可参见：<a href="https://cran.r-project.org/package=stargazer/" class="uri">https://cran.r-project.org/package=stargazer/</a>。</p></li>
<li><p><strong>xtable</strong> <span class="citation">(<a href="#ref-R-xtable" role="doc-biblioref">Dahl et al. 2019</a>)</span>；这个包可能是最早的创建表格的包，其第一次发布是在 2000 年。它同时支持LaTeX和HTML格式。该软件包可在 CRAN 上访问：<a href="https://cran.r-project.org/package=xtable/" class="uri">https://cran.r-project.org/package=xtable/</a>。</p></li>
</ul>
<p>还有一些其它生成表格的包，这里不再进一步介绍，只是在这里列出它们，以供感兴趣者参考：<strong>tables</strong> <span class="citation">(<a href="#ref-R-tables" role="doc-biblioref"><strong>R-tables?</strong></a>)</span>、<strong>pander</strong> <span class="citation">(<a href="#ref-R-pander" role="doc-biblioref">Daróczi and Tsegelskyi 2022</a>)</span>、<strong>tangram</strong> <span class="citation">(<a href="#ref-R-tangram" role="doc-biblioref"><strong>R-tangram?</strong></a>)</span>、<strong>ztable</strong> <span class="citation">(<a href="#ref-R-ztable" role="doc-biblioref"><strong>R-ztable?</strong></a>)</span> 以及 <strong>condformat</strong> <span class="citation">(<a href="#ref-R-condformat" role="doc-biblioref"><strong>R-condformat?</strong></a>)</span>。</p>
</div>
</div>
<div id="chunk-options" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> 块选项</h2>
<p>在之前的章节中，R 包 <strong>knitr</strong> 展现了其在 R Markdown 中起到的关键作用。在本节和接下来的第 <a href="rmarkdown-operation.html#output-hook">6.4</a>、<a href="rmarkdown-operation.html#other-trick">6.6</a> 两节中，将进一步展示一些与 <strong>knitr</strong> 相关的编程技巧，从而更有效地辅助工作的开展。</p>
<p>事实上，在 R Markdown 的代码块中，有超过 50 个块选项可以用来微调 <strong>knitr</strong> 处理代码块的方式，选项的完整列表可参阅在线文档<a href="https://yihui.org/knitr/options/" class="uri">https://yihui.org/knitr/options/</a>。</p>
<p>需要注意的是，接下来的几节只展示了将块选项应用到单个代码块的例子，但实际上，任何块选项都可以进行全局设置，应用于整个文档，而不必在每个代码块中重复。如果要设置全局的块选项，需要在代码块（通常为文档中的第一个代码块）中调用 <code>knitr::opts_chunk$set()</code>。例如若需要对整个文档调整文本输出中的前导符号（<code>comment = "#&gt;"</code>，见第 <a href="rmarkdown-operation.html#chunk-leading">6.2.5</a> 节）、隐藏源代码（<code>echo = FALSE</code>，见第 <a href="rmarkdown-operation.html#chunk-output">6.2.3</a> 节）并控制图片大小（<code>fig.width = 6</code>，见第 <a href="rmarkdown-base.html#element-plot">2.6.1</a> 节），可以进行如下设置：</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb256-1"><a href="rmarkdown-operation.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb256-2"><a href="rmarkdown-operation.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb256-3"><a href="rmarkdown-operation.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="in">  comment = &quot;#&gt;&quot;, echo = FALSE, fig.width = 6</span></span>
<span id="cb256-4"><a href="rmarkdown-operation.html#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb256-5"><a href="rmarkdown-operation.html#cb256-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<div id="chunk-variable" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> 在块选项中使用变量</h3>
<p>通常情况下，块选项中会使用常数（如：<code>fig.width = 6</code>），但有些时候仅使用常数无法满足需求，例如应展现的图像大小可能来源于其它代码块的结果，而非一成不变，每次根据结果来手动调整就会费时又费力。</p>
<p>实际上，块选项可以使用任意的 R 表达式，无论简单或复杂。一种特殊的情况是将变量传递给一个块选项（注意变量本身也可被视为一个 R 表达式）。例如，为了满足图像大小变化的需求，可以在文档的一个代码块中定义关于图像宽度的变量，然后在其他代码块中使用它：</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb257-1"><a href="rmarkdown-operation.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb257-2"><a href="rmarkdown-operation.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="in">my_width &lt;- 7</span></span>
<span id="cb257-3"><a href="rmarkdown-operation.html#cb257-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb257-4"><a href="rmarkdown-operation.html#cb257-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-5"><a href="rmarkdown-operation.html#cb257-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=my_width}</span></span>
<span id="cb257-6"><a href="rmarkdown-operation.html#cb257-6" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb257-7"><a href="rmarkdown-operation.html#cb257-7" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>另外，块选项中也可以使用更为复杂的函数，例如可以使用 <code>if-else</code> 语句来调整图片大小：</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb258-1"><a href="rmarkdown-operation.html#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb258-2"><a href="rmarkdown-operation.html#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="in">fig_small &lt;- FALSE  # 输出更大的图片需要改为 TRUE</span></span>
<span id="cb258-3"><a href="rmarkdown-operation.html#cb258-3" aria-hidden="true" tabindex="-1"></a><span class="in">width_small &lt;- 4</span></span>
<span id="cb258-4"><a href="rmarkdown-operation.html#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="in">width_large &lt;- 8</span></span>
<span id="cb258-5"><a href="rmarkdown-operation.html#cb258-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb258-6"><a href="rmarkdown-operation.html#cb258-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-7"><a href="rmarkdown-operation.html#cb258-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=if (fig_small) width_small else width_large}</span></span>
<span id="cb258-8"><a href="rmarkdown-operation.html#cb258-8" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb258-9"><a href="rmarkdown-operation.html#cb258-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>不仅如此，还可以只在所需要的包可使用时才运行一个代码块（<code>eval=FALSE</code> 意味着不运行该代码）：</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb259-1"><a href="rmarkdown-operation.html#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=require(&#39;leaflet&#39;)}</span></span>
<span id="cb259-2"><a href="rmarkdown-operation.html#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="in">library(leaflet)</span></span>
<span id="cb259-3"><a href="rmarkdown-operation.html#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="in">leaflet() %&gt;% addTiles()</span></span>
<span id="cb259-4"><a href="rmarkdown-operation.html#cb259-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>需要注意的是，<code>require('package')</code> 只有当这个包已安装且可使用时才会返回 <code>TRUE</code>，否则会返回 <code>FALSE</code>。</p>
</div>
<div id="chunk-error" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> 如何在遇到 error 的时候继续编译</h3>
<p>在默认情况下，R Markdown 文档中代码块运行产生的错误将使程序终止。但瑕疵掩不住美玉，一次报错不妨碍整体的质量；失败是成功之母，一次报错更是珍贵的学习机会。出于种种原因，用户希望在代码块报错的时候显示错误并继续运行，可以使用块选项 <code>error = TRUE</code>，例如：</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb260-1"><a href="rmarkdown-operation.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb260-2"><a href="rmarkdown-operation.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="in">1 + &quot;a&quot;</span></span>
<span id="cb260-3"><a href="rmarkdown-operation.html#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>这样在编译 R Markdown 文档后，将在输出文档中看到如下的错误消息：</p>
<pre><code>Error in 1 + &quot;a&quot;: non-numeric argument to binary operator</code></pre>
<p>实际上，在 R Markdown 中，默认设定为 <code>error = FALSE</code>，这也导致了 R 在运行代码块时，出现错误就会终止。</p>
</div>
<div id="chunk-output" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> 控制输出</h3>
<p>默认情况下，<strong>knitr</strong> 会显示代码块的所有可能输出，包括源代码、提示信息（message）、警告（warning）、文本输出和图像输出等，但有时处于种种目的，只需要部分输出。本节将详细介绍如何控制各类结果的输出。</p>
<div id="hide-one" class="section level4" number="6.2.3.1">
<h4><span class="header-section-number">6.2.3.1</span> 隐藏源代码、提示信息、警告、文本输出或图像输出</h4>
<p>对于输出结果中的各类元素，可以使用相应的块选项来单独隐藏它们：</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb262-1"><a href="rmarkdown-operation.html#cb262-1" aria-hidden="true" tabindex="-1"></a>隐藏源代码：</span>
<span id="cb262-2"><a href="rmarkdown-operation.html#cb262-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-3"><a href="rmarkdown-operation.html#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb262-4"><a href="rmarkdown-operation.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb262-5"><a href="rmarkdown-operation.html#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb262-6"><a href="rmarkdown-operation.html#cb262-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-7"><a href="rmarkdown-operation.html#cb262-7" aria-hidden="true" tabindex="-1"></a>隐藏提示信息（message）：</span>
<span id="cb262-8"><a href="rmarkdown-operation.html#cb262-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-9"><a href="rmarkdown-operation.html#cb262-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb262-10"><a href="rmarkdown-operation.html#cb262-10" aria-hidden="true" tabindex="-1"></a><span class="in">message(&quot;这个message不会显示&quot;)</span></span>
<span id="cb262-11"><a href="rmarkdown-operation.html#cb262-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb262-12"><a href="rmarkdown-operation.html#cb262-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-13"><a href="rmarkdown-operation.html#cb262-13" aria-hidden="true" tabindex="-1"></a>隐藏警告（warning）：</span>
<span id="cb262-14"><a href="rmarkdown-operation.html#cb262-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-15"><a href="rmarkdown-operation.html#cb262-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb262-16"><a href="rmarkdown-operation.html#cb262-16" aria-hidden="true" tabindex="-1"></a><span class="in"># 这将生成一个warning，但不会被输出</span></span>
<span id="cb262-17"><a href="rmarkdown-operation.html#cb262-17" aria-hidden="true" tabindex="-1"></a><span class="in">1:2 + 1:3</span></span>
<span id="cb262-18"><a href="rmarkdown-operation.html#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb262-19"><a href="rmarkdown-operation.html#cb262-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-20"><a href="rmarkdown-operation.html#cb262-20" aria-hidden="true" tabindex="-1"></a>隐藏文本输出（也可以使用<span class="in">`results = FALSE`</span>）：</span>
<span id="cb262-21"><a href="rmarkdown-operation.html#cb262-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-22"><a href="rmarkdown-operation.html#cb262-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results=&#39;hide&#39;}</span></span>
<span id="cb262-23"><a href="rmarkdown-operation.html#cb262-23" aria-hidden="true" tabindex="-1"></a><span class="in">print(&quot;这个文本输出不会显示。&quot;)</span></span>
<span id="cb262-24"><a href="rmarkdown-operation.html#cb262-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb262-25"><a href="rmarkdown-operation.html#cb262-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-26"><a href="rmarkdown-operation.html#cb262-26" aria-hidden="true" tabindex="-1"></a>隐藏图形输出：</span>
<span id="cb262-27"><a href="rmarkdown-operation.html#cb262-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-28"><a href="rmarkdown-operation.html#cb262-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show=&#39;hide&#39;}</span></span>
<span id="cb262-29"><a href="rmarkdown-operation.html#cb262-29" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb262-30"><a href="rmarkdown-operation.html#cb262-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb262-31"><a href="rmarkdown-operation.html#cb262-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-32"><a href="rmarkdown-operation.html#cb262-32" aria-hidden="true" tabindex="-1"></a>需要注意的是，上面的代码块会生成图形，它只是没有显示在输出中而已。</span></code></pre></div>
<p>关于 <strong>knitr</strong> 的一个常见问题是如何隐藏包的加载消息。例如，在运行 <code>library(tidyverse)</code> 或 <code>library(ggplot2)</code> 时，可能会看到一些正在加载的 message。这类 message 也可以通过块选项 <code>message = FALSE</code> 来隐藏。</p>
<p>另外，还可以通过索引来有选择地显示或隐藏这些元素。下面的示例只输出了源代码的第四个和第五个表达式（注意，一个注释会被算作一个表达式）、前两个 message 以及第二个和第三个 warning：</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb263-1"><a href="rmarkdown-operation.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=c(4, 5), message=c(1, 2), warning=2:3}</span></span>
<span id="cb263-2"><a href="rmarkdown-operation.html#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 一种生成服从N(0,1)分布的随机数的方法</span></span>
<span id="cb263-3"><a href="rmarkdown-operation.html#cb263-3" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- qnorm(runif(10))</span></span>
<span id="cb263-4"><a href="rmarkdown-operation.html#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="in"># 在实践中我们还可以使用</span></span>
<span id="cb263-5"><a href="rmarkdown-operation.html#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- rnorm(10)</span></span>
<span id="cb263-6"><a href="rmarkdown-operation.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="in">x</span></span>
<span id="cb263-7"><a href="rmarkdown-operation.html#cb263-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-8"><a href="rmarkdown-operation.html#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:5) message(&#39;这是 message &#39;, i)</span></span>
<span id="cb263-9"><a href="rmarkdown-operation.html#cb263-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-10"><a href="rmarkdown-operation.html#cb263-10" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:5) warning(&#39;这是 warning &#39;, i)</span></span>
<span id="cb263-11"><a href="rmarkdown-operation.html#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>还可以使用负索引，例如，<code>echo = -2</code> 表示在输出中排除源代码的第二个表达式。</p>
<p>类似地，可以通过使用 <code>fig.keep</code> 选项 来选择显示或隐藏哪些图。例如，<code>fig.keep = 1:2</code> 意味着保留前两幅图。这个选项有一些快捷的方式，如 <code>fig.keep = "first"</code> 将只保留第一幅图、<code>fig.keep = "last"</code> 只保留最后的图以及 <code>fig.keep = "none"</code> 将丢弃所有的图。需要注意的是，<code>fig.keep = "none"</code> 和 <code>fig.show = "hide"</code> 这两个选项是不同的，后者将生成图像文件，只是会隐藏它们，而前者则根本不会生成图像文件。</p>
<p>对于 <code>html_document</code> 输出中的源代码块，如果不想完全省略它们（<code>echo = FALSE</code>），可以参考<a href="rmarkdown-document.html#html-code-folding">3.1.2.6</a>节，来学习如何在页面上折叠它们，并允许报告用户通过单击展开按钮来展开它们。</p>
</div>
<div id="hide-all" class="section level4" number="6.2.3.2">
<h4><span class="header-section-number">6.2.3.2</span> 隐藏代码块的所有输出</h4>
<p>有的时候，可能想要执行一个代码块而根本不显示任何输出。与使用第 <a href="rmarkdown-operation.html#hide-one">6.2.3.1</a> 节中提到的单独选项不同，可以使用一个选项 <code>include = FALSE</code> 来隐藏代码块所有的输出，例如：</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb264-1"><a href="rmarkdown-operation.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb264-2"><a href="rmarkdown-operation.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 任意的R代码</span></span>
<span id="cb264-3"><a href="rmarkdown-operation.html#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>使用 <code>include=FALSE</code> 时，代码块将被运行（除非 <code>eval=FALSE</code>），但输出将被完全隐藏，报告用户将看不到任何的源代码、提示信息、警告、文本输出或图像输出等。</p>
</div>
<div id="opts-collapse" class="section level4" number="6.2.3.3">
<h4><span class="header-section-number">6.2.3.3</span> 将文本输出压缩到源代码块中</h4>
<p>在 R Markdown 报告中，输出结果中的文本输出部分和源代码部分之间会存在间隔。如果想去除这些间隔，可以考虑使用块选项 <code>collapse = TRUE</code> 将文本输出压缩到源代码块中。<code>collapse = TRUE</code> 时的输出如下所示：</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="rmarkdown-operation.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb265-2"><a href="rmarkdown-operation.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb265-3"><a href="rmarkdown-operation.html#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb265-4"><a href="rmarkdown-operation.html#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>若没有设定 <code>collapse = TRUE</code>（默认为<code>FALSE</code>），则会变成：</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="rmarkdown-operation.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="rmarkdown-operation.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div id="results-asis" class="section level4" number="6.2.3.4">
<h4><span class="header-section-number">6.2.3.4</span> 将文本输出调整为原始的 Markdown 形式 (*)</h4>
<p>默认情况下，代码块的文本输出将逐字输出，并添加两个前导符号 <code>##</code>（见第 <a href="rmarkdown-operation.html#chunk-leading">6.2.5</a> 节）。由于 <strong>knitr</strong> 将文本放在单独的代码块中，所以文本是逐字的。例如，对于代码 <code>1:5</code>，<strong>knitr</strong> 的原始输出为：</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb270-1"><a href="rmarkdown-operation.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb270-2"><a href="rmarkdown-operation.html#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="in">## [1] 1 2 3 4 5</span></span>
<span id="cb270-3"><a href="rmarkdown-operation.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>有的时候，比如在批量生成报告时，用户可能不希望逐字输出文本，而是将文本输出视为 Markdown 的内容。例如，如果想写一个类似 <code>cat('# 这是一个标题')</code> 的节标题，但原始的输出是：</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb271-1"><a href="rmarkdown-operation.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb271-2"><a href="rmarkdown-operation.html#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="in">## # 这是一个标题</span></span>
<span id="cb271-3"><a href="rmarkdown-operation.html#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>用户往往不希望文本位于单独的代码块（或开头的<code>##</code>）中，而希望原始输出与传递给<code>cat()</code>的字符串完全一致，即：</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb272-1"><a href="rmarkdown-operation.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是一个标题</span></span></code></pre></div>
<p>这个问题可以通过添加块选项 <code>results = 'asis'</code> 来解决。这个选项告诉 <strong>knitr</strong> 不要将文本输出逐字包装成代码块，而是“原样”对待它。当想要从 R 代码动态生成内容时，这一点特别有用。例如，可以使用选项 <code>results = 'asis'</code> 从以下代码块生成 <code>iris</code> 数据的列名列表:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="rmarkdown-operation.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&#39;- `&#39;</span>, <span class="fu">names</span>(iris), <span class="st">&#39;`&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<ul>
<li><code>Sepal.Length</code></li>
<li><code>Sepal.Width</code></li>
<li><code>Petal.Length</code></li>
<li><code>Petal.Width</code></li>
<li><code>Species</code></li>
</ul>
<p>连字符（<code>-</code>）是 Markdown 中用于生成无序列表的语法，其中反引号是可选的。若没有设置 <code>results = 'asis'</code> 选项，则上述代码块的输出为：</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="rmarkdown-operation.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&#39;- `&#39;</span>, <span class="fu">names</span>(iris), <span class="st">&#39;`&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## - `Sepal.Length`
## - `Sepal.Width`
## - `Petal.Length`
## - `Petal.Width`
## - `Species`</code></pre>
<p>下面是一个完整的例子，展示了如何在<code>for</code>循环中为<code>mtcars</code>数据的所有列生成节标题、段落和图：</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb276-1"><a href="rmarkdown-operation.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb276-2"><a href="rmarkdown-operation.html#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 以编程的方式生成内容</span></span>
<span id="cb276-3"><a href="rmarkdown-operation.html#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb276-4"><a href="rmarkdown-operation.html#cb276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-5"><a href="rmarkdown-operation.html#cb276-5" aria-hidden="true" tabindex="-1"></a>通过代码块选项 <span class="in">`results = &#39;asis&#39;`</span>，可以将文本作为原始的 Markdown 内容写出来，</span>
<span id="cb276-6"><a href="rmarkdown-operation.html#cb276-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-7"><a href="rmarkdown-operation.html#cb276-7" aria-hidden="true" tabindex="-1"></a>同时也可以与图片混合。</span>
<span id="cb276-8"><a href="rmarkdown-operation.html#cb276-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb276-9"><a href="rmarkdown-operation.html#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mtcars-plots, results=&#39;asis&#39;}</span></span>
<span id="cb276-10"><a href="rmarkdown-operation.html#cb276-10" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in names(mtcars)) {</span></span>
<span id="cb276-11"><a href="rmarkdown-operation.html#cb276-11" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(&#39;\n\n# 变量 `&#39;, i, &#39;` 的概要\n\n&#39;)</span></span>
<span id="cb276-12"><a href="rmarkdown-operation.html#cb276-12" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- mtcars[, i]</span></span>
<span id="cb276-13"><a href="rmarkdown-operation.html#cb276-13" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(unique(x)) &lt;= 6) {</span></span>
<span id="cb276-14"><a href="rmarkdown-operation.html#cb276-14" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(&#39;`&#39;, i, &#39;` 是一个分类变量。\n\n&#39;)</span></span>
<span id="cb276-15"><a href="rmarkdown-operation.html#cb276-15" aria-hidden="true" tabindex="-1"></a><span class="in">    plot(table(x), xlab = i, ylab = &#39;频率&#39;, lwd = 10)</span></span>
<span id="cb276-16"><a href="rmarkdown-operation.html#cb276-16" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb276-17"><a href="rmarkdown-operation.html#cb276-17" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(&#39;连续变量 `&#39;, i, &#39;` 的直方图。\n\n&#39;)</span></span>
<span id="cb276-18"><a href="rmarkdown-operation.html#cb276-18" aria-hidden="true" tabindex="-1"></a><span class="in">    hist(x, xlab = i, main = &#39;&#39;)</span></span>
<span id="cb276-19"><a href="rmarkdown-operation.html#cb276-19" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb276-20"><a href="rmarkdown-operation.html#cb276-20" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb276-21"><a href="rmarkdown-operation.html#cb276-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>需要注意的是，上述示例代码中添加了过多的换行符（<code>\n</code>），从而将不同的元素在 Markdown 中清晰地分开。在不同的元素之间使用过多的换行符是无害的，但是如果换行符不够，就会产生问题。例如，下面的 Markdown 文本就会产生很多的歧义：</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb277-1"><a href="rmarkdown-operation.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是一个标题吗？</span></span>
<span id="cb277-2"><a href="rmarkdown-operation.html#cb277-2" aria-hidden="true" tabindex="-1"></a>这是一个段落还是标题的一部分呢？</span>
<span id="cb277-3"><a href="rmarkdown-operation.html#cb277-3" aria-hidden="true" tabindex="-1"></a><span class="al">![这张图片呢？](foo.png)</span></span>
<span id="cb277-4"><a href="rmarkdown-operation.html#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这行又是什么？</span></span></code></pre></div>
<p>如果产生了更多的空行（可以由<code>cat('\n')</code>生成），则歧义就会消失：</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb278-1"><a href="rmarkdown-operation.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是一个标题！</span></span>
<span id="cb278-2"><a href="rmarkdown-operation.html#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="rmarkdown-operation.html#cb278-3" aria-hidden="true" tabindex="-1"></a>这绝对是个段落。</span>
<span id="cb278-4"><a href="rmarkdown-operation.html#cb278-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-5"><a href="rmarkdown-operation.html#cb278-5" aria-hidden="true" tabindex="-1"></a><span class="al">![这是一张图。](foo.png)</span></span>
<span id="cb278-6"><a href="rmarkdown-operation.html#cb278-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-7"><a href="rmarkdown-operation.html#cb278-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是另一个标题</span></span></code></pre></div>
<p><code>cat()</code> 函数不是唯一可以生成文本输出的函数，另一个常用的函数是 <code>print()</code>。但需要注意的是，<code>print()</code> 经常被 <em>隐式</em> 调用来打印对象，这就是为什么在 R 控制台（console）中输入一个对象或值后会看到输出。例如，当在 R 控制台中输入 <code>1:5</code> 并按下 <code>Enter</code> 键时，会看到输出，这是因为 R 实际上隐式地调用了 <code>print(1:5)</code>。经常令人感到困惑的是，不能在表达式（例如 <code>for</code> 循环）中直接生成输出，而如果在 R 控制台上输入对象或值，它们将被正确打印出来。这个主题非常技术性，具体细节可以参看博文<a href="https://yihui.org/en/2017/06/top-level-r-expressions/">“The Ghost Printer behind Top-level R Expressions”</a>。如果对技术细节不感兴趣，只要记住这条规则即可：如果在 <code>for</code> 循环中没有看到输出，那么可能应该使用 <code>print()</code> 函数来显式地打印对象。</p>
</div>
</div>
<div id="chunk-reformat" class="section level3" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> 重新格式化源代码</h3>
<p>有的时候，因个人习惯以及代码熟练度的不同，源代码格式会有所不同，甚至有些杂乱，这会加大报告用户的阅读难度（尤其是当老师或助教阅读的时候，这会直接影响作业的分数）。本节将介绍如何通过块选项，让源代码自动地“变好看”。</p>
<p>当设置块选项 <code>tidy = TRUE</code> 时， R 的源代码将被 <strong>formatR</strong> 包 <span class="citation">(<a href="#ref-R-formatR" role="doc-biblioref">Xie 2021a</a>)</span>的 <code>tidy_source()</code> 函数重新格式化。<code>tidy_source()</code> 可以在几个方面重新格式化代码，比如在大多数操作符周围添加空格、适当缩进代码以及用 <code>&lt;-</code> 替换赋值操作符 <code>=</code> 。块选项 <code>tidy.opts</code> 可以是传递给 <code>formatR::tidy_source()</code> 的一个参数列表，例如：</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb279-1"><a href="rmarkdown-operation.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, tidy=TRUE, tidy.opts=list(arrow=TRUE, indent=2)}</span></span>
<span id="cb279-2"><a href="rmarkdown-operation.html#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 混乱的 R 代码...</span></span>
<span id="cb279-3"><a href="rmarkdown-operation.html#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="in">1+            1</span></span>
<span id="cb279-4"><a href="rmarkdown-operation.html#cb279-4" aria-hidden="true" tabindex="-1"></a><span class="in">x=1:10#有些使用者更喜欢用 &#39;&lt;-&#39; 来作为赋值操作符</span></span>
<span id="cb279-5"><a href="rmarkdown-operation.html#cb279-5" aria-hidden="true" tabindex="-1"></a><span class="in">if(TRUE){</span></span>
<span id="cb279-6"><a href="rmarkdown-operation.html#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="in">print(&#39;Hello world!&#39;) # 缩进 2 个空格</span></span>
<span id="cb279-7"><a href="rmarkdown-operation.html#cb279-7" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb279-8"><a href="rmarkdown-operation.html#cb279-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出结果为：</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="rmarkdown-operation.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 混乱的 R 代码...</span></span>
<span id="cb280-2"><a href="rmarkdown-operation.html#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb280-3"><a href="rmarkdown-operation.html#cb280-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>  <span class="co">#有些使用者更喜欢用 &#39;&lt;-&#39; 来作为赋值操作符</span></span>
<span id="cb280-4"><a href="rmarkdown-operation.html#cb280-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb280-5"><a href="rmarkdown-operation.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Hello world!&quot;</span>)  <span class="co"># 缩进 2 个空格</span></span>
<span id="cb280-6"><a href="rmarkdown-operation.html#cb280-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>第 <a href="rmarkdown-base.html#output-width">2.5.1</a> 节介绍了如何控制输出的宽度。如果想进一步控制源代码的宽度，则可以在设置 <code>tidy = TRUE</code> 时使用 <code>width.cutoff</code> 参数，例如：</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb281-1"><a href="rmarkdown-operation.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, tidy=TRUE, tidy.opts=list(width.cutoff=50)}</span></span>
<span id="cb281-2"><a href="rmarkdown-operation.html#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 一个很长的表达式</span></span>
<span id="cb281-3"><a href="rmarkdown-operation.html#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="in">1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+</span></span>
<span id="cb281-4"><a href="rmarkdown-operation.html#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="in">1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1</span></span>
<span id="cb281-5"><a href="rmarkdown-operation.html#cb281-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出结果为：</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="rmarkdown-operation.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个很长的表达式</span></span>
<span id="cb282-2"><a href="rmarkdown-operation.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb282-3"><a href="rmarkdown-operation.html#cb282-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb282-4"><a href="rmarkdown-operation.html#cb282-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb282-5"><a href="rmarkdown-operation.html#cb282-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<p>更多可能的参数可以参见帮助页 <code>?formatR::tidy_source</code>，也可以浏览 <a href="https://yihui.org/formatR/" class="uri">https://yihui.org/formatR/</a> 来了解这个函数的示例和局限性。</p>
<p>另外，还可以通过设定块选项 <code>tidy = 'styler'</code> 来使用 <strong>styler</strong> 包<span class="citation">(<a href="#ref-R-styler" role="doc-biblioref"><strong>R-styler?</strong></a>)</span>重新格式化 R 代码，其中的格式化函数为 <code>styler::style_text()</code>。<strong>styler</strong> 包比 <strong>formatR</strong> 具有更丰富的特性。例如，它可以对齐函数参数并使用管道操作符 <code>%&gt;%</code>。块选项 <code>tidy.opts</code> 同样可以用于将附加参数传递给 <code>styler::style_text()</code>，例如：</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb283-1"><a href="rmarkdown-operation.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, tidy=&#39;styler&#39;, tidy.opts=list(strict=FALSE)}</span></span>
<span id="cb283-2"><a href="rmarkdown-operation.html#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 对齐赋值操作符</span></span>
<span id="cb283-3"><a href="rmarkdown-operation.html#cb283-3" aria-hidden="true" tabindex="-1"></a><span class="in">a   &lt;- 1#一个变量</span></span>
<span id="cb283-4"><a href="rmarkdown-operation.html#cb283-4" aria-hidden="true" tabindex="-1"></a><span class="in">abc &lt;- 2#另一个变量</span></span>
<span id="cb283-5"><a href="rmarkdown-operation.html#cb283-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>在默认情况下，<code>tidy = FALSE</code> 并且 R 代码不会被重新格式化。</p>
</div>
<div id="chunk-leading" class="section level3" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> 调整文本输出中的前导符号</h3>
<p>默认情况下，R Markdown 会在文本输出的前面插入两个符号 <code>##</code>，那么这个符号能不能更改或者干脆删除呢？第 <a href="rmarkdown-operation.html#results-asis">6.2.3.4</a> 节介绍了通过在添加 <code>results = 'asis'</code> 选项来生成 Markdown 形式输出的方法。但如果只是想调整前导符号，而仍然想将文本放在单独的块中，则可以通过块选项 <code>comment</code> 来实现。如果要删除 <code>##</code>，可以使用空字符串，例如：</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb284-1"><a href="rmarkdown-operation.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, comment=&quot;&quot;}</span></span>
<span id="cb284-2"><a href="rmarkdown-operation.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="in">1:100</span></span>
<span id="cb284-3"><a href="rmarkdown-operation.html#cb284-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>当然，可以使用任何其他的字符值，例如，<code>comment = "#&gt;"</code>。那么为什么 <code>comment</code> 选项默认为 <code>##</code> 呢？这是因为 <code>#</code> 表示 R 中的注释，当文本输出被注释掉时，从报告中的代码块中一次性复制所有代码并自己运行它将更容易，不需要担心运行文本输出（并非 R 代码）会报错。例如，在下面的代码块中，可以复制所有四行文本，并将它们作为 R 代码正确地运行：</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="rmarkdown-operation.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb285-2"><a href="rmarkdown-operation.html#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb285-3"><a href="rmarkdown-operation.html#cb285-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb285-4"><a href="rmarkdown-operation.html#cb285-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span></code></pre></div>
<p>而如果通过 <code>comment = ""</code> 删除 <code>##</code> ，通常会无法直接运行所有的代码。如下面的例子所展示的，如果直接复制这四行，就需要手动删除第二和第四行：</p>
</div>
<div id="chunk-property" class="section level3" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> 为文本输出块添加属性 (*)</h3>
</div>
<div id="chunk-multiplot" class="section level3" number="6.2.7">
<h3><span class="header-section-number">6.2.7</span> 同一张图的多种图像输出格式</h3>
</div>
<div id="chunk-process" class="section level3" number="6.2.8">
<h3><span class="header-section-number">6.2.8</span> 图像的后期加工 (*)</h3>
</div>
<div id="chunk-highquality" class="section level3" number="6.2.9">
<h3><span class="header-section-number">6.2.9</span> 输出高质量的图像 (*)</h3>
</div>
<div id="chunk-step-plot" class="section level3" number="6.2.10">
<h3><span class="header-section-number">6.2.10</span> 带有低级绘图功能的逐步绘图 (*)</h3>
</div>
<div id="chunk-print" class="section level3" number="6.2.11">
<h3><span class="header-section-number">6.2.11</span> 在代码块中自定义对象的打印格式 (*)</h3>
</div>
<div id="option-hook" class="section level3" number="6.2.12">
<h3><span class="header-section-number">6.2.12</span> 选项钩子 (*)</h3>
</div>
</div>
<div id="other-language" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> 与其他语言的结合</h2>
<p>在 R Markdown 中，<strong>knitr</strong> 软件包除了支持 R 语言外，还支持许多其他语言。</p>
<p>不同语言代码块表示方式类似，只需修改代码块中三个反引号后的花括号中的第一个单词即可。例如，<code>```{r}</code> 中的小 <code>r</code> 表示该代码块为 R 代码块，而 <code>```{python}</code> 是指该代码块为 Python 代码块。本节将介绍一些读者可能不太熟悉的语言。</p>
<p>在 knitr 中，每种语言都通过<strong>语言引擎</strong>得到支持。语言引擎本质上是一些函数，它们以源代码和块的选项作为输入，最后输出一个字符串。并通过 <code>knitr::knit_engines</code> 进行管理。可以使用以下方式检查现有引擎：</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="rmarkdown-operation.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">get</span>())</span></code></pre></div>
<pre><code>##  [1] &quot;awk&quot;       &quot;bash&quot;      &quot;coffee&quot;    &quot;gawk&quot;      &quot;groovy&quot;    &quot;haskell&quot;  
##  [7] &quot;lein&quot;      &quot;mysql&quot;     &quot;node&quot;      &quot;octave&quot;    &quot;perl&quot;      &quot;psql&quot;     
## [13] &quot;Rscript&quot;   &quot;ruby&quot;      &quot;sas&quot;       &quot;scala&quot;     &quot;sed&quot;       &quot;sh&quot;       
## [19] &quot;stata&quot;     &quot;zsh&quot;       &quot;asis&quot;      &quot;asy&quot;       &quot;block&quot;     &quot;block2&quot;   
## [25] &quot;bslib&quot;     &quot;c&quot;         &quot;cat&quot;       &quot;cc&quot;        &quot;comment&quot;   &quot;css&quot;      
## [31] &quot;dot&quot;       &quot;embed&quot;     &quot;fortran&quot;   &quot;fortran95&quot; &quot;go&quot;        &quot;highlight&quot;
## [37] &quot;js&quot;        &quot;julia&quot;     &quot;python&quot;    &quot;R&quot;         &quot;Rcpp&quot;      &quot;sass&quot;     
## [43] &quot;scss&quot;      &quot;sql&quot;       &quot;stan&quot;      &quot;targets&quot;   &quot;tikz&quot;      &quot;verbatim&quot;</code></pre>
<p>目前，大多数非 R 语言的代码块都是独立执行的。例如，同一文档中的所有 <code>bash</code> 代码块都在各自的会话中单独执行，因此后面的 <code>bash</code> 代码块不能使用在先前 <code>bash</code> 代码块中创建的变量，更改后的工作目录（通过 <code>cd</code> ）在其他 bash 代码块中不会一直存在。只有 R、Python 和 Julia 代码块在同一个会话中执行。并且 R 会话和 Python 会话是两个不同的会话，但是可以从另一个会话访问或操作一个会话的对象(参见<a href="https://bookdown.org/yihui/rmarkdown-cookbook/eng-python.html#eng-python">15.2</a>节)。</p>
<p><strong>R Markdown权威指南</strong> (<a href="https://bookdown.org/yihui/rmarkdown-cookbook/other-languages.html#ref-rmarkdown2018">Xie, Allaire, and Grolemund 2018</a>) 的<a href="https://bookdown.org/yihui/rmarkdown/language-engines.html">2.7节</a> 展示了如何在 R Markdown 中使用 Python, Shell, SQL, Rcpp, Stan, JavaScript, CSS, Julia, C，和 Fortran 代码。这里就不做进一步介绍，本节主要重点介绍更多的语言引擎。读者可以在下面的库中找到更多的例子： <a href="https://github.com/yihui/knitr-examples" class="uri">https://github.com/yihui/knitr-examples</a> （查找包含单词引擎的文件名）。</p>
<p>首先，通过注册一个自定义语言引擎来说明语言引擎是如何工作的。</p>
<div id="register-language" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> 注册自定义语言引擎 (*)</h3>
<p>使用 <code>knitr::knit engines$set()</code> 注册一个自定义语言引擎。它接受一个函数作为输入，例如：</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="rmarkdown-operation.html#cb288-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">foo =</span> <span class="cf">function</span>(options) {</span>
<span id="cb288-2"><a href="rmarkdown-operation.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 源代码在options$code</span></span>
<span id="cb288-3"><a href="rmarkdown-operation.html#cb288-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>这样就已经注册了 <code>foo</code> 引擎，现在读者可以使用以 <code>```{foo}</code> 开头的代码块了。该引擎函数中的 <code>options</code> 参数是代码块的块选项列表。可以在 <code>options$code</code> 中以字符向量的形式访问块的源代码。例如，对于代码块：</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb289-1"><a href="rmarkdown-operation.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{foo}</span></span>
<span id="cb289-2"><a href="rmarkdown-operation.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb289-3"><a href="rmarkdown-operation.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="in">2 + 2</span></span>
<span id="cb289-4"><a href="rmarkdown-operation.html#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p><code>options</code> 的代码元素是一个字符向量 <code>c('1 + 1', '2 + 2')</code>。语言引擎实际上并不需要处理计算机语言，但可以处理代码块中的任何文本。首先，来展示一个简单的引擎示例，该引擎将代码块的内容转换为大写：</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="rmarkdown-operation.html#cb290-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">upper =</span> <span class="cf">function</span>(options) {</span>
<span id="cb290-2"><a href="rmarkdown-operation.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  code <span class="ot">&lt;-</span> <span class="fu">paste</span>(options<span class="sc">$</span>code, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb290-3"><a href="rmarkdown-operation.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (options<span class="sc">$</span>eval) <span class="fu">toupper</span>(code) <span class="cf">else</span> code</span>
<span id="cb290-4"><a href="rmarkdown-operation.html#cb290-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>引擎的作用是将 <code>toupper</code> 函数应用于代码，并以单个字符串的形式返回结果（通过 <code>\n</code> 连接所有代码行）。注意 <code>toupper()</code> 仅在 chunk 选项 <code>eval = TRUE</code> 时才应用，否则返回原始字符串。</p>
<p>以上已经向读者们展示了如何在引擎函数中使用 <code>eval</code> 之类的块选项。类似地，考虑在函数体中添加 <code>if (options$results == 'hide') return()</code> 来隐藏 chunk 选项时的输出 <code>results = 'hide'</code> 。下面是一个使用 <code>upper</code> 引擎及其输出的示例块</p>
<blockquote>
<div class="sourceCode" id="cb291"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb291-1"><a href="rmarkdown-operation.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{upper}</span></span>
<span id="cb291-2"><a href="rmarkdown-operation.html#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="in">Hello, **knitr** engines!</span></span>
<span id="cb291-3"><a href="rmarkdown-operation.html#cb291-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>HELLO, <strong>KNITR</strong> ENGINES!</p>
</blockquote>
<p>接下来，将展示一个名为 <code>py</code> 的另一种 <code>python</code> 引擎的示例<a href="references.html#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a>。这个引擎是通过 R 函数 <code>system2()</code> 调用 <code>python</code> 命令来实现的：</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="rmarkdown-operation.html#cb292-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">py =</span> <span class="cf">function</span>(options) {</span>
<span id="cb292-2"><a href="rmarkdown-operation.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  code <span class="ot">&lt;-</span> <span class="fu">paste</span>(options<span class="sc">$</span>code, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb292-3"><a href="rmarkdown-operation.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  out  <span class="ot">&lt;-</span> <span class="fu">system2</span>(</span>
<span id="cb292-4"><a href="rmarkdown-operation.html#cb292-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;python&#39;</span>, <span class="fu">c</span>(<span class="st">&#39;-c&#39;</span>, <span class="fu">shQuote</span>(code)), <span class="at">stdout =</span> <span class="cn">TRUE</span></span>
<span id="cb292-5"><a href="rmarkdown-operation.html#cb292-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb292-6"><a href="rmarkdown-operation.html#cb292-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">engine_output</span>(options, code, out)</span>
<span id="cb292-7"><a href="rmarkdown-operation.html#cb292-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>为了充分理解以上引擎的功能，读者需要了解以下内容：</p>
<ol style="list-style-type: decimal">
<li><p>给定 Python 代码作为字符串（上述函数中的代码），我们可以通过命令行调用 <code>python -c 'code'</code> 执行代码。 那就是 <code>system2()</code> 所做的。并通过在 <code>system2()</code> 中指定 <code>stdout = TRUE</code> 来收集（文本）输出。</p></li>
<li><p>将块选项、源代码和文本输出传递给函数 <code>knitr::engine_output()</code> 以生成最终输出。这个函数处理常见的块选项，比如 <code>echo = FALSE</code> 和 <code>results = 'hide'</code>，所以读者不需要注意这些情况。</p></li>
</ol>
<p><strong>knitr</strong> 中的许多语言引擎都是这样定义的(例如，使用 <code>system2()</code> 来执行与语言对应的命令)。如果读者对技术细节感兴趣，可以在这里的 R 源代码中查看大多数语言引擎的源代码
<a href="https://github.com/yihui/knitr/blob/master/R/engine.R" class="uri">https://github.com/yihui/knitr/blob/master/R/engine.R</a>。</p>
<p>现在，可以使用新的引擎 <code>py</code>，例如：</p>
<blockquote>
<div class="sourceCode" id="cb293"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb293-1"><a href="rmarkdown-operation.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{py}</span></span>
<span id="cb293-2"><a href="rmarkdown-operation.html#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="in">print(1 + 1)</span></span>
<span id="cb293-3"><a href="rmarkdown-operation.html#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<pre><code>## 2</code></pre>
</blockquote>
<p>如果觉得自己的版本比现有的版本更好，读者甚至可以通过 <code>knitr::knit_engines$set()</code> 重写现有的语言引擎。但是，通常不建议读者这样做，因为这会让熟悉现有引擎的用户感到惊讶。不过无论如何都想读者意识到这种可能性。</p>
</div>
<div id="python-rmd" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> 运行 Python 代码并与 Python 交互</h3>
<p>R Markdown 和 <strong>knitr</strong> 支持 Python。要将 Python 代码块添加到 R Markdown 文档中，可以在块的头部变为<code>```{python}</code>，例如：</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb295-1"><a href="rmarkdown-operation.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb295-2"><a href="rmarkdown-operation.html#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="in">print(&quot;Hello Python!&quot;)</span></span>
<span id="cb295-3"><a href="rmarkdown-operation.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>读者可以像往常一样在 chunk 头中添加 chunk 选项，比如 <code>echo = FALSE</code> 或 <code>eval = FALSE</code> ，并且也支持使用 Python 中的 <strong>matplotlib</strong> 包绘图。</p>
<p>R Markdown 和 <strong>knitr</strong> 中的 Python 支持 <strong>reticulate</strong> 包 <span class="citation">(<a href="#ref-R-reticulate" role="doc-biblioref">Ushey, Allaire, and Tang 2021</a>)</span>，这个包的一个重要特性是它允许 Python 和 R 之间的双向通信。例如，可以在 R 会话中通过 <strong>reticulate</strong> 包中的 py 对象访问或创建 Python 变量：</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb296-1"><a href="rmarkdown-operation.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, setup}</span></span>
<span id="cb296-2"><a href="rmarkdown-operation.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="in">library(reticulate)</span></span>
<span id="cb296-3"><a href="rmarkdown-operation.html#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb296-4"><a href="rmarkdown-operation.html#cb296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-5"><a href="rmarkdown-operation.html#cb296-5" aria-hidden="true" tabindex="-1"></a>在 Python 会话中创建一个变量 <span class="in">`x`</span>:</span>
<span id="cb296-6"><a href="rmarkdown-operation.html#cb296-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-7"><a href="rmarkdown-operation.html#cb296-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-8"><a href="rmarkdown-operation.html#cb296-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb296-9"><a href="rmarkdown-operation.html#cb296-9" aria-hidden="true" tabindex="-1"></a><span class="in">x = [1, 2, 3]</span></span>
<span id="cb296-10"><a href="rmarkdown-operation.html#cb296-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb296-11"><a href="rmarkdown-operation.html#cb296-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-12"><a href="rmarkdown-operation.html#cb296-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-13"><a href="rmarkdown-operation.html#cb296-13" aria-hidden="true" tabindex="-1"></a>在 R 代码块中访问 Python 变量 <span class="in">`x`</span>:</span>
<span id="cb296-14"><a href="rmarkdown-operation.html#cb296-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-15"><a href="rmarkdown-operation.html#cb296-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb296-16"><a href="rmarkdown-operation.html#cb296-16" aria-hidden="true" tabindex="-1"></a><span class="in">py$x</span></span>
<span id="cb296-17"><a href="rmarkdown-operation.html#cb296-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb296-18"><a href="rmarkdown-operation.html#cb296-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-19"><a href="rmarkdown-operation.html#cb296-19" aria-hidden="true" tabindex="-1"></a>在 Python 会话中使用 R 创建一个新变量 <span class="in">`y`</span>， 并传递一个数据帧给 <span class="in">`y`</span>:</span>
<span id="cb296-20"><a href="rmarkdown-operation.html#cb296-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-21"><a href="rmarkdown-operation.html#cb296-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb296-22"><a href="rmarkdown-operation.html#cb296-22" aria-hidden="true" tabindex="-1"></a><span class="in">py$y &lt;- head(cars)</span></span>
<span id="cb296-23"><a href="rmarkdown-operation.html#cb296-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb296-24"><a href="rmarkdown-operation.html#cb296-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-25"><a href="rmarkdown-operation.html#cb296-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-26"><a href="rmarkdown-operation.html#cb296-26" aria-hidden="true" tabindex="-1"></a>在 Python 中输出变量 <span class="in">`y`</span>：</span>
<span id="cb296-27"><a href="rmarkdown-operation.html#cb296-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-28"><a href="rmarkdown-operation.html#cb296-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb296-29"><a href="rmarkdown-operation.html#cb296-29" aria-hidden="true" tabindex="-1"></a><span class="in">print(y)</span></span>
<span id="cb296-30"><a href="rmarkdown-operation.html#cb296-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>有关 <strong>reticulate</strong> 的更多信息，可以在查看它的文档
<a href="https://rstudio.github.io/reticulate/" class="uri">https://rstudio.github.io/reticulate/</a>。</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="rmarkdown-operation.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb297-2"><a href="rmarkdown-operation.html#cb297-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb297-3"><a href="rmarkdown-operation.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb297-4"><a href="rmarkdown-operation.html#cb297-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
<p>设置 <code>comment = ""</code> 的一个理由是，使用 R 控制台（console）的用户对其更为熟悉。在 R 控制台中，用户不会在文本输出前面看到<code>##</code>。如果想模仿 R 控制台的行为，可以将 <code>comment = ""</code> 和 <code>prompt = TRUE</code> 结合在一起使用，例如：</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb298-1"><a href="rmarkdown-operation.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, comment=&quot;&quot;, prompt=TRUE}</span></span>
<span id="cb298-2"><a href="rmarkdown-operation.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb298-3"><a href="rmarkdown-operation.html#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="in">if (TRUE) {</span></span>
<span id="cb298-4"><a href="rmarkdown-operation.html#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="in">  2 + 2</span></span>
<span id="cb298-5"><a href="rmarkdown-operation.html#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb298-6"><a href="rmarkdown-operation.html#cb298-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>对于曾经在 R 控制台中输入并运行过代码的用户，输出结果看起来应该相当熟悉，因为源代码中包含提示字符（prompt character） <code>&gt;</code> 和延续字符（continuation character） <code>+</code>，这就是 <code>prompt = TRUE</code> 的作用：</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="rmarkdown-operation.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb299-2"><a href="rmarkdown-operation.html#cb299-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb299-3"><a href="rmarkdown-operation.html#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">if</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb299-4"><a href="rmarkdown-operation.html#cb299-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb299-5"><a href="rmarkdown-operation.html#cb299-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb299-6"><a href="rmarkdown-operation.html#cb299-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
</div>
<div id="chunk-property" class="section level3" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> 为文本输出块添加属性 (*)</h3>
<p>第 <a href="rmarkdown-document.html#html-css-list">3.1.2.5</a> 节展示了一些基于块选项 <code>class.source</code> 样式化代码块的示例。实际上，在 <strong>knitr</strong> 中有更多类似的选项，如 <code>class.output</code>、<code>class.message</code>、<code>class.warning</code> 以及 <code>class.error</code>。这些选项可以用于将类名添加到相应的文本输出块中，例如 <code>error = TRUE</code> （见第 <a href="rmarkdown-operation.html#chunk-error">6.2.2</a> 节）。就像在第 <a href="rmarkdown-document.html#html-css-list">3.1.2.5</a> 节中演示的那样，这些选项最常见的应用可能是使用根据类名定义的 CSS 规则对输出块进行样式化。</p>
<p>通常情况下，文本输出块本质上是一个单独的代码块，它的 Markdown 源代码如下所示：</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb300-1"><a href="rmarkdown-operation.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{.className}</span></span>
<span id="cb300-2"><a href="rmarkdown-operation.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="in">输出行</span></span>
<span id="cb300-3"><a href="rmarkdown-operation.html#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>当输出格式为 HTML 时，通常会转换为<a href="references.html#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb301-1"><a href="rmarkdown-operation.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;className&quot;</span><span class="kw">&gt;</span></span>
<span id="cb301-2"><a href="rmarkdown-operation.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;code&gt;</span>输出行<span class="kw">&lt;/code&gt;</span></span>
<span id="cb301-3"><a href="rmarkdown-operation.html#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/pre&gt;</span></span></code></pre></div>
<p><code>class.*</code> 选项控制了 <code>&lt;pre&gt;</code> 元素中的 <code>class</code> 属性，而 <code>&lt;pre&gt;</code> 是之前提到的文本输出块的“容器”。</p>
<p>事实上，这个类只是 HTML 中 <code>&lt;pre&gt;</code> 元素可能的属性之一。一个 HTML 元素可以有许多其他属性，比如宽度、高度和样式等。块选项 <code>attr.*</code>，包括 <code>attr.source</code>、<code>attr.output</code>、<code>attr.message</code>、<code>attr.warning</code> 以及 <code>attr.error</code>，允许用户向文本输出块添加任意属性。例如，使用 <code>attr.source = 'style="background: pink;"'</code>，可以将源代码块的背景颜色更改为粉红色，相应的代码块将是：</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb302-1"><a href="rmarkdown-operation.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{style=&quot;background: pink;&quot;}</span></span>
<span id="cb302-2"><a href="rmarkdown-operation.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="in">...</span></span>
<span id="cb302-3"><a href="rmarkdown-operation.html#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>以及 HTML 输出会是：</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb303-1"><a href="rmarkdown-operation.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;background: pink;&quot;</span><span class="kw">&gt;</span></span>
<span id="cb303-2"><a href="rmarkdown-operation.html#cb303-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb303-3"><a href="rmarkdown-operation.html#cb303-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/pre&gt;</span></span></code></pre></div>
<p>更多的例子可以参见第 <a href="rmarkdown-operation.html#scrollable-output">6.4.3</a> 节。</p>
<p>作为一个技术性拓展，块选项 <code>class.*</code> 只是 <code>attr.*</code> 的特殊情况，例如，<code>class.source = 'numberLines'</code> 等价于 <code>attr.source = '.numberLines'</code>（注意这里的前导点），但 <code>attr.source</code> 可以取任意的属性值，例如 <code>attr.source = c('.numberLines', 'startFrom="11"')</code>。</p>
<p>这些选项对 HTML 输出非常有用。在某些情况下，这些属性可能对其他输出格式也有用，但这种情况相对较少。这些属性需要被 Pandoc 或第三方的包支持。例如 Pandoc 中，<code>.numberLines</code> 属性适用于 HTML 和 LaTeX 输出；第三方的包则通常需要通过一个 Lua 过滤器，感兴趣者请参见：<a href="https://bookdown.org/yihui/rmarkdown-cookbook/lua-filters.html" class="uri">https://bookdown.org/yihui/rmarkdown-cookbook/lua-filters.html</a>。</p>
</div>
<div id="chunk-multiplot" class="section level3" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> 同一张图的多种图像输出格式</h3>
<p>在大多数情况下，报告可能只需要一种图像格式，例如 <code>png</code> 或 <code>tiff</code>。但有些时候，一些报告需要提交多种格式的图像，这就需要进一步了解图像格式选择的原理。</p>
<p>图像格式由块选项 <code>dev</code> 控制，即渲染图像的图像设备，这个选项的取值可以为设备名（即输出格式）的向量，例如：</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb304-1"><a href="rmarkdown-operation.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, dev=c(&#39;png&#39;, &#39;pdf&#39;, &#39;svg&#39;, &#39;tiff&#39;)}</span></span>
<span id="cb304-2"><a href="rmarkdown-operation.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb304-3"><a href="rmarkdown-operation.html#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出文档中只会呈现第一种格式的图像，但其它格式的图像也会被生成。这里需要注意的是，在默认情况下，图像文件在输出文档呈现后会立即被删除，如要保存这些文件，请参见<a href="rmarkdown-project.html#keep-plot">7.1.5</a>节。</p>
</div>
<div id="chunk-process" class="section level3" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> 图像的后期加工 (*)</h3>
<p>有的时候，可能会需要对已有的图像进行后期加工，从而实现简单的“PS”功能，这一需求可以通过块选项 <code>fig.process</code> 来实现。需要传递给该选项一个输入文件路径、返回已处理图像文件路径的函数。该函数可以有第二个可选参数 <code>options</code>，代表一个由当前块选项组成的列表。</p>
<p>下面的例子展示了如何使用一个功能强大的 <strong>magick</strong>包 <span class="citation">(<a href="#ref-R-magick" role="doc-biblioref">Ooms 2021</a>)</span> 来在图像中添加 R logo。首先，定义一个函数 <code>add_logo()</code>：</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="rmarkdown-operation.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;magick&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="rmarkdown-operation.html#cb306-1" aria-hidden="true" tabindex="-1"></a>add_logo <span class="ot">=</span> <span class="cf">function</span>(path, options) {</span>
<span id="cb306-2"><a href="rmarkdown-operation.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 代码块中创建的图像</span></span>
<span id="cb306-3"><a href="rmarkdown-operation.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read</span>(path)</span>
<span id="cb306-4"><a href="rmarkdown-operation.html#cb306-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R logo</span></span>
<span id="cb306-5"><a href="rmarkdown-operation.html#cb306-5" aria-hidden="true" tabindex="-1"></a>  logo <span class="ot">=</span> <span class="fu">file.path</span>(<span class="fu">R.home</span>(<span class="st">&quot;doc&quot;</span>), <span class="st">&quot;html&quot;</span>, <span class="st">&quot;logo.jpg&quot;</span>)</span>
<span id="cb306-6"><a href="rmarkdown-operation.html#cb306-6" aria-hidden="true" tabindex="-1"></a>  logo <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read</span>(logo)</span>
<span id="cb306-7"><a href="rmarkdown-operation.html#cb306-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 默认的重力方向为西北，用户可以通过代码块来改变它</span></span>
<span id="cb306-8"><a href="rmarkdown-operation.html#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># option magick.gravity</span></span>
<span id="cb306-9"><a href="rmarkdown-operation.html#cb306-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(g <span class="ot">&lt;-</span> options<span class="sc">$</span>magick.gravity)) g <span class="ot">=</span> <span class="st">&#39;northwest&#39;</span></span>
<span id="cb306-10"><a href="rmarkdown-operation.html#cb306-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 在图像中添加 logo</span></span>
<span id="cb306-11"><a href="rmarkdown-operation.html#cb306-11" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_composite</span>(img, logo, <span class="at">gravity =</span> g)</span>
<span id="cb306-12"><a href="rmarkdown-operation.html#cb306-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 写入新的图像中 </span></span>
<span id="cb306-13"><a href="rmarkdown-operation.html#cb306-13" aria-hidden="true" tabindex="-1"></a>  magick<span class="sc">::</span><span class="fu">image_write</span>(img, path)</span>
<span id="cb306-14"><a href="rmarkdown-operation.html#cb306-14" aria-hidden="true" tabindex="-1"></a>  path</span>
<span id="cb306-15"><a href="rmarkdown-operation.html#cb306-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>该函数会读取图像的路径，添加 R logo，并将新图像保存到原路径。在默认情况下，logo 会被添加到图像的左上角（西北方向），但用户可以通过自定义块选项 <code>magick.gravity</code>（这个选项名可以是任意的）来自定义位置。</p>
<p>下一步就是将处理函数 <code>add_logo()</code> 应用到代码块中，并使用块选项 <code>fig.process = add_logo</code> 和 <code>magick.gravity = "northeast"</code>，所以 logo 会被添加到右上角。实际输出见图 <a href="rmarkdown-operation.html#fig:magick-logo">6.2</a>。</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="rmarkdown-operation.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, .<span class="dv">1</span>, .<span class="dv">1</span>))</span>
<span id="cb307-2"><a href="rmarkdown-operation.html#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(faithful<span class="sc">$</span>eruptions, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">&#39;&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span>, <span class="at">border =</span> <span class="st">&#39;white&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:magick-logo"></span>
<img src="rmarkdown-guide_files/figure-html/magick-logo-1.png" alt="通过块选项 fig.process 来给一幅图添加 R logo。"  />
<p class="caption">
图 6.2: 通过块选项 fig.process 来给一幅图添加 R logo。
</p>
</div>
<p>在对<strong>magick</strong>包更加熟悉后，就可以通过更有创意和有用的想法来后期加工你的图像。</p>
<p>下面的例子展示了 <code>fig.process</code> 选项的另一个应用，其中 <code>pdf2png()</code> 函数可以将 PDF 图像转换成 PNG 格式。第 <a href="rmarkdown-operation.html#chunk-highquality">6.2.9</a> 节介绍了如何使用 <code>tikz</code> 图像设备来生成图，但该设备生成的 PDF 图不适用于非 LaTeX 的输出文档。而在设置块选项 <code>dev = "tikz"</code> 和 <code>fig.process = pdf2png</code> 后，就可以显示图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.3</a> 的 PNG 版本了。</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="rmarkdown-operation.html#cb308-1" aria-hidden="true" tabindex="-1"></a>pdf2png <span class="ot">=</span> <span class="cf">function</span>(path) {</span>
<span id="cb308-2"><a href="rmarkdown-operation.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 只对非LaTeX的输出进行转换</span></span>
<span id="cb308-3"><a href="rmarkdown-operation.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) <span class="fu">return</span>(path)</span>
<span id="cb308-4"><a href="rmarkdown-operation.html#cb308-4" aria-hidden="true" tabindex="-1"></a>  path2 <span class="ot">=</span> xfun<span class="sc">::</span><span class="fu">with_ext</span>(path, <span class="st">&quot;png&quot;</span>)</span>
<span id="cb308-5"><a href="rmarkdown-operation.html#cb308-5" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read_pdf</span>(path)</span>
<span id="cb308-6"><a href="rmarkdown-operation.html#cb308-6" aria-hidden="true" tabindex="-1"></a>  magick<span class="sc">::</span><span class="fu">image_write</span>(img, path2, <span class="at">format =</span> <span class="st">&quot;png&quot;</span>)</span>
<span id="cb308-7"><a href="rmarkdown-operation.html#cb308-7" aria-hidden="true" tabindex="-1"></a>  path2</span>
<span id="cb308-8"><a href="rmarkdown-operation.html#cb308-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="chunk-highquality" class="section level3" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> 输出高质量的图像 (*)</h3>
<p>不同格式的图像往往在输出质量上有差异。<strong>rmarkdown</strong> 包为不同的输出格式设置了合理的默认图像设备。例如，对 HTML 输出格式使用 <code>png()</code> 设备，所以 <strong>knitr</strong> 将生成 png 绘图文件；而对 PDF 输出格式则使用 <code>pdf()</code> 设备。如果对默认图像设备的输出质量不满意，可以通过块选项
<code>dev</code>
来更改它们。<strong>knitr</strong>
支持的设备为：<code>"bmp"</code>，<code>"postscript"</code>，<code>"pdf"</code>，<code>"png"</code>，<code>"svg"</code>，<code>"jpeg"</code>，<code>"pictex"</code>，<code>"tiff"</code>，<code>"win.metafile"</code>，<code>"cairo_pdf"</code>，<code>"cairo_ps"</code>，<code>"quartz_pdf"</code>，<code>"quartz_png"</code>，<code>"quartz_jpeg"</code>，<code>"quartz_tiff"</code>，<code>"quartz_gif"</code>，<code>"quartz_psd"</code>，<code>"quartz_bmp"</code>，<code>"CairoJPEG"</code>，<code>"CairoPNG"</code>，<code>"CairoPS"</code>，<code>"CairoPDF"</code>，<code>"CairoSVG"</code>，<code>"CairoTIFF"</code>，<code>"Cairo_pdf"</code>，<code>"Cairo_png"</code>，<code>"Cairo_ps"</code>，<code>"Cairo_svg"</code>，<code>"svglite"</code>，<code>"ragg_png"</code>，以及<code>"tikz"</code>。</p>
<p>通常情况下，图像设备名也是函数名。更多关于图像设备的信息可以参阅 R 的帮助页面。例如，可以在 R 的控制台中输入 <code>?svg</code> 来了解关于 <code>svg</code> 设备的细节，它包含在 R 的基础包中，所以不需要额外安装。需要注意的是，<code>quartz_XXX</code> 设备是基于 <code>quartz()</code> 函数的，并且它们仅在 macOS 上可用；<code>CairoXXX</code> 设备来自的 R 包 <strong>cairoDevice</strong><span class="citation">(<a href="#ref-R-cairoDevice" role="doc-biblioref"><strong>R-cairoDevice?</strong></a>)</span>；<code>svglite</code> 设备来自 <strong>svglite</strong> 包 <span class="citation">(<a href="#ref-R-svglite" role="doc-biblioref">Wickham et al. 2022</a>)</span>；<code>tikz</code> 设备则在 <strong>tikzDevice</strong> 包 <span class="citation">(<a href="#ref-R-tikzDevice" role="doc-biblioref">Sharpsteen and Bracken 2020</a>)</span>中。如果需要使用这些包中的图像设备，必须先安装这些包。</p>
<p>通常，矢量图比位图质量更高，并且可以在不损失质量的情况下缩放矢量图。对于 HTML 输出，可以使用 <code>dev = "svg"</code> 或 <code>dev = "svglite"</code> 来绘制 SVG（可缩放矢量图，Scalable Vector Graphics）。需要注意的是，默认情况下 <code>png</code> 设备生成的图像为位图。</p>
<p>对于 PDF 输出，如果对图像中的字体非常挑剔，可以使用 <code>dev = "tikz"</code>，因为它提供了对 LaTeX 的原生支持，这意味着图像中的所有元素，包括文本和符号，都可以通过 LaTeX 以高质量呈现。图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.3</a> 展示了一个在R图像中用块选项 <code>dev = "tikz"</code> 添加 LaTeX 数学表达式的例子。</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="rmarkdown-operation.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, .<span class="dv">1</span>))</span>
<span id="cb309-2"><a href="rmarkdown-operation.html#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(dnorm, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&#39;$x$&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;$</span><span class="sc">\\</span><span class="st">phi(x)$&#39;</span>,</span>
<span id="cb309-3"><a href="rmarkdown-operation.html#cb309-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&#39;The density function of $N(0, 1)$&#39;</span>)</span>
<span id="cb309-4"><a href="rmarkdown-operation.html#cb309-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">1</span>, .<span class="dv">2</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb309-5"><a href="rmarkdown-operation.html#cb309-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;$</span><span class="sc">\\</span><span class="st">phi(x)=</span><span class="sc">\\</span><span class="st">frac{1}{</span><span class="sc">\\</span><span class="st">sqrt{2</span><span class="sc">\\</span><span class="st">pi}}e^{</span><span class="sc">\\</span><span class="st">frac{-x^2}{2}}$&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:dev-tikz"></span>
<img src="images/tikz-latex.png" alt="通过 tikz  设备呈现的图像。"  />
<p class="caption">
图 6.3: 通过 tikz 设备呈现的图像。
</p>
</div>
<p>需要注意的是，R 的基础包实际上支持数学表达式，但它们不是通过 LaTeX 呈现的（具体细节可参见 <code>?plotmath</code>）。此外，还有几个高级选项可以调整 <code>tikz</code> 设备的排版细节（参见 <code>?tikzDevice::tikz</code>）。例如，如果图像中包含多字节字符，可以设置选项：</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="rmarkdown-operation.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tikzDefaultEngine =</span> <span class="st">&#39;xetex&#39;</span>)</span></code></pre></div>
<p>这是因为在处理 LaTeX 文档中的多字节字符时，<code>xetex</code> 通常比默认引擎 <code>pdftex</code> 要好。</p>
<p><code>tikz</code> 设备主要有两个缺点。首先，它需要安装 LaTeX，但这其实并不会很麻烦（见第 <a href="rmarkdown-base.html#install-tinytex">2.2.2</a> 节），虽然还需要几个 LaTeX 包，但这些包也可以通过 TinyTeX 很方便地安装：</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="rmarkdown-operation.html#cb311-1" aria-hidden="true" tabindex="-1"></a>tinytex<span class="sc">::</span><span class="fu">tlmgr_install</span>(<span class="fu">c</span>(<span class="st">&#39;pgf&#39;</span>, <span class="st">&#39;preview&#39;</span>, <span class="st">&#39;xcolor&#39;</span>))</span></code></pre></div>
<p>其次，<code>tikz</code> 设备渲染图的速度通常要慢得多，因为这个设备会生成 LaTeX 文件，并且必须将其编译成 PDF。如果觉得代码块很耗时，可以通过块选项 <code>cache = TRUE</code> 来启用缓存（见第 <a href="rmarkdown-operation.html#cache">6.5</a> 节）。</p>
<p>图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.3</a> 实际上也使用了块选项 <code>fig.process = pdf2png</code>，当输出格式不是 LaTeX时，<code>pdf2png</code> 函数可以将 PDF 图转换为 PNG，其定义见第 <a href="rmarkdown-operation.html#chunk-process">6.2.8</a>节。如果没有这一转换，可能无法在 Web 浏览器中查看该书在线版本中的 PDF 图。</p>
</div>
<div id="chunk-step-plot" class="section level3" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> 带有低级绘图功能的逐步绘图 (*)</h3>
<p>在 R 中，有两种类型的绘图函数可以用来画图：高级的绘图函数用于创建新图，以及低级的绘图函数用于在现有的图中添加元素，更多信息请参见R手册《<a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html"><em>An Introduction to R</em></a>》的第 12 章（“Graphical procedures”）。</p>
<p>在默认的情况下，当使用一系列低级的绘图函数来修改以前的图像时，<strong>knitr</strong> 不会显示中间的图，只会显示所有函数执行后的最后一个图。</p>
<p>然而有的时候，尤其是在教学过程中，展示中间的图像是很有用的。为此，可以设置块选项 <code>fig.keep = 'low'</code> 来保留各低级函数更改后的图。例如，图 <a href="rmarkdown-operation.html#fig:low-plots-1">6.4</a> 和图 <a href="rmarkdown-operation.html#fig:low-plots-2">6.5</a> 来自一个带有块选项 <code>fig.keep = 'low'</code> 的单个代码块，尽管它们很像两个代码块的输出结果。不仅如此，本节还通过块选项 <code>fig.cap=c('cars ...', '在现有的...')</code> 给它们分配了不同的标题。</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="rmarkdown-operation.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, .<span class="dv">1</span>, .<span class="dv">1</span>))</span>
<span id="cb312-2"><a href="rmarkdown-operation.html#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:low-plots-1"></span>
<img src="rmarkdown-guide_files/figure-html/low-plots-1.png" alt="cars 数据的点图" width="672" />
<p class="caption">
图 6.4: cars 数据的点图
</p>
</div>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="rmarkdown-operation.html#cb313-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data =</span> cars)</span>
<span id="cb313-2"><a href="rmarkdown-operation.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:low-plots-2"></span>
<img src="rmarkdown-guide_files/figure-html/low-plots-2.png" alt="在现有的点图中添加一条回归线" width="672" />
<p class="caption">
图 6.5: 在现有的点图中添加一条回归线
</p>
</div>
<p>如果想在不同的代码块中继续修改这张图，请参阅第 <a href="rmarkdown-operation.html#modify-before">6.6.5</a> 节。</p>
</div>
<div id="chunk-print" class="section level3" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> 在代码块中自定义对象的打印格式 (*)</h3>
<p>在默认的情况下，代码块中的对象会通过 <code>knitr::knit_print()</code> 函数来打印，基本上就相当于 R 中的 <code>print()</code>，但这往往并不能满足用户的需求。有的时候用户可能希望直接输出表格，除了第 <a href="rmarkdown-operation.html#table-advanced">6.1</a> 节提到的方法外，还有更便捷的方法实现。</p>
<p>本质上，<code>knit_print()</code> 函数是一个 S3 通用函数，这意味着可以通过在其上注册 S3 方法来拓展输出方式。下面的例子展示了如何通过 <code>knitr::kable()</code> 来自动将数据框打印成表格：</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb314-1"><a href="rmarkdown-operation.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb314-2"><a href="rmarkdown-operation.html#cb314-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 使用自定义的 `knit_print` 方法来打印数据框</span></span>
<span id="cb314-3"><a href="rmarkdown-operation.html#cb314-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb314-4"><a href="rmarkdown-operation.html#cb314-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-5"><a href="rmarkdown-operation.html#cb314-5" aria-hidden="true" tabindex="-1"></a>首先，定义一个 <span class="in">`knit_print`</span> 方法，并注册它：</span>
<span id="cb314-6"><a href="rmarkdown-operation.html#cb314-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-7"><a href="rmarkdown-operation.html#cb314-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb314-8"><a href="rmarkdown-operation.html#cb314-8" aria-hidden="true" tabindex="-1"></a><span class="in">knit_print.data.frame = function(x, ...) {</span></span>
<span id="cb314-9"><a href="rmarkdown-operation.html#cb314-9" aria-hidden="true" tabindex="-1"></a><span class="in">  res = paste(c(&quot;&quot;, &quot;&quot;, knitr::kable(x)), collapse = &quot;\n&quot;)</span></span>
<span id="cb314-10"><a href="rmarkdown-operation.html#cb314-10" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::asis_output(res)</span></span>
<span id="cb314-11"><a href="rmarkdown-operation.html#cb314-11" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb314-12"><a href="rmarkdown-operation.html#cb314-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-13"><a href="rmarkdown-operation.html#cb314-13" aria-hidden="true" tabindex="-1"></a><span class="in">registerS3method(</span></span>
<span id="cb314-14"><a href="rmarkdown-operation.html#cb314-14" aria-hidden="true" tabindex="-1"></a><span class="in">  &quot;knit_print&quot;, &quot;data.frame&quot;, knit_print.data.frame,</span></span>
<span id="cb314-15"><a href="rmarkdown-operation.html#cb314-15" aria-hidden="true" tabindex="-1"></a><span class="in">  envir = asNamespace(&quot;knitr&quot;)</span></span>
<span id="cb314-16"><a href="rmarkdown-operation.html#cb314-16" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb314-17"><a href="rmarkdown-operation.html#cb314-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb314-18"><a href="rmarkdown-operation.html#cb314-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-19"><a href="rmarkdown-operation.html#cb314-19" aria-hidden="true" tabindex="-1"></a>现在可以在数据框上测试这个自定义的打印方法。</span>
<span id="cb314-20"><a href="rmarkdown-operation.html#cb314-20" aria-hidden="true" tabindex="-1"></a>需要注意的是，之后不再需要显式地调用 <span class="in">`knitr::kable()`</span> 了。</span>
<span id="cb314-21"><a href="rmarkdown-operation.html#cb314-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-22"><a href="rmarkdown-operation.html#cb314-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb314-23"><a href="rmarkdown-operation.html#cb314-23" aria-hidden="true" tabindex="-1"></a><span class="in">head(iris)</span></span>
<span id="cb314-24"><a href="rmarkdown-operation.html#cb314-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb314-25"><a href="rmarkdown-operation.html#cb314-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-26"><a href="rmarkdown-operation.html#cb314-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb314-27"><a href="rmarkdown-operation.html#cb314-27" aria-hidden="true" tabindex="-1"></a><span class="in">head(mtcars)</span></span>
<span id="cb314-28"><a href="rmarkdown-operation.html#cb314-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>更多关于 <code>knit_print()</code> 函数的信息可参见 <strong>knitr</strong> 包的简介：</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="rmarkdown-operation.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&#39;knit_print&#39;</span>, <span class="at">package =</span> <span class="st">&#39;knitr&#39;</span>)</span></code></pre></div>
<p><strong>printr</strong> 包 <span class="citation">(<a href="#ref-R-printr" role="doc-biblioref"><strong>R-printr?</strong></a>)</span>提供了一些 S3 方法来自动将 R 对象打印为表格。只需要在R代码块中输入 <code>library(printr)</code>，所有的方法都将自动注册。</p>
<p>如果觉得上述技术实现难度较大，一些 R Markdown 输出格式，如 <code>html_document</code> 和 <code>pdf_document</code> 也提供了一个选项 <code>df_print</code>，它允许用户自定义数据框的打印行为。例如，如果想通过 <code>knitr::kable()</code> 来将数据框打印为表格，可以设置选项：</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb316-1"><a href="rmarkdown-operation.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb316-2"><a href="rmarkdown-operation.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb316-3"><a href="rmarkdown-operation.html#cb316-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb316-4"><a href="rmarkdown-operation.html#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">df_print</span><span class="kw">:</span><span class="at"> kable</span></span>
<span id="cb316-5"><a href="rmarkdown-operation.html#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
<p>有关输出格式的更多细节可参阅输出格式的帮助页（如 <code>?rmarkdown::html_document</code>），可以了解 <code>df_print</code> 选项支持哪些输出格式，以及对应的值是什么。</p>
<p>事实上，还可以通过块选项 <code>render</code> 来完全代替打印函数 <code>knit_print()</code>，<code>render</code> 可以使用任何函数来打印对象。例如，如果想使用 <strong>pander</strong> 包来打印对象，可以设置块选项 <code>render</code> 为函数 <code>pander::pander()</code>：</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb317-1"><a href="rmarkdown-operation.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, render=pander::pander}</span></span>
<span id="cb317-2"><a href="rmarkdown-operation.html#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="in">head(iris)</span></span>
<span id="cb317-3"><a href="rmarkdown-operation.html#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>最终得到的结果见表 <a href="#tab:print-render"><strong>??</strong></a></p>
<pre><code>## Retrieving &#39;https://cloud.r-project.org/bin/macosx/contrib/4.1/pander_0.6.5.tgz&#39; ...
##  OK [downloaded 1.1 Mb in 0.3 secs]
## Installing pander [0.6.5] ...
##  OK [installed binary]
## Moving pander [0.6.5] into the cache ...
##  OK [moved to cache in 1.1 milliseconds]</code></pre>
<table style="width:94%;">
<colgroup>
<col width="20%" />
<col width="19%" />
<col width="20%" />
<col width="19%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Sepal.Length</th>
<th align="center">Sepal.Width</th>
<th align="center">Petal.Length</th>
<th align="center">Petal.Width</th>
<th align="center">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">5.1</td>
<td align="center">3.5</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">4.9</td>
<td align="center">3</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="odd">
<td align="center">4.7</td>
<td align="center">3.2</td>
<td align="center">1.3</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">4.6</td>
<td align="center">3.1</td>
<td align="center">1.5</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">3.6</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">5.4</td>
<td align="center">3.9</td>
<td align="center">1.7</td>
<td align="center">0.4</td>
<td align="center">setosa</td>
</tr>
</tbody>
</table>
<p><code>render</code>选项给了用户完全的自由来打印 R 对象。</p>
</div>
<div id="option-hook" class="section level3" number="6.3.9">
<h3><span class="header-section-number">6.3.9</span> 选项钩子 (*)</h3>
<p>有时候，用户可能需要根据其他块选项的值，来动态地改变某个块选项，例如设定图像宽不小于高。实际上，可以使用对象 <code>opts_hooks</code> 来设置一个选项钩子（option hook）来实现这个功能。选项钩子是一个与该选项相关的函数，会在对应的块选项不是 <code>NULL</code> 时自动执行。这个函数将当前代码块的选项列表作为输入参数，并且会返回一个（可能是修改过的）列表。例如，对于图像宽和高的限制，可以调整<code>fig.width</code>选项，使它总是不小于<code>fig.height</code>：</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="rmarkdown-operation.html#cb319-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.width =</span> <span class="cf">function</span>(options) {</span>
<span id="cb319-2"><a href="rmarkdown-operation.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (options<span class="sc">$</span>fig.width <span class="sc">&lt;</span> options<span class="sc">$</span>fig.height) {</span>
<span id="cb319-3"><a href="rmarkdown-operation.html#cb319-3" aria-hidden="true" tabindex="-1"></a>    options<span class="sc">$</span>fig.width <span class="ot">=</span> options<span class="sc">$</span>fig.height</span>
<span id="cb319-4"><a href="rmarkdown-operation.html#cb319-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb319-5"><a href="rmarkdown-operation.html#cb319-5" aria-hidden="true" tabindex="-1"></a>  options</span>
<span id="cb319-6"><a href="rmarkdown-operation.html#cb319-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>因为 <code>fig.width</code> 永远不会是 <code>NULL</code>，所以这个钩子函数总是在代码块之前执行，以更新它的块选项。对于下面的代码块，如果设置了上述的选项钩子，则 <code>fig.width</code> 的实际值将是 6 而不是最初定义的 5：</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb320-1"><a href="rmarkdown-operation.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig.width = 5, fig.height = 6}</span></span>
<span id="cb320-2"><a href="rmarkdown-operation.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="in">plot(1:10)</span></span>
<span id="cb320-3"><a href="rmarkdown-operation.html#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>另外，第 <a href="rmarkdown-operation.html#chunk-leading">6.2.5</a> 节的最后一个例子介绍了如何将输出格式调整成类似于 R 控制台（console）的格式，这一功能也可以用选项钩子实现，从而可以使用一个单独的块选项 <code>console = TRUE</code> 来代替 <code>comment = ""</code> 和 <code>prompt = TRUE</code>。需要注意的是，<code>console</code> 不是一个内置的 <strong>knitr</strong> 块选项，而是一个自定义的任意的选项名，它的默认值是 <code>NULL</code>。下面是一个完整的例子：</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb321-1"><a href="rmarkdown-operation.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb321-2"><a href="rmarkdown-operation.html#cb321-2" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_hooks$set(console = function(options) {</span></span>
<span id="cb321-3"><a href="rmarkdown-operation.html#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="in">  if (isTRUE(options$console)) {</span></span>
<span id="cb321-4"><a href="rmarkdown-operation.html#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="in">    options$comment &lt;- &#39;&#39;; options$prompt &lt;- TRUE</span></span>
<span id="cb321-5"><a href="rmarkdown-operation.html#cb321-5" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb321-6"><a href="rmarkdown-operation.html#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="in">  options</span></span>
<span id="cb321-7"><a href="rmarkdown-operation.html#cb321-7" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb321-8"><a href="rmarkdown-operation.html#cb321-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb321-9"><a href="rmarkdown-operation.html#cb321-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-10"><a href="rmarkdown-operation.html#cb321-10" aria-hidden="true" tabindex="-1"></a>默认输出为：</span>
<span id="cb321-11"><a href="rmarkdown-operation.html#cb321-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-12"><a href="rmarkdown-operation.html#cb321-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb321-13"><a href="rmarkdown-operation.html#cb321-13" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb321-14"><a href="rmarkdown-operation.html#cb321-14" aria-hidden="true" tabindex="-1"></a><span class="in">if (TRUE) {</span></span>
<span id="cb321-15"><a href="rmarkdown-operation.html#cb321-15" aria-hidden="true" tabindex="-1"></a><span class="in">  2 + 2</span></span>
<span id="cb321-16"><a href="rmarkdown-operation.html#cb321-16" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb321-17"><a href="rmarkdown-operation.html#cb321-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb321-18"><a href="rmarkdown-operation.html#cb321-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-19"><a href="rmarkdown-operation.html#cb321-19" aria-hidden="true" tabindex="-1"></a>设置 <span class="in">`console = TRUE`</span> 时的输出为：</span>
<span id="cb321-20"><a href="rmarkdown-operation.html#cb321-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-21"><a href="rmarkdown-operation.html#cb321-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, console=TRUE}</span></span>
<span id="cb321-22"><a href="rmarkdown-operation.html#cb321-22" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb321-23"><a href="rmarkdown-operation.html#cb321-23" aria-hidden="true" tabindex="-1"></a><span class="in">if (TRUE) {</span></span>
<span id="cb321-24"><a href="rmarkdown-operation.html#cb321-24" aria-hidden="true" tabindex="-1"></a><span class="in">  2 + 2</span></span>
<span id="cb321-25"><a href="rmarkdown-operation.html#cb321-25" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb321-26"><a href="rmarkdown-operation.html#cb321-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>本节第三个例子介绍了如何自动向输出块中添加行号，输出块可以包括源代码块、文本输出、提示信息、警告以及报错。下面的例子使用单个的块选项 <code>numberLines</code> 来控制想要添加行号的输出块。首先定义相关函数：</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="rmarkdown-operation.html#cb322-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_hooks<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb322-2"><a href="rmarkdown-operation.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">numberLines =</span> <span class="cf">function</span>(options) {</span>
<span id="cb322-3"><a href="rmarkdown-operation.html#cb322-3" aria-hidden="true" tabindex="-1"></a>    attrs <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;attr.&quot;</span>, options<span class="sc">$</span>numberLines)</span>
<span id="cb322-4"><a href="rmarkdown-operation.html#cb322-4" aria-hidden="true" tabindex="-1"></a>    options[attrs] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(options[attrs], c, <span class="st">&quot;.numberLines&quot;</span>)</span>
<span id="cb322-5"><a href="rmarkdown-operation.html#cb322-5" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb322-6"><a href="rmarkdown-operation.html#cb322-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb322-7"><a href="rmarkdown-operation.html#cb322-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb322-8"><a href="rmarkdown-operation.html#cb322-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-9"><a href="rmarkdown-operation.html#cb322-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb322-10"><a href="rmarkdown-operation.html#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">numberLines =</span> <span class="fu">c</span>(</span>
<span id="cb322-11"><a href="rmarkdown-operation.html#cb322-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;source&quot;</span>, <span class="st">&quot;output&quot;</span>, <span class="st">&quot;message&quot;</span>, <span class="st">&quot;warning&quot;</span>, <span class="st">&quot;error&quot;</span></span>
<span id="cb322-12"><a href="rmarkdown-operation.html#cb322-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb322-13"><a href="rmarkdown-operation.html#cb322-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>选项钩子 <code>numberLines</code> 会将属性 <code>.numberLines</code> 附加到输出块上，并且通过 <code>opts_chunk$set()</code> 来设置块选项 <code>numberLines</code>，从而确保选项钩子会被执行。</p>
<p>通过以上设置，用户可以在代码块上使用选项 <code>numberLines</code> 来决定哪些输出块将具有行号，例如 <code>numberLines = c('source', 'output')</code> 代表给源代码和文本输出添加行号；而设定 <code>numberLines = NULL</code> 则将完全删除行号。</p>
<p>除了使用选项钩子外，还可以直接设置块选项 <code>、attr.source = '.numberLines'</code> 来实现目的。本节介绍的选项钩子的优点是，它们只在块选项中附加属性 <code>.numberLines</code>，这意味着它们不会覆盖现有的块选项值，例如，下面代码块中的源代码块将被编号（使用上面的设置），并且编号会从第二行开始：</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb323-1"><a href="rmarkdown-operation.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, attr.source=&#39;startFrom=&quot;2&quot;&#39;}</span></span>
<span id="cb323-2"><a href="rmarkdown-operation.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 这行注释不会被编号</span></span>
<span id="cb323-3"><a href="rmarkdown-operation.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb323-4"><a href="rmarkdown-operation.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>这等价于：</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb324-1"><a href="rmarkdown-operation.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, attr.source=c(&#39;startFrom=&quot;2&quot;&#39;, &#39;.numberLines&#39;}</span></span>
<span id="cb324-2"><a href="rmarkdown-operation.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 这行注释不会被编号</span></span>
<span id="cb324-3"><a href="rmarkdown-operation.html#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb324-4"><a href="rmarkdown-operation.html#cb324-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div id="python-rmd" class="section level3" number="6.3.10">
<h3><span class="header-section-number">6.3.10</span> 运行 Python 代码并与 Python 交互</h3>
</div>
<div id="chunk-asis" class="section level3" number="6.3.11">
<h3><span class="header-section-number">6.3.11</span> 通过 <code>asis</code> 引擎有条件地执行内容</h3>
<p>正如其名，<code>asis</code> 引擎会按原样（as is）输出块的内容。使用此引擎的优点在于，用户可以有条件地包含一些内容，块的内容的显示由块选项 <code>echo</code> 决定。当 <code>echo = FALSE</code> 时，数据块将被隐藏。下面是一个简单的例子：</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb325-1"><a href="rmarkdown-operation.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb325-2"><a href="rmarkdown-operation.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="in">getRandomNumber &lt;- function() {</span></span>
<span id="cb325-3"><a href="rmarkdown-operation.html#cb325-3" aria-hidden="true" tabindex="-1"></a><span class="in">  sample(1:6, 1)</span></span>
<span id="cb325-4"><a href="rmarkdown-operation.html#cb325-4" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb325-5"><a href="rmarkdown-operation.html#cb325-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb325-6"><a href="rmarkdown-operation.html#cb325-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-7"><a href="rmarkdown-operation.html#cb325-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{asis, echo = getRandomNumber() == 4}</span></span>
<span id="cb325-8"><a href="rmarkdown-operation.html#cb325-8" aria-hidden="true" tabindex="-1"></a><span class="in">根据 https://xkcd.com/221/,  刚生成的是一个**真**随机数!</span></span>
<span id="cb325-9"><a href="rmarkdown-operation.html#cb325-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>只有当条件 <code>getRandomNumber() == 4</code> （随机）为真时， <code>asis</code> 块中的文本才会显示。</p>
</div>
<div id="chunk-shell" class="section level3" number="6.3.12">
<h3><span class="header-section-number">6.3.12</span> 执行 Shell 脚本</h3>
<p>【之后再修改】
你可以根据你的喜好，使用 <code>bash</code>、 <code>sh</code> 或 <code>zsh</code> 任何一种引擎运行 Shell 脚本。下面是一个带有 chunk 头 <code>```{bash}</code> 的 bash 示例：</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb326-1"><a href="rmarkdown-operation.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.Rmd <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 5</span></code></pre></div>
<pre><code>## [1] &quot;01-intro.Rmd&quot;       &quot;02-base.Rmd&quot;        &quot;03-document.Rmd&quot;   
## [4] &quot;04-working.Rmd&quot;     &quot;05-interaction.Rmd&quot;</code></pre>
<p>注意，bash是用 R 函数 <code>system2()</code> 调用的。它将忽略配置文件，例如 <code>~/.bash_profile</code> 和 <code>~/.bash_login</code>，其中可能定义了命令别名或修改过的环境变量(如 <code>PATH</code> 变量)。如果你想要这些配置文件像你使用终端时一样被执行，你可以通过引擎将参数 <code>-l</code> 传递给 <code>bash</code>。例如：</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb328-1"><a href="rmarkdown-operation.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{bash, engine.opts=&#39;-l&#39;}</span></span>
<span id="cb328-2"><a href="rmarkdown-operation.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="in">echo $PATH</span></span>
<span id="cb328-3"><a href="rmarkdown-operation.html#cb328-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>如果你想对所有 <code>bash</code> 块全局启用 <code>-l</code> 参数，你可以在文档开头的 global chunk 选项中设置为：</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="rmarkdown-operation.html#cb329-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">engine.opts =</span> <span class="fu">list</span>(<span class="at">bash =</span> <span class="st">&#39;-l&#39;</span>))</span></code></pre></div>
<p>还可以将其他参数作为字符向量提供给 chunk 选项<code>engine.opts</code>，从而传递给 <code>bash</code>。</p>
</div>
<div id="cat-file" class="section level3" number="6.3.13">
<h3><span class="header-section-number">6.3.13</span> 通过 cat 引擎将块内容写入文件</h3>
<p>有时将代码块的内容写入外部文件，然后在其他代码块中使用此文件可能会很有用。当然，可以通过 <code>writeLines()</code> 等 R 函数来实现这一点，但问题是，当内容相对较长或包含特殊字符时，传递给 <code>writeLines()</code> 的字符串可能看起来很笨拙。下面是将长字符串写入文件 <code>my-file.txt</code> 的示例：</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="rmarkdown-operation.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;这是一个长字符串。它有多条线。记得要避免双引号 </span><span class="sc">\&quot;\&quot;</span><span class="st">, 但是‘单引号’是可以的。</span></span>
<span id="cb330-2"><a href="rmarkdown-operation.html#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="st">希望思考关于需要多少反斜杠时，不要失去理智。例如，到底是 &#39;</span><span class="sc">\t</span><span class="st">&#39;、&#39;</span><span class="sc">\\</span><span class="st">t&#39; 还是 &#39;</span><span class="sc">\\\\</span><span class="st">t&#39;?&quot;</span>, <span class="at">con =</span> <span class="st">&quot;my-file.txt&quot;</span>)</span></code></pre></div>
<p>自 R 4.0.0 以来，这个问题已经大大缓解了，因为 R 开始支持 <code>r"( )"</code> 中的原始字符串（参见帮助页面 <code>?Quotes</code>），而且读者不需要记住所有关于特殊字符的规则。即使使用原始字符串，在代码块中显式地将长字符串写入文件仍然会让读者分心。</p>
<p><strong>knitr</strong> 中的 <code>cat</code> 引擎为读者提供了一种在代码块中呈现文本内容或将其写入外部文件的方法，而无需考虑有关 R 字符串的所有规则（例如，当需要字面上的反斜杠时，读者需要使用双反斜杠）。</p>
<p>要将块内容写入文件，请在块选项 <code>engine.opts</code> 中指定文件路径，例如 <code>engine.opts = list(file = 'path/to/file')</code>。在引擎盖下，在 <code>engine.opts</code> 中指定的值列表将传递给该函数 <code>base::cat()</code> 并且 <code>file</code> 是 <code>base::cat()</code> 的参数之一。</p>
<p>接下来，将提供三个示例来说明 <code>cat</code> 引擎的用法。</p>
<div id="write-css" class="section level4" number="6.3.13.1">
<h4><span class="header-section-number">6.3.13.1</span> 写入 CSS 文件</h4>
<!-- \@ref(chunk-styling) -->
<p>第一种方法是在 R Markdown 文档中嵌入一个 <code>css</code> 代码块，以使用 CSS 样式化元素。另一种方法是通过一些 R Markdown 输出格式(如，<code>html_document</code>)的 CSS 选项为 Pandoc 提供一个定制的 CSS 文件。 <code>cat</code> 引擎可以用来从 Rmd 编写这个 CSS 文件。</p>
<p>下面的例子展示了如何从文档中的块生成 <code>custom.css</code> 文件，并将文件路径传递给 <code>html_document</code> 格式的 <code>css</code> 选项。</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb331-1"><a href="rmarkdown-operation.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb331-2"><a href="rmarkdown-operation.html#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;从代码块中创建一个 CSS 文件&quot;</span></span>
<span id="cb331-3"><a href="rmarkdown-operation.html#cb331-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb331-4"><a href="rmarkdown-operation.html#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb331-5"><a href="rmarkdown-operation.html#cb331-5" aria-hidden="true" tabindex="-1"></a><span class="co">    css: custom.css</span></span>
<span id="cb331-6"><a href="rmarkdown-operation.html#cb331-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb331-7"><a href="rmarkdown-operation.html#cb331-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-8"><a href="rmarkdown-operation.html#cb331-8" aria-hidden="true" tabindex="-1"></a>下面的 chunck 中将写入 <span class="in">`custom.css`</span>，它将在 Pandoc 转换期间使用。</span>
<span id="cb331-9"><a href="rmarkdown-operation.html#cb331-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{cat, engine.opts = list(file = &quot;custom.css&quot;)}</span></span>
<span id="cb331-10"><a href="rmarkdown-operation.html#cb331-10" aria-hidden="true" tabindex="-1"></a><span class="in">h2 {</span></span>
<span id="cb331-11"><a href="rmarkdown-operation.html#cb331-11" aria-hidden="true" tabindex="-1"></a><span class="in">  color: blue;</span></span>
<span id="cb331-12"><a href="rmarkdown-operation.html#cb331-12" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb331-13"><a href="rmarkdown-operation.html#cb331-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb331-14"><a href="rmarkdown-operation.html#cb331-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-15"><a href="rmarkdown-operation.html#cb331-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## 标题会变蓝</span></span></code></pre></div>
<p><code>css</code> 代码块方法与此方法之间的唯一区别是，前一种方法将 CSS 代码写在输出文档的 <code>&lt;body&gt;</code> 标记内的位置（即，在代码块的位置），并且将 CSS 代码写在输出文档的 <code>&lt;body&gt;</code> 标记内。 后一种方法将 CSS 写入输出文档的 <code>&lt;body&gt;</code> 区域。输出文档中不会有任何实际的视觉差异。</p>
</div>
<div id="write-latex" class="section level4" number="6.3.13.2">
<h4><span class="header-section-number">6.3.13.2</span> 在序言中包含 LaTeX 代码</h4>
<!-- \@ref(latex-preamble) -->
<p>在 6.1 节中，我们介绍了如何将 LaTeX 代码添加到序言中，这需要一个外部 <code>.tex</code> 文件。也可以从 Rmd 生成此文件，这是一个示例：</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb332-1"><a href="rmarkdown-operation.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb332-2"><a href="rmarkdown-operation.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;从代码块中创建一个 .tex 文件&quot;</span></span>
<span id="cb332-3"><a href="rmarkdown-operation.html#cb332-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> &quot;Jane Doe&quot;</span></span>
<span id="cb332-4"><a href="rmarkdown-operation.html#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="an">classoption:</span><span class="co"> twoside</span></span>
<span id="cb332-5"><a href="rmarkdown-operation.html#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb332-6"><a href="rmarkdown-operation.html#cb332-6" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document:</span></span>
<span id="cb332-7"><a href="rmarkdown-operation.html#cb332-7" aria-hidden="true" tabindex="-1"></a><span class="co">    includes:</span></span>
<span id="cb332-8"><a href="rmarkdown-operation.html#cb332-8" aria-hidden="true" tabindex="-1"></a><span class="co">      in_header: preamble.tex</span></span>
<span id="cb332-9"><a href="rmarkdown-operation.html#cb332-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb332-10"><a href="rmarkdown-operation.html#cb332-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-11"><a href="rmarkdown-operation.html#cb332-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># 它是如何运作的</span></span>
<span id="cb332-12"><a href="rmarkdown-operation.html#cb332-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-13"><a href="rmarkdown-operation.html#cb332-13" aria-hidden="true" tabindex="-1"></a>将代码块写入文件 <span class="in">`preamble.tex`</span> 以定义 PDF 输出文档的页眉和页脚：</span>
<span id="cb332-14"><a href="rmarkdown-operation.html#cb332-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-15"><a href="rmarkdown-operation.html#cb332-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{cat, engine.opts=list(file = &#39;preamble.tex&#39;)}</span></span>
<span id="cb332-16"><a href="rmarkdown-operation.html#cb332-16" aria-hidden="true" tabindex="-1"></a><span class="in">\usepackage{fancyhdr}</span></span>
<span id="cb332-17"><a href="rmarkdown-operation.html#cb332-17" aria-hidden="true" tabindex="-1"></a><span class="in">\usepackage{lipsum}</span></span>
<span id="cb332-18"><a href="rmarkdown-operation.html#cb332-18" aria-hidden="true" tabindex="-1"></a><span class="in">\pagestyle{fancy}</span></span>
<span id="cb332-19"><a href="rmarkdown-operation.html#cb332-19" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyhead[CO,CE]{This is fancy header}</span></span>
<span id="cb332-20"><a href="rmarkdown-operation.html#cb332-20" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyfoot[CO,CE]{And this is a fancy footer}</span></span>
<span id="cb332-21"><a href="rmarkdown-operation.html#cb332-21" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyfoot[LE,RO]{\thepage}</span></span>
<span id="cb332-22"><a href="rmarkdown-operation.html#cb332-22" aria-hidden="true" tabindex="-1"></a><span class="in">\fancypagestyle{plain}{\pagestyle{fancy}}</span></span>
<span id="cb332-23"><a href="rmarkdown-operation.html#cb332-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb332-24"><a href="rmarkdown-operation.html#cb332-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-25"><a href="rmarkdown-operation.html#cb332-25" aria-hidden="true" tabindex="-1"></a>\lipsum<span class="co">[</span><span class="ot">1-15</span><span class="co">]</span></span>
<span id="cb332-26"><a href="rmarkdown-operation.html#cb332-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-27"><a href="rmarkdown-operation.html#cb332-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># 更多随机内容</span></span>
<span id="cb332-28"><a href="rmarkdown-operation.html#cb332-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-29"><a href="rmarkdown-operation.html#cb332-29" aria-hidden="true" tabindex="-1"></a>\lipsum<span class="co">[</span><span class="ot">16-30</span><span class="co">]</span></span></code></pre></div>
<p>在上面的 <code>cat</code> 代码块中的 LaTeX 代码中，我们定义了 PDF 文档的页眉和页脚。如果我们还想在页脚中显示作者姓名，我们可以用选项<code>engine.opts = list(file = 'preamble.tex', append = TRUE)</code> 和 <code>code = sprintf('\\fancyfoot[LO,RE]{%s}', rmarkdown::metadata$author)</code>将作者信息附加到另一个 <code>cat</code> 代码块中的 <code>preamble.tex</code> 中。要理解这是如何工作的，请回忆一下我们在本节前面提到的：<code>engine.opts</code> 被传递给 <code>base::cat()</code>。(因此 <code>append = TRUE</code> 被传递给 <code>cat()</code>)，你可以通过阅读 16.2 节来理解 chunk 选项代码。
<!-- \@ref(option-code) --></p>
</div>
<div id="yaml-input" class="section level4" number="6.3.13.3">
<h4><span class="header-section-number">6.3.13.3</span> 将 YAML 数据写入文件并显示它</h4>
<p>默认情况下，<code>cat</code> 代码块的内容不会显示在输出文档中。如果还想在写出它之后显示它，则将块选项 <code>class.source</code> 设置为语言名称。语言名称用于语法高亮显示。在下面的例子中，我们指定为 <code>yaml</code> 语言：</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb333-1"><a href="rmarkdown-operation.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{cat, engine.opts=list(file=&#39;demo.yml&#39;), class.source=&#39;yaml&#39;}</span></span>
<span id="cb333-2"><a href="rmarkdown-operation.html#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="in">a:</span></span>
<span id="cb333-3"><a href="rmarkdown-operation.html#cb333-3" aria-hidden="true" tabindex="-1"></a><span class="in">  aa: &quot;something&quot;</span></span>
<span id="cb333-4"><a href="rmarkdown-operation.html#cb333-4" aria-hidden="true" tabindex="-1"></a><span class="in">  bb: 1</span></span>
<span id="cb333-5"><a href="rmarkdown-operation.html#cb333-5" aria-hidden="true" tabindex="-1"></a><span class="in">b:</span></span>
<span id="cb333-6"><a href="rmarkdown-operation.html#cb333-6" aria-hidden="true" tabindex="-1"></a><span class="in">  aa: &quot;something else&quot;</span></span>
<span id="cb333-7"><a href="rmarkdown-operation.html#cb333-7" aria-hidden="true" tabindex="-1"></a><span class="in">  bb: 2</span></span>
<span id="cb333-8"><a href="rmarkdown-operation.html#cb333-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>其输出显示在下面，并且还生成了一个文件 <code>demo.yml</code>。</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb334-1"><a href="rmarkdown-operation.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">a</span><span class="kw">:</span></span>
<span id="cb334-2"><a href="rmarkdown-operation.html#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aa</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;something&quot;</span></span>
<span id="cb334-3"><a href="rmarkdown-operation.html#cb334-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bb</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb334-4"><a href="rmarkdown-operation.html#cb334-4" aria-hidden="true" tabindex="-1"></a><span class="fu">b</span><span class="kw">:</span></span>
<span id="cb334-5"><a href="rmarkdown-operation.html#cb334-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aa</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;something else&quot;</span></span>
<span id="cb334-6"><a href="rmarkdown-operation.html#cb334-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bb</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span></code></pre></div>
<p>为了显示文件 <code>demo.yml</code> 确实已经生成，我们可以尝试使用 <strong>yaml</strong> 包 <span class="citation">(<a href="#ref-R-yaml" role="doc-biblioref">Stephens et al. 2020</a>)</span> 将其读入 R。</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="rmarkdown-operation.html#cb335-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">tree</span>(yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">&#39;demo.yml&#39;</span>))</span></code></pre></div>
<pre><code>## List of 2
##  |-a:List of 2
##  |  |-aa: chr &quot;something&quot;
##  |  |-bb: int 1
##  |-b:List of 2
##     |-aa: chr &quot;something else&quot;
##     |-bb: int 2</code></pre>
</div>
</div>
<div id="sas-rmd" class="section level3" number="6.3.14">
<h3><span class="header-section-number">6.3.14</span> 运行 SAS 代码</h3>
<p>你可以使用 <code>sas</code> 引擎运行 SAS (<a href="https://www.sas.com" class="uri">https://www.sas.com</a>) 代码。你需要确保 SAS 可执行文件在你的环境变量 <code>PATH</code> 中，或者(如果你不知道 <code>PATH</code> 是什么意思)通过 chunk 选项 <code>engine.path</code> 来提供 SAS 可执行文件的完整路径，例如：<code>engine.path = "C:\\Program Files\\SASHome\\x86\\SASFoundation\\9.3\\sas.exe"</code>。下面是一个输出 “Hello World” 的示例：</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb337-1"><a href="rmarkdown-operation.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{sas}</span></span>
<span id="cb337-2"><a href="rmarkdown-operation.html#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="in">data _null_;</span></span>
<span id="cb337-3"><a href="rmarkdown-operation.html#cb337-3" aria-hidden="true" tabindex="-1"></a><span class="in">put &#39;Hello, world!&#39;;</span></span>
<span id="cb337-4"><a href="rmarkdown-operation.html#cb337-4" aria-hidden="true" tabindex="-1"></a><span class="in">run;</span></span>
<span id="cb337-5"><a href="rmarkdown-operation.html#cb337-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div id="stata-rmd" class="section level3" number="6.3.15">
<h3><span class="header-section-number">6.3.15</span> 运行 Stata 代码</h3>
<p>如果你安装了 Stata，你可以通过 <code>stata</code> 引擎 Stata (<a href="https://www.stata.com" class="uri">https://www.stata.com</a>) 来运行 Stata (<a href="https://www.stata.com" class="uri">https://www.stata.com</a>) 代码。除非可以通过环境变量 <code>PATH</code> 找到 <code>stata</code> 可执行文件，否则你需要通过 chunk 选项 <code>engine.path</code> 指定到可执行文件的完整路径，例如：<code>engine.path = "C:/Program Files (x86)/Stata15/StataSE-64.exe"</code>。下面给出一个例子：</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb338-1"><a href="rmarkdown-operation.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb338-2"><a href="rmarkdown-operation.html#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="in">sysuse auto</span></span>
<span id="cb338-3"><a href="rmarkdown-operation.html#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="in">summarize</span></span>
<span id="cb338-4"><a href="rmarkdown-operation.html#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>在 <strong>knitr</strong> 中的 <code>stata</code> 引擎是相当有限的。Doug Hemken 已经通过 <strong>Statamarkdown</strong> 包 中对其进行了实质性的扩展，该包可以通过Github中获得，地址为： <a href="https://github.com/Hemken/Statamarkdown。通过在线搜索" class="uri">https://github.com/Hemken/Statamarkdown。通过在线搜索</a> “Stata R Markdown”，你可以找到关于这个包的教程。</p>
</div>
<div id="asymptote-plot" class="section level3" number="6.3.16">
<h3><span class="header-section-number">6.3.16</span> 用渐近线 Asymptote 创建图形</h3>
<p>渐近线 Asymptote (<a href="https://asymptote.sourceforge.io" class="uri">https://asymptote.sourceforge.io</a>) 是矢量图形的强大语言。如果你已经安装了 Asymptote，那么可以使用 <code>asy</code> 引擎在 R Markdown 中编写并运行 Asymptote 代码(有关安装的说明，请参阅其网站)。下面是从仓库 <a href="https://github.com/vectorgraphics/asymptote" class="uri">https://github.com/vectorgraphics/asymptote</a> 中复制的示例，其输出如图 <a href="#fig:elevation"><strong>??</strong></a> 所示：</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb339-1"><a href="rmarkdown-operation.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> graph3<span class="op">;</span></span>
<span id="cb339-2"><a href="rmarkdown-operation.html#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> grid3<span class="op">;</span></span>
<span id="cb339-3"><a href="rmarkdown-operation.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> palette<span class="op">;</span></span>
<span id="cb339-4"><a href="rmarkdown-operation.html#cb339-4" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span>prc <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb339-5"><a href="rmarkdown-operation.html#cb339-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-6"><a href="rmarkdown-operation.html#cb339-6" aria-hidden="true" tabindex="-1"></a>currentprojection<span class="op">=</span>orthographic<span class="op">(</span><span class="fl">0.8</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb339-7"><a href="rmarkdown-operation.html#cb339-7" aria-hidden="true" tabindex="-1"></a>size<span class="op">(</span><span class="dv">500</span><span class="op">,</span><span class="dv">400</span><span class="op">,</span>IgnoreAspect<span class="op">);</span></span>
<span id="cb339-8"><a href="rmarkdown-operation.html#cb339-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-9"><a href="rmarkdown-operation.html#cb339-9" aria-hidden="true" tabindex="-1"></a>real f<span class="op">(</span>pair z<span class="op">)</span> <span class="op">{</span><span class="cf">return</span> cos<span class="op">(</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>z<span class="op">.</span>x<span class="op">)*</span>sin<span class="op">(</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>z<span class="op">.</span>y<span class="op">);}</span></span>
<span id="cb339-10"><a href="rmarkdown-operation.html#cb339-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-11"><a href="rmarkdown-operation.html#cb339-11" aria-hidden="true" tabindex="-1"></a>surface s<span class="op">=</span>surface<span class="op">(</span>f<span class="op">,(-</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">,-</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">),(</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">),</span><span class="dv">50</span><span class="op">,</span>Spline<span class="op">);</span></span>
<span id="cb339-12"><a href="rmarkdown-operation.html#cb339-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-13"><a href="rmarkdown-operation.html#cb339-13" aria-hidden="true" tabindex="-1"></a>surface S<span class="op">=</span>planeproject<span class="op">(</span>unitsquare3<span class="op">)*</span>s<span class="op">;</span></span>
<span id="cb339-14"><a href="rmarkdown-operation.html#cb339-14" aria-hidden="true" tabindex="-1"></a>S<span class="op">.</span>colors<span class="op">(</span>palette<span class="op">(</span>s<span class="op">.</span>map<span class="op">(</span>zpart<span class="op">),</span>Rainbow<span class="op">()));</span></span>
<span id="cb339-15"><a href="rmarkdown-operation.html#cb339-15" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>S<span class="op">,</span>nolight<span class="op">);</span></span>
<span id="cb339-16"><a href="rmarkdown-operation.html#cb339-16" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>s<span class="op">,</span>lightgray<span class="op">+</span>opacity<span class="op">(</span><span class="fl">0.7</span><span class="op">));</span></span>
<span id="cb339-17"><a href="rmarkdown-operation.html#cb339-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-18"><a href="rmarkdown-operation.html#cb339-18" aria-hidden="true" tabindex="-1"></a>grid3<span class="op">(</span>XYZgrid<span class="op">);</span></span></code></pre></div>
<p>注意，对于 PDF 输出，可能需要一些额外的 LaTeX 包，否则可能会出现如下错误：</p>
<pre><code>! LaTeX Error: File `ocgbase.sty&#39; not found.</code></pre>
<!-- \@ref(install-latex-pkgs) -->
<p>如果出现这种错误，请参见 1.3 章节了解如何安装丢失的 LaTeX 包。</p>
<p>在上面的 <code>asy</code> 块中，我们使用了 <code>settings.prc = false</code> 的设置。如果没有此设置，当输出格式为 PDF 时，渐近线将生成交互式 3D 图形。但是，交互图形只能在 Acrobat Reader 中查看。如果使用 Acrobat Reader，则可以与图形交互。例如，你可以用鼠标旋转图 <a href="#fig:elevation"><strong>??</strong></a> 中的 3D 表面。</p>
<div id="asym-r" class="section level4" number="6.3.16.1">
<h4><span class="header-section-number">6.3.16.1</span> 在 R 中生成数据并通过 Asymptote 读取</h4>
<p>现在我们展示一个示例，其中我们首先将在 R 中生成的数据保存到 CSV 文件中(下面是一个 R 代码块)：</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="rmarkdown-operation.html#cb341-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">l =</span> <span class="dv">100</span>)</span>
<span id="cb341-2"><a href="rmarkdown-operation.html#cb341-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">sin</span>(x)</span>
<span id="cb341-3"><a href="rmarkdown-operation.html#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&#39;sine.csv&#39;</span>)</span></code></pre></div>
<p>然后通过 Asymptote 读取，并根据图 <a href="#fig:sine-curve"><strong>??</strong></a> 所示的数据绘制图表(下面是一个 <code>asy</code> 的代码块)：</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb342-1"><a href="rmarkdown-operation.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> graph<span class="op">;</span></span>
<span id="cb342-2"><a href="rmarkdown-operation.html#cb342-2" aria-hidden="true" tabindex="-1"></a>size<span class="op">(</span><span class="dv">400</span><span class="op">,</span><span class="dv">300</span><span class="op">,</span>IgnoreAspect<span class="op">);</span></span>
<span id="cb342-3"><a href="rmarkdown-operation.html#cb342-3" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span>prc <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb342-4"><a href="rmarkdown-operation.html#cb342-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-5"><a href="rmarkdown-operation.html#cb342-5" aria-hidden="true" tabindex="-1"></a><span class="co">// import data from csv file</span></span>
<span id="cb342-6"><a href="rmarkdown-operation.html#cb342-6" aria-hidden="true" tabindex="-1"></a>file in<span class="op">=</span>input<span class="op">(</span><span class="st">&quot;sine.csv&quot;</span><span class="op">).</span>line<span class="op">().</span>csv<span class="op">();</span></span>
<span id="cb342-7"><a href="rmarkdown-operation.html#cb342-7" aria-hidden="true" tabindex="-1"></a>real<span class="op">[][]</span> a<span class="op">=</span>in<span class="op">.</span>dimension<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb342-8"><a href="rmarkdown-operation.html#cb342-8" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>transpose<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb342-9"><a href="rmarkdown-operation.html#cb342-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-10"><a href="rmarkdown-operation.html#cb342-10" aria-hidden="true" tabindex="-1"></a><span class="co">// generate a path</span></span>
<span id="cb342-11"><a href="rmarkdown-operation.html#cb342-11" aria-hidden="true" tabindex="-1"></a>path rpath <span class="op">=</span> graph<span class="op">(</span>a<span class="op">[</span><span class="dv">0</span><span class="op">],</span>a<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb342-12"><a href="rmarkdown-operation.html#cb342-12" aria-hidden="true" tabindex="-1"></a>path lpath <span class="op">=</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">)--(</span><span class="dv">5</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb342-13"><a href="rmarkdown-operation.html#cb342-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-14"><a href="rmarkdown-operation.html#cb342-14" aria-hidden="true" tabindex="-1"></a><span class="co">// find intersection</span></span>
<span id="cb342-15"><a href="rmarkdown-operation.html#cb342-15" aria-hidden="true" tabindex="-1"></a>pair pA<span class="op">=</span>intersectionpoint<span class="op">(</span>rpath<span class="op">,</span>lpath<span class="op">);</span></span>
<span id="cb342-16"><a href="rmarkdown-operation.html#cb342-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-17"><a href="rmarkdown-operation.html#cb342-17" aria-hidden="true" tabindex="-1"></a><span class="co">// draw all</span></span>
<span id="cb342-18"><a href="rmarkdown-operation.html#cb342-18" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>rpath<span class="op">,</span>red<span class="op">);</span></span>
<span id="cb342-19"><a href="rmarkdown-operation.html#cb342-19" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>lpath<span class="op">,</span>dashed <span class="op">+</span> blue<span class="op">);</span></span>
<span id="cb342-20"><a href="rmarkdown-operation.html#cb342-20" aria-hidden="true" tabindex="-1"></a>dot<span class="op">(</span><span class="st">&quot;$</span><span class="er">\d</span><span class="st">elta$&quot;</span><span class="op">,</span>pA<span class="op">,</span>NE<span class="op">);</span></span>
<span id="cb342-21"><a href="rmarkdown-operation.html#cb342-21" aria-hidden="true" tabindex="-1"></a>xaxis<span class="op">(</span><span class="st">&quot;$x$&quot;</span><span class="op">,</span>BottomTop<span class="op">,</span>LeftTicks<span class="op">);</span></span>
<span id="cb342-22"><a href="rmarkdown-operation.html#cb342-22" aria-hidden="true" tabindex="-1"></a>yaxis<span class="op">(</span><span class="st">&quot;$y$&quot;</span><span class="op">,</span>LeftRight<span class="op">,</span>RightTicks<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="sass-scss" class="section level3" number="6.3.17">
<h3><span class="header-section-number">6.3.17</span> 使用 Sass/SCSS 构建 HTML 页面</h3>
<p>Sass (<a href="https://sass-lang.com" class="uri">https://sass-lang.com</a>) 是一种 CSS 扩展语言，它使用比普通 CSS 更灵活的方式创建 CSS 规则。</p>
<p><strong>sass</strong> <span class="citation">(<a href="#ref-R-sass" role="doc-biblioref">Cheng et al. 2021</a>)</span> (Cheng et al. 2020) 包可以用来编译 Sass 到 CSS。基于 <strong>sass</strong> 包，<strong>knitr</strong> 包含两个语言引擎： <code>sass</code>和 <code>scss</code> (分别对应于 Sass 和 SCSS 语法)，将代码块编译为 CSS。下面是一个 <code>scss</code> 代码块，头部块为<code>```{scss}</code>：</p>
<pre class="scss"><code>$font-stack: &quot;Comic Sans MS&quot;, cursive, sans-serif;
$primary-color: #00FF00;

.book.font-family-1 {
  font: 100% $font-stack;
  color: $primary-color;
}</code></pre>
<style type="text/css">
.book.font-family-1{font:100% "Comic Sans MS",cursive,sans-serif;color:lime}
</style>
<p>Sass 语法与 SCSS 语法略有不同，例如:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb344-1"><a href="rmarkdown-operation.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{sass}</span></span>
<span id="cb344-2"><a href="rmarkdown-operation.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="in">$font-stack: &quot;Comic Sans MS&quot;, cursive, sans-serif</span></span>
<span id="cb344-3"><a href="rmarkdown-operation.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="in">$primary-color: #00FF00</span></span>
<span id="cb344-4"><a href="rmarkdown-operation.html#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="rmarkdown-operation.html#cb344-5" aria-hidden="true" tabindex="-1"></a><span class="in">.book.font-family-1</span></span>
<span id="cb344-6"><a href="rmarkdown-operation.html#cb344-6" aria-hidden="true" tabindex="-1"></a><span class="in">  font: 100% $font-stack</span></span>
<span id="cb344-7"><a href="rmarkdown-operation.html#cb344-7" aria-hidden="true" tabindex="-1"></a><span class="in">  color: $primary-color</span></span>
<span id="cb344-8"><a href="rmarkdown-operation.html#cb344-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>由于上面这一语句的作用，在<a href="https://bookdown.org/yihui/rmarkdown-cookbook/eng-sass.html">本节的HTML版本</a>中，当前页面的英文字体会被更改为 Comic Sans。</p>
<p><code>sass</code>/<code>scss</code> 代码块是通过<code>sass::sass()</code>函数编译而成的。目前，块选项 <code>engine.opts</code> 可以定制 CSS 代码的输出样式，例如：<code>engine.opts = list(style = "expanded")</code>。默认的样式是 “compressed”。请参阅帮助页面 <code>?sass::sass_options</code> 了解更多 <code>output_style</code> 可用的参数。</p>
</div>
</div>
<div id="output-hook" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> 输出钩子 (*)</h2>
<div id="edit-source" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> 编辑源代码</h3>
</div>
<div id="source-index" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> 向源代码中添加行号</h3>
</div>
<div id="scrollable-output" class="section level3" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> 可滚动的文本输出</h3>
</div>
<div id="truncated-output" class="section level3" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> 截断文本输出</h3>
</div>
<div id="html5-plot" class="section level3" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> 以HTML5格式输出图像</h3>
</div>
</div>
<div id="cache" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> 缓存 (*)</h2>
<div id="chunk-cache" class="section level3" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> 缓存耗时的代码块</h3>
<p>在一个报告中，往往会有一些运行起来很费时且很关键的代码块（如数据预处理等）。为了节省时间，可以考虑通过块选项 <code>cache = TRUE</code> 来缓存该代码块的结果。当启用缓存时，如果一个代码块之前被执行过且之后没有任何变化时，<strong>knitr</strong> 将跳过这个代码块的执行，从而大大缩短编译所需的时间。而当再次修改代码块时（如修改代码或块选项），之前的缓存将自动失效，并且 <strong>knitr</strong> 将再次运行并缓存该代码块。</p>
<p>对于一个被缓存了的代码块，它的输出以及变量对象将从上一次的运行中自动加载，就像该代码块被再次执行了一样。当加载结果比计算结果快得多时，缓存操作通常是有用的。然而，天下没有免费的午餐，有的时候 <strong>knitr</strong> 会令缓存失效或是部分失效，如外部文件内容的改变可能没有体现在报告中等等。更多关于如何缓存，特别是缓存失效的相关知识可参见：<a href="https://yihui.org/en/2018/06/cache-invalidation/" class="uri">https://yihui.org/en/2018/06/cache-invalidation/</a>。</p>
<p>缓存的一个典型应用场景是保存和重新加载那些需要很长时间才能在代码块中计算的 R 对象。需要注意的是，代码需要没有任何“副产物”，否则建议不要进行缓存。例如在使用 <code>options()</code> 更改全局 R 选项时，产生的更改不会被缓存。</p>
<p>正如前文提到的，缓存依赖于代码或块选项。如果改变了任何块选项（除了 <code>include</code> 选项），缓存将会失效。此特性可用于解决一个常见的问题，即当代码需要读取外部数据文件时，应在更新数据文件时使缓存失效，那仅仅像下面这样简单地使用 <code>cache = TRUE</code> 是不够的：</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb345-1"><a href="rmarkdown-operation.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r import-data, cache=TRUE}</span></span>
<span id="cb345-2"><a href="rmarkdown-operation.html#cb345-2" aria-hidden="true" tabindex="-1"></a><span class="in">d &lt;- read.csv(&#39;数据.csv&#39;)</span></span>
<span id="cb345-3"><a href="rmarkdown-operation.html#cb345-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>必须要让 <strong>knitr</strong> 知道数据文件是否已被更改。一种方法是添加另一个块选项 <code>cache.extra = file.mtime('数据.csv')</code>，或者更严格的方式：<code>cache.extra = tools::md5sum('数据.csv')</code>。前者意味着如果文件的修改时间发生了变化，就需要使缓存失效；而后者的意思是，如果文件的内容被修改，就更新缓存。需要注意的是，<code>cache.extra</code>不是一个内置的 <strong>knitr</strong> 代码选项，可以为该选项使用任何其他名称，只要它不与内置选项名称冲突。</p>
<p>类似地，还可以将缓存与其他信息相关联，比如R的版本（<code>cache.extra = getRversion()</code>）、时间（<code>cache.extra = Sys.Date()</code>）或是操作系统（<code>cache.extra = Sys.info()[['sysname']]</code>），当这些条件改变时，可以使缓存正确地失效。</p>
<p>需要注意的是，本书不建议在文档中设置全局块选项 <code>cache = TRUE</code>，因为缓存可能相当棘手。相反的，可以只在个别耗时很久的代码块上启用缓存，这样并不会产生副产物。</p>
<p>如果对 <strong>knitr</strong> 的缓存设计不满意，还可以选择自己缓存对象，下面是一个简单的例子：</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="rmarkdown-operation.html#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">&#39;结果.rds&#39;</span>)) {</span>
<span id="cb346-2"><a href="rmarkdown-operation.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&#39;结果.rds&#39;</span>)</span>
<span id="cb346-3"><a href="rmarkdown-operation.html#cb346-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb346-4"><a href="rmarkdown-operation.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">compute_it</span>()  <span class="co"># 一个很耗时的函数</span></span>
<span id="cb346-5"><a href="rmarkdown-operation.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(res, <span class="st">&#39;结果.rds&#39;</span>)</span>
<span id="cb346-6"><a href="rmarkdown-operation.html#cb346-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>在这一例子中，使缓存失效的唯一（也是简单的）方法就是删除文件<code>results.rds</code>。如果对这个简单的缓存机制感兴趣，可以使用在<a href="rmarkdown-operation.html#cache-rds">6.5.4</a>节中介绍的函数<code>xfun::cache_rds()</code>。</p>
</div>
<div id="cache-path" class="section level3" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> 为多种输出格式缓存代码块</h3>
<p>当通过块选项 <code>cache = TRUE</code>启用缓存时，<strong>knitr</strong> 将把在代码块中生成的 R 对象写入缓存数据库，以便下次重新加载它们。缓存数据库的路径由块选项 <code>cache.path</code> 决定。默认情况下，R Markdown 对不同的输出格式会使用不同的缓存路径，这意味着对于每种输出格式都将完全执行一次这个（耗时的）代码块。这可能很不方便，但这种默认的行为是有原因的，即代码块的输出可能依赖于特定的输出格式。例如，生成图像，当输出格式为<code>word_document</code>时，图像的输出可能是像 <code>![text](path/to/image.png)</code> 这样的标记代码；而或者当输出格式为 <code>html_document</code> 时，输出的HTML代码则类似 <code>&lt;img src="path/to/image.png" /&gt;</code>。</p>
<p>当代码块没有任何副产物（如图像）时，对所有输出格式使用相同的缓存数据库是安全的，还可以节省时间。例如，当读取一个大型数据对象或运行一个比较耗时的模型时，若结果不依赖于输出格式，就可以使用相同的缓存数据库。可以通过块选项 <code>cache.path</code> ，例如：</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb347-1"><a href="rmarkdown-operation.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r important-computing, cache=TRUE, cache.path=&quot;cache/&quot;}</span></span>
<span id="cb347-2"><a href="rmarkdown-operation.html#cb347-2" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>实际上，在 R Markdown 中，<code>cache.path</code> 的默认设置为 <code>cache.path = "INPUT_cache/FORMAT/"</code>，其中 <code>INPUT</code> 代表输入的文件名，<code>FORMAT</code> 为输出格式（如 <code>html</code>、<code>latex</code> 或 <code>docx</code>），这就导致了不同的输出格式对应不同的缓存路径。</p>
</div>
<div id="cache-lazy" class="section level3" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> 缓存大型的对象</h3>
<p>当设定块选项 <code>cache = TRUE</code> 时，缓存的对象将被延迟加载到 R 中，这意味着对象将不会从缓存数据库中读取，直到它在代码中被实际使用。当不是所有对象都在文档中稍后被使用时，这一操作可以节省一些内存。例如，如果读取了一个大型的数据对象，但在后续的分析中只使用了其中的一个子集，那么原始的数据对象将不会从缓存数据库中加载：</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb348-1"><a href="rmarkdown-operation.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, read-data, cache=TRUE}</span></span>
<span id="cb348-2"><a href="rmarkdown-operation.html#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="in">full &lt;- read.csv(&quot;大型数据集.csv&quot;)</span></span>
<span id="cb348-3"><a href="rmarkdown-operation.html#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="in">rows &lt;- subset(full, price &gt; 100)</span></span>
<span id="cb348-4"><a href="rmarkdown-operation.html#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="in"># 之后只使用 `rows` 数据集</span></span>
<span id="cb348-5"><a href="rmarkdown-operation.html#cb348-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-6"><a href="rmarkdown-operation.html#cb348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-7"><a href="rmarkdown-operation.html#cb348-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb348-8"><a href="rmarkdown-operation.html#cb348-8" aria-hidden="true" tabindex="-1"></a><span class="in">plot(rows)</span></span>
<span id="cb348-9"><a href="rmarkdown-operation.html#cb348-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>然而，当一个对象太大时，可能会遇到这样的报错：</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="rmarkdown-operation.html#cb349-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">lazyLoadDBinsertVariable</span>(vars[i], ... </span>
<span id="cb349-2"><a href="rmarkdown-operation.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  long vectors not supported yet<span class="sc">:</span> ...</span>
<span id="cb349-3"><a href="rmarkdown-operation.html#cb349-3" aria-hidden="true" tabindex="-1"></a>Execution halted</span></code></pre></div>
<p>如果出现这个问题，可以尝试通过块选项 <code>cache.lazy = FALSE</code> 来关闭延迟加载，这样该代码块中的所有对象都将立即被加载到内存中。</p>
</div>
<div id="cache-rds" class="section level3" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> 一个更透明的缓存机制</h3>
<p>如果在使用的过程中，觉得前文介绍的基于 <strong>knitr</strong> 的缓存机过于复杂，可以考虑使用基于函数 <code>xfun::cache_rds()</code> 的一个更简单的缓存机制，例如：</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="rmarkdown-operation.html#cb350-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb350-2"><a href="rmarkdown-operation.html#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 在这里编写你的耗时代码</span></span>
<span id="cb350-3"><a href="rmarkdown-operation.html#cb350-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>关于 <strong>knitr</strong> 缓存，其棘手之处在于如何决定何时使缓存失效，而使用 <code>xfun::cache_rds()</code> 则要清楚得多：第一次将 R 表达式传递给这个函数时，它会计算表达式并将结果保存到 <code>.rds</code> 文件中；下次再次运行 <code>cache_rds()</code> 时，它会读取 <code>.rds</code> 文件，并立即返回结果，而不再次计算表达式。使缓存无效的最明显的方法是删除 <code>.rds</code> 的文件。如果不想手动删除它，则可以用参数 <code>rerun = TRUE</code> 来调用 <code>xfun::cache_rds()</code>。</p>
<p>当 <code>xfun::cache_rds()</code> 在 <strong>knitr</strong> 源文档的一个代码块中被调用时，<code>.rds</code> 文件的路径由块选项 <code>cache.path</code> 和块标签决定。例如，对于在 Rmd 文档 <code>input.Rmd</code> 中带有块标签 <code>foo</code> 的代码块：</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb351-1"><a href="rmarkdown-operation.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, foo}</span></span>
<span id="cb351-2"><a href="rmarkdown-operation.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="in">res &lt;- xfun::cache_rds({</span></span>
<span id="cb351-3"><a href="rmarkdown-operation.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="in">  Sys.sleep(3)</span></span>
<span id="cb351-4"><a href="rmarkdown-operation.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="in">  1:10</span></span>
<span id="cb351-5"><a href="rmarkdown-operation.html#cb351-5" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb351-6"><a href="rmarkdown-operation.html#cb351-6" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p><code>.rds</code> 文件的路径格式为 <code>input_cache/FORMAT/foo_HASH.rds</code>，其中 <code>FORMAT</code> 是 Pandoc 输出格式名称（例如 <code>html</code> 或 <code>latex</code>）， <code>HASH</code> 是一个MD5哈希值，包含了 32 个十六进制数字（a-f 和 0-9），例如 <code>input_cache/html/foo_7a3f22c4309d400eff95de0e8bddac71.rds</code>。</p>
<p>如帮助页面 <code>?xfun::cache_rds</code> 所述，通常在两种的情况下可能想要使缓存失效：（1）待求值表达式中的代码发生了变化；（2）代码使用了一个外部变量，并且该变量的值已经改变。本节接下来将解释这两种情况下缓存是如何失效的，以及如何将缓存的多个副本保存到对应于不同版本的代码中。</p>
<div id="通过更改表达式中的代码使缓存失效" class="section level4" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> 通过更改表达式中的代码使缓存失效</h4>
<p>当改变 <code>cache_rds()</code>中的代码时（例如，从 <code>cache_rds({x + 1})</code> 改为 <code>cache_rds({x + 2})</code>），缓存将自动失效，表达式将被重新计算。但是需要注意的是，空格或注释的变化是不重要的，或者一般来说，只要更改不影响已解析的表达式，缓存就不会失效。例如，下面传递给 <code>cache_rds()</code> 的两个表达式在本质上是相同的：</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="rmarkdown-operation.html#cb352-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb352-2"><a href="rmarkdown-operation.html#cb352-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>);</span>
<span id="cb352-3"><a href="rmarkdown-operation.html#cb352-3" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>;  <span class="co"># 分号不影响</span></span>
<span id="cb352-4"><a href="rmarkdown-operation.html#cb352-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">+</span><span class="dv">1</span>;</span>
<span id="cb352-5"><a href="rmarkdown-operation.html#cb352-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb352-6"><a href="rmarkdown-operation.html#cb352-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb352-7"><a href="rmarkdown-operation.html#cb352-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb352-8"><a href="rmarkdown-operation.html#cb352-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb352-9"><a href="rmarkdown-operation.html#cb352-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>  <span class="co"># 一个注释</span></span>
<span id="cb352-10"><a href="rmarkdown-operation.html#cb352-10" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span></span>
<span id="cb352-11"><a href="rmarkdown-operation.html#cb352-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="co"># 可以随意修改空格部分</span></span>
<span id="cb352-12"><a href="rmarkdown-operation.html#cb352-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>因此，如果对第一个表达式执行 <code>cache_rds()</code> ，那么第二个表达式将能够调用缓存的结果。这一特性非常有用，因为其允许在代码中进行修饰性更改，而不会使缓存失效。</p>
<p>如果不确定两个版本的代码是否相等，则可以尝试下面的 <code>parse_code()</code> 函数：</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="rmarkdown-operation.html#cb353-1" aria-hidden="true" tabindex="-1"></a>parse_code <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb353-2"><a href="rmarkdown-operation.html#cb353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deparse</span>(<span class="fu">substitute</span>(expr))</span>
<span id="cb353-3"><a href="rmarkdown-operation.html#cb353-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb353-4"><a href="rmarkdown-operation.html#cb353-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 空格或分号不影响</span></span>
<span id="cb353-5"><a href="rmarkdown-operation.html#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_code</span>({x<span class="sc">+</span><span class="dv">1</span>})</span></code></pre></div>
<pre><code>## [1] &quot;{&quot;         &quot;    x + 1&quot; &quot;}&quot;</code></pre>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="rmarkdown-operation.html#cb355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_code</span>({ x   <span class="sc">+</span>    <span class="dv">1</span>; })</span></code></pre></div>
<pre><code>## [1] &quot;{&quot;         &quot;    x + 1&quot; &quot;}&quot;</code></pre>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="rmarkdown-operation.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 左箭头和右箭头是等价的</span></span>
<span id="cb357-2"><a href="rmarkdown-operation.html#cb357-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">parse_code</span>({x <span class="ot">&lt;-</span> <span class="dv">1</span>}), <span class="fu">parse_code</span>({<span class="dv">1</span> <span class="ot">-&gt;</span> x}))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="通过更改全局变量使缓存失效" class="section level4" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> 通过更改全局变量使缓存失效</h4>
<p>通常情况下，表达式中有两种类型的变量：全局变量和局部变量。全局变量是在表达式外部创建的，局部变量则是在表达式内部创建的。如果表达式中全局变量的值发生了变化，那么缓存的结果和再次运行的结果之间可能会产生差异。例如，在下面的表达式中，如果 <code>y</code> 发生了变化，需要想要使缓存失效并重新运行表达式，否则仍然会得到根据 <code>y</code> 之前的值计算得到的结果：</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="rmarkdown-operation.html#cb359-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb359-2"><a href="rmarkdown-operation.html#cb359-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-3"><a href="rmarkdown-operation.html#cb359-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb359-4"><a href="rmarkdown-operation.html#cb359-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb359-5"><a href="rmarkdown-operation.html#cb359-5" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb359-6"><a href="rmarkdown-operation.html#cb359-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>如果要使缓存在 <code>y</code> 发生变化时失效，则需要通过 <code>hash</code> 参数，让 <code>cache_rds()</code> 在决定缓存是否应该失效时知道需要考虑 <code>y</code>：</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="rmarkdown-operation.html#cb360-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb360-2"><a href="rmarkdown-operation.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb360-3"><a href="rmarkdown-operation.html#cb360-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb360-4"><a href="rmarkdown-operation.html#cb360-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y))</span></code></pre></div>
<p>当 <code>hash</code> 参数的值改变时，缓存文件名中的 32 位哈希值（如前所述）会相应地改变，导致缓存失效。这提供了一种方法来指定缓存与其他 R 对象的依赖关系。例如，如果想要使缓存依赖于 <code>y</code> 以及 R 的版本，可以这样指定依赖：</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="rmarkdown-operation.html#cb361-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb361-2"><a href="rmarkdown-operation.html#cb361-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb361-3"><a href="rmarkdown-operation.html#cb361-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb361-4"><a href="rmarkdown-operation.html#cb361-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y, <span class="fu">getRversion</span>()))</span></code></pre></div>
<p>或者如果想让缓存依赖于 <code>y</code> 以及数据文件最后一次修改的时间，可以这样做：</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="rmarkdown-operation.html#cb362-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb362-2"><a href="rmarkdown-operation.html#cb362-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;数据.csv&quot;</span>)</span>
<span id="cb362-3"><a href="rmarkdown-operation.html#cb362-3" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">1</span>]] <span class="sc">+</span> y</span>
<span id="cb362-4"><a href="rmarkdown-operation.html#cb362-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y, <span class="fu">file.mtime</span>(<span class="st">&quot;数据.csv&quot;</span>)))</span></code></pre></div>
<p>如果不想为 <code>hash</code> 参数提供全局变量的列表，则可以尝试 <code>hash = "auto"</code>，它将使 <code>cache_rds()</code> 自动找出所有的全局变量，并将它们作为 <code>hash</code> 参数的值，例如：</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="rmarkdown-operation.html#cb363-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb363-2"><a href="rmarkdown-operation.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb363-3"><a href="rmarkdown-operation.html#cb363-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y <span class="sc">+</span> z  <span class="co"># y 和 z 是全局变量</span></span>
<span id="cb363-4"><a href="rmarkdown-operation.html#cb363-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<p>这等价于：</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="rmarkdown-operation.html#cb364-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb364-2"><a href="rmarkdown-operation.html#cb364-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb364-3"><a href="rmarkdown-operation.html#cb364-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y <span class="sc">+</span> z  <span class="co"># y 和 z 是全局变量</span></span>
<span id="cb364-4"><a href="rmarkdown-operation.html#cb364-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">z =</span> z))</span></code></pre></div>
<p>当 <code>hash = "auto"</code> 时，全局变量由 <code>codetools::findGlobals()</code> 识别，这可能不是完全可靠的，所以如果需要完全确定哪些变量可以使缓存失效，本书建议在 <code>hash</code> 参数中亲自给定变量列表。</p>
</div>
<div id="保留缓存的多个副本" class="section level4" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> 保留缓存的多个副本</h4>
<p>由于缓存通常用于非常耗时的代码，在使其失效时应当保守一些。有的时候可能会因过早或主动地使缓存失效而后悔，因为如果再次需要一个旧版本的缓存时，则将不得不等待很长的时间才能重新完成计算。</p>
<p>若将 <code>cache_rds()</code> 中的 <code>clean</code> 参数设置为 <code>FALSE</code>，则将允许保留旧的缓存副本。也可以设置全局 R 选项 <code>options(xfun.cache_rds.clean = FALSE)</code> 来使其成为文档的默认行为。在默认情况下，<code>clean = TRUE</code> 和 <code>cache_rds()</code> 每次都会尝试删除旧的缓存。如果还在进行代码测试，那么设置 <code>clean = FALSE</code> 会很有用。例如，可以缓存一个线性模型的两个版本：</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="rmarkdown-operation.html#cb365-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb365-2"><a href="rmarkdown-operation.html#cb365-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data =</span> cars)</span>
<span id="cb365-3"><a href="rmarkdown-operation.html#cb365-3" aria-hidden="true" tabindex="-1"></a>}, <span class="at">clean =</span> <span class="cn">FALSE</span>)</span>
<span id="cb365-4"><a href="rmarkdown-operation.html#cb365-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-5"><a href="rmarkdown-operation.html#cb365-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb365-6"><a href="rmarkdown-operation.html#cb365-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(dist <span class="sc">~</span> speed <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> cars)</span>
<span id="cb365-7"><a href="rmarkdown-operation.html#cb365-7" aria-hidden="true" tabindex="-1"></a>}, <span class="at">clean =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>在决定使用哪个模型之后，可以再次设置 <code>clean = TRUE</code>，或者删除 <code>clean</code> 参数（默认为 <code>TRUE</code>）。</p>
</div>
<div id="与-knitr-的缓存比较" class="section level4" number="6.5.4.4">
<h4><span class="header-section-number">6.5.4.4</span> 与 <strong>knitr</strong> 的缓存比较</h4>
<p>那么什么时候使用 <strong>knitr</strong> 的缓存（例如，设置块选项 <code>cache = TRUE</code>），什么时候在 <strong>knitr</strong> 源文档中使用 <code>xfun::cache_rds()</code>呢？后者最大的缺点是它不缓存副产物（而只缓存表达式的值），而 <strong>knitr</strong> 却可以。有的时候，一些副产物是有用的，比如打印的输出或图像。例如，在下面的代码中，当使用 <code>cache_rds()</code> 加载缓存时，文本输出和图像将会丢失，只会返回 <code>1:10</code>：</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="rmarkdown-operation.html#cb366-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb366-2"><a href="rmarkdown-operation.html#cb366-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Hello world!&quot;</span>)</span>
<span id="cb366-3"><a href="rmarkdown-operation.html#cb366-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(cars)</span>
<span id="cb366-4"><a href="rmarkdown-operation.html#cb366-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb366-5"><a href="rmarkdown-operation.html#cb366-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>相比之下，对于设定选项为 <code>cache = TRUE</code> 的代码块，所有的内容都将被缓存：</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb367-1"><a href="rmarkdown-operation.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE}</span></span>
<span id="cb367-2"><a href="rmarkdown-operation.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="in">print(&quot;Hello world!&quot;)</span></span>
<span id="cb367-3"><a href="rmarkdown-operation.html#cb367-3" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb367-4"><a href="rmarkdown-operation.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="in">1:10</span></span>
<span id="cb367-5"><a href="rmarkdown-operation.html#cb367-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>但 <strong>knitr</strong> 的缓存最大的缺点（同时也是用户最常抱怨的）是缓存可能会在不经意间失效，因为缓存由太多的因素所决定。例如，任何块选项的改变都会使缓存失效<a href="references.html#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a>，但有些块选项可能与计算无关。例如在下面的代码块中，改变块选项 <code>fig.width = 6</code> 到 <code>fig.width = 10</code> 会导致缓存失效，但实际上却不需要重新运行一次代码：</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb368-1"><a href="rmarkdown-operation.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, cache=TRUE, fig.width=6}</span></span>
<span id="cb368-2"><a href="rmarkdown-operation.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 这个块没有生成图像</span></span>
<span id="cb368-3"><a href="rmarkdown-operation.html#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="in">x &lt;- rnorm(1000)</span></span>
<span id="cb368-4"><a href="rmarkdown-operation.html#cb368-4" aria-hidden="true" tabindex="-1"></a><span class="in">mean(x)</span></span>
<span id="cb368-5"><a href="rmarkdown-operation.html#cb368-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>实际上，<strong>knitr</strong> 的缓存非常强大且灵活，它的行为可以通过多种方式进行调整。它的作者也经常怀疑是否值得介绍这些不太为人所知的特性，因为可能会导致用户花更多的时间来学习和理解缓存如何工作，而非运行实际的代码。</p>
<p>在不清楚用哪个的情况下，<code>xfun::cache_rds()</code> 是缓存计算结果的通用方法，它可以在任何地方使用，而 <strong>knitr</strong> 的缓存只能在 <strong>knitr</strong> 文档中使用。</p>
</div>
</div>
</div>
<div id="other-trick" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> 其它使用 knitr 的小技巧 (*)</h2>
<div id="reuse-chunk" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> 重复使用代码块</h3>
</div>
<div id="use-creat" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> 在创建对象之前使用它 (*)</h3>
</div>
<div id="compile-exit" class="section level3" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> 提前退出编译</h3>
</div>
<div id="plot-show-else" class="section level3" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> 生成一个图像并在其他地方显示</h3>
</div>
<div id="modify-before" class="section level3" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> 修改之前代码块中的图像</h3>
</div>
<div id="reuse-option" class="section level3" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> 保存一组块选项并重复使用它们 (*)</h3>
</div>
<div id="knit-expand" class="section level3" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> 使用 knitr::knit_expand() 来生成 Rmd 源代码</h3>
</div>
<div id="repeat-label" class="section level3" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> 允许代码块中的标签重复 (*)</h3>

</div>
</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-sass" class="csl-entry">
Cheng, Joe, Timothy Mastny, Richard Iannone, Barret Schloerke, and Carson Sievert. 2021. <em>Sass: Syntactically Awesome Style Sheets (Sass)</em>. <a href="https://github.com/rstudio/sass">https://github.com/rstudio/sass</a>.
</div>
<div id="ref-R-xtable" class="csl-entry">
Dahl, David B., David Scott, Charles Roosen, Arni Magnusson, and Jonathan Swinton. 2019. <em>Xtable: Export Tables to LaTeX or HTML</em>. <a href="http://xtable.r-forge.r-project.org/">http://xtable.r-forge.r-project.org/</a>.
</div>
<div id="ref-R-pander" class="csl-entry">
Daróczi, Gergely, and Roman Tsegelskyi. 2022. <em>Pander: An r Pandoc Writer</em>. <a href="https://rapporter.github.io/pander/">https://rapporter.github.io/pander/</a>.
</div>
<div id="ref-R-huxtable" class="csl-entry">
Hugh-Jones, David. 2021. <em>Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats</em>. <a href="https://hughjonesd.github.io/huxtable/">https://hughjonesd.github.io/huxtable/</a>.
</div>
<div id="ref-R-magick" class="csl-entry">
Ooms, Jeroen. 2021. <em>Magick: Advanced Graphics and Image-Processing in r</em>. <a href="https://CRAN.R-project.org/package=magick">https://CRAN.R-project.org/package=magick</a>.
</div>
<div id="ref-R-tikzDevice" class="csl-entry">
Sharpsteen, Charlie, and Cameron Bracken. 2020. <em>tikzDevice: R Graphics Output in LaTeX Format</em>. <a href="https://github.com/daqana/tikzDevice">https://github.com/daqana/tikzDevice</a>.
</div>
<div id="ref-R-yaml" class="csl-entry">
Stephens, Jeremy, Kirill Simonov, Yihui Xie, Zhuoer Dong, Hadley Wickham, Jeffrey Horner, reikoch, Will Beasley, Brendan O’Connor, and Gregory R. Warnes. 2020. <em>Yaml: Methods to Convert r Data to YAML and Back</em>. <a href="https://github.com/viking/r-yaml/">https://github.com/viking/r-yaml/</a>.
</div>
<div id="ref-R-reticulate" class="csl-entry">
Ushey, Kevin, JJ Allaire, and Yuan Tang. 2021. <em>Reticulate: Interface to Python</em>. <a href="https://github.com/rstudio/reticulate">https://github.com/rstudio/reticulate</a>.
</div>
<div id="ref-R-svglite" class="csl-entry">
Wickham, Hadley, Lionel Henry, Thomas Lin Pedersen, T Jake Luciani, Matthieu Decorde, and Vaudor Lise. 2022. <em>Svglite: An SVG Graphics Device</em>. <a href="https://CRAN.R-project.org/package=svglite">https://CRAN.R-project.org/package=svglite</a>.
</div>
<div id="ref-R-formatR" class="csl-entry">
Xie, Yihui. 2021a. <em>formatR: Format r Code Automatically</em>. <a href="https://github.com/yihui/formatR">https://github.com/yihui/formatR</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://rmarkdown-guide.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="rmarkdown-interaction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown-project.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cosname/rmarkdown-guide/edit/master/06-operation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
