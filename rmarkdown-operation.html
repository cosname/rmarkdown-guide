<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 6 章 R Markdown 的操作技巧 | R Markdown 指南</title>
  <meta name="description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  <meta name="github-repo" content="cosname/rmarkdown-guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  
  <meta name="twitter:description" content="第 6 章 R Markdown 的操作技巧 | R Markdown 指南" />
  

<meta name="author" content="高春辉" />
<meta name="author" content="王祎帆" />
<meta name="author" content="闫求识" />
<meta name="author" content="庄亮亮" />
<meta name="author" content="杨晓龙" />


<meta name="date" content="2022-11-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rmarkdown-interaction.html"/>
<link rel="next" href="rmarkdown-project.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
<script src="libs/tile-view-0.2.6/tile-view.js"></script>
<script type="application/json" id="xaringanExtra-editable-docid">{"id":"x858a70096e54fe89a95c5347eb82d55","expires":1}</script>
<script src="libs/himalaya-1.1.0/himalaya.js"></script>
<script src="libs/js-cookie-3.0.0/js.cookie.js"></script>
<link href="libs/editable-0.2.6/editable.css" rel="stylesheet" />
<script src="libs/editable-0.2.6/editable.js"></script>
<script src="libs/fabric-4.3.1/fabric.min.js"></script>
<link href="libs/xaringanExtra-scribble-0.0.1/scribble.css" rel="stylesheet" />
<script src="libs/xaringanExtra-scribble-0.0.1/scribble.js"></script>
<script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
<script src="libs/tone-13.8.34/Tone.js"></script>
<script src="libs/slide-tone-0.2.6/slide-tone.js"></script>
<link href="libs/animate.css-3.7.2/animate.xaringan.css" rel="stylesheet" />
<link href="libs/animate.css-xaringan-3.7.2/animate.slide_left.css" rel="stylesheet" />
<link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
<script src="libs/panelset-0.2.6/panelset.js"></script>
<script src="libs/xaringanExtra-webcam-0.0.1/webcam.js"></script>
<script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
<script src="libs/xaringanExtra_fit-screen-0.2.6/fit-screen.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R Markdown 中文指南</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#为什么要写这样一本书"><i class="fa fa-check"></i><b>0.1</b> 为什么要写这样一本书？</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#本书是怎么写出来的"><i class="fa fa-check"></i><b>0.2</b> 本书是怎么写出来的？</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#本书的创作理念是什么"><i class="fa fa-check"></i><b>0.3</b> 本书的创作理念是什么？</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#本书主要有哪些内容"><i class="fa fa-check"></i><b>0.4</b> 本书主要有哪些内容？</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#阅读本书时的注意事项"><i class="fa fa-check"></i><b>0.5</b> 阅读本书时的注意事项</a></li>
</ul></li>
<li class="part"><span><b>I 初识 R Markdown</b></span></li>
<li class="chapter" data-level="1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html"><i class="fa fa-check"></i><b>1</b> R Markdown概述</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#rmarkdown-source"><i class="fa fa-check"></i><b>1.1</b> R Markdown 的渊源</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#r-markdown-literate-programming"><i class="fa fa-check"></i><b>1.1.1</b> R Markdown 与文学化编程</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#rmarkdown-example"><i class="fa fa-check"></i><b>1.2</b> 以案例形式初识 R Markdown</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-report"><i class="fa fa-check"></i><b>1.2.1</b> 数据分析报告</a></li>
<li class="chapter" data-level="1.2.2" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-note"><i class="fa fa-check"></i><b>1.2.2</b> 交互笔记本</a></li>
<li class="chapter" data-level="1.2.3" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-cv"><i class="fa fa-check"></i><b>1.2.3</b> 个人简历</a></li>
<li class="chapter" data-level="1.2.4" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-resume"><i class="fa fa-check"></i><b>1.2.4</b> 网站</a></li>
<li class="chapter" data-level="1.2.5" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-ppt"><i class="fa fa-check"></i><b>1.2.5</b> 幻灯片</a></li>
<li class="chapter" data-level="1.2.6" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-forms"><i class="fa fa-check"></i><b>1.2.6</b> 交互报表</a></li>
<li class="chapter" data-level="1.2.7" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#example-dynamic"><i class="fa fa-check"></i><b>1.2.7</b> 动态文档</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="rmarkdown-intro.html"><a href="rmarkdown-intro.html#r-markdown-的渊源与发展"><i class="fa fa-check"></i><b>1.3</b> R Markdown 的渊源与发展</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html"><i class="fa fa-check"></i><b>2</b> R Markdown 的基础知识</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rstudio-config"><i class="fa fa-check"></i><b>2.1</b> 安装 RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-rmarkdown"><i class="fa fa-check"></i><b>2.2</b> 安装 rmarkdown 包</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-tinytex"><i class="fa fa-check"></i><b>2.2.1</b> 安装 TinyTex</a></li>
<li class="chapter" data-level="2.2.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#install-git"><i class="fa fa-check"></i><b>2.2.2</b> 安装 Git (*)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rmarkdown-element"><i class="fa fa-check"></i><b>2.3</b> R Markdown 的基本元素</a></li>
<li class="chapter" data-level="2.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rmarkdown-compile"><i class="fa fa-check"></i><b>2.4</b> R Markdown 的编译过程和组成元素</a></li>
<li class="chapter" data-level="2.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#yaml"><i class="fa fa-check"></i><b>2.5</b> YAML 头部</a></li>
<li class="chapter" data-level="2.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#markdown-syntax"><i class="fa fa-check"></i><b>2.6</b> Markdown 语法</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#简单段内格式"><i class="fa fa-check"></i><b>2.6.1</b> 简单段内格式</a></li>
<li class="chapter" data-level="2.6.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#换行"><i class="fa fa-check"></i><b>2.6.2</b> 换行</a></li>
<li class="chapter" data-level="2.6.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#段落格式"><i class="fa fa-check"></i><b>2.6.3</b> 段落格式</a></li>
<li class="chapter" data-level="2.6.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#markdown-code"><i class="fa fa-check"></i><b>2.6.4</b> 代码块</a></li>
<li class="chapter" data-level="2.6.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#markdown-figure"><i class="fa fa-check"></i><b>2.6.5</b> 图片</a></li>
<li class="chapter" data-level="2.6.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#markdown-table"><i class="fa fa-check"></i><b>2.6.6</b> 表格</a></li>
<li class="chapter" data-level="2.6.7" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#数学公式"><i class="fa fa-check"></i><b>2.6.7</b> 数学公式</a></li>
<li class="chapter" data-level="2.6.8" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#总结"><i class="fa fa-check"></i><b>2.6.8</b> 总结</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#code-block-and-inline"><i class="fa fa-check"></i><b>2.7</b> 代码块和行内代码</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#代码块选项"><i class="fa fa-check"></i><b>2.7.1</b> 代码块选项</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#document-element"><i class="fa fa-check"></i><b>2.8</b> 文档元素</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-figure"><i class="fa fa-check"></i><b>2.8.1</b> 图片</a></li>
<li class="chapter" data-level="2.8.2" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-table"><i class="fa fa-check"></i><b>2.8.2</b> 表格</a></li>
<li class="chapter" data-level="2.8.3" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#page-break"><i class="fa fa-check"></i><b>2.8.3</b> 分页符和分割线</a></li>
<li class="chapter" data-level="2.8.4" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#toc"><i class="fa fa-check"></i><b>2.8.4</b> 目录</a></li>
<li class="chapter" data-level="2.8.5" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#bibliography"><i class="fa fa-check"></i><b>2.8.5</b> 参考文献</a></li>
<li class="chapter" data-level="2.8.6" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#引用-r-包"><i class="fa fa-check"></i><b>2.8.6</b> 引用 R 包</a></li>
<li class="chapter" data-level="2.8.7" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#cross-reference"><i class="fa fa-check"></i><b>2.8.7</b> 交叉引用</a></li>
<li class="chapter" data-level="2.8.8" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#index"><i class="fa fa-check"></i><b>2.8.8</b> 索引</a></li>
<li class="chapter" data-level="2.8.9" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#动画"><i class="fa fa-check"></i><b>2.8.9</b> 动画</a></li>
<li class="chapter" data-level="2.8.10" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-widget"><i class="fa fa-check"></i><b>2.8.10</b> 交互组件</a></li>
<li class="chapter" data-level="2.8.11" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-media"><i class="fa fa-check"></i><b>2.8.11</b> 音频和视频</a></li>
<li class="chapter" data-level="2.8.12" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#element-digram"><i class="fa fa-check"></i><b>2.8.12</b> 流程图</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="rmarkdown-base.html"><a href="rmarkdown-base.html#rstudio-图形化编辑器"><i class="fa fa-check"></i><b>2.9</b> RStudio 图形化编辑器</a></li>
</ul></li>
<li class="part"><span><b>II 基于 R Markdown 的应用</b></span></li>
<li class="chapter" data-level="3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html"><i class="fa fa-check"></i><b>3</b> 使用 R Markdown 创建常用文档</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-html"><i class="fa fa-check"></i><b>3.1</b> HTML 文档</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-title"><i class="fa fa-check"></i><b>3.1.1</b> 目录和标题</a></li>
<li class="chapter" data-level="3.1.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-theme"><i class="fa fa-check"></i><b>3.1.2</b> 主题和样式</a></li>
<li class="chapter" data-level="3.1.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-pic"><i class="fa fa-check"></i><b>3.1.3</b> 图片和数据框</a></li>
<li class="chapter" data-level="3.1.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#html-module"><i class="fa fa-check"></i><b>3.1.4</b> 组件和内容</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-pdf"><i class="fa fa-check"></i><b>3.2</b> PDF 文档</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-rmd"><i class="fa fa-check"></i><b>3.2.1</b> 从 R Markdown 到 PDF 文档</a></li>
<li class="chapter" data-level="3.2.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-chinese"><i class="fa fa-check"></i><b>3.2.2</b> 在 PDF 文档中使用中文的注意事项</a></li>
<li class="chapter" data-level="3.2.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-general-setting"><i class="fa fa-check"></i><b>3.2.3</b> 与 HTML 文档中相通的一些设置</a></li>
<li class="chapter" data-level="3.2.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex"><i class="fa fa-check"></i><b>3.2.4</b> LaTeX 选项</a></li>
<li class="chapter" data-level="3.2.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex-citation"><i class="fa fa-check"></i><b>3.2.5</b> 使用 LaTeX 包处理参考文献</a></li>
<li class="chapter" data-level="3.2.6" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-latex-engine"><i class="fa fa-check"></i><b>3.2.6</b> LaTeX 的渲染引擎</a></li>
<li class="chapter" data-level="3.2.7" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#pdf-keep-tex"><i class="fa fa-check"></i><b>3.2.7</b> 保留生成的 TeX 中间文件</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-ppt"><i class="fa fa-check"></i><b>3.3</b> PPT 幻灯片</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#ioslides-presentation"><i class="fa fa-check"></i><b>3.3.1</b> ioslides 幻灯片</a></li>
<li class="chapter" data-level="3.3.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#slidy-presentation"><i class="fa fa-check"></i><b>3.3.2</b> Slidy 幻灯片</a></li>
<li class="chapter" data-level="3.3.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#beamer-presentation"><i class="fa fa-check"></i><b>3.3.3</b> Beamer 幻灯片</a></li>
<li class="chapter" data-level="3.3.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#powerpoint-presentation"><i class="fa fa-check"></i><b>3.3.4</b> PowerPoint 幻灯片</a></li>
<li class="chapter" data-level="3.3.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#ppt-xaringan"><i class="fa fa-check"></i><b>3.3.5</b> Xaringan 幻灯片</a></li>
<li class="chapter" data-level="3.3.6" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#xaringan-extension"><i class="fa fa-check"></i><b>3.3.6</b> Xaringan 幻灯片的扩展包</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-word"><i class="fa fa-check"></i><b>3.4</b> Word 文档</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-template"><i class="fa fa-check"></i><b>3.4.1</b> 创建 word 模板</a></li>
<li class="chapter" data-level="3.4.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-custom-template"><i class="fa fa-check"></i><b>3.4.2</b> 自定义 Word 模板</a></li>
<li class="chapter" data-level="3.4.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-rmd"><i class="fa fa-check"></i><b>3.4.3</b> R Markdown 和 Word 之间的双向工作流程</a></li>
<li class="chapter" data-level="3.4.4" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#word-style"><i class="fa fa-check"></i><b>3.4.4</b> 个人风格元素</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#rmarkdown-new"><i class="fa fa-check"></i><b>3.5</b> 创建新的文档格式</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-existing"><i class="fa fa-check"></i><b>3.5.1</b> 从现有文档格式衍生新格式</a></li>
<li class="chapter" data-level="3.5.2" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-new"><i class="fa fa-check"></i><b>3.5.2</b> 完全的自定义输出格式</a></li>
<li class="chapter" data-level="3.5.3" data-path="rmarkdown-document.html"><a href="rmarkdown-document.html#new-using"><i class="fa fa-check"></i><b>3.5.3</b> 使用新的文档输出格式</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html"><i class="fa fa-check"></i><b>4</b> 基于 R Markdown 工作与学习</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-email"><i class="fa fa-check"></i><b>4.1</b> 发邮件：<code>blastula</code></a></li>
<li class="chapter" data-level="4.2" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-package"><i class="fa fa-check"></i><b>4.2</b> 制作 R 包：<code>fusen</code></a></li>
<li class="chapter" data-level="4.3" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-cv"><i class="fa fa-check"></i><b>4.3</b> 制作简历：<code>datadrivencv</code></a></li>
<li class="chapter" data-level="4.4" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-bookdown"><i class="fa fa-check"></i><b>4.4</b> 写书和记学习笔记：<code>bookdown</code></a></li>
<li class="chapter" data-level="4.5" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-blogdown"><i class="fa fa-check"></i><b>4.5</b> 制作网站：<code>blogdown</code></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#blogdown-intro"><i class="fa fa-check"></i><b>4.5.1</b> blogdown 简介</a></li>
<li class="chapter" data-level="4.5.2" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#blogdown-steps"><i class="fa fa-check"></i><b>4.5.2</b> 具体操作</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#rmarkdown-paper"><i class="fa fa-check"></i><b>4.6</b> 制作科技论文的支撑材料</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#建议文件结构"><i class="fa fa-check"></i><b>4.6.1</b> 建议文件结构</a></li>
<li class="chapter" data-level="4.6.2" data-path="rmarkdown-working.html"><a href="rmarkdown-working.html#分析报告的正文"><i class="fa fa-check"></i><b>4.6.2</b> 分析报告的正文</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III R Markdown 进阶操作</b></span></li>
<li class="chapter" data-level="5" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html"><i class="fa fa-check"></i><b>5</b> 使用 R Markdown 创建动态交互文档</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmarkdown-shiny"><i class="fa fa-check"></i><b>5.1</b> Web 交互界面：Shiny 小程序</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-start"><i class="fa fa-check"></i><b>5.1.1</b> 入门指南</a></li>
<li class="chapter" data-level="5.1.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-deploy"><i class="fa fa-check"></i><b>5.1.2</b> Shiny 部署</a></li>
<li class="chapter" data-level="5.1.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-app"><i class="fa fa-check"></i><b>5.1.3</b> 嵌入 Shiny 应用程序</a></li>
<li class="chapter" data-level="5.1.4" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-widget"><i class="fa fa-check"></i><b>5.1.4</b> Shiny 小部件</a></li>
<li class="chapter" data-level="5.1.5" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-link"><i class="fa fa-check"></i><b>5.1.5</b> Shiny 文档间的链接</a></li>
<li class="chapter" data-level="5.1.6" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#shiny-render"><i class="fa fa-check"></i><b>5.1.6</b> Shiny 文档的渲染</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmarkdown-dashboards"><i class="fa fa-check"></i><b>5.2</b> 交互式仪表盘：Dashboards</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-intro"><i class="fa fa-check"></i><b>5.2.1</b> Dashboards 入门</a></li>
<li class="chapter" data-level="5.2.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-layout"><i class="fa fa-check"></i><b>5.2.2</b> Dashboards 排版</a></li>
<li class="chapter" data-level="5.2.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-module"><i class="fa fa-check"></i><b>5.2.3</b> Dashboards 组件</a></li>
<li class="chapter" data-level="5.2.4" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#dashboards-shiny"><i class="fa fa-check"></i><b>5.2.4</b> Dashboards 与 Shiny</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#package-rmd"><i class="fa fa-check"></i><b>5.3</b> 在 R package 中使用 R Markdown</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmd-vignettes"><i class="fa fa-check"></i><b>5.3.1</b> 写软件包的文档</a></li>
<li class="chapter" data-level="5.3.2" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#package-template"><i class="fa fa-check"></i><b>5.3.2</b> R 包中的 R Markdown 模板</a></li>
<li class="chapter" data-level="5.3.3" data-path="rmarkdown-interaction.html"><a href="rmarkdown-interaction.html#rmd-auto"><i class="fa fa-check"></i><b>5.3.3</b> 定义一个自动化报告函数</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html"><i class="fa fa-check"></i><b>6</b> R Markdown 的操作技巧</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#table-advanced"><i class="fa fa-check"></i><b>6.1</b> 表格操作进阶</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#table-complex"><i class="fa fa-check"></i><b>6.1.1</b> 利用函数 <code>knitr::kable()</code> 生成复杂的表格</a></li>
<li class="chapter" data-level="6.1.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#kable-extra"><i class="fa fa-check"></i><b>6.1.2</b> 利用 <strong>kableExtra</strong> 美化表格</a></li>
<li class="chapter" data-level="6.1.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#else-table"><i class="fa fa-check"></i><b>6.1.3</b> 其它表格包</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-options"><i class="fa fa-check"></i><b>6.2</b> 块选项</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-variable"><i class="fa fa-check"></i><b>6.2.1</b> 在块选项中使用变量</a></li>
<li class="chapter" data-level="6.2.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-error"><i class="fa fa-check"></i><b>6.2.2</b> 如何在遇到 error 的时候继续编译</a></li>
<li class="chapter" data-level="6.2.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-output"><i class="fa fa-check"></i><b>6.2.3</b> 控制输出</a></li>
<li class="chapter" data-level="6.2.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-reformat"><i class="fa fa-check"></i><b>6.2.4</b> 重新格式化源代码</a></li>
<li class="chapter" data-level="6.2.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-leading"><i class="fa fa-check"></i><b>6.2.5</b> 调整文本输出中的前导符号</a></li>
<li class="chapter" data-level="6.2.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-property"><i class="fa fa-check"></i><b>6.2.6</b> 为文本输出块添加属性 (*)</a></li>
<li class="chapter" data-level="6.2.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-multiplot"><i class="fa fa-check"></i><b>6.2.7</b> 同一张图的多种图像输出格式</a></li>
<li class="chapter" data-level="6.2.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-process"><i class="fa fa-check"></i><b>6.2.8</b> 图像的后期加工 (*)</a></li>
<li class="chapter" data-level="6.2.9" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-highquality"><i class="fa fa-check"></i><b>6.2.9</b> 输出高质量的图像 (*)</a></li>
<li class="chapter" data-level="6.2.10" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-step-plot"><i class="fa fa-check"></i><b>6.2.10</b> 带有低级绘图功能的逐步绘图 (*)</a></li>
<li class="chapter" data-level="6.2.11" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-print"><i class="fa fa-check"></i><b>6.2.11</b> 在代码块中自定义对象的打印格式 (*)</a></li>
<li class="chapter" data-level="6.2.12" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#option-hook"><i class="fa fa-check"></i><b>6.2.12</b> 选项钩子 (*)</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#other-language"><i class="fa fa-check"></i><b>6.3</b> 与其他语言的结合</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#register-language"><i class="fa fa-check"></i><b>6.3.1</b> 注册自定义语言引擎 (*)</a></li>
<li class="chapter" data-level="6.3.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#python-rmd"><i class="fa fa-check"></i><b>6.3.2</b> 运行 Python 代码并与 Python 交互</a></li>
<li class="chapter" data-level="6.3.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-asis"><i class="fa fa-check"></i><b>6.3.3</b> 通过 <code>asis</code> 引擎有条件地执行内容</a></li>
<li class="chapter" data-level="6.3.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-shell"><i class="fa fa-check"></i><b>6.3.4</b> 执行 Shell 脚本</a></li>
<li class="chapter" data-level="6.3.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cat-file"><i class="fa fa-check"></i><b>6.3.5</b> 通过 cat 引擎将块内容写入文件</a></li>
<li class="chapter" data-level="6.3.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#sas-rmd"><i class="fa fa-check"></i><b>6.3.6</b> 运行 SAS 代码</a></li>
<li class="chapter" data-level="6.3.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#stata-rmd"><i class="fa fa-check"></i><b>6.3.7</b> 运行 Stata 代码</a></li>
<li class="chapter" data-level="6.3.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#asymptote-plot"><i class="fa fa-check"></i><b>6.3.8</b> 用渐近线 Asymptote 创建图形</a></li>
<li class="chapter" data-level="6.3.9" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#sass-scss"><i class="fa fa-check"></i><b>6.3.9</b> 使用 Sass/SCSS 构建 HTML 页面</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#output-hook"><i class="fa fa-check"></i><b>6.4</b> 输出钩子 (*)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#edit-source"><i class="fa fa-check"></i><b>6.4.1</b> 编辑源代码</a></li>
<li class="chapter" data-level="6.4.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#source-index"><i class="fa fa-check"></i><b>6.4.2</b> 向源代码中添加行号</a></li>
<li class="chapter" data-level="6.4.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#scrollable-output"><i class="fa fa-check"></i><b>6.4.3</b> 可滚动的文本输出</a></li>
<li class="chapter" data-level="6.4.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#truncated-output"><i class="fa fa-check"></i><b>6.4.4</b> 截断文本输出</a></li>
<li class="chapter" data-level="6.4.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#html5-plot"><i class="fa fa-check"></i><b>6.4.5</b> 以 HTML5 格式输出图像</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache"><i class="fa fa-check"></i><b>6.5</b> 缓存 (*)</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#chunk-cache"><i class="fa fa-check"></i><b>6.5.1</b> 缓存耗时的代码块</a></li>
<li class="chapter" data-level="6.5.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-path"><i class="fa fa-check"></i><b>6.5.2</b> 为多种输出格式缓存代码块</a></li>
<li class="chapter" data-level="6.5.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-lazy"><i class="fa fa-check"></i><b>6.5.3</b> 缓存大型的对象</a></li>
<li class="chapter" data-level="6.5.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#cache-rds"><i class="fa fa-check"></i><b>6.5.4</b> 一个更透明的缓存机制</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#other-trick"><i class="fa fa-check"></i><b>6.6</b> 其它使用 knitr 的小技巧 (*)</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#reuse-chunk"><i class="fa fa-check"></i><b>6.6.1</b> 重复使用代码块</a></li>
<li class="chapter" data-level="6.6.2" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#use-creat"><i class="fa fa-check"></i><b>6.6.2</b> 在创建对象之前使用它 (*)</a></li>
<li class="chapter" data-level="6.6.3" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#compile-exit"><i class="fa fa-check"></i><b>6.6.3</b> 提前退出编译</a></li>
<li class="chapter" data-level="6.6.4" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#plot-show-else"><i class="fa fa-check"></i><b>6.6.4</b> 控制图像显示位置</a></li>
<li class="chapter" data-level="6.6.5" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#modify-before"><i class="fa fa-check"></i><b>6.6.5</b> 修改之前代码块中的图像</a></li>
<li class="chapter" data-level="6.6.6" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#reuse-option"><i class="fa fa-check"></i><b>6.6.6</b> 复用块选项 (*)</a></li>
<li class="chapter" data-level="6.6.7" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#knit-expand"><i class="fa fa-check"></i><b>6.6.7</b> 使用 <code>knitr::knit_expand()</code> 来生成 Rmd 源代码</a></li>
<li class="chapter" data-level="6.6.8" data-path="rmarkdown-operation.html"><a href="rmarkdown-operation.html#repeat-label"><i class="fa fa-check"></i><b>6.6.8</b> 重复代码块标签 (*)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html"><i class="fa fa-check"></i><b>7</b> 使用 R Markdown 开展项目工作</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#project-manage"><i class="fa fa-check"></i><b>7.1</b> 使用 R Markdown 在工作中管理项目</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-r"><i class="fa fa-check"></i><b>7.1.1</b> 来自外部的 R 脚本</a></li>
<li class="chapter" data-level="7.1.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-read"><i class="fa fa-check"></i><b>7.1.2</b> 将外部脚本读取到一个块中</a></li>
<li class="chapter" data-level="7.1.3" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#external-multi"><i class="fa fa-check"></i><b>7.1.3</b> 从外部脚本读取多个代码块 (*)</a></li>
<li class="chapter" data-level="7.1.4" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#child-document"><i class="fa fa-check"></i><b>7.1.4</b> 子文档 (*)</a></li>
<li class="chapter" data-level="7.1.5" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#keep-plot"><i class="fa fa-check"></i><b>7.1.5</b> 保留图像文件</a></li>
<li class="chapter" data-level="7.1.6" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#chunk-directory"><i class="fa fa-check"></i><b>7.1.6</b> R 代码块的工作目录</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#work-flow"><i class="fa fa-check"></i><b>7.2</b> 使用 R Markdown 实现工作流</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#rstudio-shortcut"><i class="fa fa-check"></i><b>7.2.1</b> 使用 RStudio 键盘快捷键</a></li>
<li class="chapter" data-level="7.2.2" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#spell-check"><i class="fa fa-check"></i><b>7.2.2</b> R Markdown 的拼写检查</a></li>
<li class="chapter" data-level="7.2.3" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#render-rmd"><i class="fa fa-check"></i><b>7.2.3</b> 用 <code>rmarkdown::render()</code> 呈现 R Markdown</a></li>
<li class="chapter" data-level="7.2.4" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#parameterized-reports"><i class="fa fa-check"></i><b>7.2.4</b> 参数化的报告</a></li>
<li class="chapter" data-level="7.2.5" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#customize-button"><i class="fa fa-check"></i><b>7.2.5</b> 自定义 <code>Knit</code> 按钮 (*)</a></li>
<li class="chapter" data-level="7.2.6" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#google-drive"><i class="fa fa-check"></i><b>7.2.6</b> 通过 Google Drive 对 Rmd 文档进行协作</a></li>
<li class="chapter" data-level="7.2.7" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#workflowr-web"><i class="fa fa-check"></i><b>7.2.7</b> 用 <code>workflowr</code> 将 R Markdown 项目组织到一个研究网站上</a></li>
<li class="chapter" data-level="7.2.8" data-path="rmarkdown-project.html"><a href="rmarkdown-project.html#github-actions"><i class="fa fa-check"></i><b>7.2.8</b> 使用 GitHub Actions 实现自动化部署</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Markdown 指南</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rmarkdown-operation" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">第 6 章</span> R Markdown 的操作技巧<a href="rmarkdown-operation.html#rmarkdown-operation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="table-advanced" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> 表格操作进阶<a href="rmarkdown-operation.html#table-advanced" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在日常报告中，表格是展示结果的主要方式之一，例如下表展示了某中学某次考试的学生成绩：</p>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>然而，该成绩表并不美观，例如有些人习惯将内容居中，一般情况下给表格添加标题会更容易让人读懂，即得到表 <a href="rmarkdown-operation.html#tab:target-table">6.1</a> 的结果：</p>
<table>
<caption><span id="tab:target-table">表 6.1: </span>考试成绩</caption>
<thead>
<tr class="header">
<th align="center">姓名</th>
<th align="center">语文</th>
<th align="center">数学</th>
<th align="center">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">张三</td>
<td align="center">89</td>
<td align="center">93</td>
<td align="center">92</td>
</tr>
<tr class="even">
<td align="center">李四</td>
<td align="center">90</td>
<td align="center">97</td>
<td align="center">85</td>
</tr>
<tr class="odd">
<td align="center">王五</td>
<td align="center">85</td>
<td align="center">91</td>
<td align="center">97</td>
</tr>
</tbody>
</table>
<p>除了居中操作以及添加标题外，在制作表格时还会产生各种各样的特定需求，例如合并单元格、添加底色等。本节将系统地介绍在 R Markdown 中生成表格和进一步对其个性化的方法，主要包括下列内容：</p>
<ul>
<li><p>介绍表格生成函数 <code>knitr::kable()</code> 的所有特征；</p></li>
<li><p>使用 <strong>kableExtra</strong> <span class="citation">(<a href="#ref-R-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span> 包来展现更高级的个性化制作方法；</p></li>
<li><p>提供其它生成表格的 R 包以供读者参考。</p></li>
</ul>
<div id="table-complex" class="section level3 hasAnchor" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> 利用函数 <code>knitr::kable()</code> 生成复杂的表格<a href="rmarkdown-operation.html#table-complex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在 R Markdown 中，通常使用 <strong>knitr</strong> 包中的函数 <code>kable()</code> 来快速创建一个表格。<code>kable()</code> 可以处理数据框、矩阵等“矩形数据”，快速生成表格，而表格的外观则可以通过修改函数参数来自定义，下面将对这些参数进行介绍：</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="rmarkdown-operation.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(x, format, <span class="at">digits =</span> <span class="fu">getOption</span>(<span class="st">&quot;digits&quot;</span>),</span>
<span id="cb276-2"><a href="rmarkdown-operation.html#cb276-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">NA</span>, <span class="at">col.names =</span> <span class="cn">NA</span>, align, <span class="at">caption =</span> <span class="cn">NULL</span>,</span>
<span id="cb276-3"><a href="rmarkdown-operation.html#cb276-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="cn">NULL</span>, <span class="at">format.args =</span> <span class="fu">list</span>(), <span class="at">escape =</span> <span class="cn">TRUE</span>,</span>
<span id="cb276-4"><a href="rmarkdown-operation.html#cb276-4" aria-hidden="true" tabindex="-1"></a>    ...)</span></code></pre></div>
<div id="kable-formats" class="section level4 hasAnchor" number="6.1.1.1">
<h4><span class="header-section-number">6.1.1.1</span> 表格样式<a href="rmarkdown-operation.html#kable-formats" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在大多数情况下，如果只需要制作一个简单表格，<code>knitr::kable(x)</code> 就足够了。其中 <code>format</code> 参数会根据 <strong>knitr</strong> 源文档自动设置。它可能的取值是 <code>pipe</code> （列与列之间由短的竖线分隔的表），<code>simple</code> （仅包含横向分割线的简单表格），<code>latex</code> （LaTex 表格），<code>html</code> （HTML 表格），和 <code>rst</code> （reStructuredText 表格）。为了展示各个取值的不同，这里直接给出了各个取值在不同编程语言中的原始代码。</p>
<p>对于 R Markdown 文档，<code>kable()</code> 默认使用 <code>pipe</code> 格式的表格，输出结果如下所示：</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="rmarkdown-operation.html#cb277-1" aria-hidden="true" tabindex="-1"></a>grade <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb277-2"><a href="rmarkdown-operation.html#cb277-2" aria-hidden="true" tabindex="-1"></a>                    语文 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">89</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb277-3"><a href="rmarkdown-operation.html#cb277-3" aria-hidden="true" tabindex="-1"></a>                    数学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="dv">91</span>),</span>
<span id="cb277-4"><a href="rmarkdown-operation.html#cb277-4" aria-hidden="true" tabindex="-1"></a>                    英语 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">85</span>,<span class="dv">97</span>))</span>
<span id="cb277-5"><a href="rmarkdown-operation.html#cb277-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;pipe&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb278"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb278-1"><a href="rmarkdown-operation.html#cb278-1" aria-hidden="true" tabindex="-1"></a>|姓名 | 语文| 数学| 英语|</span>
<span id="cb278-2"><a href="rmarkdown-operation.html#cb278-2" aria-hidden="true" tabindex="-1"></a>|:----|----:|----:|----:|</span>
<span id="cb278-3"><a href="rmarkdown-operation.html#cb278-3" aria-hidden="true" tabindex="-1"></a>|张三 |   89|   93|   92|</span>
<span id="cb278-4"><a href="rmarkdown-operation.html#cb278-4" aria-hidden="true" tabindex="-1"></a>|李四 |   90|   97|   85|</span>
<span id="cb278-5"><a href="rmarkdown-operation.html#cb278-5" aria-hidden="true" tabindex="-1"></a>|王五 |   85|   91|   97|</span></code></pre></div>
<p>也可以生成一个（基于 Pandoc 的）简单的表格，或 HMTL、LaTex 以及 reStructuredText 格式的表格：</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="rmarkdown-operation.html#cb279-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;simple&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb280"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb280-1"><a href="rmarkdown-operation.html#cb280-1" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb280-2"><a href="rmarkdown-operation.html#cb280-2" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb280-3"><a href="rmarkdown-operation.html#cb280-3" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb280-4"><a href="rmarkdown-operation.html#cb280-4" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb280-5"><a href="rmarkdown-operation.html#cb280-5" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="rmarkdown-operation.html#cb281-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;html&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb282-1"><a href="rmarkdown-operation.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table&gt;</span></span>
<span id="cb282-2"><a href="rmarkdown-operation.html#cb282-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;thead&gt;</span></span>
<span id="cb282-3"><a href="rmarkdown-operation.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb282-4"><a href="rmarkdown-operation.html#cb282-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 姓名 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb282-5"><a href="rmarkdown-operation.html#cb282-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 语文 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb282-6"><a href="rmarkdown-operation.html#cb282-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 数学 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb282-7"><a href="rmarkdown-operation.html#cb282-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 英语 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb282-8"><a href="rmarkdown-operation.html#cb282-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb282-9"><a href="rmarkdown-operation.html#cb282-9" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;/thead&gt;</span></span>
<span id="cb282-10"><a href="rmarkdown-operation.html#cb282-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tbody&gt;</span></span>
<span id="cb282-11"><a href="rmarkdown-operation.html#cb282-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb282-12"><a href="rmarkdown-operation.html#cb282-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 张三 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-13"><a href="rmarkdown-operation.html#cb282-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 89 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-14"><a href="rmarkdown-operation.html#cb282-14" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 93 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-15"><a href="rmarkdown-operation.html#cb282-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 92 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-16"><a href="rmarkdown-operation.html#cb282-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb282-17"><a href="rmarkdown-operation.html#cb282-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb282-18"><a href="rmarkdown-operation.html#cb282-18" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 李四 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-19"><a href="rmarkdown-operation.html#cb282-19" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 90 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-20"><a href="rmarkdown-operation.html#cb282-20" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-21"><a href="rmarkdown-operation.html#cb282-21" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-22"><a href="rmarkdown-operation.html#cb282-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb282-23"><a href="rmarkdown-operation.html#cb282-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb282-24"><a href="rmarkdown-operation.html#cb282-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 王五 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-25"><a href="rmarkdown-operation.html#cb282-25" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-26"><a href="rmarkdown-operation.html#cb282-26" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 91 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-27"><a href="rmarkdown-operation.html#cb282-27" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb282-28"><a href="rmarkdown-operation.html#cb282-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb282-29"><a href="rmarkdown-operation.html#cb282-29" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/tbody&gt;</span></span>
<span id="cb282-30"><a href="rmarkdown-operation.html#cb282-30" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/table&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="rmarkdown-operation.html#cb283-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;latex&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb284"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb284-1"><a href="rmarkdown-operation.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb284-2"><a href="rmarkdown-operation.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb284-3"><a href="rmarkdown-operation.html#cb284-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb284-4"><a href="rmarkdown-operation.html#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb284-5"><a href="rmarkdown-operation.html#cb284-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb284-6"><a href="rmarkdown-operation.html#cb284-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb284-7"><a href="rmarkdown-operation.html#cb284-7" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb284-8"><a href="rmarkdown-operation.html#cb284-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb284-9"><a href="rmarkdown-operation.html#cb284-9" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb284-10"><a href="rmarkdown-operation.html#cb284-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb284-11"><a href="rmarkdown-operation.html#cb284-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="rmarkdown-operation.html#cb285-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="st">&#39;rst&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb286"><pre class="sourceCode rst"><code class="sourceCode rest"><span id="cb286-1"><a href="rmarkdown-operation.html#cb286-1" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span>
<span id="cb286-2"><a href="rmarkdown-operation.html#cb286-2" aria-hidden="true" tabindex="-1"></a>姓名  语文  数学  英语</span>
<span id="cb286-3"><a href="rmarkdown-operation.html#cb286-3" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span>
<span id="cb286-4"><a href="rmarkdown-operation.html#cb286-4" aria-hidden="true" tabindex="-1"></a>张三    89    93    92</span>
<span id="cb286-5"><a href="rmarkdown-operation.html#cb286-5" aria-hidden="true" tabindex="-1"></a>李四    90    97    85</span>
<span id="cb286-6"><a href="rmarkdown-operation.html#cb286-6" aria-hidden="true" tabindex="-1"></a>王五    85    91    97</span>
<span id="cb286-7"><a href="rmarkdown-operation.html#cb286-7" aria-hidden="true" tabindex="-1"></a>====  ====  ====  ====</span></code></pre></div>
<p>需要注意的是，只有 <code>pipe</code> 和 <code>simple</code> 格式是“可移植”的，也就是说，它们适用于任何输出文档的格式，而其他格式则只适用于特定的输出格式，例如，<code>format = 'latex'</code> 只适用于 LaTex 输出文档。使用特定的表格格式可以带来更多的自主控制能力，但代价是牺牲了可移植性。</p>
<p>如果在一个报告中，只需要一种非默认的表格格式，可以直接设置全局的 R 选项 <code>knitr.table.format</code>。例如若只需要 LaTex 格式的表格，则可以设置：</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="rmarkdown-operation.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.table.format =</span> <span class="st">&#39;latex&#39;</span>)</span></code></pre></div>
<p>这一选项也可以是一个返回格式字符串或 <code>NULL</code> 的函数。在 <code>NULL</code> 的情况下，<strong>knitr</strong> 将自动决定适当的格式。例如，可以只在输出格式为 LaTeX 时使用 <code>latex</code> 格式:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="rmarkdown-operation.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.table.format =</span> <span class="cf">function</span>() {</span>
<span id="cb288-2"><a href="rmarkdown-operation.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) <span class="st">&#39;latex&#39;</span> <span class="cf">else</span> <span class="st">&#39;pipe&#39;</span></span>
<span id="cb288-3"><a href="rmarkdown-operation.html#cb288-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="修改列名" class="section level4 hasAnchor" number="6.1.1.2">
<h4><span class="header-section-number">6.1.1.2</span> 修改列名<a href="rmarkdown-operation.html#修改列名" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- https://stackoverflow.com/questions/51432502/replace-column-names-in-kable-r-markdown/51444998#51444998 -->
<p>在一些情况下，在数据框（data frame）中定义的列的名称可能与想要显示给读者的内容不同，需要进行修改。在使用英文时，数据的列名通常不使用空格来分隔单词，而是使用点、下划线以及大小写来进行分隔。而在制作表格时，这样的变量名会显得有些不自然。在中文环境下，虽然空格的问题较少，但也存在变量名过长的情况，在 R 中也往往使用简化的名词或对应的英文简写来代替。在这种情况下，可以使用 <code>col.names</code> 参数将列名替换为一个包含新名称的向量，即 <code>col.names = c(...)</code>。例如，可以在上文成绩表的列名中提供更多信息：</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="rmarkdown-operation.html#cb289-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade,</span>
<span id="cb289-2"><a href="rmarkdown-operation.html#cb289-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">&#39;第1组&#39;</span>, <span class="fu">colnames</span>(grade))))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">第1组姓名</th>
<th align="right">第1组语文</th>
<th align="right">第1组数学</th>
<th align="right">第1组英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p><code>col.names</code> 参数可以接受任意的字符向量（不一定是通过 <code>paste0()</code> 等函数修改的列名），只要向量的长度等于数据对象的列数即可，例如可以把列名换成英文：</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="rmarkdown-operation.html#cb290-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade,</span>
<span id="cb290-2"><a href="rmarkdown-operation.html#cb290-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;Chinese&#39;</span>, <span class="st">&#39;Math&#39;</span>, <span class="st">&#39;English&#39;</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="right">Chinese</th>
<th align="right">Math</th>
<th align="right">English</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</div>
<div id="指定列的对齐方式" class="section level4 hasAnchor" number="6.1.1.3">
<h4><span class="header-section-number">6.1.1.3</span> 指定列的对齐方式<a href="rmarkdown-operation.html#指定列的对齐方式" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果想要改变表格中列的对齐方式，可以使用由字符 <code>l</code> （left，左对齐）、<code>c</code> （center，居中）以及 <code>r</code> （right，右对齐）组成的值向量或一个多字符的字符串来进行对齐，即 <code>kable(..., align = c('c', 'l'))</code> 和 <code>kable(..., align = 'cl')</code> 是等价的。在默认情况下，数字列是右对齐的，其他列是左对齐的。例如可以对成绩表进行调整，使得前两列右对齐，后两列左对齐：</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="rmarkdown-operation.html#cb291-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;rrll&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">姓名</th>
<th align="right">语文</th>
<th align="left">数学</th>
<th align="left">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">张三</td>
<td align="right">89</td>
<td align="left">93</td>
<td align="left">92</td>
</tr>
<tr class="even">
<td align="right">李四</td>
<td align="right">90</td>
<td align="left">97</td>
<td align="left">85</td>
</tr>
<tr class="odd">
<td align="right">王五</td>
<td align="right">85</td>
<td align="left">91</td>
<td align="left">97</td>
</tr>
</tbody>
</table>
<p>而当对齐方式统一时，也可以用一个字母来代替，例如可以把成绩表所有列都居中表示：</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="rmarkdown-operation.html#cb292-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;c&#39;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="center">姓名</th>
<th align="center">语文</th>
<th align="center">数学</th>
<th align="center">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">张三</td>
<td align="center">89</td>
<td align="center">93</td>
<td align="center">92</td>
</tr>
<tr class="even">
<td align="center">李四</td>
<td align="center">90</td>
<td align="center">97</td>
<td align="center">85</td>
</tr>
<tr class="odd">
<td align="center">王五</td>
<td align="center">85</td>
<td align="center">91</td>
<td align="center">97</td>
</tr>
</tbody>
</table>
</div>
<div id="kable-caption" class="section level4 hasAnchor" number="6.1.1.4">
<h4><span class="header-section-number">6.1.1.4</span> 添加表格标题<a href="rmarkdown-operation.html#kable-caption" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>给表格添加标题需要用到 <code>caption</code> 参数，如表 <a href="rmarkdown-operation.html#tab:kable-cap">6.2</a> 所示：</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="rmarkdown-operation.html#cb293-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&#39;考试成绩&#39;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:kable-cap">表 6.2: </span>考试成绩</caption>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>正如本书 <a href="rmarkdown-base.html#cross-reference">2.8.7</a> 节所提到的那样，当一个表格有标题并且以 <strong>bookdown</strong> 来输出格式时，它可以被交叉引用，而在基础的 <code>html_document</code> 和 <code>pdf_document</code> 中则不行。</p>
</div>
<div id="调整数字格式" class="section level4 hasAnchor" number="6.1.1.5">
<h4><span class="header-section-number">6.1.1.5</span> 调整数字格式<a href="rmarkdown-operation.html#调整数字格式" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有的时候，表格中的数字位数很长，展示的时候需要缩短，这时可以通过 <code>digits</code> 参数（会被传递给 <code>round()</code> 函数）来设置最大的小数位数，以及通过 <code>format.args</code>（会被传递给 R 中的 <code>format()</code> 函数）来设置其他格式化参数。</p>
<p>首先是几个简单的 <code>round()</code> 和 <code>format()</code> 的例子，从而可以更好地理解之后的 <code>kable()</code> 中 <code>digits</code> 参数是如何工作的:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="rmarkdown-operation.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="dv">0</span>)</span>
<span id="cb294-2"><a href="rmarkdown-operation.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1</span></span>
<span id="cb294-3"><a href="rmarkdown-operation.html#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb294-4"><a href="rmarkdown-operation.html#cb294-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.2</span></span>
<span id="cb294-5"><a href="rmarkdown-operation.html#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">1.234567</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb294-6"><a href="rmarkdown-operation.html#cb294-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 1.235</span></span>
<span id="cb294-7"><a href="rmarkdown-operation.html#cb294-7" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="dv">1000</span>, <span class="at">scientific =</span> <span class="cn">TRUE</span>)</span>
<span id="cb294-8"><a href="rmarkdown-operation.html#cb294-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;1e+03&quot;</span></span>
<span id="cb294-9"><a href="rmarkdown-operation.html#cb294-9" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fl">10000.123</span>, <span class="at">big.mark =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb294-10"><a href="rmarkdown-operation.html#cb294-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;10,000.12&quot;</span></span></code></pre></div>
<p>可以将数字四舍五入并格式化成表格：</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="rmarkdown-operation.html#cb295-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">cbind</span>(<span class="at">X1 =</span> <span class="fu">runif</span>(<span class="dv">3</span>),</span>
<span id="cb295-2"><a href="rmarkdown-operation.html#cb295-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">X2 =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>),</span>
<span id="cb295-3"><a href="rmarkdown-operation.html#cb295-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">X3 =</span> <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1000</span>))</span>
<span id="cb295-4"><a href="rmarkdown-operation.html#cb295-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-5"><a href="rmarkdown-operation.html#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 保留最多四位小数</span></span>
<span id="cb295-6"><a href="rmarkdown-operation.html#cb295-6" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">4</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4513</td>
<td align="right">1e+03</td>
<td align="right">-300.9029</td>
</tr>
<tr class="even">
<td align="right">0.7838</td>
<td align="right">1e+05</td>
<td align="right">528.2758</td>
</tr>
<tr class="odd">
<td align="right">0.7097</td>
<td align="right">1e+07</td>
<td align="right">-622.8860</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="rmarkdown-operation.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 每列分别设置</span></span>
<span id="cb296-2"><a href="rmarkdown-operation.html#cb296-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.45127</td>
<td align="right">1e+03</td>
<td align="right">-300.90</td>
</tr>
<tr class="even">
<td align="right">0.78378</td>
<td align="right">1e+05</td>
<td align="right">528.28</td>
</tr>
<tr class="odd">
<td align="right">0.70968</td>
<td align="right">1e+07</td>
<td align="right">-622.89</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="rmarkdown-operation.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 不使用科学计数法</span></span>
<span id="cb297-2"><a href="rmarkdown-operation.html#cb297-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb297-3"><a href="rmarkdown-operation.html#cb297-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">scientific =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.451</td>
<td align="right">1000</td>
<td align="right">-300.903</td>
</tr>
<tr class="even">
<td align="right">0.784</td>
<td align="right">100000</td>
<td align="right">528.276</td>
</tr>
<tr class="odd">
<td align="right">0.710</td>
<td align="right">10000000</td>
<td align="right">-622.886</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="rmarkdown-operation.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 给 big numbers 添加逗号</span></span>
<span id="cb298-2"><a href="rmarkdown-operation.html#cb298-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb298-3"><a href="rmarkdown-operation.html#cb298-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">format.args =</span> <span class="fu">list</span>(<span class="at">big.mark =</span> <span class="st">&#39;,&#39;</span>,</span>
<span id="cb298-4"><a href="rmarkdown-operation.html#cb298-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.451</td>
<td align="right">1,000</td>
<td align="right">-300.903</td>
</tr>
<tr class="even">
<td align="right">0.784</td>
<td align="right">100,000</td>
<td align="right">528.276</td>
</tr>
<tr class="odd">
<td align="right">0.710</td>
<td align="right">10,000,000</td>
<td align="right">-622.886</td>
</tr>
</tbody>
</table>
</div>
<div id="显示缺失值" class="section level4 hasAnchor" number="6.1.1.6">
<h4><span class="header-section-number">6.1.1.6</span> 显示缺失值<a href="rmarkdown-operation.html#显示缺失值" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有的时候，表中可能会存在缺失值，如该学生没有缺考或没有选修某个课。在默认情况下，R 中缺失值（如<code>NA</code>）在表格中显示为字符串<code>NA</code>，如：</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="rmarkdown-operation.html#cb299-1" aria-hidden="true" tabindex="-1"></a>grade2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb299-2"><a href="rmarkdown-operation.html#cb299-2" aria-hidden="true" tabindex="-1"></a>                     物理 <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb299-3"><a href="rmarkdown-operation.html#cb299-3" aria-hidden="true" tabindex="-1"></a>                     政治 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="cn">NA</span>),</span>
<span id="cb299-4"><a href="rmarkdown-operation.html#cb299-4" aria-hidden="true" tabindex="-1"></a>                     计算机 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="cn">NA</span>,<span class="dv">97</span>))</span>
<span id="cb299-5"><a href="rmarkdown-operation.html#cb299-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)  <span class="co"># 默认显示 NA</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">NA</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">NA</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<p>为了表格美观，也可以使用其他的值来替换它们，或者通过使用全局 R 选项 <code>knitr.kable.NA</code>来调整显示的内容（例如使<code>NA</code>对应的单元格为空）。例如，可以将下面第一个表中的<code>NA</code>单元格设为空，然后在第二个表中显示<code>**</code>：</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="rmarkdown-operation.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用空值代替 NA</span></span>
<span id="cb300-2"><a href="rmarkdown-operation.html#cb300-2" aria-hidden="true" tabindex="-1"></a>opts <span class="ot">=</span> <span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>)</span>
<span id="cb300-3"><a href="rmarkdown-operation.html#cb300-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right"></td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right"></td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="rmarkdown-operation.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用指定字符（**） 代替 NA</span></span>
<span id="cb301-2"><a href="rmarkdown-operation.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.kable.NA =</span> <span class="st">&#39;**&#39;</span>)</span>
<span id="cb301-3"><a href="rmarkdown-operation.html#cb301-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade2)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">**</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">**</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">**</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="rmarkdown-operation.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(opts)  <span class="co"># 恢复全局 R 选项</span></span></code></pre></div>
</div>
<div id="转义特殊字符" class="section level4 hasAnchor" number="6.1.1.7">
<h4><span class="header-section-number">6.1.1.7</span> 转义特殊字符<a href="rmarkdown-operation.html#转义特殊字符" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>HTML 或者 LaTeX 对应的编程语言之中包含了一些特殊的字符，例如在 LaTeX 中输入公式可能需要的 <code>$</code> 等。为了使结果能够正常输出，<code>kable()</code> 将默认通过参数 <code>escape = TRUE</code> 来“转义”这些特殊字符，即令这些特殊字符失去其特殊含义，使得所有的字符可以逐字生成，而不会生成特殊符号（如 <code>\beta</code> 将不会自动显示为 <span class="math inline">\(\beta\)</span>）。例如对于 HTML 格式的表格，<code>&gt;</code> 将被替换为 <code>&amp;gt;</code>；而对于 LaTeX 格式的表格，<code>_</code> 将被转义为 <code>\_</code> <a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>。</p>
<p>如果接触过这些字符，并且知道如何正确使用它们，那么可以通过 <code>escape = FALSE</code> 来禁用这个参数，但要注意必须确保特殊字符不会在 LaTeX 或 HTML 中触发语法错误。表 <a href="rmarkdown-operation.html#tab:latex-math-escape">6.3</a> 展示了转义之后的结果，表 <a href="rmarkdown-operation.html#tab:latex-math">6.4</a> 则展示了一些包含特殊字符（<code>$</code>、<code>\</code> 以及 <code>_</code>）的 LaTeX 数学表达式：</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="rmarkdown-operation.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加数学表达式</span></span>
<span id="cb303-2"><a href="rmarkdown-operation.html#cb303-2" aria-hidden="true" tabindex="-1"></a>g_range <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(成绩范围 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 90$&quot;</span>,<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 80$&quot;</span>,</span>
<span id="cb303-3"><a href="rmarkdown-operation.html#cb303-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">ge 70$&quot;</span>),</span>
<span id="cb303-4"><a href="rmarkdown-operation.html#cb303-4" aria-hidden="true" tabindex="-1"></a>                    语文 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">10</span>,<span class="dv">20</span>),</span>
<span id="cb303-5"><a href="rmarkdown-operation.html#cb303-5" aria-hidden="true" tabindex="-1"></a>                    数学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">16</span>),</span>
<span id="cb303-6"><a href="rmarkdown-operation.html#cb303-6" aria-hidden="true" tabindex="-1"></a>                    英语 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">20</span>))</span>
<span id="cb303-7"><a href="rmarkdown-operation.html#cb303-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(g_range) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;成绩范围&quot;</span>,</span>
<span id="cb303-8"><a href="rmarkdown-operation.html#cb303-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$Chinese_{Jan}$&quot;</span>,</span>
<span id="cb303-9"><a href="rmarkdown-operation.html#cb303-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$Math_{Jan}$&quot;</span>,</span>
<span id="cb303-10"><a href="rmarkdown-operation.html#cb303-10" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&quot;$English_{Jan}$&quot;</span>)</span>
<span id="cb303-11"><a href="rmarkdown-operation.html#cb303-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range, <span class="at">escape =</span> <span class="cn">TRUE</span>,</span>
<span id="cb303-12"><a href="rmarkdown-operation.html#cb303-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;escape = TRUE 生成的表&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:latex-math-escape">表 6.3: </span>escape = TRUE 生成的表</caption>
<thead>
<tr class="header">
<th align="left">成绩范围</th>
<th align="right"><span class="math inline">\(Chinese_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(Math_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(English_{Jan}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 90\)</span></td>
<td align="right">6</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\ge 80\)</span></td>
<td align="right">10</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 70\)</span></td>
<td align="right">20</td>
<td align="right">16</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="rmarkdown-operation.html#cb304-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range, <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb304-2"><a href="rmarkdown-operation.html#cb304-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;escape = FALSE 生成的表&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:latex-math">表 6.4: </span>escape = FALSE 生成的表</caption>
<thead>
<tr class="header">
<th align="left">成绩范围</th>
<th align="right"><span class="math inline">\(Chinese_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(Math_{Jan}\)</span></th>
<th align="right"><span class="math inline">\(English_{Jan}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 90\)</span></td>
<td align="right">6</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\ge 80\)</span></td>
<td align="right">10</td>
<td align="right">7</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\ge 70\)</span></td>
<td align="right">20</td>
<td align="right">16</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>如表 <a href="rmarkdown-operation.html#tab:latex-math-escape">6.3</a> 所示，如果设置 <code>escape = TRUE</code>，特殊字符将被转义或替换。例如，在 LaTeX 格式的表格中，<code>$</code> 会被转义为 <code>\$</code>、<code>_</code> 被转义为 <code>\_</code> 以及 <code>\</code> 被替换为 <code>\textbackslash{}</code>：</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="rmarkdown-operation.html#cb305-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(g_range[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">escape =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb306-1"><a href="rmarkdown-operation.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r}</span>
<span id="cb306-2"><a href="rmarkdown-operation.html#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb306-3"><a href="rmarkdown-operation.html#cb306-3" aria-hidden="true" tabindex="-1"></a>成绩范围 <span class="op">&amp;</span> <span class="fu">\$</span>Chinese<span class="fu">\_\{</span>Jan<span class="fu">\}\$\\</span></span>
<span id="cb306-4"><a href="rmarkdown-operation.html#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb306-5"><a href="rmarkdown-operation.html#cb306-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 90<span class="fu">\$</span> <span class="op">&amp;</span> 6<span class="fu">\\</span></span>
<span id="cb306-6"><a href="rmarkdown-operation.html#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb306-7"><a href="rmarkdown-operation.html#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 80<span class="fu">\$</span> <span class="op">&amp;</span> 10<span class="fu">\\</span></span>
<span id="cb306-8"><a href="rmarkdown-operation.html#cb306-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb306-9"><a href="rmarkdown-operation.html#cb306-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\$\textbackslash</span>{}ge 70<span class="fu">\$</span> <span class="op">&amp;</span> 20<span class="fu">\\</span></span>
<span id="cb306-10"><a href="rmarkdown-operation.html#cb306-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb306-11"><a href="rmarkdown-operation.html#cb306-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>其他 LaTeX 中常见的特殊字符包括<code>#</code>、<code>%</code>、<code>&amp;</code>、<code>{</code> 以及 <code>}</code>；HTML 中常见的特殊字符包括<code>&amp;</code>、<code>&lt;</code>、 <code>&gt;</code> 以及 <code>"</code>。在生成带有 <code>escape = FALSE</code> 的表格时，需要格外小心并确保正确地使用了特殊字符。一个常见的错误是在使用 <code>escape = FALSE</code> 时，在 LaTeX 表格的列名或标题中包含 <code>%</code> 或 <code>_</code> 等字符，而没有意识到它们是特殊的字符。</p>
<p>如果想知道 <code>escape = TRUE</code> 参数会如何转义特殊字符，可以通过 <strong>knitr</strong> 中两个内部辅助函数 <code>escape_latex</code> 和 <code>escape_html</code> 来分别查询在 LaTeX 和 HTML 格式的表格中的转义结果：。下面是一些例子：</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="rmarkdown-operation.html#cb307-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">:::</span><span class="fu">escape_latex</span>(<span class="fu">c</span>(<span class="st">&#39;100%&#39;</span>, <span class="st">&#39;# 一个观点&#39;</span>, <span class="st">&#39;文字_1&#39;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;100\\%&quot;       &quot;\\# 一个观点&quot; &quot;文字\\_1&quot;</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="rmarkdown-operation.html#cb309-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">:::</span><span class="fu">escape_html</span>(<span class="fu">c</span>(<span class="st">&#39;&lt;address&gt;&#39;</span>, <span class="st">&#39;x = &quot;字符&quot;&#39;</span>, <span class="st">&#39;a &amp; b&#39;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;&amp;lt;address&amp;gt;&quot;      &quot;x = &amp;quot;字符&amp;quot;&quot; &quot;a &amp;amp; b&quot;</code></pre>
</div>
<div id="多张表格并排" class="section level4 hasAnchor" number="6.1.1.8">
<h4><span class="header-section-number">6.1.1.8</span> 多张表格并排<a href="rmarkdown-operation.html#多张表格并排" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有的时候，将多张表格并排放置可以便于比较，将数据框或矩阵以列表的形式传递给 <code>kable()</code> 就可以实现这一功能。例如，表 <a href="rmarkdown-operation.html#tab:two-tables">6.5</a> 包含了之前展示过的两张表：</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="rmarkdown-operation.html#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据对象 grade 和 grade2 由之前的代码块生成</span></span>
<span id="cb311-2"><a href="rmarkdown-operation.html#cb311-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb311-3"><a href="rmarkdown-operation.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(grade, grade2),</span>
<span id="cb311-4"><a href="rmarkdown-operation.html#cb311-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;两张表并排放置&#39;</span>,</span>
<span id="cb311-5"><a href="rmarkdown-operation.html#cb311-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">booktabs =</span> <span class="cn">TRUE</span>, <span class="at">valign =</span> <span class="st">&#39;t&#39;</span></span>
<span id="cb311-6"><a href="rmarkdown-operation.html#cb311-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
<span id="tab:two-tables">表 6.5: </span>两张表并排放置
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">语文</th>
<th align="right">数学</th>
<th align="right">英语</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="left">姓名</th>
<th align="right">物理</th>
<th align="right">政治</th>
<th align="right">计算机</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">NA</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">NA</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>需要注意的是，此功能仅适用于 HTML 和 PDF 格式的输出。</p>
<p>另外，如果在并排放置各个表的时候，想能够分别自定义它们，可以使用 <code>kables()</code> 函数（即 <code>kable()</code> 的复数形式），并将一个对象为 <code>kable()</code> 的列表传递给它。例如，在表 <a href="rmarkdown-operation.html#tab:kables">6.6</a> 中，可以更改左表中的列名，并将右表中的小数点位数设置为 4：</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="rmarkdown-operation.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据对象 grade 和 d 由之前的代码块生成</span></span>
<span id="cb312-2"><a href="rmarkdown-operation.html#cb312-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kables</span>(</span>
<span id="cb312-3"><a href="rmarkdown-operation.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb312-4"><a href="rmarkdown-operation.html#cb312-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 第一个 kable()：修改列名</span></span>
<span id="cb312-5"><a href="rmarkdown-operation.html#cb312-5" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb312-6"><a href="rmarkdown-operation.html#cb312-6" aria-hidden="true" tabindex="-1"></a>      grade,</span>
<span id="cb312-7"><a href="rmarkdown-operation.html#cb312-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&#39;Name&#39;</span>, <span class="st">&#39;Chinese&#39;</span>, <span class="st">&#39;Math&#39;</span>, <span class="st">&#39;English&#39;</span>),</span>
<span id="cb312-8"><a href="rmarkdown-operation.html#cb312-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">valign =</span> <span class="st">&#39;t&#39;</span></span>
<span id="cb312-9"><a href="rmarkdown-operation.html#cb312-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb312-10"><a href="rmarkdown-operation.html#cb312-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 第二个 kable()：设置 digits 选项</span></span>
<span id="cb312-11"><a href="rmarkdown-operation.html#cb312-11" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(d, <span class="at">digits =</span> <span class="dv">4</span>, <span class="at">valign =</span> <span class="st">&#39;t&#39;</span>)</span>
<span id="cb312-12"><a href="rmarkdown-operation.html#cb312-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb312-13"><a href="rmarkdown-operation.html#cb312-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;由 knitr::kables() 生成的两张表&#39;</span></span>
<span id="cb312-14"><a href="rmarkdown-operation.html#cb312-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table class="kable_wrapper">
<caption>
<span id="tab:kables">表 6.6: </span>由 knitr::kables() 生成的两张表
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="right">Chinese</th>
<th align="right">Math</th>
<th align="right">English</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">张三</td>
<td align="right">89</td>
<td align="right">93</td>
<td align="right">92</td>
</tr>
<tr class="even">
<td align="left">李四</td>
<td align="right">90</td>
<td align="right">97</td>
<td align="right">85</td>
</tr>
<tr class="odd">
<td align="left">王五</td>
<td align="right">85</td>
<td align="right">91</td>
<td align="right">97</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr class="header">
<th align="right">X1</th>
<th align="right">X2</th>
<th align="right">X3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.4513</td>
<td align="right">1e+03</td>
<td align="right">-300.9029</td>
</tr>
<tr class="even">
<td align="right">0.7838</td>
<td align="right">1e+05</td>
<td align="right">528.2758</td>
</tr>
<tr class="odd">
<td align="right">0.7097</td>
<td align="right">1e+07</td>
<td align="right">-622.8860</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div id="利用-for-循环生成多个表" class="section level4 hasAnchor" number="6.1.1.9">
<h4><span class="header-section-number">6.1.1.9</span> 利用 <code>for</code> 循环生成多个表 (*)<a href="rmarkdown-operation.html#利用-for-循环生成多个表" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>结合 <code>for</code> 循环与 <code>kable()</code> 生成多张表时，有一点需要额外注意。必须在迭代中用 <code>print()</code> 显示打印 <code>kable()</code> 的结果，并应用块选项 <code>results = 'asis'</code>，例如：</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb313-1"><a href="rmarkdown-operation.html#cb313-1" aria-hidden="true" tabindex="-1"></a>```{r, results=&#39;asis&#39;}</span>
<span id="cb313-2"><a href="rmarkdown-operation.html#cb313-2" aria-hidden="true" tabindex="-1"></a>for (i in 1:3) {</span>
<span id="cb313-3"><a href="rmarkdown-operation.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  print(knitr::kable(grade))</span>
<span id="cb313-4"><a href="rmarkdown-operation.html#cb313-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb313-5"><a href="rmarkdown-operation.html#cb313-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>而下面的代码块只会在文档中输出最后一张表：</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb314-1"><a href="rmarkdown-operation.html#cb314-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb314-2"><a href="rmarkdown-operation.html#cb314-2" aria-hidden="true" tabindex="-1"></a>for (i in 1:3) {</span>
<span id="cb314-3"><a href="rmarkdown-operation.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  knitr::kable(grade)</span>
<span id="cb314-4"><a href="rmarkdown-operation.html#cb314-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb314-5"><a href="rmarkdown-operation.html#cb314-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>这个问题并不特定于 <code>kable()</code>，同时也存在于许多其他的 R 包中。其背后原因较为复杂,对技术细节感兴趣的读者可以参考博文 <a href="https://yihui.org/en/2017/06/top-level-r-expressions/">“The Ghost Printer behind Top-level R Expressions.”</a></p>
<p>需要生成多个表格时，最好添加一些换行符（<code>\n</code>）或 HTML 注释（<code>&lt;!-- --&gt;</code>），从而清晰地分隔所有输出的元素，例如：</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb315-1"><a href="rmarkdown-operation.html#cb315-1" aria-hidden="true" tabindex="-1"></a>```{r, results=&#39;asis&#39;}</span>
<span id="cb315-2"><a href="rmarkdown-operation.html#cb315-2" aria-hidden="true" tabindex="-1"></a>for (i in 1:3) {</span>
<span id="cb315-3"><a href="rmarkdown-operation.html#cb315-3" aria-hidden="true" tabindex="-1"></a>  print(knitr::kable(grade, caption = &#39;标题&#39;))</span>
<span id="cb315-4"><a href="rmarkdown-operation.html#cb315-4" aria-hidden="true" tabindex="-1"></a>  cat(&#39;\n\n&lt;!-- --&gt;\n\n&#39;)</span>
<span id="cb315-5"><a href="rmarkdown-operation.html#cb315-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb315-6"><a href="rmarkdown-operation.html#cb315-6" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>如果没有这些分隔符，Pandoc 可能无法检测到某些元素。例如，当一个图片之后面紧跟着一个表格时，这个表格并不会被识别到：</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb316-1"><a href="rmarkdown-operation.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb316-2"><a href="rmarkdown-operation.html#cb316-2" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb316-3"><a href="rmarkdown-operation.html#cb316-3" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb316-4"><a href="rmarkdown-operation.html#cb316-4" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb316-5"><a href="rmarkdown-operation.html#cb316-5" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb316-6"><a href="rmarkdown-operation.html#cb316-6" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<p>解决办法是用空行或注释分隔图片和表格，例如：</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb317-1"><a href="rmarkdown-operation.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb317-2"><a href="rmarkdown-operation.html#cb317-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-3"><a href="rmarkdown-operation.html#cb317-3" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb317-4"><a href="rmarkdown-operation.html#cb317-4" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb317-5"><a href="rmarkdown-operation.html#cb317-5" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb317-6"><a href="rmarkdown-operation.html#cb317-6" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb317-7"><a href="rmarkdown-operation.html#cb317-7" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
<p>或者</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb318-1"><a href="rmarkdown-operation.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="al">![](logo.png)</span></span>
<span id="cb318-2"><a href="rmarkdown-operation.html#cb318-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-3"><a href="rmarkdown-operation.html#cb318-3" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- --&gt;</span></span>
<span id="cb318-4"><a href="rmarkdown-operation.html#cb318-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-5"><a href="rmarkdown-operation.html#cb318-5" aria-hidden="true" tabindex="-1"></a>姓名    语文   数学   英语</span>
<span id="cb318-6"><a href="rmarkdown-operation.html#cb318-6" aria-hidden="true" tabindex="-1"></a>-----  -----  -----  -----</span>
<span id="cb318-7"><a href="rmarkdown-operation.html#cb318-7" aria-hidden="true" tabindex="-1"></a>张三      89     93     92</span>
<span id="cb318-8"><a href="rmarkdown-operation.html#cb318-8" aria-hidden="true" tabindex="-1"></a>李四      90     97     85</span>
<span id="cb318-9"><a href="rmarkdown-operation.html#cb318-9" aria-hidden="true" tabindex="-1"></a>王五      85     91     97</span></code></pre></div>
</div>
<div id="自定义-latex-表格" class="section level4 hasAnchor" number="6.1.1.10">
<h4><span class="header-section-number">6.1.1.10</span> 自定义 LaTeX 表格 (*)<a href="rmarkdown-operation.html#自定义-latex-表格" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果只需要 LaTeX 格式的输出时，可以在 <code>kable()</code> 中使用一些额外的选项。注意在其他类型的输出中（如 HTML），这些选项将被忽略。除非已经设置了全局的表格格式选项（见本书 <a href="rmarkdown-operation.html#kable-formats">6.1.1.1</a> 节），否则必须像本节的例子那样使用 <code>kable()</code> 的 <code>format</code> 参数，例如：</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="rmarkdown-operation.html#cb319-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>带标题的表格（见本书 <a href="rmarkdown-operation.html#kable-caption">6.1.1.4</a> 节）会被放入 <code>table</code> 环境中，即：</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode latex"><code class="sourceCode latex"><span id="cb320-1"><a href="rmarkdown-operation.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">table</span>}</span>
<span id="cb320-2"><a href="rmarkdown-operation.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="co">% 表格 (通常为 tabular 环境)</span></span>
<span id="cb320-3"><a href="rmarkdown-operation.html#cb320-3" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">table</span>}</span></code></pre></div>
<p>不同的环境有不同的默认排版方式，例如 LaTeX 会对 <code>table</code> 及 <code>figure</code> 等环境采用浮动布局。可以通过 <code>table.envir</code> 参数来对环境进行调整：</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="rmarkdown-operation.html#cb321-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">table.envir =</span> <span class="st">&#39;Table&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb322"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb322-1"><a href="rmarkdown-operation.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">Table</span>}</span>
<span id="cb322-2"><a href="rmarkdown-operation.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb322-3"><a href="rmarkdown-operation.html#cb322-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb322-4"><a href="rmarkdown-operation.html#cb322-4" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb322-5"><a href="rmarkdown-operation.html#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb322-6"><a href="rmarkdown-operation.html#cb322-6" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb322-7"><a href="rmarkdown-operation.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb322-8"><a href="rmarkdown-operation.html#cb322-8" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb322-9"><a href="rmarkdown-operation.html#cb322-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb322-10"><a href="rmarkdown-operation.html#cb322-10" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb322-11"><a href="rmarkdown-operation.html#cb322-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb322-12"><a href="rmarkdown-operation.html#cb322-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span>
<span id="cb322-13"><a href="rmarkdown-operation.html#cb322-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">Table</span>}</span></code></pre></div>
<p>表格的位置由参数 <code>position</code> 来控制。例如，可以通过 <code>position = "!b"</code> 来强制将表格固定到页面的底部：</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="rmarkdown-operation.html#cb323-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>,</span>
<span id="cb323-2"><a href="rmarkdown-operation.html#cb323-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">table.envir =</span> <span class="st">&#39;table&#39;</span>, <span class="at">position =</span> <span class="st">&#39;!b&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb324"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb324-1"><a href="rmarkdown-operation.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">table</span>}[!b]</span>
<span id="cb324-2"><a href="rmarkdown-operation.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{l|r|r|r}</span>
<span id="cb324-3"><a href="rmarkdown-operation.html#cb324-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb324-4"><a href="rmarkdown-operation.html#cb324-4" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb324-5"><a href="rmarkdown-operation.html#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb324-6"><a href="rmarkdown-operation.html#cb324-6" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb324-7"><a href="rmarkdown-operation.html#cb324-7" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb324-8"><a href="rmarkdown-operation.html#cb324-8" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb324-9"><a href="rmarkdown-operation.html#cb324-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb324-10"><a href="rmarkdown-operation.html#cb324-10" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb324-11"><a href="rmarkdown-operation.html#cb324-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\hline</span></span>
<span id="cb324-12"><a href="rmarkdown-operation.html#cb324-12" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span>
<span id="cb324-13"><a href="rmarkdown-operation.html#cb324-13" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">table</span>}</span></code></pre></div>
<p>当表格有标题时，也可以通过 <code>caption.short</code> 参数给它分配一个短的标题，例如：</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="rmarkdown-operation.html#cb325-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&#39;一个很长很长的标题！&#39;</span>,</span>
<span id="cb325-2"><a href="rmarkdown-operation.html#cb325-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption.short =</span> <span class="st">&#39;短标题&#39;</span>)</span></code></pre></div>
<p>短标题将会进入 LaTeX 中 <code>\caption[]{}</code> 命令的方括号中，经常在 PDF 输出文档的表格目录中使用（如果不提供短标题，那里则会显示完整的标题）。</p>
<p><code>booktabs = TRUE</code> 可以使用 LaTeX 包 <a href="https://ctan.org/pkg/booktabs"><strong>booktabs</strong></a>{LaTeX package!booktabs} 进行表格排版。</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="rmarkdown-operation.html#cb326-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb327"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb327-1"><a href="rmarkdown-operation.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{lrrr}</span>
<span id="cb327-2"><a href="rmarkdown-operation.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\toprule</span></span>
<span id="cb327-3"><a href="rmarkdown-operation.html#cb327-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb327-4"><a href="rmarkdown-operation.html#cb327-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\midrule</span></span>
<span id="cb327-5"><a href="rmarkdown-operation.html#cb327-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb327-6"><a href="rmarkdown-operation.html#cb327-6" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb327-7"><a href="rmarkdown-operation.html#cb327-7" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb327-8"><a href="rmarkdown-operation.html#cb327-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\bottomrule</span></span>
<span id="cb327-9"><a href="rmarkdown-operation.html#cb327-9" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>需要注意的是，当在 R Markdown 文档中需要额外的 LaTeX 包时（如 <strong>booktabs</strong>），必须在 YAML 中声明这些包（请参阅第 <a href="rmarkdown-document.html#pdf-latex">3.2.4</a> 节了解如何声明）。</p>
<!--**【！！！现有目录需要补充】**-->
<!-- pdf content -->
<div class="cols">
<div class="col">
<div class="sourceCode" id="cb328"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb328-1"><a href="rmarkdown-operation.html#cb328-1" aria-hidden="true" tabindex="-1"></a>```{r booktabs-false, include=knitr::is_latex_output()}</span>
<span id="cb328-2"><a href="rmarkdown-operation.html#cb328-2" aria-hidden="true" tabindex="-1"></a>knitr::kable(grade, format = &#39;latex&#39;,</span>
<span id="cb328-3"><a href="rmarkdown-operation.html#cb328-3" aria-hidden="true" tabindex="-1"></a>             booktabs = FALSE,</span>
<span id="cb328-4"><a href="rmarkdown-operation.html#cb328-4" aria-hidden="true" tabindex="-1"></a>             caption = &#39;booktabs = FALSE 时的表格&#39;)</span>
<span id="cb328-5"><a href="rmarkdown-operation.html#cb328-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb328-6"><a href="rmarkdown-operation.html#cb328-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-7"><a href="rmarkdown-operation.html#cb328-7" aria-hidden="true" tabindex="-1"></a>```{r booktabs-true, include=knitr::is_latex_output()}</span>
<span id="cb328-8"><a href="rmarkdown-operation.html#cb328-8" aria-hidden="true" tabindex="-1"></a>knitr::kable(grade, format = &#39;latex&#39;,</span>
<span id="cb328-9"><a href="rmarkdown-operation.html#cb328-9" aria-hidden="true" tabindex="-1"></a>             booktabs = TRUE,</span>
<span id="cb328-10"><a href="rmarkdown-operation.html#cb328-10" aria-hidden="true" tabindex="-1"></a>             caption = &#39;booktabs = TRUE 时的表格&#39;)</span>
<span id="cb328-11"><a href="rmarkdown-operation.html#cb328-11" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
</div>
<div class="col">
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-131"></span>
<img src="images/06-booktabs.png" alt="booktabs 表格样式" width="103" />
<p class="caption">
图 6.1: booktabs 表格样式
</p>
</div>
</div>
</div>
<p>对于 <code>booktabs = FALSE</code>：</p>
<ul>
<li><p>表的列由垂直线分隔。可以通过 <code>vline</code> 参数来删除垂直线，例如 <code>knitr::kable(grade, vline = "")</code> （默认值是<code>vline = "|"</code>）。也可以将这个选项设置为一个全局的 R 选项，这样就不需要为每个表设置它，例如 <code>options(knitr.table.vline = "")</code>。</p></li>
<li><p>水平线可以通过参数 <code>toprule</code>、<code>midrule</code>、<code>linesep</code> 以及 <code>bottomrule</code> 来定义，它们的默认值都是<code>\hline</code>。</p></li>
</ul>
<p>对于 <code>booktabs = TRUE</code>：</p>
<ul>
<li><p>表格中没有垂直线，但可以通过 <code>vline</code> 参数来添加。</p></li>
<li><p>表格只有标题和底部行有水平线。默认参数值是 <code>toprule = "\\toprule"</code>、<code>midrule = "\\midrule"</code> 以及 <code>bottomrule = "\\bottomrule"</code>。默认情况下，每 5 行加一个行间距（<code>\addlinespace</code>），这是由参数 <code>linesep</code> 控制的，默认值为 <code>c("", "", "", "", "\\addlinespace")</code>。如果想每 1 行加一个 <code>\addlinespace</code>，则可以这样做：</p></li>
</ul>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="rmarkdown-operation.html#cb329-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">format =</span> <span class="st">&#39;latex&#39;</span>,</span>
<span id="cb329-2"><a href="rmarkdown-operation.html#cb329-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">linesep =</span> <span class="fu">c</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">addlinespace&#39;</span>),</span>
<span id="cb329-3"><a href="rmarkdown-operation.html#cb329-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">booktabs =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb330"><pre class="sourceCode tex"><code class="sourceCode latex"><span id="cb330-1"><a href="rmarkdown-operation.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tabular</span>}{lrrr}</span>
<span id="cb330-2"><a href="rmarkdown-operation.html#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\toprule</span></span>
<span id="cb330-3"><a href="rmarkdown-operation.html#cb330-3" aria-hidden="true" tabindex="-1"></a>姓名 <span class="op">&amp;</span> 语文 <span class="op">&amp;</span> 数学 <span class="op">&amp;</span> 英语<span class="fu">\\</span></span>
<span id="cb330-4"><a href="rmarkdown-operation.html#cb330-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\midrule</span></span>
<span id="cb330-5"><a href="rmarkdown-operation.html#cb330-5" aria-hidden="true" tabindex="-1"></a>张三 <span class="op">&amp;</span> 89 <span class="op">&amp;</span> 93 <span class="op">&amp;</span> 92<span class="fu">\\</span></span>
<span id="cb330-6"><a href="rmarkdown-operation.html#cb330-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\addlinespace</span></span>
<span id="cb330-7"><a href="rmarkdown-operation.html#cb330-7" aria-hidden="true" tabindex="-1"></a>李四 <span class="op">&amp;</span> 90 <span class="op">&amp;</span> 97 <span class="op">&amp;</span> 85<span class="fu">\\</span></span>
<span id="cb330-8"><a href="rmarkdown-operation.html#cb330-8" aria-hidden="true" tabindex="-1"></a><span class="fu">\addlinespace</span></span>
<span id="cb330-9"><a href="rmarkdown-operation.html#cb330-9" aria-hidden="true" tabindex="-1"></a>王五 <span class="op">&amp;</span> 85 <span class="op">&amp;</span> 91 <span class="op">&amp;</span> 97<span class="fu">\\</span></span>
<span id="cb330-10"><a href="rmarkdown-operation.html#cb330-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\bottomrule</span></span>
<span id="cb330-11"><a href="rmarkdown-operation.html#cb330-11" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tabular</span>}</span></code></pre></div>
<p>如果想删除所有的行间距，可以使用<code>linesep = ''</code>。</p>
<p>有的时候，表可能比一页还长。可以使用参数 <code>longtable = TRUE</code>，该参数使用 LaTeX 包 <a href="https://ctan.org/pkg/longtable"><strong>longtable</strong></a> 将表跨到多个页面。</p>
<p>另外，当表格被包含在 <code>table</code> 环境中时（例如，当表有标题时），表格默认居中对齐。如果不想让表格居中，可以使用参数 <code>centering = FALSE</code>。</p>
</div>
<div id="自定义-html-表格" class="section level4 hasAnchor" number="6.1.1.11">
<h4><span class="header-section-number">6.1.1.11</span> 自定义 HTML 表格 (*)<a href="rmarkdown-operation.html#自定义-html-表格" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- https://stackoverflow.com/questions/24254552/knitr-style-table-with-css -->
<p>如果想自定义通过 <code>knitr::kable(format = "html")</code> 生成的表，除了前面提到的常见参数外，只有一个额外的参数需要注意：<code>table.attr</code>。这个参数允许用户向 <code>&lt;table&gt;</code> 标签添加任意属性。例如可以向表格中添加一个类<code>striped</code>：</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="rmarkdown-operation.html#cb331-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(grade, <span class="at">table.attr =</span> <span class="st">&#39;class=&quot;striped&quot;&#39;</span>,</span>
<span id="cb331-2"><a href="rmarkdown-operation.html#cb331-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">&quot;html&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb332"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb332-1"><a href="rmarkdown-operation.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;striped&quot;</span><span class="kw">&gt;</span></span>
<span id="cb332-2"><a href="rmarkdown-operation.html#cb332-2" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;thead&gt;</span></span>
<span id="cb332-3"><a href="rmarkdown-operation.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb332-4"><a href="rmarkdown-operation.html#cb332-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 姓名 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb332-5"><a href="rmarkdown-operation.html#cb332-5" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 语文 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb332-6"><a href="rmarkdown-operation.html#cb332-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 数学 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb332-7"><a href="rmarkdown-operation.html#cb332-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;th</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 英语 <span class="kw">&lt;/th&gt;</span></span>
<span id="cb332-8"><a href="rmarkdown-operation.html#cb332-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb332-9"><a href="rmarkdown-operation.html#cb332-9" aria-hidden="true" tabindex="-1"></a> <span class="kw">&lt;/thead&gt;</span></span>
<span id="cb332-10"><a href="rmarkdown-operation.html#cb332-10" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;tbody&gt;</span></span>
<span id="cb332-11"><a href="rmarkdown-operation.html#cb332-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb332-12"><a href="rmarkdown-operation.html#cb332-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 张三 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-13"><a href="rmarkdown-operation.html#cb332-13" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 89 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-14"><a href="rmarkdown-operation.html#cb332-14" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 93 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-15"><a href="rmarkdown-operation.html#cb332-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 92 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-16"><a href="rmarkdown-operation.html#cb332-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb332-17"><a href="rmarkdown-operation.html#cb332-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb332-18"><a href="rmarkdown-operation.html#cb332-18" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 李四 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-19"><a href="rmarkdown-operation.html#cb332-19" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 90 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-20"><a href="rmarkdown-operation.html#cb332-20" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-21"><a href="rmarkdown-operation.html#cb332-21" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-22"><a href="rmarkdown-operation.html#cb332-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb332-23"><a href="rmarkdown-operation.html#cb332-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb332-24"><a href="rmarkdown-operation.html#cb332-24" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:left;&quot;</span><span class="kw">&gt;</span> 王五 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-25"><a href="rmarkdown-operation.html#cb332-25" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 85 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-26"><a href="rmarkdown-operation.html#cb332-26" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 91 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-27"><a href="rmarkdown-operation.html#cb332-27" aria-hidden="true" tabindex="-1"></a>   <span class="kw">&lt;td</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;text-align:right;&quot;</span><span class="kw">&gt;</span> 97 <span class="kw">&lt;/td&gt;</span></span>
<span id="cb332-28"><a href="rmarkdown-operation.html#cb332-28" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb332-29"><a href="rmarkdown-operation.html#cb332-29" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/tbody&gt;</span></span>
<span id="cb332-30"><a href="rmarkdown-operation.html#cb332-30" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/table&gt;</span></span></code></pre></div>
<p>然而，类的名称不足以改变表的外观，必须定义 CSS<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> 类的规则。例如，要制作奇数行和偶数行有不同颜色的条纹表，可以为偶数行或奇数行添加浅灰色背景：</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb333-1"><a href="rmarkdown-operation.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.striped</span> tr<span class="in">:nth-child(even)</span> { <span class="kw">background</span>: <span class="cn">#eee</span><span class="op">;</span> }</span></code></pre></div>
<p>上面的 CSS 规则意味着所有 <code>striped</code> 类的元素的子元素，且具有偶数行号（<code>:nth-child(even)</code>）的行（即 <code>&lt;tr&gt;</code> 标签），将它们的背景颜色设置为 <code>#eee</code>。</p>
<p>使用一点 CSS 可以使一个普通的 HTML 表看起来好看很多。图 <a href="rmarkdown-operation.html#fig:striped-table">6.2</a> 是一个 HTML 表格的截图，其中应用了以下 CSS 规则：</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb334-1"><a href="rmarkdown-operation.html#cb334-1" aria-hidden="true" tabindex="-1"></a>table {</span>
<span id="cb334-2"><a href="rmarkdown-operation.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span>: <span class="bu">auto</span><span class="op">;</span></span>
<span id="cb334-3"><a href="rmarkdown-operation.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-top</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#666</span><span class="op">;</span></span>
<span id="cb334-4"><a href="rmarkdown-operation.html#cb334-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-bottom</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#666</span><span class="op">;</span></span>
<span id="cb334-5"><a href="rmarkdown-operation.html#cb334-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb334-6"><a href="rmarkdown-operation.html#cb334-6" aria-hidden="true" tabindex="-1"></a>table thead th { <span class="kw">border-bottom</span>: <span class="dv">1</span><span class="dt">px</span> <span class="dv">solid</span> <span class="cn">#ddd</span><span class="op">;</span> }</span>
<span id="cb334-7"><a href="rmarkdown-operation.html#cb334-7" aria-hidden="true" tabindex="-1"></a>th<span class="op">,</span> td { <span class="kw">padding</span>: <span class="dv">5</span><span class="dt">px</span><span class="op">;</span> }</span>
<span id="cb334-8"><a href="rmarkdown-operation.html#cb334-8" aria-hidden="true" tabindex="-1"></a>thead<span class="op">,</span> tfoot<span class="op">,</span> tr<span class="in">:nth-child(even)</span> { <span class="kw">background</span>: <span class="cn">#eee</span><span class="op">;</span> }</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:striped-table"></span>
<img src="images/striped-table.png" alt="利用 HTML 和 CSS 创建的条纹表"  />
<p class="caption">
图 6.2: 利用 HTML 和 CSS 创建的条纹表
</p>
</div>
</div>
</div>
<div id="kable-extra" class="section level3 hasAnchor" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> 利用 <strong>kableExtra</strong> 美化表格<a href="rmarkdown-operation.html#kable-extra" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>kableExtra</strong> 包<span class="citation">(<a href="#ref-R-kableExtra" role="doc-biblioref">Zhu 2021</a>)</span> 设计的目的为扩展 <code>knitr::kable()</code> 生成表格的基本功能（见第 <a href="rmarkdown-operation.html#table-complex">6.1.1</a> 节）。由于 <code>knitr::kable()</code> 的设计很简单，就像很多其他的 R 包一样，它肯定有很多缺失的功能，而 <strong>kableExtra</strong> 完美地填补了空白，可以配合 <code>knitr::kable()</code> 生成更好看的表格。最令人惊讶的是，<strong>kableExtra</strong> 的大多数表格的特性都适用于 HTML 和 PDF 格式，例如，借助 <strong>kableExtra</strong> 包可以绘制如图 <a href="rmarkdown-operation.html#fig:striped-table">6.2</a> 的条纹表。</p>
<p>一般情况下，<strong>kableExtra</strong> 包可以通过 CRAN 安装，也可以尝试 GitHub 上的开发版本 (<a href="https://github.com/haozhu233/kableExtra" class="uri">https://github.com/haozhu233/kableExtra</a>)：</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="rmarkdown-operation.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 通过 CRAN 安装</span></span>
<span id="cb335-2"><a href="rmarkdown-operation.html#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;kableExtra&quot;</span>)</span>
<span id="cb335-3"><a href="rmarkdown-operation.html#cb335-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 安装开发版本</span></span>
<span id="cb335-4"><a href="rmarkdown-operation.html#cb335-4" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;haozhu233/kableExtra&quot;</span>)</span></code></pre></div>
<p><a href="https://haozhu233.github.io/kableExtra/" class="uri">https://haozhu233.github.io/kableExtra/</a> 提供了大量的文档，介绍了很多关于如何自定义 <code>kable()</code> 的 HTML 或 LaTeX 输出结果的例子。本节只提供几个示例，更多内容可参见该文档。</p>
<p>另外，<strong>kableExtra</strong> 包支持使用管道操作符 <code>%&gt;%</code>，可以将 <code>kable()</code> 的输出结果连到 <strong>kableExtra</strong> 的样式函数上，例如表 <a href="rmarkdown-operation.html#tab:striped-table-extra">6.7</a>：</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="rmarkdown-operation.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb336-2"><a href="rmarkdown-operation.html#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb336-3"><a href="rmarkdown-operation.html#cb336-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">caption =</span> <span class="st">&quot;条纹表&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb336-4"><a href="rmarkdown-operation.html#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;striped&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:striped-table-extra">表 6.7: </span>条纹表
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
</tr>
</tbody>
</table>
<div id="设定字体尺寸" class="section level4 hasAnchor" number="6.1.2.1">
<h4><span class="header-section-number">6.1.2.1</span> 设定字体尺寸<a href="rmarkdown-operation.html#设定字体尺寸" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有的时候，在展示一些表格时，需要设定字体的尺寸，如放大或缩小某些特定问题。<strong>kableExtra</strong> 包中的 <code>kable_styling()</code> 函数可以帮助用户对整个表进行样式化。例如，可以指定页面上表格的对齐方式、表格的宽度和字体大小。表 <a href="rmarkdown-operation.html#tab:little-size">6.8</a> 展示了一个使用小字体的例子：</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="rmarkdown-operation.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb337-2"><a href="rmarkdown-operation.html#cb337-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;字体较小的表格&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb337-3"><a href="rmarkdown-operation.html#cb337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">8</span>)</span></code></pre></div>
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:little-size">表 6.8: </span>字体较小的表格
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
</tr>
</tbody>
</table>
</div>
<div id="特定的行或列的样式" class="section level4 hasAnchor" number="6.1.2.2">
<h4><span class="header-section-number">6.1.2.2</span> 特定的行或列的样式<a href="rmarkdown-operation.html#特定的行或列的样式" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有时还需要对表格的行或列的具体样式进行调整，如加粗某行等。函数 <code>row_spec()</code> 和 <code>column_spec()</code> 可分别用于样式化单独的行和列。表 <a href="rmarkdown-operation.html#tab:style-col-row">6.9</a> 将第一行文字加粗并设为斜体，将第二行添加黑色背景，同时更改字体颜色为白色并旋转，给第三行文字加下划线并更改其字体，并给第四列加删除线：</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="rmarkdown-operation.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade, <span class="at">align =</span> <span class="st">&#39;c&#39;</span>, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb338-2"><a href="rmarkdown-operation.html#cb338-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;更改特定行或列的样式&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="rmarkdown-operation.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">italic =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb338-4"><a href="rmarkdown-operation.html#cb338-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;white&#39;</span>,</span>
<span id="cb338-5"><a href="rmarkdown-operation.html#cb338-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">background =</span> <span class="st">&#39;black&#39;</span>, <span class="at">angle =</span> <span class="dv">45</span>) <span class="sc">%&gt;%</span></span>
<span id="cb338-6"><a href="rmarkdown-operation.html#cb338-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">3</span>, <span class="at">underline =</span> <span class="cn">TRUE</span>, <span class="at">monospace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb338-7"><a href="rmarkdown-operation.html#cb338-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">strikeout =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:style-col-row">表 6.9: </span>更改特定行或列的样式
</caption>
<thead>
<tr>
<th style="text-align:center;">
姓名
</th>
<th style="text-align:center;">
语文
</th>
<th style="text-align:center;">
数学
</th>
<th style="text-align:center;">
英语
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;font-weight: bold;font-style: italic;">
张三
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;">
89
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;">
93
</td>
<td style="text-align:center;font-weight: bold;font-style: italic;text-decoration: line-through;">
92
</td>
</tr>
<tr>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
李四
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
90
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);">
97
</td>
<td style="text-align:center;color: white !important;background-color: black !important;-webkit-transform: rotate(45deg); -moz-transform: rotate(45deg); -ms-transform: rotate(45deg); -o-transform: rotate(45deg); transform: rotate(45deg);text-decoration: line-through;">
85
</td>
</tr>
<tr>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
王五
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
85
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;">
91
</td>
<td style="text-align:center;font-family: monospace;text-decoration: underline;text-decoration: line-through;">
97
</td>
</tr>
</tbody>
</table>
<p>类似地，也可以使用 <code>cell_spec()</code> 函数来给单个单元格设定样式。</p>
</div>
<div id="给行或列分组" class="section level4 hasAnchor" number="6.1.2.3">
<h4><span class="header-section-number">6.1.2.3</span> 给行或列分组<a href="rmarkdown-operation.html#给行或列分组" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>回想 Excel 里的操作，对单元格进行合并的操作可以给行或列进行分组。在 R Markdown 中，行和列可以分别通过函数 <code>pack_rows()</code> 和 <code>add_header_above()</code> 来进行分组。另外，也可以通过 <code>collapse_rows()</code> 来折叠行，这样一个单元格可以跨越多个行。表 <a href="rmarkdown-operation.html#tab:group-col-row">6.10</a> 展示了一个给标题列分组后的表格：</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="rmarkdown-operation.html#cb339-1" aria-hidden="true" tabindex="-1"></a>grade3 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(姓名 <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;张三&quot;</span>,<span class="st">&quot;李四&quot;</span>,<span class="st">&quot;王五&quot;</span>),</span>
<span id="cb339-2"><a href="rmarkdown-operation.html#cb339-2" aria-hidden="true" tabindex="-1"></a>                     物理 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">85</span>),</span>
<span id="cb339-3"><a href="rmarkdown-operation.html#cb339-3" aria-hidden="true" tabindex="-1"></a>                     化学 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">86</span>,<span class="dv">92</span>,<span class="dv">80</span>),</span>
<span id="cb339-4"><a href="rmarkdown-operation.html#cb339-4" aria-hidden="true" tabindex="-1"></a>                     生物 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">94</span>,<span class="dv">85</span>,<span class="dv">90</span>),</span>
<span id="cb339-5"><a href="rmarkdown-operation.html#cb339-5" aria-hidden="true" tabindex="-1"></a>                     政治 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">93</span>,<span class="dv">97</span>,<span class="dv">95</span>),</span>
<span id="cb339-6"><a href="rmarkdown-operation.html#cb339-6" aria-hidden="true" tabindex="-1"></a>                     历史 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">84</span>,<span class="dv">80</span>),</span>
<span id="cb339-7"><a href="rmarkdown-operation.html#cb339-7" aria-hidden="true" tabindex="-1"></a>                     地理 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">99</span>,<span class="dv">89</span>,<span class="dv">95</span>),</span>
<span id="cb339-8"><a href="rmarkdown-operation.html#cb339-8" aria-hidden="true" tabindex="-1"></a>                     计算机 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>,<span class="dv">95</span>,<span class="dv">97</span>),</span>
<span id="cb339-9"><a href="rmarkdown-operation.html#cb339-9" aria-hidden="true" tabindex="-1"></a>                     体育 <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">85</span>,<span class="dv">99</span>,<span class="dv">95</span>))</span>
<span id="cb339-10"><a href="rmarkdown-operation.html#cb339-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade3, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb339-11"><a href="rmarkdown-operation.html#cb339-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;对标题列进行分组&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb339-12"><a href="rmarkdown-operation.html#cb339-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;理科&quot;</span> <span class="ot">=</span> <span class="dv">3</span>,</span>
<span id="cb339-13"><a href="rmarkdown-operation.html#cb339-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;文科&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;其它&quot;</span> <span class="ot">=</span> <span class="dv">2</span>))</span></code></pre></div>
<table>
<caption>
<span id="tab:group-col-row">表 6.10: </span>对标题列进行分组
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
理科
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
文科
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
其它
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>对于 <code>add_header_above()</code> 中的命名向量，其名称是显示在表头中的文本，向量的整数值表示一个名称应该跨越多少列，例如，<code>"理科" = 3</code> 表示 <code>理科</code> 应该跨越三列。</p>
<p>表 <a href="rmarkdown-operation.html#tab:pack-rows">6.11</a> 提供了 <code>pack_rows()</code> 的示例，其中 <code>index</code> 参数的含义类似于之前解释过的 <code>add_header_above()</code> 参数：</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="rmarkdown-operation.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade3, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb340-2"><a href="rmarkdown-operation.html#cb340-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;对行进行折叠&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="rmarkdown-operation.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pack_rows</span>(</span>
<span id="cb340-4"><a href="rmarkdown-operation.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">c</span>(<span class="st">&quot;一班&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;二班&quot;</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb340-5"><a href="rmarkdown-operation.html#cb340-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
<span id="tab:pack-rows">表 6.11: </span>对行进行折叠
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr grouplength="1">
<td colspan="9" style="border-bottom: 1px solid;">
<strong>一班</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
张三
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr grouplength="2">
<td colspan="9" style="border-bottom: 1px solid;">
<strong>二班</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
</div>
<div id="按比例缩小-latex-中的表格" class="section level4 hasAnchor" number="6.1.2.4">
<h4><span class="header-section-number">6.1.2.4</span> 按比例缩小 LaTeX 中的表格<a href="rmarkdown-operation.html#按比例缩小-latex-中的表格" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有一些特性是 HTML 或 LaTeX 输出格式特有的。例如，横向打印格式只在 LaTeX 中有意义，所以 <strong>kableExtra</strong> 中的 <code>landscape()</code> 函数只对 LaTeX 格式的输出有效。对于一个比较宽的表格（表 <a href="rmarkdown-operation.html#tab:no-scale-down">6.12</a>），（表 <a href="rmarkdown-operation.html#tab:scale-down">6.13</a>）展现了如何将表格按比例缩小以适应页面的宽度（否则该表格会太宽）：</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="rmarkdown-operation.html#cb341-1" aria-hidden="true" tabindex="-1"></a>grade4 <span class="ot">&lt;-</span> <span class="fu">merge</span>(grade, grade3, <span class="at">by =</span> <span class="st">&quot;姓名&quot;</span>)</span>
<span id="cb341-2"><a href="rmarkdown-operation.html#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade4,</span>
<span id="cb341-3"><a href="rmarkdown-operation.html#cb341-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb341-4"><a href="rmarkdown-operation.html#cb341-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;原始表格（太宽）&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:no-scale-down">表 6.12: </span>原始表格（太宽）
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="rmarkdown-operation.html#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(grade4,</span>
<span id="cb342-2"><a href="rmarkdown-operation.html#cb342-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb342-3"><a href="rmarkdown-operation.html#cb342-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;缩小后的表格&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb342-4"><a href="rmarkdown-operation.html#cb342-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="st">&quot;scale_down&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:scale-down">表 6.13: </span>缩小后的表格
</caption>
<thead>
<tr>
<th style="text-align:left;">
姓名
</th>
<th style="text-align:right;">
语文
</th>
<th style="text-align:right;">
数学
</th>
<th style="text-align:right;">
英语
</th>
<th style="text-align:right;">
物理
</th>
<th style="text-align:right;">
化学
</th>
<th style="text-align:right;">
生物
</th>
<th style="text-align:right;">
政治
</th>
<th style="text-align:right;">
历史
</th>
<th style="text-align:right;">
地理
</th>
<th style="text-align:right;">
计算机
</th>
<th style="text-align:right;">
体育
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
张三
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
86
</td>
<td style="text-align:right;">
94
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
99
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
</tr>
<tr>
<td style="text-align:left;">
李四
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
92
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
84
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
99
</td>
</tr>
<tr>
<td style="text-align:left;">
王五
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
91
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
85
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
80
</td>
<td style="text-align:right;">
95
</td>
<td style="text-align:right;">
97
</td>
<td style="text-align:right;">
95
</td>
</tr>
</tbody>
</table>
<p>注意如果在浏览 HTML 版本的话，表 <a href="rmarkdown-operation.html#tab:no-scale-down">6.12</a> 和表 <a href="rmarkdown-operation.html#tab:scale-down">6.13</a> 表格是没有差异的。</p>
</div>
</div>
<div id="else-table" class="section level3 hasAnchor" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> 其它表格包<a href="rmarkdown-operation.html#else-table" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>还有很多其他的 R 包可以用来生成表格。本节引入 <code>kable()</code> （见第 <a href="rmarkdown-operation.html#table-complex">6.1.1</a> 节）和 <strong>kableExtra</strong> （见第 <a href="rmarkdown-operation.html#kable-extra">6.1.2</a> 节）的主要原因不是它们比其他包更好，而是因为作者们只熟悉它们，而且它们的功能可以涵盖大部分的日常使用需求。接下来本节将列出一些已知的其它软件包，感兴趣的读者可以去尝试并决定哪一个最适合自己。</p>
<ul>
<li><p><strong>flextable</strong> <span class="citation">(<a href="#ref-R-flextable" role="doc-biblioref"><strong>R-flextable?</strong></a>)</span> 和 <strong>huxtable</strong> <span class="citation">(<a href="#ref-R-huxtable" role="doc-biblioref">Hugh-Jones 2021</a>)</span>：<strong>flextable</strong> 和 <strong>huxtable</strong> 支持多种表格输出格式的包。它们都支持 HTML、LaTeX 以及 Office 格式，并且包含最常见的表格特性（例如条件格式化）。更多关于 <strong>flextable</strong> 的信息可参见：<a href="https://davidgohel.github.io/flextable/" class="uri">https://davidgohel.github.io/flextable/</a>，<strong>huxtable</strong> 的说明文档则在：<a href="https://hughjonesd.github.io/huxtable/" class="uri">https://hughjonesd.github.io/huxtable/</a>。</p></li>
<li><p><strong>gt</strong> <span class="citation">(<a href="#ref-R-gt" role="doc-biblioref"><strong>R-gt?</strong></a>)</span>：这个 R 包允许用户将表格的不同部分组合在一起，例如表头（标题和副标题）、列标签、表格主体、行组标签以及表格的脚注，从而组成一个完整的表格，其中有些部分是可选择性添加的。还可以格式化数字，并为单元格添加背景阴影。目前 <strong>gt</strong> 主要支持 HTML 输出。<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a>更多关于 <strong>gt</strong> 的信息可参见：<a href="https://gt.rstudio.com" class="uri">https://gt.rstudio.com</a>。</p></li>
<li><p><strong>formattable</strong> <span class="citation">(<a href="#ref-R-formattable" role="doc-biblioref"><strong>R-formattable?</strong></a>)</span>：这个 R 包提供了一些格式化数字的工具函数（如 <code>percent()</code> 和 <code>accounting()</code>），以及对列进行样式化的函数（如格式化文本，用背景阴影或颜色条注释数字，或在单元格中添加图标等等）。和 <strong>gt</strong> 相同，<strong>formattable</strong> 包也主要支持HTML格式。更多信息可参见GitHub项目：<a href="https://github.com/renkun-ken/formattable/" class="uri">https://github.com/renkun-ken/formattable/</a>。</p></li>
<li><p><strong>DT</strong> <span class="citation">(<a href="#ref-R-DT" role="doc-biblioref"><strong>R-DT?</strong></a>)</span>：它只支持 HTML 格式。<strong>DT</strong> 构建在 JavaScript 库 <strong>DataTables</strong> 之上，它可以将静态表转换为HTML页面上的交互式表。使用者可以对表进行排序、搜索和分页。<strong>DT</strong> 还支持格式化单元格，与 Shiny 一起构建交互式应用程序，并包含了大量的 <strong>DataTables</strong> 扩展（例如，可以将表格导出到Excel，或交互式重新排列表格的列）。更多信息可参见：<a href="https://github.com/rstudio/DT/" class="uri">https://github.com/rstudio/DT/</a>。</p></li>
<li><p><strong>reactable</strong> <span class="citation">(<a href="#ref-R-reactable" role="doc-biblioref"><strong>R-reactable?</strong></a>)</span>：与 <strong>DT</strong> 类似，这个包也基于 JavaScript 库创建交互式表。它在某些方面比 <strong>DT</strong> 更好（比如行分组和聚合操作，以及嵌入HTML小部件），但 <strong>reactable</strong> 并不包含 <strong>DT</strong> 全部的特性。更多信息可参见：<a href="https://glin.github.io/reactable/" class="uri">https://glin.github.io/reactable/</a>。</p></li>
<li><p><strong>rhandsontable</strong><span class="citation">(<a href="#ref-R-rhandsontable" role="doc-biblioref"><strong>R-rhandsontable?</strong></a>)</span>：这个包也类似于 <strong>DT</strong>，并且和 Excel 比较像（例如，可以直接在表中编辑数据）。更多信息可参见：<a href="https://jrowen.github.io/rhandsontable/" class="uri">https://jrowen.github.io/rhandsontable/</a>。</p></li>
<li><p><strong>pixiedust</strong> <span class="citation">(<a href="#ref-R-pixiedust" role="doc-biblioref"><strong>R-pixiedust?</strong></a>)</span>：这个包通过 <strong>broom</strong> 包<span class="citation">(<a href="#ref-R-broom" role="doc-biblioref"><strong>R-broom?</strong></a>)</span>来为为模型结果（如线性模型）创建表格，它支持 Markdown、HTML 以及 LaTeX 输出格式。更多信息可参见：<a href="https://github.com/nutterb/pixiedust/" class="uri">https://github.com/nutterb/pixiedust/</a>。</p></li>
<li><p><strong>stargazer</strong> <span class="citation">(<a href="#ref-R-stargazer" role="doc-biblioref"><strong>R-stargazer?</strong></a>)</span>：格式化回归模型和汇总统计表。更多信息可参见：<a href="https://cran.r-project.org/package=stargazer/" class="uri">https://cran.r-project.org/package=stargazer/</a>。</p></li>
<li><p><strong>xtable</strong> <span class="citation">(<a href="#ref-R-xtable" role="doc-biblioref">Dahl et al. 2019</a>)</span>；这个包可能是最早的创建表格的包，其第一次发布是在 2000 年。它同时支持LaTeX和HTML格式。该软件包可在 CRAN 上访问：<a href="https://cran.r-project.org/package=xtable/" class="uri">https://cran.r-project.org/package=xtable/</a>。</p></li>
</ul>
<p>还有一些其它生成表格的包，这里不再进一步介绍，只是在这里列出它们，以供感兴趣者参考：<strong>tables</strong> <span class="citation">(<a href="#ref-R-tables" role="doc-biblioref"><strong>R-tables?</strong></a>)</span>、<strong>pander</strong> <span class="citation">(<a href="#ref-R-pander" role="doc-biblioref">Daróczi and Tsegelskyi 2022</a>)</span>、<strong>tangram</strong> <span class="citation">(<a href="#ref-R-tangram" role="doc-biblioref"><strong>R-tangram?</strong></a>)</span>、<strong>ztable</strong> <span class="citation">(<a href="#ref-R-ztable" role="doc-biblioref"><strong>R-ztable?</strong></a>)</span> 以及 <strong>condformat</strong> <span class="citation">(<a href="#ref-R-condformat" role="doc-biblioref"><strong>R-condformat?</strong></a>)</span>。</p>
</div>
</div>
<div id="chunk-options" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> 块选项<a href="rmarkdown-operation.html#chunk-options" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>本节和接下来的第 <a href="rmarkdown-operation.html#output-hook">6.4</a>、<a href="rmarkdown-operation.html#other-trick">6.6</a> 两节进一步展示一些与 <strong>knitr</strong> 代码块选项相关的编程技巧。</p>
<p>R Markdown 支持超过 50 个块选项 用于调整 <strong>knitr</strong> 处理代码块的方式，完整列表可参阅在线文档<a href="https://yihui.org/knitr/options/" class="uri">https://yihui.org/knitr/options/</a>。</p>
<p>下面的几节展示了在单个代码块中使用块选项的例子，希望为全部代码块统一设置块选项的读者可以参考第 @ref(#code-block-and-inline) 节。</p>
<div id="chunk-variable" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> 在块选项中使用变量<a href="rmarkdown-operation.html#chunk-variable" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>通常情况下，块选项中会使用常数（如：<code>fig.width = 6</code>），但有些时候仅使用常数无法满足需求，例如应展现的图像大小可能来源于其它代码块的结果，而非一成不变，每次根据结果来手动调整就会费时又费力。</p>
<p>实际上，块选项可以使用任意的 R 表达式，无论简单或复杂。一种特殊的情况是将变量传递给一个块选项（注意变量本身也可被视为一个 R 表达式）。例如，为了满足图像大小变化的需求，可以在文档的一个代码块中定义关于图像宽度的变量，然后在其他代码块中使用它：</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb343-1"><a href="rmarkdown-operation.html#cb343-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb343-2"><a href="rmarkdown-operation.html#cb343-2" aria-hidden="true" tabindex="-1"></a>my_width &lt;- 7</span>
<span id="cb343-3"><a href="rmarkdown-operation.html#cb343-3" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb343-4"><a href="rmarkdown-operation.html#cb343-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-5"><a href="rmarkdown-operation.html#cb343-5" aria-hidden="true" tabindex="-1"></a>```{r, fig.width=my_width}</span>
<span id="cb343-6"><a href="rmarkdown-operation.html#cb343-6" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb343-7"><a href="rmarkdown-operation.html#cb343-7" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>另外，块选项中也可以使用更为复杂的函数，例如可以使用 <code>if-else</code> 语句来调整图片大小：</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb344-1"><a href="rmarkdown-operation.html#cb344-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb344-2"><a href="rmarkdown-operation.html#cb344-2" aria-hidden="true" tabindex="-1"></a>fig_small &lt;- FALSE  # 输出更大的图片需要改为 TRUE</span>
<span id="cb344-3"><a href="rmarkdown-operation.html#cb344-3" aria-hidden="true" tabindex="-1"></a>width_small &lt;- 4</span>
<span id="cb344-4"><a href="rmarkdown-operation.html#cb344-4" aria-hidden="true" tabindex="-1"></a>width_large &lt;- 8</span>
<span id="cb344-5"><a href="rmarkdown-operation.html#cb344-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb344-6"><a href="rmarkdown-operation.html#cb344-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-7"><a href="rmarkdown-operation.html#cb344-7" aria-hidden="true" tabindex="-1"></a>```{r, fig.width=if (fig_small) width_small else width_large}</span>
<span id="cb344-8"><a href="rmarkdown-operation.html#cb344-8" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb344-9"><a href="rmarkdown-operation.html#cb344-9" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>不仅如此，还可以只在所需要的包可使用时才运行一个代码块（<code>eval=FALSE</code> 意味着不运行该代码）：</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb345-1"><a href="rmarkdown-operation.html#cb345-1" aria-hidden="true" tabindex="-1"></a>```{r, eval=require(&#39;leaflet&#39;)}</span>
<span id="cb345-2"><a href="rmarkdown-operation.html#cb345-2" aria-hidden="true" tabindex="-1"></a>library(leaflet)</span>
<span id="cb345-3"><a href="rmarkdown-operation.html#cb345-3" aria-hidden="true" tabindex="-1"></a>leaflet() %&gt;% addTiles()</span>
<span id="cb345-4"><a href="rmarkdown-operation.html#cb345-4" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>需要注意的是，<code>require('package')</code> 只有当这个包已安装且可使用时才会返回 <code>TRUE</code>，否则会返回 <code>FALSE</code>。</p>
</div>
<div id="chunk-error" class="section level3 hasAnchor" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> 如何在遇到 error 的时候继续编译<a href="rmarkdown-operation.html#chunk-error" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在默认情况下，R Markdown 文档中代码块运行产生的错误将使程序终止。但瑕疵掩不住美玉，一次报错不妨碍整体的质量；失败是成功之母，一次报错更是珍贵的学习机会。出于种种原因，用户希望在代码块报错的时候显示错误并继续运行，可以使用块选项 <code>error = TRUE</code>，例如：</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb346-1"><a href="rmarkdown-operation.html#cb346-1" aria-hidden="true" tabindex="-1"></a>```{r, error=TRUE}</span>
<span id="cb346-2"><a href="rmarkdown-operation.html#cb346-2" aria-hidden="true" tabindex="-1"></a>1 + &quot;a&quot;</span>
<span id="cb346-3"><a href="rmarkdown-operation.html#cb346-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>这样在编译 R Markdown 文档后，将在输出文档中看到如下的错误消息：</p>
<pre><code>Error in 1 + &quot;a&quot;: non-numeric argument to binary operator</code></pre>
<p>实际上，在 R Markdown 中，默认设定为 <code>error = FALSE</code>，这也导致了 R 在运行代码块时，出现错误就会终止。</p>
</div>
<div id="chunk-output" class="section level3 hasAnchor" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> 控制输出<a href="rmarkdown-operation.html#chunk-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>默认情况下，<strong>knitr</strong> 会显示代码块的所有可能输出，包括源代码、提示信息（message）、警告（warning）、文本输出和图像输出等，但有时处于种种目的，只需要部分输出。本节将详细介绍如何控制各类结果的输出。</p>
<div id="hide-one" class="section level4 hasAnchor" number="6.2.3.1">
<h4><span class="header-section-number">6.2.3.1</span> 隐藏源代码、提示信息、警告、文本输出或图像输出<a href="rmarkdown-operation.html#hide-one" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>对于输出结果中的各类元素，可以使用相应的块选项来单独隐藏它们：</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb348-1"><a href="rmarkdown-operation.html#cb348-1" aria-hidden="true" tabindex="-1"></a>隐藏源代码：</span>
<span id="cb348-2"><a href="rmarkdown-operation.html#cb348-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-3"><a href="rmarkdown-operation.html#cb348-3" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb348-4"><a href="rmarkdown-operation.html#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1</span></span>
<span id="cb348-5"><a href="rmarkdown-operation.html#cb348-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-6"><a href="rmarkdown-operation.html#cb348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-7"><a href="rmarkdown-operation.html#cb348-7" aria-hidden="true" tabindex="-1"></a>隐藏提示信息（message）：</span>
<span id="cb348-8"><a href="rmarkdown-operation.html#cb348-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-9"><a href="rmarkdown-operation.html#cb348-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE}</span></span>
<span id="cb348-10"><a href="rmarkdown-operation.html#cb348-10" aria-hidden="true" tabindex="-1"></a><span class="in">message(&quot;这个message不会显示&quot;)</span></span>
<span id="cb348-11"><a href="rmarkdown-operation.html#cb348-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-12"><a href="rmarkdown-operation.html#cb348-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-13"><a href="rmarkdown-operation.html#cb348-13" aria-hidden="true" tabindex="-1"></a>隐藏警告（warning）：</span>
<span id="cb348-14"><a href="rmarkdown-operation.html#cb348-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-15"><a href="rmarkdown-operation.html#cb348-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb348-16"><a href="rmarkdown-operation.html#cb348-16" aria-hidden="true" tabindex="-1"></a><span class="in"># 这将生成一个warning，但不会被输出</span></span>
<span id="cb348-17"><a href="rmarkdown-operation.html#cb348-17" aria-hidden="true" tabindex="-1"></a><span class="in">1:2 + 1:3</span></span>
<span id="cb348-18"><a href="rmarkdown-operation.html#cb348-18" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-19"><a href="rmarkdown-operation.html#cb348-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-20"><a href="rmarkdown-operation.html#cb348-20" aria-hidden="true" tabindex="-1"></a>隐藏文本输出（也可以使用<span class="in">`results = FALSE`</span>）：</span>
<span id="cb348-21"><a href="rmarkdown-operation.html#cb348-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-22"><a href="rmarkdown-operation.html#cb348-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results=&#39;hide&#39;}</span></span>
<span id="cb348-23"><a href="rmarkdown-operation.html#cb348-23" aria-hidden="true" tabindex="-1"></a><span class="in">print(&quot;这个文本输出不会显示。&quot;)</span></span>
<span id="cb348-24"><a href="rmarkdown-operation.html#cb348-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-25"><a href="rmarkdown-operation.html#cb348-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-26"><a href="rmarkdown-operation.html#cb348-26" aria-hidden="true" tabindex="-1"></a>隐藏图形输出：</span>
<span id="cb348-27"><a href="rmarkdown-operation.html#cb348-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-28"><a href="rmarkdown-operation.html#cb348-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show=&#39;hide&#39;}</span></span>
<span id="cb348-29"><a href="rmarkdown-operation.html#cb348-29" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb348-30"><a href="rmarkdown-operation.html#cb348-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb348-31"><a href="rmarkdown-operation.html#cb348-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-32"><a href="rmarkdown-operation.html#cb348-32" aria-hidden="true" tabindex="-1"></a>需要注意的是，上面的代码块会生成图形，它只是没有显示在输出中而已。</span></code></pre></div>
<p>关于 <strong>knitr</strong> 的一个常见问题是如何隐藏包的加载消息。例如，在运行 <code>library(tidyverse)</code> 或 <code>library(ggplot2)</code> 时，可能会看到一些正在加载的 message。这类 message 也可以通过块选项 <code>message = FALSE</code> 来隐藏。</p>
<p>另外，还可以通过索引来有选择地显示或隐藏这些元素。下面的示例只输出了源代码的第四个和第五个表达式（注意，一个注释会被算作一个表达式）、前两个 message 以及第二个和第三个 warning：</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb349-1"><a href="rmarkdown-operation.html#cb349-1" aria-hidden="true" tabindex="-1"></a>```{r, echo=c(4, 5), message=c(1, 2), warning=2:3}</span>
<span id="cb349-2"><a href="rmarkdown-operation.html#cb349-2" aria-hidden="true" tabindex="-1"></a># 一种生成服从N(0,1)分布的随机数的方法</span>
<span id="cb349-3"><a href="rmarkdown-operation.html#cb349-3" aria-hidden="true" tabindex="-1"></a>x &lt;- qnorm(runif(10))</span>
<span id="cb349-4"><a href="rmarkdown-operation.html#cb349-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-5"><a href="rmarkdown-operation.html#cb349-5" aria-hidden="true" tabindex="-1"></a># 在实践中还可以使用</span>
<span id="cb349-6"><a href="rmarkdown-operation.html#cb349-6" aria-hidden="true" tabindex="-1"></a>x &lt;- rnorm(10)</span>
<span id="cb349-7"><a href="rmarkdown-operation.html#cb349-7" aria-hidden="true" tabindex="-1"></a>x</span>
<span id="cb349-8"><a href="rmarkdown-operation.html#cb349-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-9"><a href="rmarkdown-operation.html#cb349-9" aria-hidden="true" tabindex="-1"></a>for (i in 1:5) message(&#39;这是 message &#39;, i)</span>
<span id="cb349-10"><a href="rmarkdown-operation.html#cb349-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-11"><a href="rmarkdown-operation.html#cb349-11" aria-hidden="true" tabindex="-1"></a>for (i in 1:5) warning(&#39;这是 warning &#39;, i)</span>
<span id="cb349-12"><a href="rmarkdown-operation.html#cb349-12" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>还可以使用负索引，例如，<code>echo = -2</code> 表示在输出中排除源代码的第二个表达式。</p>
<p>类似地，可以通过使用 <code>fig.keep</code> 选项 来选择显示或隐藏哪些图。例如，<code>fig.keep = 1:2</code> 意味着保留前两幅图。这个选项有一些快捷的方式，如 <code>fig.keep = "first"</code> 将只保留第一幅图、<code>fig.keep = "last"</code> 只保留最后的图以及 <code>fig.keep = "none"</code> 将丢弃所有的图。需要注意的是，<code>fig.keep = "none"</code> 和 <code>fig.show = "hide"</code> 这两个选项是不同的，后者将生成图像文件，只是会隐藏它们，而前者则根本不会生成图像文件。</p>
<p>对于 <code>html_document</code> 输出中的源代码块，如果不想完全省略它们（<code>echo = FALSE</code>），可以参考<a href="rmarkdown-document.html#html-code-folding">3.1.2.6</a>节，来学习如何在页面上折叠它们，并允许报告用户通过单击展开按钮来展开它们。</p>
</div>
<div id="hide-all" class="section level4 hasAnchor" number="6.2.3.2">
<h4><span class="header-section-number">6.2.3.2</span> 隐藏代码块的所有输出<a href="rmarkdown-operation.html#hide-all" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>有的时候，可能想要执行一个代码块而根本不显示任何输出。与使用第 <a href="rmarkdown-operation.html#hide-one">6.2.3.1</a> 节中提到的单独选项不同，可以使用一个选项 <code>include = FALSE</code> 来隐藏代码块所有的输出，例如：</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb350-1"><a href="rmarkdown-operation.html#cb350-1" aria-hidden="true" tabindex="-1"></a>```{r, include=FALSE}</span>
<span id="cb350-2"><a href="rmarkdown-operation.html#cb350-2" aria-hidden="true" tabindex="-1"></a># 任意的R代码</span>
<span id="cb350-3"><a href="rmarkdown-operation.html#cb350-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>使用 <code>include=FALSE</code> 时，代码块将被运行（除非 <code>eval=FALSE</code>），但输出将被完全隐藏，报告用户将看不到任何的源代码、提示信息、警告、文本输出或图像输出等。</p>
</div>
<div id="opts-collapse" class="section level4 hasAnchor" number="6.2.3.3">
<h4><span class="header-section-number">6.2.3.3</span> 将文本输出压缩到源代码块中<a href="rmarkdown-operation.html#opts-collapse" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>在 R Markdown 报告中，输出结果中的文本输出部分和源代码部分之间会存在间隔。如果想去除这些间隔，可以考虑使用块选项 <code>collapse = TRUE</code> 将文本输出压缩到源代码块中。<code>collapse = TRUE</code> 时的输出如下所示：</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="rmarkdown-operation.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb351-2"><a href="rmarkdown-operation.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb351-3"><a href="rmarkdown-operation.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb351-4"><a href="rmarkdown-operation.html#cb351-4" aria-hidden="true" tabindex="-1"></a><span class="do">##  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
<p>若没有设定 <code>collapse = TRUE</code>（默认为<code>FALSE</code>），则会变成：</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="rmarkdown-operation.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="rmarkdown-operation.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div id="results-asis" class="section level4 hasAnchor" number="6.2.3.4">
<h4><span class="header-section-number">6.2.3.4</span> 将文本输出调整为原始的 Markdown 形式 (*)<a href="rmarkdown-operation.html#results-asis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>默认情况下，代码块的文本输出将逐字输出，并添加两个前导符号 <code>##</code>（见第 <a href="rmarkdown-operation.html#chunk-leading">6.2.5</a> 节）。由于 <strong>knitr</strong> 将文本放在单独的代码块中，所以文本是逐字的。例如，对于代码 <code>1:5</code>，<strong>knitr</strong> 的原始输出为：</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb356-1"><a href="rmarkdown-operation.html#cb356-1" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb356-2"><a href="rmarkdown-operation.html#cb356-2" aria-hidden="true" tabindex="-1"></a>## [1] 1 2 3 4 5</span>
<span id="cb356-3"><a href="rmarkdown-operation.html#cb356-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>有的时候，比如在批量生成报告时，用户可能不希望逐字输出文本，而是将文本输出视为 Markdown 的内容。例如，如果想写一个类似 <code>cat('# 这是一个标题')</code> 的节标题，但原始的输出是：</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb357-1"><a href="rmarkdown-operation.html#cb357-1" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb357-2"><a href="rmarkdown-operation.html#cb357-2" aria-hidden="true" tabindex="-1"></a>## # 这是一个标题</span>
<span id="cb357-3"><a href="rmarkdown-operation.html#cb357-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>用户往往不希望文本位于单独的代码块（或开头的<code>##</code>）中，而希望原始输出与传递给<code>cat()</code>的字符串完全一致，即：</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb358-1"><a href="rmarkdown-operation.html#cb358-1" aria-hidden="true" tabindex="-1"></a># 这是一个标题</span></code></pre></div>
<p>这个问题可以通过添加块选项 <code>results = 'asis'</code> 来解决。这个选项告诉 <strong>knitr</strong> 不要将文本输出逐字包装成代码块，而是“原样”对待它。当想要从 R 代码动态生成内容时，这一点特别有用。例如，可以使用选项 <code>results = 'asis'</code> 从以下代码块生成 <code>iris</code> 数据的列名列表:</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="rmarkdown-operation.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&#39;- `&#39;</span>, <span class="fu">names</span>(iris), <span class="st">&#39;`&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<ul>
<li><code>Sepal.Length</code></li>
<li><code>Sepal.Width</code></li>
<li><code>Petal.Length</code></li>
<li><code>Petal.Width</code></li>
<li><code>Species</code></li>
</ul>
<p>连字符（<code>-</code>）是 Markdown 中用于生成无序列表的语法，其中反引号是可选的。若没有设置 <code>results = 'asis'</code> 选项，则上述代码块的输出为：</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="rmarkdown-operation.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">&#39;- `&#39;</span>, <span class="fu">names</span>(iris), <span class="st">&#39;`&#39;</span>), <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span></code></pre></div>
<pre><code>## - `Sepal.Length`
## - `Sepal.Width`
## - `Petal.Length`
## - `Petal.Width`
## - `Species`</code></pre>
<p>下面是一个完整的例子，展示了如何在<code>for</code>循环中为<code>mtcars</code>数据的所有列生成节标题、段落和图：</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb362-1"><a href="rmarkdown-operation.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb362-2"><a href="rmarkdown-operation.html#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 以编程的方式生成内容</span></span>
<span id="cb362-3"><a href="rmarkdown-operation.html#cb362-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb362-4"><a href="rmarkdown-operation.html#cb362-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-5"><a href="rmarkdown-operation.html#cb362-5" aria-hidden="true" tabindex="-1"></a>通过代码块选项 <span class="in">`results = &#39;asis&#39;`</span>，可以将文本作为原始的 Markdown 内容写出来，</span>
<span id="cb362-6"><a href="rmarkdown-operation.html#cb362-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-7"><a href="rmarkdown-operation.html#cb362-7" aria-hidden="true" tabindex="-1"></a>同时也可以与图片混合。</span>
<span id="cb362-8"><a href="rmarkdown-operation.html#cb362-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-9"><a href="rmarkdown-operation.html#cb362-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, mtcars-plots, results=&#39;asis&#39;}</span></span>
<span id="cb362-10"><a href="rmarkdown-operation.html#cb362-10" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in names(mtcars)) {</span></span>
<span id="cb362-11"><a href="rmarkdown-operation.html#cb362-11" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(&#39;\n\n# 变量 `&#39;, i, &#39;` 的概要\n\n&#39;)</span></span>
<span id="cb362-12"><a href="rmarkdown-operation.html#cb362-12" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- mtcars[, i]</span></span>
<span id="cb362-13"><a href="rmarkdown-operation.html#cb362-13" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(unique(x)) &lt;= 6) {</span></span>
<span id="cb362-14"><a href="rmarkdown-operation.html#cb362-14" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(&#39;`&#39;, i, &#39;` 是一个分类变量。\n\n&#39;)</span></span>
<span id="cb362-15"><a href="rmarkdown-operation.html#cb362-15" aria-hidden="true" tabindex="-1"></a><span class="in">    plot(table(x), xlab = i, ylab = &#39;频率&#39;, lwd = 10)</span></span>
<span id="cb362-16"><a href="rmarkdown-operation.html#cb362-16" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {</span></span>
<span id="cb362-17"><a href="rmarkdown-operation.html#cb362-17" aria-hidden="true" tabindex="-1"></a><span class="in">    cat(&#39;连续变量 `&#39;, i, &#39;` 的直方图。\n\n&#39;)</span></span>
<span id="cb362-18"><a href="rmarkdown-operation.html#cb362-18" aria-hidden="true" tabindex="-1"></a><span class="in">    hist(x, xlab = i, main = &#39;&#39;)</span></span>
<span id="cb362-19"><a href="rmarkdown-operation.html#cb362-19" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb362-20"><a href="rmarkdown-operation.html#cb362-20" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb362-21"><a href="rmarkdown-operation.html#cb362-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>需要注意的是，上述示例代码中添加了过多的换行符（<code>\n</code>），从而将不同的元素在 Markdown 中清晰地分开。在不同的元素之间使用过多的换行符是无害的，但是如果换行符不够，就会产生问题。例如，下面的 Markdown 文本就会产生很多的歧义：</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb363-1"><a href="rmarkdown-operation.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是一个标题吗？</span></span>
<span id="cb363-2"><a href="rmarkdown-operation.html#cb363-2" aria-hidden="true" tabindex="-1"></a>这是一个段落还是标题的一部分呢？</span>
<span id="cb363-3"><a href="rmarkdown-operation.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="al">![这张图片呢？](foo.png)</span></span>
<span id="cb363-4"><a href="rmarkdown-operation.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这行又是什么？</span></span></code></pre></div>
<p>如果产生了更多的空行（可以由<code>cat('\n')</code>生成），则歧义就会消失：</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb364-1"><a href="rmarkdown-operation.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是一个标题！</span></span>
<span id="cb364-2"><a href="rmarkdown-operation.html#cb364-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-3"><a href="rmarkdown-operation.html#cb364-3" aria-hidden="true" tabindex="-1"></a>这绝对是个段落。</span>
<span id="cb364-4"><a href="rmarkdown-operation.html#cb364-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-5"><a href="rmarkdown-operation.html#cb364-5" aria-hidden="true" tabindex="-1"></a><span class="al">![这是一张图。](foo.png)</span></span>
<span id="cb364-6"><a href="rmarkdown-operation.html#cb364-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-7"><a href="rmarkdown-operation.html#cb364-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># 这是另一个标题</span></span></code></pre></div>
<p><code>cat()</code> 函数不是唯一可以生成文本输出的函数，另一个常用的函数是 <code>print()</code>。但需要注意的是，<code>print()</code> 经常被 <em>隐式</em> 调用来打印对象，这就是为什么在 R 控制台（console）中输入一个对象或值后会看到输出。例如，当在 R 控制台中输入 <code>1:5</code> 并按下 <code>Enter</code> 键时，会看到输出，这是因为 R 实际上隐式地调用了 <code>print(1:5)</code>。经常令人感到困惑的是，不能在表达式（例如 <code>for</code> 循环）中直接生成输出，而如果在 R 控制台上输入对象或值，它们将被正确打印出来。这个主题非常技术性，具体细节可以参看博文<a href="https://yihui.org/en/2017/06/top-level-r-expressions/">“The Ghost Printer behind Top-level R Expressions”</a>。如果对技术细节不感兴趣，只要记住这条规则即可：如果在 <code>for</code> 循环中没有看到输出，那么可能应该使用 <code>print()</code> 函数来显式地打印对象。</p>
</div>
</div>
<div id="chunk-reformat" class="section level3 hasAnchor" number="6.2.4">
<h3><span class="header-section-number">6.2.4</span> 重新格式化源代码<a href="rmarkdown-operation.html#chunk-reformat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有的时候，因个人习惯以及代码熟练度的不同，源代码格式会有所不同，甚至有些杂乱，这会加大报告用户的阅读难度（尤其是当老师或助教阅读的时候，这会直接影响作业的分数）。本节将介绍如何通过块选项，让源代码自动地“变好看”。</p>
<p>当设置块选项 <code>tidy = TRUE</code> 时， R 的源代码将被 <strong>formatR</strong> 包 <span class="citation">(<a href="#ref-R-formatR" role="doc-biblioref">Xie 2022b</a>)</span>的 <code>tidy_source()</code> 函数重新格式化。<code>tidy_source()</code> 可以在几个方面重新格式化代码，比如在大多数操作符周围添加空格、适当缩进代码以及用 <code>&lt;-</code> 替换赋值操作符 <code>=</code> 。块选项 <code>tidy.opts</code> 可以是传递给 <code>formatR::tidy_source()</code> 的一个参数列表，例如：</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb365-1"><a href="rmarkdown-operation.html#cb365-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, tidy=TRUE, tidy.opts=list(arrow=TRUE, indent=2)}</span></span>
<span id="cb365-2"><a href="rmarkdown-operation.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 混乱的 R 代码...</span></span>
<span id="cb365-3"><a href="rmarkdown-operation.html#cb365-3" aria-hidden="true" tabindex="-1"></a><span class="in">1+            1</span></span>
<span id="cb365-4"><a href="rmarkdown-operation.html#cb365-4" aria-hidden="true" tabindex="-1"></a><span class="in">x=1:10#有些使用者更喜欢用 &#39;&lt;-&#39; 来作为赋值操作符</span></span>
<span id="cb365-5"><a href="rmarkdown-operation.html#cb365-5" aria-hidden="true" tabindex="-1"></a><span class="in">if(TRUE){</span></span>
<span id="cb365-6"><a href="rmarkdown-operation.html#cb365-6" aria-hidden="true" tabindex="-1"></a><span class="in">print(&#39;Hello world!&#39;) # 缩进 2 个空格</span></span>
<span id="cb365-7"><a href="rmarkdown-operation.html#cb365-7" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb365-8"><a href="rmarkdown-operation.html#cb365-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出结果为：</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="rmarkdown-operation.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 混乱的 R 代码...</span></span>
<span id="cb366-2"><a href="rmarkdown-operation.html#cb366-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb366-3"><a href="rmarkdown-operation.html#cb366-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>  <span class="co">#有些使用者更喜欢用 &#39;&lt;-&#39; 来作为赋值操作符</span></span>
<span id="cb366-4"><a href="rmarkdown-operation.html#cb366-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb366-5"><a href="rmarkdown-operation.html#cb366-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Hello world!&quot;</span>)  <span class="co"># 缩进 2 个空格</span></span>
<span id="cb366-6"><a href="rmarkdown-operation.html#cb366-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>块选项 <code>out.width</code> 可以控制输出的宽度。如果想进一步控制源代码的宽度，则可以在设置 <code>tidy = TRUE</code> 时使用 <code>width.cutoff</code> 参数，例如：</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb367-1"><a href="rmarkdown-operation.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, tidy=TRUE, tidy.opts=list(width.cutoff=50)}</span></span>
<span id="cb367-2"><a href="rmarkdown-operation.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="in"># 一个很长的表达式</span></span>
<span id="cb367-3"><a href="rmarkdown-operation.html#cb367-3" aria-hidden="true" tabindex="-1"></a><span class="in">1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+</span></span>
<span id="cb367-4"><a href="rmarkdown-operation.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="in">1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1+1</span></span>
<span id="cb367-5"><a href="rmarkdown-operation.html#cb367-5" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>输出结果为：</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="rmarkdown-operation.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个很长的表达式</span></span>
<span id="cb368-2"><a href="rmarkdown-operation.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb368-3"><a href="rmarkdown-operation.html#cb368-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb368-4"><a href="rmarkdown-operation.html#cb368-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb368-5"><a href="rmarkdown-operation.html#cb368-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span></code></pre></div>
<p>更多可能的参数可以参见帮助页 <code>?formatR::tidy_source</code>，也可以浏览 <a href="https://yihui.org/formatR/" class="uri">https://yihui.org/formatR/</a> 来了解这个函数的示例和局限性。</p>
<p>另外，还可以通过设定块选项 <code>tidy = 'styler'</code> 来使用 <strong>styler</strong> 包<span class="citation">(<a href="#ref-R-styler" role="doc-biblioref"><strong>R-styler?</strong></a>)</span>重新格式化 R 代码，其中的格式化函数为 <code>styler::style_text()</code>。<strong>styler</strong> 包比 <strong>formatR</strong> 具有更丰富的特性。例如，它可以对齐函数参数并使用管道操作符 <code>%&gt;%</code>。块选项 <code>tidy.opts</code> 同样可以用于将附加参数传递给 <code>styler::style_text()</code>，例如：</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb369-1"><a href="rmarkdown-operation.html#cb369-1" aria-hidden="true" tabindex="-1"></a>```{r, tidy=&#39;styler&#39;, tidy.opts=list(strict=FALSE)}</span>
<span id="cb369-2"><a href="rmarkdown-operation.html#cb369-2" aria-hidden="true" tabindex="-1"></a># 对齐赋值操作符</span>
<span id="cb369-3"><a href="rmarkdown-operation.html#cb369-3" aria-hidden="true" tabindex="-1"></a>a   &lt;- 1 # 一个变量</span>
<span id="cb369-4"><a href="rmarkdown-operation.html#cb369-4" aria-hidden="true" tabindex="-1"></a>abc &lt;- 2 # 另一个变量</span>
<span id="cb369-5"><a href="rmarkdown-operation.html#cb369-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>在默认情况下，<code>tidy = FALSE</code> 并且 R 代码不会被重新格式化。</p>
</div>
<div id="chunk-leading" class="section level3 hasAnchor" number="6.2.5">
<h3><span class="header-section-number">6.2.5</span> 调整文本输出中的前导符号<a href="rmarkdown-operation.html#chunk-leading" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>默认情况下，R Markdown 会在文本输出的前面插入两个符号 <code>##</code>，那么这个符号能不能更改或者干脆删除呢？第 <a href="rmarkdown-operation.html#results-asis">6.2.3.4</a> 节介绍了通过在添加 <code>results = 'asis'</code> 选项来生成 Markdown 形式输出的方法。但如果只是想调整前导符号，而仍然想将文本放在单独的块中，则可以通过块选项 <code>comment</code> 来实现。如果要删除 <code>##</code>，可以使用空字符串，例如：</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb370-1"><a href="rmarkdown-operation.html#cb370-1" aria-hidden="true" tabindex="-1"></a>```{r, comment=&quot;&quot;}</span>
<span id="cb370-2"><a href="rmarkdown-operation.html#cb370-2" aria-hidden="true" tabindex="-1"></a>1:100</span>
<span id="cb370-3"><a href="rmarkdown-operation.html#cb370-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>当然，可以使用任何其他的字符值，例如，<code>comment = "#&gt;"</code>。那么为什么 <code>comment</code> 选项默认为 <code>##</code> 呢？这是因为 <code>#</code> 表示 R 中的注释，当文本输出被注释掉时，从报告中的代码块中一次性复制所有代码并自己运行它将更容易，不需要担心运行文本输出（并非 R 代码）会报错。例如，在下面的代码块中，可以复制所有四行文本，并将它们作为 R 代码正确地运行：</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="rmarkdown-operation.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb371-2"><a href="rmarkdown-operation.html#cb371-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 2</span></span>
<span id="cb371-3"><a href="rmarkdown-operation.html#cb371-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb371-4"><a href="rmarkdown-operation.html#cb371-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 4</span></span></code></pre></div>
<p>而如果通过 <code>comment = ""</code> 删除 <code>##</code> ，通常会无法直接运行所有的代码。如下面的例子所展示的，如果直接复制这四行，就需要手动删除第二和第四行：</p>
</div>
<div id="chunk-property" class="section level3 hasAnchor" number="6.2.6">
<h3><span class="header-section-number">6.2.6</span> 为文本输出块添加属性 (*)<a href="rmarkdown-operation.html#chunk-property" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>第 <a href="rmarkdown-document.html#html-css-list">3.1.2.5</a> 节展示了一些基于块选项 <code>class.source</code> 样式化代码块的示例。实际上，在 <strong>knitr</strong> 中有更多类似的选项，如 <code>class.output</code>、<code>class.message</code>、<code>class.warning</code> 以及 <code>class.error</code>。这些选项可以用于将类名添加到相应的文本输出块中，例如 <code>error = TRUE</code> （见第 <a href="rmarkdown-operation.html#chunk-error">6.2.2</a> 节）。就像在第 <a href="rmarkdown-document.html#html-css-list">3.1.2.5</a> 节中演示的那样，这些选项最常见的应用可能是使用根据类名定义的 CSS 规则对输出块进行样式化。</p>
<p>通常情况下，文本输出块本质上是一个单独的代码块，它的 Markdown 源代码如下所示：</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb372-1"><a href="rmarkdown-operation.html#cb372-1" aria-hidden="true" tabindex="-1"></a>```{.className}</span>
<span id="cb372-2"><a href="rmarkdown-operation.html#cb372-2" aria-hidden="true" tabindex="-1"></a>输出行</span>
<span id="cb372-3"><a href="rmarkdown-operation.html#cb372-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>当输出格式为 HTML 时，通常会转换为<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb373-1"><a href="rmarkdown-operation.html#cb373-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;className&quot;</span><span class="kw">&gt;</span></span>
<span id="cb373-2"><a href="rmarkdown-operation.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;code&gt;</span>输出行<span class="kw">&lt;/code&gt;</span></span>
<span id="cb373-3"><a href="rmarkdown-operation.html#cb373-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/pre&gt;</span></span></code></pre></div>
<p><code>class.*</code> 选项控制了 <code>&lt;pre&gt;</code> 元素中的 <code>class</code> 属性，而 <code>&lt;pre&gt;</code> 是之前提到的文本输出块的“容器”。</p>
<p>事实上，这个类只是 HTML 中 <code>&lt;pre&gt;</code> 元素可能的属性之一。一个 HTML 元素可以有许多其他属性，比如宽度、高度和样式等。块选项 <code>attr.*</code>，包括 <code>attr.source</code>、<code>attr.output</code>、<code>attr.message</code>、<code>attr.warning</code> 以及 <code>attr.error</code>，允许用户向文本输出块添加任意属性。例如，使用 <code>attr.source = 'style="background: pink;"'</code>，可以将源代码块的背景颜色更改为粉红色，相应的代码块将是：</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb374-1"><a href="rmarkdown-operation.html#cb374-1" aria-hidden="true" tabindex="-1"></a>```{style=&quot;background: pink;&quot;}</span>
<span id="cb374-2"><a href="rmarkdown-operation.html#cb374-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb374-3"><a href="rmarkdown-operation.html#cb374-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>以及 HTML 输出会是：</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb375-1"><a href="rmarkdown-operation.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;background: pink;&quot;</span><span class="kw">&gt;</span></span>
<span id="cb375-2"><a href="rmarkdown-operation.html#cb375-2" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb375-3"><a href="rmarkdown-operation.html#cb375-3" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/pre&gt;</span></span></code></pre></div>
<p>更多的例子可以参见第 <a href="rmarkdown-operation.html#scrollable-output">6.4.3</a> 节。</p>
<p>作为一个技术性拓展，块选项 <code>class.*</code> 只是 <code>attr.*</code> 的特殊情况，例如，<code>class.source = 'numberLines'</code> 等价于 <code>attr.source = '.numberLines'</code>（注意这里的前导点），但 <code>attr.source</code> 可以取任意的属性值，例如 <code>attr.source = c('.numberLines', 'startFrom="11"')</code>。</p>
<p>这些选项对 HTML 输出非常有用。在某些情况下，这些属性可能对其他输出格式也有用，但这种情况相对较少。这些属性需要被 Pandoc 或第三方的包支持。例如 Pandoc 中，<code>.numberLines</code> 属性适用于 HTML 和 LaTeX 输出；第三方的包则通常需要通过一个 Lua 过滤器，感兴趣者请参见：<a href="https://bookdown.org/yihui/rmarkdown-cookbook/lua-filters.html" class="uri">https://bookdown.org/yihui/rmarkdown-cookbook/lua-filters.html</a>。</p>
</div>
<div id="chunk-multiplot" class="section level3 hasAnchor" number="6.2.7">
<h3><span class="header-section-number">6.2.7</span> 同一张图的多种图像输出格式<a href="rmarkdown-operation.html#chunk-multiplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在大多数情况下，报告可能只需要一种图像格式，例如 <code>png</code> 或 <code>tiff</code>。但有些时候，一些报告需要提交多种格式的图像，这就需要进一步了解图像格式选择的原理。</p>
<p>图像格式由块选项 <code>dev</code> 控制，即渲染图像的图像设备，这个选项的取值可以为设备名（即输出格式）的向量，例如：</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb376-1"><a href="rmarkdown-operation.html#cb376-1" aria-hidden="true" tabindex="-1"></a>```{r, dev=c(&#39;png&#39;, &#39;pdf&#39;, &#39;svg&#39;, &#39;tiff&#39;)}</span>
<span id="cb376-2"><a href="rmarkdown-operation.html#cb376-2" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb376-3"><a href="rmarkdown-operation.html#cb376-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>输出文档中只会呈现第一种格式的图像，但其它格式的图像也会被生成。这里需要注意的是，在默认情况下，图像文件在输出文档呈现后会立即被删除，如要保存这些文件，请参见<a href="rmarkdown-project.html#keep-plot">7.1.5</a>节。</p>
</div>
<div id="chunk-process" class="section level3 hasAnchor" number="6.2.8">
<h3><span class="header-section-number">6.2.8</span> 图像的后期加工 (*)<a href="rmarkdown-operation.html#chunk-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有的时候，可能会需要对已有的图像进行后期加工，从而实现简单的“PS”功能，这一需求可以通过块选项 <code>fig.process</code> 来实现。需要传递给该选项一个输入文件路径、返回已处理图像文件路径的函数。该函数可以有第二个可选参数 <code>options</code>，代表一个由当前块选项组成的列表。</p>
<p>下面的例子展示了如何使用一个功能强大的 <strong>magick</strong>包 <span class="citation">(<a href="#ref-R-magick" role="doc-biblioref">Ooms 2021</a>)</span> 来在图像中添加 R logo。首先，定义一个函数 <code>add_logo()</code>：</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="rmarkdown-operation.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;magick&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="rmarkdown-operation.html#cb378-1" aria-hidden="true" tabindex="-1"></a>add_logo <span class="ot">=</span> <span class="cf">function</span>(path, options) {</span>
<span id="cb378-2"><a href="rmarkdown-operation.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 代码块中创建的图像</span></span>
<span id="cb378-3"><a href="rmarkdown-operation.html#cb378-3" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read</span>(path)</span>
<span id="cb378-4"><a href="rmarkdown-operation.html#cb378-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-5"><a href="rmarkdown-operation.html#cb378-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R logo</span></span>
<span id="cb378-6"><a href="rmarkdown-operation.html#cb378-6" aria-hidden="true" tabindex="-1"></a>  logo <span class="ot">=</span> <span class="fu">file.path</span>(<span class="fu">R.home</span>(<span class="st">&quot;doc&quot;</span>), <span class="st">&quot;html&quot;</span>, <span class="st">&quot;logo.jpg&quot;</span>)</span>
<span id="cb378-7"><a href="rmarkdown-operation.html#cb378-7" aria-hidden="true" tabindex="-1"></a>  logo <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read</span>(logo)</span>
<span id="cb378-8"><a href="rmarkdown-operation.html#cb378-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-9"><a href="rmarkdown-operation.html#cb378-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 默认的重力方向为西北，用户可以通过代码块来改变它</span></span>
<span id="cb378-10"><a href="rmarkdown-operation.html#cb378-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># option magick.gravity</span></span>
<span id="cb378-11"><a href="rmarkdown-operation.html#cb378-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(g <span class="ot">&lt;-</span> options<span class="sc">$</span>magick.gravity)) g <span class="ot">=</span> <span class="st">&#39;northwest&#39;</span></span>
<span id="cb378-12"><a href="rmarkdown-operation.html#cb378-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-13"><a href="rmarkdown-operation.html#cb378-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 在图像中添加 logo</span></span>
<span id="cb378-14"><a href="rmarkdown-operation.html#cb378-14" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_composite</span>(img, logo, <span class="at">gravity =</span> g)</span>
<span id="cb378-15"><a href="rmarkdown-operation.html#cb378-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-16"><a href="rmarkdown-operation.html#cb378-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 写入新的图像中</span></span>
<span id="cb378-17"><a href="rmarkdown-operation.html#cb378-17" aria-hidden="true" tabindex="-1"></a>  magick<span class="sc">::</span><span class="fu">image_write</span>(img, path)</span>
<span id="cb378-18"><a href="rmarkdown-operation.html#cb378-18" aria-hidden="true" tabindex="-1"></a>  path</span>
<span id="cb378-19"><a href="rmarkdown-operation.html#cb378-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>该函数会读取图像的路径，添加 R logo，并将新图像保存到原路径。在默认情况下，logo 会被添加到图像的左上角（西北方向），但用户可以通过自定义块选项 <code>magick.gravity</code>（这个选项名可以是任意的）来自定义位置。</p>
<p>下一步就是将处理函数 <code>add_logo()</code> 应用到代码块中，并使用块选项 <code>fig.process = add_logo</code> 和 <code>magick.gravity = "northeast"</code>，所以 logo 会被添加到右上角。实际输出见图 <a href="rmarkdown-operation.html#fig:magick-logo">6.3</a>。</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="rmarkdown-operation.html#cb379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, .<span class="dv">1</span>, .<span class="dv">1</span>))</span>
<span id="cb379-2"><a href="rmarkdown-operation.html#cb379-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(faithful<span class="sc">$</span>eruptions, <span class="at">breaks =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">&#39;&#39;</span>, <span class="at">col =</span> <span class="st">&#39;gray&#39;</span>, <span class="at">border =</span> <span class="st">&#39;white&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:magick-logo"></span>
<img src="figures/Figure-magick-logo-1.png" alt="通过块选项 fig.process 来给一幅图添加 R logo。"  />
<p class="caption">
图 6.3: 通过块选项 fig.process 来给一幅图添加 R logo。
</p>
</div>
<p>在对<strong>magick</strong>包更加熟悉后，就可以通过更有创意和有用的想法来后期加工图像。</p>
<p>下面的例子展示了 <code>fig.process</code> 选项的另一个应用，其中 <code>pdf2png()</code> 函数可以将 PDF 图像转换成 PNG 格式。第 <a href="rmarkdown-operation.html#chunk-highquality">6.2.9</a> 节介绍了如何使用 <code>tikz</code> 图像设备来生成图，但该设备生成的 PDF 图不适用于非 LaTeX 的输出文档。而在设置块选项 <code>dev = "tikz"</code> 和 <code>fig.process = pdf2png</code> 后，就可以显示图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.4</a> 的 PNG 版本了。</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="rmarkdown-operation.html#cb380-1" aria-hidden="true" tabindex="-1"></a>pdf2png <span class="ot">=</span> <span class="cf">function</span>(path) {</span>
<span id="cb380-2"><a href="rmarkdown-operation.html#cb380-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 只对非LaTeX的输出进行转换</span></span>
<span id="cb380-3"><a href="rmarkdown-operation.html#cb380-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) <span class="fu">return</span>(path)</span>
<span id="cb380-4"><a href="rmarkdown-operation.html#cb380-4" aria-hidden="true" tabindex="-1"></a>  path2 <span class="ot">=</span> xfun<span class="sc">::</span><span class="fu">with_ext</span>(path, <span class="st">&quot;png&quot;</span>)</span>
<span id="cb380-5"><a href="rmarkdown-operation.html#cb380-5" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">=</span> magick<span class="sc">::</span><span class="fu">image_read_pdf</span>(path)</span>
<span id="cb380-6"><a href="rmarkdown-operation.html#cb380-6" aria-hidden="true" tabindex="-1"></a>  magick<span class="sc">::</span><span class="fu">image_write</span>(img, path2, <span class="at">format =</span> <span class="st">&quot;png&quot;</span>)</span>
<span id="cb380-7"><a href="rmarkdown-operation.html#cb380-7" aria-hidden="true" tabindex="-1"></a>  path2</span>
<span id="cb380-8"><a href="rmarkdown-operation.html#cb380-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="chunk-highquality" class="section level3 hasAnchor" number="6.2.9">
<h3><span class="header-section-number">6.2.9</span> 输出高质量的图像 (*)<a href="rmarkdown-operation.html#chunk-highquality" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>不同格式的图像往往在输出质量上有差异。<strong>rmarkdown</strong> 包为不同的输出格式设置了合理的默认图像设备。例如，对 HTML 输出格式使用 <code>png()</code> 设备，所以 <strong>knitr</strong> 将生成 png 绘图文件；而对 PDF 输出格式则使用 <code>pdf()</code> 设备。如果对默认图像设备的输出质量不满意，可以通过块选项 <code>dev</code> 来更改它们。<strong>knitr</strong> 支持的设备为：<code>"bmp"</code>，<code>"postscript"</code>，<code>"pdf"</code>，<code>"png"</code>，<code>"svg"</code>，<code>"jpeg"</code>，<code>"pictex"</code>，<code>"tiff"</code>，<code>"win.metafile"</code>，<code>"cairo_pdf"</code>，<code>"cairo_ps"</code>，<code>"quartz_pdf"</code>，<code>"quartz_png"</code>，<code>"quartz_jpeg"</code>，<code>"quartz_tiff"</code>，<code>"quartz_gif"</code>，<code>"quartz_psd"</code>，<code>"quartz_bmp"</code>，<code>"CairoJPEG"</code>，<code>"CairoPNG"</code>，<code>"CairoPS"</code>，<code>"CairoPDF"</code>，<code>"CairoSVG"</code>，<code>"CairoTIFF"</code>，<code>"Cairo_pdf"</code>，<code>"Cairo_png"</code>，<code>"Cairo_ps"</code>，<code>"Cairo_svg"</code>，<code>"svglite"</code>，<code>"ragg_png"</code>，以及<code>"tikz"</code>。</p>
<p>通常情况下，图像设备名也是函数名。更多关于图像设备的信息可以参阅 R 的帮助页面。例如，可以在 R 的控制台中输入 <code>?svg</code> 来了解关于 <code>svg</code> 设备的细节，它包含在 R 的基础包中，所以不需要额外安装。需要注意的是，<code>quartz_XXX</code> 设备是基于 <code>quartz()</code> 函数的，并且它们仅在 macOS 上可用；<code>CairoXXX</code> 设备来自的 R 包 <strong>cairoDevice</strong><span class="citation">(<a href="#ref-R-cairoDevice" role="doc-biblioref"><strong>R-cairoDevice?</strong></a>)</span>；<code>svglite</code> 设备来自 <strong>svglite</strong> 包 <span class="citation">(<a href="#ref-R-svglite" role="doc-biblioref">Hadley Wickham et al. 2022</a>)</span>；<code>tikz</code> 设备则在 <strong>tikzDevice</strong> 包 <span class="citation">(<a href="#ref-R-tikzDevice" role="doc-biblioref">Sharpsteen and Bracken 2020</a>)</span>中。如果需要使用这些包中的图像设备，必须先安装这些包。</p>
<p>通常，矢量图比位图质量更高，并且可以在不损失质量的情况下缩放矢量图。对于 HTML 输出，可以使用 <code>dev = "svg"</code> 或 <code>dev = "svglite"</code> 来绘制 SVG（可缩放矢量图，Scalable Vector Graphics）。需要注意的是，默认情况下 <code>png</code> 设备生成的图像为位图。</p>
<p>对于 PDF 输出，如果对图像中的字体非常挑剔，可以使用 <code>dev = "tikz"</code>，因为它提供了对 LaTeX 的原生支持，这意味着图像中的所有元素，包括文本和符号，都可以通过 LaTeX 以高质量呈现。图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.4</a> 展示了一个在R图像中用块选项 <code>dev = "tikz"</code> 添加 LaTeX 数学表达式的例子。</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="rmarkdown-operation.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">2</span>, .<span class="dv">1</span>))</span>
<span id="cb381-2"><a href="rmarkdown-operation.html#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(dnorm, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&#39;$x$&#39;</span>, <span class="at">ylab =</span> <span class="st">&#39;$</span><span class="sc">\\</span><span class="st">phi(x)$&#39;</span>,</span>
<span id="cb381-3"><a href="rmarkdown-operation.html#cb381-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&#39;The density function of $N(0, 1)$&#39;</span>)</span>
<span id="cb381-4"><a href="rmarkdown-operation.html#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">1</span>, .<span class="dv">2</span>, <span class="at">cex =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb381-5"><a href="rmarkdown-operation.html#cb381-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;$</span><span class="sc">\\</span><span class="st">phi(x)=</span><span class="sc">\\</span><span class="st">frac{1}{</span><span class="sc">\\</span><span class="st">sqrt{2</span><span class="sc">\\</span><span class="st">pi}}e^{</span><span class="sc">\\</span><span class="st">frac{-x^2}{2}}$&#39;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:dev-tikz"></span>
<img src="images/tikz-latex.png" alt="通过 tikz  设备呈现的图像。"  />
<p class="caption">
图 6.4: 通过 tikz 设备呈现的图像。
</p>
</div>
<p>需要注意的是，R 的基础包实际上支持数学表达式，但它们不是通过 LaTeX 呈现的（具体细节可参见 <code>?plotmath</code>）。此外，还有几个高级选项可以调整 <code>tikz</code> 设备的排版细节（参见 <code>?tikzDevice::tikz</code>）。例如，如果图像中包含多字节字符，可以设置选项：</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="rmarkdown-operation.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tikzDefaultEngine =</span> <span class="st">&#39;xetex&#39;</span>)</span></code></pre></div>
<p>这是因为在处理 LaTeX 文档中的多字节字符时，<code>xetex</code> 通常比默认引擎 <code>pdftex</code> 要好。</p>
<p><code>tikz</code> 设备主要有两个缺点。首先，它需要安装 LaTeX，但这其实并不会很麻烦（见第 <a href="rmarkdown-base.html#install-tinytex">2.2.1</a> 节），虽然还需要几个 LaTeX 包，但这些包也可以通过 TinyTeX 很方便地安装：</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="rmarkdown-operation.html#cb383-1" aria-hidden="true" tabindex="-1"></a>tinytex<span class="sc">::</span><span class="fu">tlmgr_install</span>(<span class="fu">c</span>(<span class="st">&#39;pgf&#39;</span>, <span class="st">&#39;preview&#39;</span>, <span class="st">&#39;xcolor&#39;</span>))</span></code></pre></div>
<p>其次，<code>tikz</code> 设备渲染图的速度通常要慢得多，因为这个设备会生成 LaTeX 文件，并且必须将其编译成 PDF。如果觉得代码块很耗时，可以通过块选项 <code>cache = TRUE</code> 来启用缓存（见第 <a href="rmarkdown-operation.html#cache">6.5</a> 节）。</p>
<p>图 <a href="rmarkdown-operation.html#fig:dev-tikz">6.4</a> 实际上也使用了块选项 <code>fig.process = pdf2png</code>，当输出格式不是 LaTeX时，<code>pdf2png</code> 函数可以将 PDF 图转换为 PNG，其定义见第 <a href="rmarkdown-operation.html#chunk-process">6.2.8</a> 节。如果没有这一转换，可能无法在 Web 浏览器中查看该书在线版本中的 PDF 图。</p>
</div>
<div id="chunk-step-plot" class="section level3 hasAnchor" number="6.2.10">
<h3><span class="header-section-number">6.2.10</span> 带有低级绘图功能的逐步绘图 (*)<a href="rmarkdown-operation.html#chunk-step-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在 R 中，有两种类型的绘图函数可以用来画图：高级的绘图函数用于创建新图，以及低级的绘图函数用于在现有的图中添加元素，更多信息请参见 R 手册《<a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html"><em>An Introduction to R</em></a>》的第 12 章（“Graphical procedures”）。</p>
<p>在默认的情况下，当使用一系列低级的绘图函数来修改以前的图像时，<strong>knitr</strong> 不会显示中间的图，只会显示所有函数执行后的最后一个图。</p>
<p>然而有的时候，尤其是在教学过程中，展示中间的图像是很有用的。为此，可以设置块选项 <code>fig.keep = 'low'</code> 来保留各低级函数更改后的图。例如，图 <a href="rmarkdown-operation.html#fig:low-plots-1">6.5</a> 和图 <a href="rmarkdown-operation.html#fig:low-plots-2">6.6</a> 来自一个带有块选项 <code>fig.keep = 'low'</code> 的单个代码块，尽管它们很像两个代码块的输出结果。不仅如此，本节还通过块选项 <code>fig.cap=c('cars ...', '在现有的...')</code> 给它们分配了不同的标题。</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="rmarkdown-operation.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, .<span class="dv">1</span>, .<span class="dv">1</span>))</span>
<span id="cb384-2"><a href="rmarkdown-operation.html#cb384-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cars)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:low-plots-1"></span>
<img src="figures/Figure-low-plots-1.png" alt="cars 数据的点图" width="2400" />
<p class="caption">
图 6.5: cars 数据的点图
</p>
</div>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="rmarkdown-operation.html#cb385-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data =</span> cars)</span>
<span id="cb385-2"><a href="rmarkdown-operation.html#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(fit)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:low-plots-2"></span>
<img src="figures/Figure-low-plots-2.png" alt="在现有的点图中添加一条回归线" width="2400" />
<p class="caption">
图 6.6: 在现有的点图中添加一条回归线
</p>
</div>
<p>如果想在不同的代码块中继续修改这张图，请参阅第 <a href="rmarkdown-operation.html#modify-before">6.6.5</a> 节。</p>
</div>
<div id="chunk-print" class="section level3 hasAnchor" number="6.2.11">
<h3><span class="header-section-number">6.2.11</span> 在代码块中自定义对象的打印格式 (*)<a href="rmarkdown-operation.html#chunk-print" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在默认的情况下，代码块中的对象会通过 <code>knitr::knit_print()</code> 函数来打印，基本上就相当于 R 中的 <code>print()</code>，但这往往并不能满足用户的需求。有的时候用户可能希望直接输出表格，除了第 <a href="rmarkdown-operation.html#table-advanced">6.1</a> 节提到的方法外，还有更便捷的方法实现。</p>
<p>本质上，<code>knit_print()</code> 函数是一个 S3 通用函数，这意味着可以通过在其上注册 S3 方法来拓展输出方式。下面的例子展示了如何通过 <code>knitr::kable()</code> 来自动将数据框打印成表格：</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb386-1"><a href="rmarkdown-operation.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb386-2"><a href="rmarkdown-operation.html#cb386-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 使用自定义的 `knit_print` 方法来打印数据框</span></span>
<span id="cb386-3"><a href="rmarkdown-operation.html#cb386-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb386-4"><a href="rmarkdown-operation.html#cb386-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-5"><a href="rmarkdown-operation.html#cb386-5" aria-hidden="true" tabindex="-1"></a>首先，定义一个 <span class="in">`knit_print`</span> 方法，并注册它：</span>
<span id="cb386-6"><a href="rmarkdown-operation.html#cb386-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-7"><a href="rmarkdown-operation.html#cb386-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb386-8"><a href="rmarkdown-operation.html#cb386-8" aria-hidden="true" tabindex="-1"></a><span class="in">knit_print.data.frame = function(x, ...) {</span></span>
<span id="cb386-9"><a href="rmarkdown-operation.html#cb386-9" aria-hidden="true" tabindex="-1"></a><span class="in">  res = paste(c(&quot;&quot;, &quot;&quot;, knitr::kable(x)), collapse = &quot;\n&quot;)</span></span>
<span id="cb386-10"><a href="rmarkdown-operation.html#cb386-10" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::asis_output(res)</span></span>
<span id="cb386-11"><a href="rmarkdown-operation.html#cb386-11" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb386-12"><a href="rmarkdown-operation.html#cb386-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-13"><a href="rmarkdown-operation.html#cb386-13" aria-hidden="true" tabindex="-1"></a><span class="in">registerS3method(</span></span>
<span id="cb386-14"><a href="rmarkdown-operation.html#cb386-14" aria-hidden="true" tabindex="-1"></a><span class="in">  &quot;knit_print&quot;, &quot;data.frame&quot;, knit_print.data.frame,</span></span>
<span id="cb386-15"><a href="rmarkdown-operation.html#cb386-15" aria-hidden="true" tabindex="-1"></a><span class="in">  envir = asNamespace(&quot;knitr&quot;)</span></span>
<span id="cb386-16"><a href="rmarkdown-operation.html#cb386-16" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb386-17"><a href="rmarkdown-operation.html#cb386-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb386-18"><a href="rmarkdown-operation.html#cb386-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-19"><a href="rmarkdown-operation.html#cb386-19" aria-hidden="true" tabindex="-1"></a>现在可以在数据框上测试这个自定义的打印方法。</span>
<span id="cb386-20"><a href="rmarkdown-operation.html#cb386-20" aria-hidden="true" tabindex="-1"></a>需要注意的是，之后不再需要显式地调用 <span class="in">`knitr::kable()`</span> 了。</span>
<span id="cb386-21"><a href="rmarkdown-operation.html#cb386-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-22"><a href="rmarkdown-operation.html#cb386-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb386-23"><a href="rmarkdown-operation.html#cb386-23" aria-hidden="true" tabindex="-1"></a><span class="in">head(iris)</span></span>
<span id="cb386-24"><a href="rmarkdown-operation.html#cb386-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb386-25"><a href="rmarkdown-operation.html#cb386-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-26"><a href="rmarkdown-operation.html#cb386-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb386-27"><a href="rmarkdown-operation.html#cb386-27" aria-hidden="true" tabindex="-1"></a><span class="in">head(mtcars)</span></span>
<span id="cb386-28"><a href="rmarkdown-operation.html#cb386-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>更多关于 <code>knit_print()</code> 函数的信息可参见 <strong>knitr</strong> 包的简介：</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="rmarkdown-operation.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vignette</span>(<span class="st">&#39;knit_print&#39;</span>, <span class="at">package =</span> <span class="st">&#39;knitr&#39;</span>)</span></code></pre></div>
<p><strong>printr</strong> 包 <span class="citation">(<a href="#ref-R-printr" role="doc-biblioref"><strong>R-printr?</strong></a>)</span>提供了一些 S3 方法来自动将 R 对象打印为表格。只需要在 R 代码块中输入 <code>library(printr)</code>，所有的方法都将自动注册。</p>
<p>如果觉得上述技术实现难度较大，一些 R Markdown 输出格式，如 <code>html_document</code> 和 <code>pdf_document</code> 也提供了一个选项 <code>df_print</code>，它允许用户自定义数据框的打印行为。例如，如果想通过 <code>knitr::kable()</code> 来将数据框打印为表格，可以设置选项：</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb388-1"><a href="rmarkdown-operation.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span>
<span id="cb388-2"><a href="rmarkdown-operation.html#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">output</span><span class="kw">:</span></span>
<span id="cb388-3"><a href="rmarkdown-operation.html#cb388-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">html_document</span><span class="kw">:</span></span>
<span id="cb388-4"><a href="rmarkdown-operation.html#cb388-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">df_print</span><span class="kw">:</span><span class="at"> kable</span></span>
<span id="cb388-5"><a href="rmarkdown-operation.html#cb388-5" aria-hidden="true" tabindex="-1"></a><span class="pp">---</span></span></code></pre></div>
<p>有关输出格式的更多细节可参阅输出格式的帮助页（如 <code>?rmarkdown::html_document</code>），可以了解 <code>df_print</code> 选项支持哪些输出格式，以及对应的值是什么。</p>
<p>事实上，还可以通过块选项 <code>render</code> 来完全代替打印函数 <code>knit_print()</code>，<code>render</code> 可以使用任何函数来打印对象。例如，如果想使用 <strong>pander</strong> 包来打印对象，可以设置块选项 <code>render</code> 为函数 <code>pander::pander()</code>：</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb389-1"><a href="rmarkdown-operation.html#cb389-1" aria-hidden="true" tabindex="-1"></a>```{r, render=pander::pander}</span>
<span id="cb389-2"><a href="rmarkdown-operation.html#cb389-2" aria-hidden="true" tabindex="-1"></a>head(iris)</span>
<span id="cb389-3"><a href="rmarkdown-operation.html#cb389-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>最终得到的结果见表 <a href="#tab:print-render"><strong>??</strong></a>。</p>
<!-- 这里 pander 没有 caption，引用失效 -->
<table style="width:94%;">
<colgroup>
<col width="20%" />
<col width="19%" />
<col width="20%" />
<col width="19%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Sepal.Length</th>
<th align="center">Sepal.Width</th>
<th align="center">Petal.Length</th>
<th align="center">Petal.Width</th>
<th align="center">Species</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">5.1</td>
<td align="center">3.5</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">4.9</td>
<td align="center">3</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="odd">
<td align="center">4.7</td>
<td align="center">3.2</td>
<td align="center">1.3</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">4.6</td>
<td align="center">3.1</td>
<td align="center">1.5</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">3.6</td>
<td align="center">1.4</td>
<td align="center">0.2</td>
<td align="center">setosa</td>
</tr>
<tr class="even">
<td align="center">5.4</td>
<td align="center">3.9</td>
<td align="center">1.7</td>
<td align="center">0.4</td>
<td align="center">setosa</td>
</tr>
</tbody>
</table>
<p><code>render</code> 选项给了用户完全的自由来打印 R 对象。</p>
</div>
<div id="option-hook" class="section level3 hasAnchor" number="6.2.12">
<h3><span class="header-section-number">6.2.12</span> 选项钩子 (*)<a href="rmarkdown-operation.html#option-hook" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时候，用户可能需要根据其他块选项的值，来动态地改变某个块选项，例如设定图像宽不小于高。实际上，可以使用对象 <code>opts_hooks</code> 来设置一个选项钩子（option hook）来实现这个功能。选项钩子是一个与该选项相关的函数，会在对应的块选项不是 <code>NULL</code> 时自动执行。这个函数将当前代码块的选项列表作为输入参数，并且会返回一个（可能是修改过的）列表。例如，对于图像宽和高的限制，可以调整<code>fig.width</code>选项，使它总是不小于<code>fig.height</code>：</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="rmarkdown-operation.html#cb390-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.width =</span> <span class="cf">function</span>(options) {</span>
<span id="cb390-2"><a href="rmarkdown-operation.html#cb390-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (options<span class="sc">$</span>fig.width <span class="sc">&lt;</span> options<span class="sc">$</span>fig.height) {</span>
<span id="cb390-3"><a href="rmarkdown-operation.html#cb390-3" aria-hidden="true" tabindex="-1"></a>    options<span class="sc">$</span>fig.width <span class="ot">=</span> options<span class="sc">$</span>fig.height</span>
<span id="cb390-4"><a href="rmarkdown-operation.html#cb390-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb390-5"><a href="rmarkdown-operation.html#cb390-5" aria-hidden="true" tabindex="-1"></a>  options</span>
<span id="cb390-6"><a href="rmarkdown-operation.html#cb390-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>因为 <code>fig.width</code> 永远不会是 <code>NULL</code>，所以这个钩子函数总是在代码块之前执行，以更新它的块选项。对于下面的代码块，如果设置了上述的选项钩子，则 <code>fig.width</code> 的实际值将是 6 而不是最初定义的 5：</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb391-1"><a href="rmarkdown-operation.html#cb391-1" aria-hidden="true" tabindex="-1"></a>```{r fig.width = 5, fig.height = 6}</span>
<span id="cb391-2"><a href="rmarkdown-operation.html#cb391-2" aria-hidden="true" tabindex="-1"></a>plot(1:10)</span>
<span id="cb391-3"><a href="rmarkdown-operation.html#cb391-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>另外，第 <a href="rmarkdown-operation.html#chunk-leading">6.2.5</a> 节的最后一个例子介绍了如何将输出格式调整成类似于 R 控制台（console）的格式，这一功能也可以用选项钩子实现，从而可以使用一个单独的块选项 <code>console = TRUE</code> 来代替 <code>comment = ""</code> 和 <code>prompt = TRUE</code>。需要注意的是，<code>console</code> 不是一个内置的 <strong>knitr</strong> 块选项，而是一个自定义的任意的选项名，它的默认值是 <code>NULL</code>。下面是一个完整的例子：</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb392-1"><a href="rmarkdown-operation.html#cb392-1" aria-hidden="true" tabindex="-1"></a>```{r, include=FALSE}</span>
<span id="cb392-2"><a href="rmarkdown-operation.html#cb392-2" aria-hidden="true" tabindex="-1"></a>knitr::opts_hooks$set(console = function(options) {</span>
<span id="cb392-3"><a href="rmarkdown-operation.html#cb392-3" aria-hidden="true" tabindex="-1"></a>  if (isTRUE(options$console)) {</span>
<span id="cb392-4"><a href="rmarkdown-operation.html#cb392-4" aria-hidden="true" tabindex="-1"></a>    options$comment &lt;- &#39;&#39;; options$prompt &lt;- TRUE</span>
<span id="cb392-5"><a href="rmarkdown-operation.html#cb392-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb392-6"><a href="rmarkdown-operation.html#cb392-6" aria-hidden="true" tabindex="-1"></a>  options</span>
<span id="cb392-7"><a href="rmarkdown-operation.html#cb392-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb392-8"><a href="rmarkdown-operation.html#cb392-8" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb392-9"><a href="rmarkdown-operation.html#cb392-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-10"><a href="rmarkdown-operation.html#cb392-10" aria-hidden="true" tabindex="-1"></a>默认输出为：</span>
<span id="cb392-11"><a href="rmarkdown-operation.html#cb392-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-12"><a href="rmarkdown-operation.html#cb392-12" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb392-13"><a href="rmarkdown-operation.html#cb392-13" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb392-14"><a href="rmarkdown-operation.html#cb392-14" aria-hidden="true" tabindex="-1"></a>if (TRUE) {</span>
<span id="cb392-15"><a href="rmarkdown-operation.html#cb392-15" aria-hidden="true" tabindex="-1"></a>  2 + 2</span>
<span id="cb392-16"><a href="rmarkdown-operation.html#cb392-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb392-17"><a href="rmarkdown-operation.html#cb392-17" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb392-18"><a href="rmarkdown-operation.html#cb392-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-19"><a href="rmarkdown-operation.html#cb392-19" aria-hidden="true" tabindex="-1"></a>设置 `console = TRUE` 时的输出为：</span>
<span id="cb392-20"><a href="rmarkdown-operation.html#cb392-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb392-21"><a href="rmarkdown-operation.html#cb392-21" aria-hidden="true" tabindex="-1"></a>```{r, console=TRUE}</span>
<span id="cb392-22"><a href="rmarkdown-operation.html#cb392-22" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb392-23"><a href="rmarkdown-operation.html#cb392-23" aria-hidden="true" tabindex="-1"></a>if (TRUE) {</span>
<span id="cb392-24"><a href="rmarkdown-operation.html#cb392-24" aria-hidden="true" tabindex="-1"></a>  2 + 2</span>
<span id="cb392-25"><a href="rmarkdown-operation.html#cb392-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb392-26"><a href="rmarkdown-operation.html#cb392-26" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>本节第三个例子介绍了如何自动向输出块中添加行号，输出块可以包括源代码块、文本输出、提示信息、警告以及报错。下面的例子使用单个的块选项 <code>numberLines</code> 来控制想要添加行号的输出块。首先定义相关函数：</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="rmarkdown-operation.html#cb393-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_hooks<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb393-2"><a href="rmarkdown-operation.html#cb393-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">numberLines =</span> <span class="cf">function</span>(options) {</span>
<span id="cb393-3"><a href="rmarkdown-operation.html#cb393-3" aria-hidden="true" tabindex="-1"></a>    attrs <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;attr.&quot;</span>, options<span class="sc">$</span>numberLines)</span>
<span id="cb393-4"><a href="rmarkdown-operation.html#cb393-4" aria-hidden="true" tabindex="-1"></a>    options[attrs] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(options[attrs], c, <span class="st">&quot;.numberLines&quot;</span>)</span>
<span id="cb393-5"><a href="rmarkdown-operation.html#cb393-5" aria-hidden="true" tabindex="-1"></a>    options</span>
<span id="cb393-6"><a href="rmarkdown-operation.html#cb393-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb393-7"><a href="rmarkdown-operation.html#cb393-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb393-8"><a href="rmarkdown-operation.html#cb393-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb393-9"><a href="rmarkdown-operation.html#cb393-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb393-10"><a href="rmarkdown-operation.html#cb393-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">numberLines =</span> <span class="fu">c</span>(</span>
<span id="cb393-11"><a href="rmarkdown-operation.html#cb393-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;source&quot;</span>, <span class="st">&quot;output&quot;</span>, <span class="st">&quot;message&quot;</span>, <span class="st">&quot;warning&quot;</span>, <span class="st">&quot;error&quot;</span></span>
<span id="cb393-12"><a href="rmarkdown-operation.html#cb393-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb393-13"><a href="rmarkdown-operation.html#cb393-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>选项钩子 <code>numberLines</code> 会将属性 <code>.numberLines</code> 附加到输出块上，并且通过 <code>opts_chunk$set()</code> 来设置块选项 <code>numberLines</code>，从而确保选项钩子会被执行。</p>
<p>通过以上设置，用户可以在代码块上使用选项 <code>numberLines</code> 来决定哪些输出块将具有行号，例如 <code>numberLines = c('source', 'output')</code> 代表给源代码和文本输出添加行号；而设定 <code>numberLines = NULL</code> 则将完全删除行号。</p>
<p>除了使用选项钩子外，还可以直接设置块选项 <code>、attr.source = '.numberLines'</code> 来实现目的。本节介绍的选项钩子的优点是，它们只在块选项中附加属性 <code>.numberLines</code>，这意味着它们不会覆盖现有的块选项值，例如，下面代码块中的源代码块将被编号（使用上面的设置），并且编号会从第二行开始：</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb394-1"><a href="rmarkdown-operation.html#cb394-1" aria-hidden="true" tabindex="-1"></a>```{r, attr.source=&#39;startFrom=&quot;2&quot;&#39;}</span>
<span id="cb394-2"><a href="rmarkdown-operation.html#cb394-2" aria-hidden="true" tabindex="-1"></a># 这行注释不会被编号</span>
<span id="cb394-3"><a href="rmarkdown-operation.html#cb394-3" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb394-4"><a href="rmarkdown-operation.html#cb394-4" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>这等价于：</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb395-1"><a href="rmarkdown-operation.html#cb395-1" aria-hidden="true" tabindex="-1"></a>```{r, attr.source=c(&#39;startFrom=&quot;2&quot;&#39;, &#39;.numberLines&#39;}</span>
<span id="cb395-2"><a href="rmarkdown-operation.html#cb395-2" aria-hidden="true" tabindex="-1"></a># 这行注释不会被编号</span>
<span id="cb395-3"><a href="rmarkdown-operation.html#cb395-3" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb395-4"><a href="rmarkdown-operation.html#cb395-4" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
</div>
</div>
<div id="other-language" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> 与其他语言的结合<a href="rmarkdown-operation.html#other-language" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>在 R Markdown 中，<strong>knitr</strong> 软件包除了支持 R 语言外，还支持许多其他语言。</p>
<p>不同语言代码块表示方式类似，只需修改代码块中三个反引号后的花括号中的第一个单词即可。例如，<code>```{r}</code> 中的小 <code>r</code> 表示该代码块为 R 代码块，而 <code>```{python}</code> 是指该代码块为 Python 代码块。本节将介绍一些读者可能不太熟悉的语言。</p>
<p>在 knitr 中，每种语言都通过<strong>语言引擎</strong>得到支持。语言引擎本质上是一些函数，它们以源代码和块的选项作为输入，最后输出一个字符串。并通过 <code>knitr::knit_engines</code> 进行管理。可以使用以下方式检查现有引擎：</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="rmarkdown-operation.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">get</span>())</span></code></pre></div>
<pre><code>##  [1] &quot;awk&quot;       &quot;bash&quot;      &quot;coffee&quot;    &quot;gawk&quot;      &quot;groovy&quot;    &quot;haskell&quot;  
##  [7] &quot;lein&quot;      &quot;mysql&quot;     &quot;node&quot;      &quot;octave&quot;    &quot;perl&quot;      &quot;psql&quot;     
## [13] &quot;Rscript&quot;   &quot;ruby&quot;      &quot;sas&quot;       &quot;scala&quot;     &quot;sed&quot;       &quot;sh&quot;       
## [19] &quot;stata&quot;     &quot;zsh&quot;       &quot;asis&quot;      &quot;asy&quot;       &quot;block&quot;     &quot;block2&quot;   
## [25] &quot;bslib&quot;     &quot;c&quot;         &quot;cat&quot;       &quot;cc&quot;        &quot;comment&quot;   &quot;css&quot;      
## [31] &quot;ditaa&quot;     &quot;dot&quot;       &quot;embed&quot;     &quot;exec&quot;      &quot;fortran&quot;   &quot;fortran95&quot;
## [37] &quot;go&quot;        &quot;highlight&quot; &quot;js&quot;        &quot;julia&quot;     &quot;python&quot;    &quot;R&quot;        
## [43] &quot;Rcpp&quot;      &quot;sass&quot;      &quot;scss&quot;      &quot;sql&quot;       &quot;stan&quot;      &quot;targets&quot;  
## [49] &quot;tikz&quot;      &quot;verbatim&quot;</code></pre>
<p>目前，大多数非 R 语言的代码块都是独立执行的。例如，同一文档中的所有 <code>bash</code> 代码块都在各自的会话中单独执行，因此后面的 <code>bash</code> 代码块不能使用在先前 <code>bash</code> 代码块中创建的变量，更改后的工作目录（通过 <code>cd</code> ）在其他 bash 代码块中不会一直存在。只有 R、Python 和 Julia 代码块在同一个会话中执行。并且 R 会话和 Python 会话是两个不同的会话，但是可以从另一个会话访问或操作一个会话的对象 (详见 <a href="https://bookdown.org/yihui/rmarkdown-cookbook/eng-python.html#eng-python" class="uri">https://bookdown.org/yihui/rmarkdown-cookbook/eng-python.html#eng-python</a>)。</p>
<p><strong>R Markdown 权威指南</strong> (<a href="https://bookdown.org/yihui/rmarkdown-cookbook/other-languages.html#ref-rmarkdown2018">Xie, Allaire, and Grolemund 2018</a>) 的<a href="https://bookdown.org/yihui/rmarkdown/language-engines.html">2.7节</a> 展示了如何在 R Markdown 中使用 Python, Shell, SQL, Rcpp, Stan, JavaScript, CSS, Julia, C，和 Fortran 代码。这里就不做进一步介绍，本节主要重点介绍更多的语言引擎。读者可以在下面的库中找到更多的例子： <a href="https://github.com/yihui/knitr-examples" class="uri">https://github.com/yihui/knitr-examples</a> （查找包含单词引擎的文件名）。</p>
<p>首先，通过注册一个自定义语言引擎来说明语言引擎是如何工作的。</p>
<div id="register-language" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> 注册自定义语言引擎 (*)<a href="rmarkdown-operation.html#register-language" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>使用 <code>knitr::knit_engines$set()</code> 注册一个自定义语言引擎。它接受一个函数作为输入，例如：</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="rmarkdown-operation.html#cb398-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">foo =</span> <span class="cf">function</span>(options) {</span>
<span id="cb398-2"><a href="rmarkdown-operation.html#cb398-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 源代码在options$code</span></span>
<span id="cb398-3"><a href="rmarkdown-operation.html#cb398-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>这样就已经注册了 <code>foo</code> 引擎，现在读者可以使用以 <code>```{foo}</code> 开头的代码块了。该引擎函数中的 <code>options</code> 参数是代码块的块选项列表。可以在 <code>options$code</code> 中以字符向量的形式访问块的源代码。例如，对于代码块：</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb399-1"><a href="rmarkdown-operation.html#cb399-1" aria-hidden="true" tabindex="-1"></a>```{foo}</span>
<span id="cb399-2"><a href="rmarkdown-operation.html#cb399-2" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb399-3"><a href="rmarkdown-operation.html#cb399-3" aria-hidden="true" tabindex="-1"></a>2 + 2</span>
<span id="cb399-4"><a href="rmarkdown-operation.html#cb399-4" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><code>options</code> 的代码元素是一个字符向量 <code>c('1 + 1', '2 + 2')</code>。语言引擎实际上并不需要处理计算机语言，但可以处理代码块中的任何文本。首先，来展示一个简单的引擎示例，该引擎将代码块的内容转换为大写：</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="rmarkdown-operation.html#cb400-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">upper =</span> <span class="cf">function</span>(options) {</span>
<span id="cb400-2"><a href="rmarkdown-operation.html#cb400-2" aria-hidden="true" tabindex="-1"></a>  code <span class="ot">&lt;-</span> <span class="fu">paste</span>(options<span class="sc">$</span>code, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb400-3"><a href="rmarkdown-operation.html#cb400-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (options<span class="sc">$</span>eval) <span class="fu">toupper</span>(code) <span class="cf">else</span> code</span>
<span id="cb400-4"><a href="rmarkdown-operation.html#cb400-4" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><code>upper</code> 引擎首先将代码向量合成一个完整的字符串，并用 <code>toupper()</code> 函数把所有字符转换为大写。注意 <code>toupper()</code> 仅在 chunk 选项 <code>eval = TRUE</code> 时才应用，否则返回原始字符串。</p>
<p>以上已经向读者们展示了如何在引擎函数中使用 <code>eval</code> 之类的块选项。类似地，考虑在函数体中添加 <code>if (options$results == 'hide') return()</code> 来隐藏 chunk 选项时的输出 <code>results = 'hide'</code> 。下面是一个使用 <code>upper</code> 引擎的例子：</p>
<blockquote>
<div class="sourceCode" id="cb401"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb401-1"><a href="rmarkdown-operation.html#cb401-1" aria-hidden="true" tabindex="-1"></a>```{upper}</span>
<span id="cb401-2"><a href="rmarkdown-operation.html#cb401-2" aria-hidden="true" tabindex="-1"></a>Hello, **knitr** engines!</span>
<span id="cb401-3"><a href="rmarkdown-operation.html#cb401-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>HELLO, <strong>KNITR</strong> ENGINES!</p>
</blockquote>
<p>下面的例子实现了一个基础的 Python 引擎。<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a>。首先获得代码块中完整的 Python 代码，随后使用 <code>system2()</code> 函数在命令行调用 Python 解释器，最后格式化输出。</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="rmarkdown-operation.html#cb402-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_engines<span class="sc">$</span><span class="fu">set</span>(<span class="at">py =</span> <span class="cf">function</span>(options) {</span>
<span id="cb402-2"><a href="rmarkdown-operation.html#cb402-2" aria-hidden="true" tabindex="-1"></a>  code <span class="ot">&lt;-</span> <span class="fu">paste</span>(options<span class="sc">$</span>code, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb402-3"><a href="rmarkdown-operation.html#cb402-3" aria-hidden="true" tabindex="-1"></a>  out  <span class="ot">&lt;-</span> <span class="fu">system2</span>(</span>
<span id="cb402-4"><a href="rmarkdown-operation.html#cb402-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;python3&#39;</span>, <span class="fu">c</span>(<span class="st">&#39;-c&#39;</span>, <span class="fu">shQuote</span>(code)), <span class="at">stdout =</span> <span class="cn">TRUE</span></span>
<span id="cb402-5"><a href="rmarkdown-operation.html#cb402-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb402-6"><a href="rmarkdown-operation.html#cb402-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">engine_output</span>(options, code, out)</span>
<span id="cb402-7"><a href="rmarkdown-operation.html#cb402-7" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p><code>knitr::engine_output()</code> 常用于返回运行结果，它会自动响应如 <code>echo = FALSE</code> 和 <code>results = 'hide'</code> 等块选项，所以这里不需要额外的 <code>if</code> 语句。</p>
<p>现在，可以使用新的引擎 <code>py</code> 运行 Python 代码，例如：</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb403-1"><a href="rmarkdown-operation.html#cb403-1" aria-hidden="true" tabindex="-1"></a>```{py}</span>
<span id="cb403-2"><a href="rmarkdown-operation.html#cb403-2" aria-hidden="true" tabindex="-1"></a>print(1 + 1)</span>
<span id="cb403-3"><a href="rmarkdown-operation.html#cb403-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<pre><code>## 2</code></pre>
<p>如果觉得自己的版本比现有的版本更好，读者甚至可以通过 <code>knitr::knit_engines$set()</code> 重写现有的语言引擎。但是，通常不建议读者这样做，因为这会让熟悉现有引擎的用户感到惊讶。不过无论如何都想读者意识到这种可能性。</p>
<p><strong>knitr</strong> 中许多语言的引擎使用了类似的实现方法。读者可以在 <a href="https://github.com/yihui/knitr/blob/master/R/engine.R" class="uri">https://github.com/yihui/knitr/blob/master/R/engine.R</a> 查看内置语言引擎的源代码。</p>
</div>
<div id="python-rmd" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> 运行 Python 代码并与 Python 交互<a href="rmarkdown-operation.html#python-rmd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R Markdown 和 <strong>knitr</strong> 支持 Python。要将 Python 代码块添加到 R Markdown 文档中，可以在块的头部变为<code>```{python}</code>，例如：</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb405-1"><a href="rmarkdown-operation.html#cb405-1" aria-hidden="true" tabindex="-1"></a>```{python}</span>
<span id="cb405-2"><a href="rmarkdown-operation.html#cb405-2" aria-hidden="true" tabindex="-1"></a>print(&quot;Hello Python!&quot;)</span>
<span id="cb405-3"><a href="rmarkdown-operation.html#cb405-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>读者可以像往常一样在 chunk 头中添加 chunk 选项，比如 <code>echo = FALSE</code> 或 <code>eval = FALSE</code> ，并且也支持使用 Python 中的 <strong>matplotlib</strong> 包绘图。</p>
<p>R Markdown 和 <strong>knitr</strong> 中的 Python 支持 <strong>reticulate</strong> 包 <span class="citation">(<a href="#ref-R-reticulate" role="doc-biblioref">Ushey, Allaire, and Tang 2022</a>)</span>，这个包的一个重要特性是它允许 Python 和 R 之间的双向通信。例如，可以在 R 会话中通过 <strong>reticulate</strong> 包中的 py 对象访问或创建 Python 变量：</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb406-1"><a href="rmarkdown-operation.html#cb406-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, setup}</span></span>
<span id="cb406-2"><a href="rmarkdown-operation.html#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="in">library(reticulate)</span></span>
<span id="cb406-3"><a href="rmarkdown-operation.html#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb406-4"><a href="rmarkdown-operation.html#cb406-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-5"><a href="rmarkdown-operation.html#cb406-5" aria-hidden="true" tabindex="-1"></a>在 Python 会话中创建一个变量 <span class="in">`x`</span>:</span>
<span id="cb406-6"><a href="rmarkdown-operation.html#cb406-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-7"><a href="rmarkdown-operation.html#cb406-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-8"><a href="rmarkdown-operation.html#cb406-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb406-9"><a href="rmarkdown-operation.html#cb406-9" aria-hidden="true" tabindex="-1"></a><span class="in">x = [1, 2, 3]</span></span>
<span id="cb406-10"><a href="rmarkdown-operation.html#cb406-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb406-11"><a href="rmarkdown-operation.html#cb406-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-12"><a href="rmarkdown-operation.html#cb406-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-13"><a href="rmarkdown-operation.html#cb406-13" aria-hidden="true" tabindex="-1"></a>在 R 代码块中访问 Python 变量 <span class="in">`x`</span>:</span>
<span id="cb406-14"><a href="rmarkdown-operation.html#cb406-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-15"><a href="rmarkdown-operation.html#cb406-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb406-16"><a href="rmarkdown-operation.html#cb406-16" aria-hidden="true" tabindex="-1"></a><span class="in">py$x</span></span>
<span id="cb406-17"><a href="rmarkdown-operation.html#cb406-17" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb406-18"><a href="rmarkdown-operation.html#cb406-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-19"><a href="rmarkdown-operation.html#cb406-19" aria-hidden="true" tabindex="-1"></a>在 Python 会话中使用 R 创建一个新变量 <span class="in">`y`</span>， 并传递一个数据帧给 <span class="in">`y`</span>:</span>
<span id="cb406-20"><a href="rmarkdown-operation.html#cb406-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-21"><a href="rmarkdown-operation.html#cb406-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb406-22"><a href="rmarkdown-operation.html#cb406-22" aria-hidden="true" tabindex="-1"></a><span class="in">py$y &lt;- head(cars)</span></span>
<span id="cb406-23"><a href="rmarkdown-operation.html#cb406-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb406-24"><a href="rmarkdown-operation.html#cb406-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-25"><a href="rmarkdown-operation.html#cb406-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-26"><a href="rmarkdown-operation.html#cb406-26" aria-hidden="true" tabindex="-1"></a>在 Python 中输出变量 <span class="in">`y`</span>：</span>
<span id="cb406-27"><a href="rmarkdown-operation.html#cb406-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-28"><a href="rmarkdown-operation.html#cb406-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb406-29"><a href="rmarkdown-operation.html#cb406-29" aria-hidden="true" tabindex="-1"></a><span class="in">print(y)</span></span>
<span id="cb406-30"><a href="rmarkdown-operation.html#cb406-30" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>有关 <strong>reticulate</strong> 的更多信息，可以在查看它的文档
<a href="https://rstudio.github.io/reticulate/" class="uri">https://rstudio.github.io/reticulate/</a>。</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="rmarkdown-operation.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb407-2"><a href="rmarkdown-operation.html#cb407-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb407-3"><a href="rmarkdown-operation.html#cb407-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb407-4"><a href="rmarkdown-operation.html#cb407-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
<p>设置 <code>comment = ""</code> 的一个理由是，使用 R 控制台（console）的用户对其更为熟悉。在 R 控制台中，用户不会在文本输出前面看到<code>##</code>。如果想模仿 R 控制台的行为，可以将 <code>comment = ""</code> 和 <code>prompt = TRUE</code> 结合在一起使用，例如：</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb408-1"><a href="rmarkdown-operation.html#cb408-1" aria-hidden="true" tabindex="-1"></a>```{r, comment=&quot;&quot;, prompt=TRUE}</span>
<span id="cb408-2"><a href="rmarkdown-operation.html#cb408-2" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb408-3"><a href="rmarkdown-operation.html#cb408-3" aria-hidden="true" tabindex="-1"></a>if (TRUE) {</span>
<span id="cb408-4"><a href="rmarkdown-operation.html#cb408-4" aria-hidden="true" tabindex="-1"></a>  2 + 2</span>
<span id="cb408-5"><a href="rmarkdown-operation.html#cb408-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb408-6"><a href="rmarkdown-operation.html#cb408-6" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>对于曾经在 R 控制台中输入并运行过代码的用户，输出结果看起来应该相当熟悉，因为源代码中包含提示字符（prompt character） <code>&gt;</code> 和延续字符（continuation character） <code>+</code>，这就是 <code>prompt = TRUE</code> 的作用：</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="rmarkdown-operation.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb409-2"><a href="rmarkdown-operation.html#cb409-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">2</span></span>
<span id="cb409-3"><a href="rmarkdown-operation.html#cb409-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="cf">if</span> (<span class="cn">TRUE</span>) {</span>
<span id="cb409-4"><a href="rmarkdown-operation.html#cb409-4" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb409-5"><a href="rmarkdown-operation.html#cb409-5" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> }</span>
<span id="cb409-6"><a href="rmarkdown-operation.html#cb409-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">4</span></span></code></pre></div>
</div>
<div id="chunk-asis" class="section level3 hasAnchor" number="6.3.3">
<h3><span class="header-section-number">6.3.3</span> 通过 <code>asis</code> 引擎有条件地执行内容<a href="rmarkdown-operation.html#chunk-asis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>正如其名，<code>asis</code> 引擎会按原样（as is）输出块的内容。使用此引擎的优点在于，用户可以有条件地包含一些内容，块的内容的显示由块选项 <code>echo</code> 决定。当 <code>echo = FALSE</code> 时，数据块将被隐藏。下面是一个简单的例子：</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb410-1"><a href="rmarkdown-operation.html#cb410-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb410-2"><a href="rmarkdown-operation.html#cb410-2" aria-hidden="true" tabindex="-1"></a>getRandomNumber &lt;- function() {</span>
<span id="cb410-3"><a href="rmarkdown-operation.html#cb410-3" aria-hidden="true" tabindex="-1"></a>  sample(1:6, 1)</span>
<span id="cb410-4"><a href="rmarkdown-operation.html#cb410-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb410-5"><a href="rmarkdown-operation.html#cb410-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb410-6"><a href="rmarkdown-operation.html#cb410-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-7"><a href="rmarkdown-operation.html#cb410-7" aria-hidden="true" tabindex="-1"></a>```{asis, echo = getRandomNumber() == 4}</span>
<span id="cb410-8"><a href="rmarkdown-operation.html#cb410-8" aria-hidden="true" tabindex="-1"></a>根据 https://xkcd.com/221/,  刚生成的是一个**真**随机数!</span>
<span id="cb410-9"><a href="rmarkdown-operation.html#cb410-9" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>只有当条件 <code>getRandomNumber() == 4</code> （随机）为真时， <code>asis</code> 块中的文本才会显示。</p>
</div>
<div id="chunk-shell" class="section level3 hasAnchor" number="6.3.4">
<h3><span class="header-section-number">6.3.4</span> 执行 Shell 脚本<a href="rmarkdown-operation.html#chunk-shell" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>【之后再修改】
使用者可以根据自己的喜好，使用 <code>bash</code>、 <code>sh</code> 或 <code>zsh</code> 任何一种引擎运行 Shell 脚本。下面是一个带有 chunk 头 <code>```{bash}</code> 的 bash 示例：</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb411-1"><a href="rmarkdown-operation.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.Rmd <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 5</span></code></pre></div>
<pre><code>## [1] &quot;01-intro.Rmd&quot;       &quot;02-base.Rmd&quot;        &quot;03-document.Rmd&quot;   
## [4] &quot;04-working.Rmd&quot;     &quot;05-interaction.Rmd&quot;</code></pre>
<p>注意，bash是用 R 函数 <code>system2()</code> 调用的。它将忽略配置文件，例如 <code>~/.bash_profile</code> 和 <code>~/.bash_login</code>，其中可能定义了命令别名或修改过的环境变量(如 <code>PATH</code> 变量)。如果想要这些配置文件像你使用终端时一样被执行，可以通过引擎将参数 <code>-l</code> 传递给 <code>bash</code>。例如：</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb413-1"><a href="rmarkdown-operation.html#cb413-1" aria-hidden="true" tabindex="-1"></a>```{bash, engine.opts=&#39;-l&#39;}</span>
<span id="cb413-2"><a href="rmarkdown-operation.html#cb413-2" aria-hidden="true" tabindex="-1"></a>echo $PATH</span>
<span id="cb413-3"><a href="rmarkdown-operation.html#cb413-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>如果想对所有 <code>bash</code> 块全局启用 <code>-l</code> 参数，可以在文档开头的 global chunk 选项中设置为：</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="rmarkdown-operation.html#cb414-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">engine.opts =</span> <span class="fu">list</span>(<span class="at">bash =</span> <span class="st">&#39;-l&#39;</span>))</span></code></pre></div>
<p>还可以将其他参数作为字符向量提供给 chunk 选项<code>engine.opts</code>，从而传递给 <code>bash</code>。</p>
</div>
<div id="cat-file" class="section level3 hasAnchor" number="6.3.5">
<h3><span class="header-section-number">6.3.5</span> 通过 cat 引擎将块内容写入文件<a href="rmarkdown-operation.html#cat-file" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时将代码块的内容写入外部文件，然后在其他代码块中使用此文件可能会很有用。当然，可以通过 <code>writeLines()</code> 等 R 函数来实现这一点，但问题是，当内容相对较长或包含特殊字符时，传递给 <code>writeLines()</code> 的字符串可能看起来很笨拙。下面是将长字符串写入文件 <code>my-file.txt</code> 的示例：</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="rmarkdown-operation.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="st">&quot;这是一个长字符串。它有多条线。记得要避免双引号 </span><span class="sc">\&quot;\&quot;</span><span class="st">, 但是‘单引号’是可以的。</span></span>
<span id="cb415-2"><a href="rmarkdown-operation.html#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="st">希望思考关于需要多少反斜杠时，不要失去理智。例如，到底是 &#39;</span><span class="sc">\t</span><span class="st">&#39;、&#39;</span><span class="sc">\\</span><span class="st">t&#39; 还是 &#39;</span><span class="sc">\\\\</span><span class="st">t&#39;?&quot;</span>, <span class="at">con =</span> <span class="st">&quot;my-file.txt&quot;</span>)</span></code></pre></div>
<p>自 R 4.0.0 以来，这个问题已经大大缓解了，因为 R 开始支持 <code>r"( )"</code> 中的原始字符串（参见帮助页面 <code>?Quotes</code>），而且读者不需要记住所有关于特殊字符的规则。即使使用原始字符串，在代码块中显式地将长字符串写入文件仍然会让读者分心。</p>
<p><strong>knitr</strong> 中的 <code>cat</code> 引擎为读者提供了一种在代码块中呈现文本内容或将其写入外部文件的方法，而无需考虑有关 R 字符串的所有规则（例如，当需要字面上的反斜杠时，读者需要使用双反斜杠）。</p>
<p>要将块内容写入文件，请在块选项 <code>engine.opts</code> 中指定文件路径，例如 <code>engine.opts = list(file = 'path/to/file')</code>。在引擎盖下，在 <code>engine.opts</code> 中指定的值列表将传递给该函数 <code>base::cat()</code> 并且 <code>file</code> 是 <code>base::cat()</code> 的参数之一。</p>
<p>接下来，将提供三个示例来说明 <code>cat</code> 引擎的用法。</p>
<div id="write-css" class="section level4 hasAnchor" number="6.3.5.1">
<h4><span class="header-section-number">6.3.5.1</span> 写入 CSS 文件<a href="rmarkdown-operation.html#write-css" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- \@ref(chunk-styling) -->
<p>第一种方法是在 R Markdown 文档中嵌入一个 <code>css</code> 代码块，以使用 CSS 样式化元素。另一种方法是通过一些 R Markdown 输出格式(如，<code>html_document</code>)的 CSS 选项为 Pandoc 提供一个定制的 CSS 文件。 <code>cat</code> 引擎可以用来从 Rmd 编写这个 CSS 文件。</p>
<p>下面的例子展示了如何从文档中的块生成 <code>custom.css</code> 文件，并将文件路径传递给 <code>html_document</code> 格式的 <code>css</code> 选项。</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb416-1"><a href="rmarkdown-operation.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb416-2"><a href="rmarkdown-operation.html#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;从代码块中创建一个 CSS 文件&quot;</span></span>
<span id="cb416-3"><a href="rmarkdown-operation.html#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb416-4"><a href="rmarkdown-operation.html#cb416-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document:</span></span>
<span id="cb416-5"><a href="rmarkdown-operation.html#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="co">    css: custom.css</span></span>
<span id="cb416-6"><a href="rmarkdown-operation.html#cb416-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb416-7"><a href="rmarkdown-operation.html#cb416-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-8"><a href="rmarkdown-operation.html#cb416-8" aria-hidden="true" tabindex="-1"></a>下面的 chunck 中将写入 <span class="in">`custom.css`</span>，它将在 Pandoc 转换期间使用。</span>
<span id="cb416-9"><a href="rmarkdown-operation.html#cb416-9" aria-hidden="true" tabindex="-1"></a><span class="in">```{cat, engine.opts = list(file = &quot;custom.css&quot;)}</span></span>
<span id="cb416-10"><a href="rmarkdown-operation.html#cb416-10" aria-hidden="true" tabindex="-1"></a><span class="in">h2 {</span></span>
<span id="cb416-11"><a href="rmarkdown-operation.html#cb416-11" aria-hidden="true" tabindex="-1"></a><span class="in">  color: blue;</span></span>
<span id="cb416-12"><a href="rmarkdown-operation.html#cb416-12" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb416-13"><a href="rmarkdown-operation.html#cb416-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb416-14"><a href="rmarkdown-operation.html#cb416-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-15"><a href="rmarkdown-operation.html#cb416-15" aria-hidden="true" tabindex="-1"></a><span class="fu">## 标题会变蓝</span></span></code></pre></div>
<p><code>css</code> 代码块方法与此方法之间的唯一区别是，前一种方法将 CSS 代码写在输出文档的 <code>&lt;body&gt;</code> 标记内的位置（即，在代码块的位置），并且将 CSS 代码写在输出文档的 <code>&lt;body&gt;</code> 标记内。 后一种方法将 CSS 写入输出文档的 <code>&lt;body&gt;</code> 区域。输出文档中不会有任何实际的视觉差异。</p>
</div>
<div id="write-latex" class="section level4 hasAnchor" number="6.3.5.2">
<h4><span class="header-section-number">6.3.5.2</span> 在序言中包含 LaTeX 代码<a href="rmarkdown-operation.html#write-latex" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!-- \@ref(latex-preamble) -->
<p>在 6.1 节中，我们介绍了如何将 LaTeX 代码添加到序言中，这需要一个外部 <code>.tex</code> 文件。也可以从 Rmd 生成此文件，这是一个示例：</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb417-1"><a href="rmarkdown-operation.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb417-2"><a href="rmarkdown-operation.html#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;从代码块中创建一个 .tex 文件&quot;</span></span>
<span id="cb417-3"><a href="rmarkdown-operation.html#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> &quot;Jane Doe&quot;</span></span>
<span id="cb417-4"><a href="rmarkdown-operation.html#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="an">classoption:</span><span class="co"> twoside</span></span>
<span id="cb417-5"><a href="rmarkdown-operation.html#cb417-5" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb417-6"><a href="rmarkdown-operation.html#cb417-6" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf_document:</span></span>
<span id="cb417-7"><a href="rmarkdown-operation.html#cb417-7" aria-hidden="true" tabindex="-1"></a><span class="co">    includes:</span></span>
<span id="cb417-8"><a href="rmarkdown-operation.html#cb417-8" aria-hidden="true" tabindex="-1"></a><span class="co">      in_header: preamble.tex</span></span>
<span id="cb417-9"><a href="rmarkdown-operation.html#cb417-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb417-10"><a href="rmarkdown-operation.html#cb417-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-11"><a href="rmarkdown-operation.html#cb417-11" aria-hidden="true" tabindex="-1"></a><span class="fu"># 它是如何运作的</span></span>
<span id="cb417-12"><a href="rmarkdown-operation.html#cb417-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-13"><a href="rmarkdown-operation.html#cb417-13" aria-hidden="true" tabindex="-1"></a>将代码块写入文件 <span class="in">`preamble.tex`</span> 以定义 PDF 输出文档的页眉和页脚：</span>
<span id="cb417-14"><a href="rmarkdown-operation.html#cb417-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-15"><a href="rmarkdown-operation.html#cb417-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{cat, engine.opts=list(file = &#39;preamble.tex&#39;)}</span></span>
<span id="cb417-16"><a href="rmarkdown-operation.html#cb417-16" aria-hidden="true" tabindex="-1"></a><span class="in">\usepackage{fancyhdr}</span></span>
<span id="cb417-17"><a href="rmarkdown-operation.html#cb417-17" aria-hidden="true" tabindex="-1"></a><span class="in">\usepackage{lipsum}</span></span>
<span id="cb417-18"><a href="rmarkdown-operation.html#cb417-18" aria-hidden="true" tabindex="-1"></a><span class="in">\pagestyle{fancy}</span></span>
<span id="cb417-19"><a href="rmarkdown-operation.html#cb417-19" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyhead[CO,CE]{This is fancy header}</span></span>
<span id="cb417-20"><a href="rmarkdown-operation.html#cb417-20" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyfoot[CO,CE]{And this is a fancy footer}</span></span>
<span id="cb417-21"><a href="rmarkdown-operation.html#cb417-21" aria-hidden="true" tabindex="-1"></a><span class="in">\fancyfoot[LE,RO]{\thepage}</span></span>
<span id="cb417-22"><a href="rmarkdown-operation.html#cb417-22" aria-hidden="true" tabindex="-1"></a><span class="in">\fancypagestyle{plain}{\pagestyle{fancy}}</span></span>
<span id="cb417-23"><a href="rmarkdown-operation.html#cb417-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb417-24"><a href="rmarkdown-operation.html#cb417-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-25"><a href="rmarkdown-operation.html#cb417-25" aria-hidden="true" tabindex="-1"></a>\lipsum<span class="co">[</span><span class="ot">1-15</span><span class="co">]</span></span>
<span id="cb417-26"><a href="rmarkdown-operation.html#cb417-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-27"><a href="rmarkdown-operation.html#cb417-27" aria-hidden="true" tabindex="-1"></a><span class="fu"># 更多随机内容</span></span>
<span id="cb417-28"><a href="rmarkdown-operation.html#cb417-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-29"><a href="rmarkdown-operation.html#cb417-29" aria-hidden="true" tabindex="-1"></a>\lipsum<span class="co">[</span><span class="ot">16-30</span><span class="co">]</span></span></code></pre></div>
<p>在上面的 <code>cat</code> 代码块中的 LaTeX 代码中，我们定义了 PDF 文档的页眉和页脚。如果我们还想在页脚中显示作者姓名，我们可以用选项<code>engine.opts = list(file = 'preamble.tex', append = TRUE)</code> 和 <code>code = sprintf('\\fancyfoot[LO,RE]{%s}', rmarkdown::metadata$author)</code>将作者信息附加到另一个 <code>cat</code> 代码块中的 <code>preamble.tex</code> 中。要理解这是如何工作的，请回忆一下我们在本节前面提到的：<code>engine.opts</code> 被传递给 <code>base::cat()</code>。(因此 <code>append = TRUE</code> 被传递给 <code>cat()</code>)，你可以通过阅读 16.2 节来理解 chunk 选项代码。
<!-- \@ref(option-code) --></p>
</div>
<div id="yaml-input" class="section level4 hasAnchor" number="6.3.5.3">
<h4><span class="header-section-number">6.3.5.3</span> 将 YAML 数据写入文件并显示它<a href="rmarkdown-operation.html#yaml-input" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>默认情况下，<code>cat</code> 代码块的内容不会显示在输出文档中。如果还想在写出它之后显示它，则将块选项 <code>class.source</code> 设置为语言名称。语言名称用于语法高亮显示。在下面的例子中，我们指定为 <code>yaml</code> 语言：</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb418-1"><a href="rmarkdown-operation.html#cb418-1" aria-hidden="true" tabindex="-1"></a>```{cat, engine.opts=list(file=&#39;demo.yml&#39;), class.source=&#39;yaml&#39;}</span>
<span id="cb418-2"><a href="rmarkdown-operation.html#cb418-2" aria-hidden="true" tabindex="-1"></a>a:</span>
<span id="cb418-3"><a href="rmarkdown-operation.html#cb418-3" aria-hidden="true" tabindex="-1"></a>  aa: &quot;something&quot;</span>
<span id="cb418-4"><a href="rmarkdown-operation.html#cb418-4" aria-hidden="true" tabindex="-1"></a>  bb: 1</span>
<span id="cb418-5"><a href="rmarkdown-operation.html#cb418-5" aria-hidden="true" tabindex="-1"></a>b:</span>
<span id="cb418-6"><a href="rmarkdown-operation.html#cb418-6" aria-hidden="true" tabindex="-1"></a>  aa: &quot;something else&quot;</span>
<span id="cb418-7"><a href="rmarkdown-operation.html#cb418-7" aria-hidden="true" tabindex="-1"></a>  bb: 2</span>
<span id="cb418-8"><a href="rmarkdown-operation.html#cb418-8" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>其输出显示在下面，并且还生成了一个文件 <code>demo.yml</code>。</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode yaml yaml"><code class="sourceCode yaml"><span id="cb419-1"><a href="rmarkdown-operation.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="fu">a</span><span class="kw">:</span></span>
<span id="cb419-2"><a href="rmarkdown-operation.html#cb419-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aa</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;something&quot;</span></span>
<span id="cb419-3"><a href="rmarkdown-operation.html#cb419-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bb</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb419-4"><a href="rmarkdown-operation.html#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="fu">b</span><span class="kw">:</span></span>
<span id="cb419-5"><a href="rmarkdown-operation.html#cb419-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">aa</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;something else&quot;</span></span>
<span id="cb419-6"><a href="rmarkdown-operation.html#cb419-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">bb</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span></code></pre></div>
<p>为了显示文件 <code>demo.yml</code> 确实已经生成，我们可以尝试使用 <strong>yaml</strong> 包 <span class="citation">(<a href="#ref-R-yaml" role="doc-biblioref">Garbett et al. 2022</a>)</span> 将其读入 R。</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="rmarkdown-operation.html#cb420-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">tree</span>(yaml<span class="sc">::</span><span class="fu">read_yaml</span>(<span class="st">&#39;demo.yml&#39;</span>))</span></code></pre></div>
<pre><code>## List of 2
##  |-a:List of 2
##  |  |-aa: chr &quot;something&quot;
##  |  |-bb: int 1
##  |-b:List of 2
##     |-aa: chr &quot;something else&quot;
##     |-bb: int 2</code></pre>
</div>
</div>
<div id="sas-rmd" class="section level3 hasAnchor" number="6.3.6">
<h3><span class="header-section-number">6.3.6</span> 运行 SAS 代码<a href="rmarkdown-operation.html#sas-rmd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>R Markdown 内置了 <code>sas</code> 引擎运行 SAS (<a href="https://www.sas.com" class="uri">https://www.sas.com</a>) 代码。用户需要确保 SAS 可执行文件位于环境变量 <code>PATH</code> 中，或者也可以通过块选项 <code>engine.path</code> 指定 SAS 可执行文件的路径，例如：<code>engine.path = "C:\\Program Files\\SASHome\\x86\\SASFoundation\\9.3\\sas.exe"</code>。下面是一个输出 “Hello World” 的示例：</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb422-1"><a href="rmarkdown-operation.html#cb422-1" aria-hidden="true" tabindex="-1"></a>```{sas}</span>
<span id="cb422-2"><a href="rmarkdown-operation.html#cb422-2" aria-hidden="true" tabindex="-1"></a>data _null_;</span>
<span id="cb422-3"><a href="rmarkdown-operation.html#cb422-3" aria-hidden="true" tabindex="-1"></a>put &#39;Hello, world!&#39;;</span>
<span id="cb422-4"><a href="rmarkdown-operation.html#cb422-4" aria-hidden="true" tabindex="-1"></a>run;</span>
<span id="cb422-5"><a href="rmarkdown-operation.html#cb422-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
</div>
<div id="stata-rmd" class="section level3 hasAnchor" number="6.3.7">
<h3><span class="header-section-number">6.3.7</span> 运行 Stata 代码<a href="rmarkdown-operation.html#stata-rmd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>stata</code> 引擎 可运行 Stata (<a href="https://www.stata.com" class="uri">https://www.stata.com</a>) 代码。与 SAS 类似，R Markdown 会调用环境变量或 <code>engine.path</code> 指定的 Stata 可执行文件，例如：<code>engine.path = "C:/Program Files (x86)/Stata15/StataSE-64.exe"</code>。</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb423-1"><a href="rmarkdown-operation.html#cb423-1" aria-hidden="true" tabindex="-1"></a>```{stata}</span>
<span id="cb423-2"><a href="rmarkdown-operation.html#cb423-2" aria-hidden="true" tabindex="-1"></a>sysuse auto</span>
<span id="cb423-3"><a href="rmarkdown-operation.html#cb423-3" aria-hidden="true" tabindex="-1"></a>summarize</span>
<span id="cb423-4"><a href="rmarkdown-operation.html#cb423-4" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><strong>knitr</strong> 内置的 <code>stata</code> 引擎功能有限。Doug Hemken 开发的 <strong>Statamarkdown</strong> 包 扩展了该引擎，Github 主页见 <a href="https://github.com/Hemken/Statamarkdown" class="uri">https://github.com/Hemken/Statamarkdown</a>。</p>
</div>
<div id="asymptote-plot" class="section level3 hasAnchor" number="6.3.8">
<h3><span class="header-section-number">6.3.8</span> 用渐近线 Asymptote 创建图形<a href="rmarkdown-operation.html#asymptote-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>渐近线 Asymptote (<a href="https://asymptote.sourceforge.io" class="uri">https://asymptote.sourceforge.io</a>) 是矢量图形的强大语言。如果你已经安装了 Asymptote，那么可以使用 <code>asy</code> 引擎在 R Markdown 中编写并运行 Asymptote 代码(有关安装的说明，请参阅其网站)。下面是从仓库 <a href="https://github.com/vectorgraphics/asymptote" class="uri">https://github.com/vectorgraphics/asymptote</a> 中复制的示例，其输出如图 <a href="#fig:elevation"><strong>??</strong></a> 所示：</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb424-1"><a href="rmarkdown-operation.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> graph3<span class="op">;</span></span>
<span id="cb424-2"><a href="rmarkdown-operation.html#cb424-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> grid3<span class="op">;</span></span>
<span id="cb424-3"><a href="rmarkdown-operation.html#cb424-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> palette<span class="op">;</span></span>
<span id="cb424-4"><a href="rmarkdown-operation.html#cb424-4" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span>prc <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb424-5"><a href="rmarkdown-operation.html#cb424-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-6"><a href="rmarkdown-operation.html#cb424-6" aria-hidden="true" tabindex="-1"></a>currentprojection<span class="op">=</span>orthographic<span class="op">(</span><span class="fl">0.8</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb424-7"><a href="rmarkdown-operation.html#cb424-7" aria-hidden="true" tabindex="-1"></a>size<span class="op">(</span><span class="dv">500</span><span class="op">,</span><span class="dv">400</span><span class="op">,</span>IgnoreAspect<span class="op">);</span></span>
<span id="cb424-8"><a href="rmarkdown-operation.html#cb424-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-9"><a href="rmarkdown-operation.html#cb424-9" aria-hidden="true" tabindex="-1"></a>real f<span class="op">(</span>pair z<span class="op">)</span> <span class="op">{</span><span class="cf">return</span> cos<span class="op">(</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>z<span class="op">.</span>x<span class="op">)*</span>sin<span class="op">(</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>z<span class="op">.</span>y<span class="op">);}</span></span>
<span id="cb424-10"><a href="rmarkdown-operation.html#cb424-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-11"><a href="rmarkdown-operation.html#cb424-11" aria-hidden="true" tabindex="-1"></a>surface s<span class="op">=</span>surface<span class="op">(</span>f<span class="op">,(-</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">,-</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">),(</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">,</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span><span class="op">),</span><span class="dv">50</span><span class="op">,</span>Spline<span class="op">);</span></span>
<span id="cb424-12"><a href="rmarkdown-operation.html#cb424-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-13"><a href="rmarkdown-operation.html#cb424-13" aria-hidden="true" tabindex="-1"></a>surface S<span class="op">=</span>planeproject<span class="op">(</span>unitsquare3<span class="op">)*</span>s<span class="op">;</span></span>
<span id="cb424-14"><a href="rmarkdown-operation.html#cb424-14" aria-hidden="true" tabindex="-1"></a>S<span class="op">.</span>colors<span class="op">(</span>palette<span class="op">(</span>s<span class="op">.</span>map<span class="op">(</span>zpart<span class="op">),</span>Rainbow<span class="op">()));</span></span>
<span id="cb424-15"><a href="rmarkdown-operation.html#cb424-15" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>S<span class="op">,</span>nolight<span class="op">);</span></span>
<span id="cb424-16"><a href="rmarkdown-operation.html#cb424-16" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>s<span class="op">,</span>lightgray<span class="op">+</span>opacity<span class="op">(</span><span class="fl">0.7</span><span class="op">));</span></span>
<span id="cb424-17"><a href="rmarkdown-operation.html#cb424-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-18"><a href="rmarkdown-operation.html#cb424-18" aria-hidden="true" tabindex="-1"></a>grid3<span class="op">(</span>XYZgrid<span class="op">);</span></span></code></pre></div>
<p>注意，对于 PDF 输出，可能需要一些额外的 LaTeX 包，否则可能会出现如下错误：</p>
<pre><code>! LaTeX Error: File `ocgbase.sty&#39; not found.</code></pre>
<!-- \@ref(install-latex-pkgs) -->
<p>如果出现这种错误，请参见 1.3 章节了解如何安装丢失的 LaTeX 包。</p>
<p>在上面的 <code>asy</code> 块中，我们使用了 <code>settings.prc = false</code> 的设置。如果没有此设置，当输出格式为 PDF 时，渐近线将生成交互式 3D 图形。但是，交互图形只能在 Acrobat Reader 中查看。如果使用 Acrobat Reader，则可以与图形交互。例如，你可以用鼠标旋转图 <a href="#fig:elevation"><strong>??</strong></a> 中的 3D 表面。</p>
<div id="asym-r" class="section level4 hasAnchor" number="6.3.8.1">
<h4><span class="header-section-number">6.3.8.1</span> Asymptote 读取 R 数据<a href="rmarkdown-operation.html#asym-r" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>下面是一个 Asymptote 与 R 交互的例子，首先 R 中的数据保存到 CSV 文件中：</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="rmarkdown-operation.html#cb426-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">l =</span> <span class="dv">100</span>)</span>
<span id="cb426-2"><a href="rmarkdown-operation.html#cb426-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">sin</span>(x)</span>
<span id="cb426-3"><a href="rmarkdown-operation.html#cb426-3" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">paste</span>(x, y, <span class="at">sep =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&#39;sine.csv&#39;</span>)</span></code></pre></div>
<p>然后通过 Asymptote 读取，并根据图 <a href="#fig:sine-curve"><strong>??</strong></a> 所示的数据绘制图表(下面是一个 <code>asy</code> 的代码块)：</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb427-1"><a href="rmarkdown-operation.html#cb427-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> graph<span class="op">;</span></span>
<span id="cb427-2"><a href="rmarkdown-operation.html#cb427-2" aria-hidden="true" tabindex="-1"></a>size<span class="op">(</span><span class="dv">400</span><span class="op">,</span><span class="dv">300</span><span class="op">,</span>IgnoreAspect<span class="op">);</span></span>
<span id="cb427-3"><a href="rmarkdown-operation.html#cb427-3" aria-hidden="true" tabindex="-1"></a>settings<span class="op">.</span>prc <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb427-4"><a href="rmarkdown-operation.html#cb427-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-5"><a href="rmarkdown-operation.html#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="co">// import data from csv file</span></span>
<span id="cb427-6"><a href="rmarkdown-operation.html#cb427-6" aria-hidden="true" tabindex="-1"></a>file in<span class="op">=</span>input<span class="op">(</span><span class="st">&quot;sine.csv&quot;</span><span class="op">).</span>line<span class="op">().</span>csv<span class="op">();</span></span>
<span id="cb427-7"><a href="rmarkdown-operation.html#cb427-7" aria-hidden="true" tabindex="-1"></a>real<span class="op">[][]</span> a<span class="op">=</span>in<span class="op">.</span>dimension<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb427-8"><a href="rmarkdown-operation.html#cb427-8" aria-hidden="true" tabindex="-1"></a>a<span class="op">=</span>transpose<span class="op">(</span>a<span class="op">);</span></span>
<span id="cb427-9"><a href="rmarkdown-operation.html#cb427-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-10"><a href="rmarkdown-operation.html#cb427-10" aria-hidden="true" tabindex="-1"></a><span class="co">// generate a path</span></span>
<span id="cb427-11"><a href="rmarkdown-operation.html#cb427-11" aria-hidden="true" tabindex="-1"></a>path rpath <span class="op">=</span> graph<span class="op">(</span>a<span class="op">[</span><span class="dv">0</span><span class="op">],</span>a<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb427-12"><a href="rmarkdown-operation.html#cb427-12" aria-hidden="true" tabindex="-1"></a>path lpath <span class="op">=</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">0</span><span class="op">)--(</span><span class="dv">5</span><span class="op">,</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb427-13"><a href="rmarkdown-operation.html#cb427-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-14"><a href="rmarkdown-operation.html#cb427-14" aria-hidden="true" tabindex="-1"></a><span class="co">// find intersection</span></span>
<span id="cb427-15"><a href="rmarkdown-operation.html#cb427-15" aria-hidden="true" tabindex="-1"></a>pair pA<span class="op">=</span>intersectionpoint<span class="op">(</span>rpath<span class="op">,</span>lpath<span class="op">);</span></span>
<span id="cb427-16"><a href="rmarkdown-operation.html#cb427-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-17"><a href="rmarkdown-operation.html#cb427-17" aria-hidden="true" tabindex="-1"></a><span class="co">// draw all</span></span>
<span id="cb427-18"><a href="rmarkdown-operation.html#cb427-18" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>rpath<span class="op">,</span>red<span class="op">);</span></span>
<span id="cb427-19"><a href="rmarkdown-operation.html#cb427-19" aria-hidden="true" tabindex="-1"></a>draw<span class="op">(</span>lpath<span class="op">,</span>dashed <span class="op">+</span> blue<span class="op">);</span></span>
<span id="cb427-20"><a href="rmarkdown-operation.html#cb427-20" aria-hidden="true" tabindex="-1"></a>dot<span class="op">(</span><span class="st">&quot;$</span><span class="er">\d</span><span class="st">elta$&quot;</span><span class="op">,</span>pA<span class="op">,</span>NE<span class="op">);</span></span>
<span id="cb427-21"><a href="rmarkdown-operation.html#cb427-21" aria-hidden="true" tabindex="-1"></a>xaxis<span class="op">(</span><span class="st">&quot;$x$&quot;</span><span class="op">,</span>BottomTop<span class="op">,</span>LeftTicks<span class="op">);</span></span>
<span id="cb427-22"><a href="rmarkdown-operation.html#cb427-22" aria-hidden="true" tabindex="-1"></a>yaxis<span class="op">(</span><span class="st">&quot;$y$&quot;</span><span class="op">,</span>LeftRight<span class="op">,</span>RightTicks<span class="op">);</span></span></code></pre></div>
</div>
</div>
<div id="sass-scss" class="section level3 hasAnchor" number="6.3.9">
<h3><span class="header-section-number">6.3.9</span> 使用 Sass/SCSS 构建 HTML 页面<a href="rmarkdown-operation.html#sass-scss" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sass (<a href="https://sass-lang.com" class="uri">https://sass-lang.com</a>) 是一种 CSS 扩展语言，它使用比普通 CSS 更灵活的方式创建 CSS 规则。Sass 在 CSS 的基础上引入了变量，规则，继承等更多编程特性，在语法上使用缩进而不是括号 <code>{</code> 分隔块，使用换行符替代分号 <code>;</code> 分隔语句。下面是一个 <code>scss</code> 代码块：</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb428-1"><a href="rmarkdown-operation.html#cb428-1" aria-hidden="true" tabindex="-1"></a>```{sass}</span>
<span id="cb428-2"><a href="rmarkdown-operation.html#cb428-2" aria-hidden="true" tabindex="-1"></a>$font-stack: &quot;Comic Sans MS&quot;, cursive, sans-serif</span>
<span id="cb428-3"><a href="rmarkdown-operation.html#cb428-3" aria-hidden="true" tabindex="-1"></a>$primary-color: #0020FF</span>
<span id="cb428-4"><a href="rmarkdown-operation.html#cb428-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-5"><a href="rmarkdown-operation.html#cb428-5" aria-hidden="true" tabindex="-1"></a>.font-demo</span>
<span id="cb428-6"><a href="rmarkdown-operation.html#cb428-6" aria-hidden="true" tabindex="-1"></a>  font: 100% $font-stack</span>
<span id="cb428-7"><a href="rmarkdown-operation.html#cb428-7" aria-hidden="true" tabindex="-1"></a>  color: $primary-color</span>
<span id="cb428-8"><a href="rmarkdown-operation.html#cb428-8" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>上面的 Scss 代码定义了两个可以复用的变量 <code>$font-stack</code> 和 <code>$primary-color</code>，并且在 <code>.font-demo</code> CSS 类中引用这些变量设置了字体和颜色。效果如下：</p>
<style type="text/css">
.font-demo{font:100% "Comic Sans MS",cursive,sans-serif;color:#0020FF}
</style>
<div class="font-demo">
<p>在过去的十多年间，R 语言发展的十分迅猛，这其中就包括了 R Markdown。这段往事可能要追溯到 2007 年。那时候，还在中国人民大学上学的谢益辉开始使用 Sweave，并沉迷于此无法自拔。不仅自己在写作业的时候尽可能的使用 Sweave，还持之以恒地向同学们兜售。Sweave 的命名是 S + weave，前者指的是 S 语言，这是 R 语言的前身，后者含义即“编织”。Sweave 之所以受到谢同学的追捧，正是因为它可以将某些东西编织起来——代码和代码执行后的结果。直到今天，Sweave 仍然是 RStudio 中从 Rnw 文档生成 PDF 的重要工具之一。</p>
</div>
<p>R Markdown 在底层使用 <strong>sass</strong> <span class="citation">(<a href="#ref-R-sass" role="doc-biblioref">Cheng et al. 2022</a>)</span> 包中的 <code>sass::sass()</code> 函数将 Sass 编译为常规 CSS。块选项 <code>engine.opts</code> 可以定制 CSS 代码的输出样式，例如：<code>engine.opts = list(style = "expanded")</code>。默认的样式是 “compressed”。请参阅帮助页面 <code>?sass::sass_options</code> 了解更多 <code>output_style</code> 可用的参数。</p>
</div>
</div>
<div id="output-hook" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> 输出钩子 (*)<a href="rmarkdown-operation.html#output-hook" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>第 <a href="rmarkdown-operation.html#chunk-output">6.2.3</a> 节介绍了如何通过使用 <strong>knitr</strong> 包控制代码块的每一段输出，如源代码、文本输出、图像输出以及 message 等。实际上，这一控制是通过“输出钩子”（Output Hook）实现的。大部分用户不需要了解钩子函数的底层细节。有兴趣的读者可以在 <a href="https://github.com/yihui/knitr/tree/master/R" class="uri">https://github.com/yihui/knitr/tree/master/R</a> 找到内置钩子函数的源代码，它们的文件名格式为 <code>hooks-*.R</code>，例如，<code>hooks-md.R</code> 包含 R Markdown 中的钩子函数）。</p>
<p>在 R Markdown 中，输出钩子负责将代码块的输出转换为最终文档里的视觉元素。<strong>knitr</strong> 运行完代码块后将结果存储为字符向量，钩子函数将这个字符向量加工为新的字符向量并返回到文档中，这就是用户最终看到的结果。考虑下面的代码块：</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb429-1"><a href="rmarkdown-operation.html#cb429-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb429-2"><a href="rmarkdown-operation.html#cb429-2" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb429-3"><a href="rmarkdown-operation.html#cb429-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><strong>knitr</strong> 运行该段代码后，得到两个字符串：源代码 <code>"1 + 1"</code> 和文本输出 <code>"[1] 2"</code>。现在需要两个输出钩子把它们转换为输出元素，一个负责源代码，一个负责文本输出。对于源代码，R Markdown 默认调用 <strong>knitr</strong> 中 <code>source</code> 钩子，它的简化版如下：</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="rmarkdown-operation.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 对于上面的例子， `x` 为字符串 &quot;1 + 1&quot;</span></span>
<span id="cb430-2"><a href="rmarkdown-operation.html#cb430-2" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x, options) {</span>
<span id="cb430-3"><a href="rmarkdown-operation.html#cb430-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 小写的 &quot;r&quot; 在这里表示编程语言的名称</span></span>
<span id="cb430-4"><a href="rmarkdown-operation.html#cb430-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;```r&quot;</span>, x, <span class="st">&quot;```&quot;</span>), <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb430-5"><a href="rmarkdown-operation.html#cb430-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>上面的输出钩子函数将源代码转换为 Markdown 代码块，即以 <code>```</code> 开头和结尾，并添加语言标记。</p>
<p>类似的，处理文本输出的 <code>output</code> 钩子简化版如下：</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="rmarkdown-operation.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(x, options) {</span>
<span id="cb431-2"><a href="rmarkdown-operation.html#cb431-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&#39;```&#39;</span>, x, <span class="st">&#39;```&#39;</span>), <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb431-3"><a href="rmarkdown-operation.html#cb431-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>经过两个输出钩子的处理后，上述代码块的最终输出为：</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb432-1"><a href="rmarkdown-operation.html#cb432-1" aria-hidden="true" tabindex="-1"></a>```r</span>
<span id="cb432-2"><a href="rmarkdown-operation.html#cb432-2" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb432-3"><a href="rmarkdown-operation.html#cb432-3" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb432-4"><a href="rmarkdown-operation.html#cb432-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-5"><a href="rmarkdown-operation.html#cb432-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb432-6"><a href="rmarkdown-operation.html#cb432-6" aria-hidden="true" tabindex="-1"></a>[1] 2</span>
<span id="cb432-7"><a href="rmarkdown-operation.html#cb432-7" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><code>source</code> 和 <code>output</code> 的实际代码更为复杂，但背后的思想是一样的。读者可以通过在 <code>knit_hooks</code> 中查看钩子函数的源代码，例如：</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="rmarkdown-operation.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了得到有意义的输出，以下代码应在一个 knitr 文档的代码块内部执行</span></span>
<span id="cb433-2"><a href="rmarkdown-operation.html#cb433-2" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">&#39;source&#39;</span>)</span>
<span id="cb433-3"><a href="rmarkdown-operation.html#cb433-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">&#39;output&#39;</span>)</span>
<span id="cb433-4"><a href="rmarkdown-operation.html#cb433-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 或者 knitr::knit_hooks$get(c(&#39;source&#39;, &#39;output&#39;))</span></span></code></pre></div>
<p>用户可以用 <code>knit_hooks</code> 中的 <code>set()</code> 函数覆盖 R Markdown 内置的钩子，从而定制文本输出。由于该方法将覆盖现有的默认钩子，所以最好先保存默认钩子的副本，以自己的方式处理输出元素，并将结果传递给默认钩子。常见的模式为：</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="rmarkdown-operation.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在这里使用 local() 是可选的，设置的原因只是想避免创建不必要的全局变量，如 `hook_old`）</span></span>
<span id="cb434-2"><a href="rmarkdown-operation.html#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="fu">local</span>({</span>
<span id="cb434-3"><a href="rmarkdown-operation.html#cb434-3" aria-hidden="true" tabindex="-1"></a>  hook_old <span class="ot">=</span> knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">&#39;NAME&#39;</span>)  <span class="co"># 保存现有的钩子</span></span>
<span id="cb434-4"><a href="rmarkdown-operation.html#cb434-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">NAME =</span> <span class="cf">function</span>(x, options) {</span>
<span id="cb434-5"><a href="rmarkdown-operation.html#cb434-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 现在可以对 x 做任何处理，并将 x 传递给现有的钩子</span></span>
<span id="cb434-6"><a href="rmarkdown-operation.html#cb434-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hook_old</span>(x, options)</span>
<span id="cb434-7"><a href="rmarkdown-operation.html#cb434-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb434-8"><a href="rmarkdown-operation.html#cb434-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>这里，<code>NAME</code> 是钩子的名称，它可以是以下值之一：</p>
<ul>
<li><p><code>source</code>：处理源代码；</p></li>
<li><p><code>output</code>：处理文本输出；</p></li>
<li><p><code>warning</code>：处理 warning （通常来自 <code>warning()</code>）；</p></li>
<li><p><code>message</code>：处理 message （通常来自 <code>message()</code>）；</p></li>
<li><p><code>error</code>：处理 error message （通常来自 <code>stop()</code>）；</p></li>
<li><p><code>plot</code>：处理图像输出路径；</p></li>
<li><p><code>inline</code>：处理行内 R 表达式的输出；</p></li>
<li><p><code>chunk</code>：处理整个块的输出；</p></li>
<li><p><code>document</code>：处理整个文档的输出。</p></li>
</ul>
<p>钩子的 <code>options</code> 参数接受一个列表，表示当前代码块的块选项。例如，如果在一个块上设置 <code>foo = TRUE</code>，可以通过钩子中的 <code>options$foo</code> 获取它的值。但需要注意的是，参数 <code>options</code> 对 <code>inline</code> 和 <code>document</code> 钩子不可用。</p>
<p>输出钩子可以让使用者能够最终控制块和文档输出的每个单独部分。与块选项（第 <a href="rmarkdown-operation.html#chunk-options">6.2</a> 节，通常具有预定义的用途）相比，输出钩子可能要强大得多，因为它们是用户自定义的函数，而且可以在函数中做任何想做的事情。</p>
<div id="edit-source" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> 编辑源代码<a href="rmarkdown-operation.html#edit-source" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有时用户可能希望隐藏部分源代码。例如，在连接数据库时隐藏密码。第 <a href="rmarkdown-operation.html#hide-one">6.2.3.1</a> 节谈到可以使用块选项 <code>echo</code> 隐藏或显示某一行（例如，通过 <code>echo = 2</code> 可以显示第二个表达式）。本节提供了一种更加灵活的方法，它不需要指定表达式的位置或索引。</p>
<p>它的基本思想是在代码中添加一个特殊的注释（例如，<code># SECRET!!</code>）。当在代码中检测到该注释时，将自动忽略该行。下面是使用 <code>source</code> 钩子的完整示例:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb435-1"><a href="rmarkdown-operation.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb435-2"><a href="rmarkdown-operation.html#cb435-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 用 `source` 钩子来隐藏某行代码</span></span>
<span id="cb435-3"><a href="rmarkdown-operation.html#cb435-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb435-4"><a href="rmarkdown-operation.html#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="rmarkdown-operation.html#cb435-5" aria-hidden="true" tabindex="-1"></a>首先，设置一个 <span class="in">`source`</span> 钩子来匹配并隐藏（排除）末尾处包含字符串 <span class="in">`# SECRET!!`</span> 的代码行：</span>
<span id="cb435-6"><a href="rmarkdown-operation.html#cb435-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-7"><a href="rmarkdown-operation.html#cb435-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb435-8"><a href="rmarkdown-operation.html#cb435-8" aria-hidden="true" tabindex="-1"></a><span class="in">local({</span></span>
<span id="cb435-9"><a href="rmarkdown-operation.html#cb435-9" aria-hidden="true" tabindex="-1"></a><span class="in">  hook_source &lt;- knitr::knit_hooks$get(&#39;source&#39;)</span></span>
<span id="cb435-10"><a href="rmarkdown-operation.html#cb435-10" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::knit_hooks$set(source = function(x, options) {</span></span>
<span id="cb435-11"><a href="rmarkdown-operation.html#cb435-11" aria-hidden="true" tabindex="-1"></a><span class="in">    x &lt;- x[!grepl(&#39;# SECRET!!$&#39;, x)]</span></span>
<span id="cb435-12"><a href="rmarkdown-operation.html#cb435-12" aria-hidden="true" tabindex="-1"></a><span class="in">    hook_source(x, options)</span></span>
<span id="cb435-13"><a href="rmarkdown-operation.html#cb435-13" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb435-14"><a href="rmarkdown-operation.html#cb435-14" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb435-15"><a href="rmarkdown-operation.html#cb435-15" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb435-16"><a href="rmarkdown-operation.html#cb435-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-17"><a href="rmarkdown-operation.html#cb435-17" aria-hidden="true" tabindex="-1"></a>现在可以测试这个新的钩子。在编译这个文档时，读者将看不到带有特殊注释 <span class="in">`# SECRET!!`</span> 的代码行。</span>
<span id="cb435-18"><a href="rmarkdown-operation.html#cb435-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-19"><a href="rmarkdown-operation.html#cb435-19" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb435-20"><a href="rmarkdown-operation.html#cb435-20" aria-hidden="true" tabindex="-1"></a><span class="in">1 + 1  # 正常显示代码</span></span>
<span id="cb435-21"><a href="rmarkdown-operation.html#cb435-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-22"><a href="rmarkdown-operation.html#cb435-22" aria-hidden="true" tabindex="-1"></a><span class="in"># 请使用你的用户名及密码</span></span>
<span id="cb435-23"><a href="rmarkdown-operation.html#cb435-23" aria-hidden="true" tabindex="-1"></a><span class="in">auth &lt;- httr::authenticate(&quot;user&quot;, &quot;passwd&quot;)</span></span>
<span id="cb435-24"><a href="rmarkdown-operation.html#cb435-24" aria-hidden="true" tabindex="-1"></a><span class="in">auth &lt;- httr::authenticate(&quot;yihui&quot;, &quot;horsebattery&quot;)  # SECRET!!</span></span>
<span id="cb435-25"><a href="rmarkdown-operation.html#cb435-25" aria-hidden="true" tabindex="-1"></a><span class="in">httr::GET(&quot;http://httpbin.org/basic-auth/user/passwd&quot;, auth)</span></span>
<span id="cb435-26"><a href="rmarkdown-operation.html#cb435-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>上述 <code>source</code> 钩子的关键部分为下面这一行，它会通过 <code>grepl()</code> 来匹配源代码向量 <code>x</code> 中末尾处包含注释 <code># SECRET!!</code> 的代码行，并隐藏（排除）它们：</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="rmarkdown-operation.html#cb436-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&#39;# SECRET!!$&#39;</span>, x)]</span></code></pre></div>
<p>准确地说，上述的钩子将隐藏（排除）所有末尾处包含注释 <code># SECRET!!</code> 的 <em>表达式</em>，而非单独的行，因为 <code>x</code> 实际上是一个由 R 中表达式组成的向量。例如，对于下面的代码块：</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="rmarkdown-operation.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb437-2"><a href="rmarkdown-operation.html#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">TRUE</span>) { <span class="co"># SECRET!!</span></span>
<span id="cb437-3"><a href="rmarkdown-operation.html#cb437-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb437-4"><a href="rmarkdown-operation.html#cb437-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>在 <code>source</code> 钩子中，<code>x</code> 的值为：</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="rmarkdown-operation.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;1 + 1&quot;</span>, <span class="st">&quot;if (TRUE) { # SECRET!!</span><span class="sc">\n</span><span class="st">  1:10</span><span class="sc">\n</span><span class="st">}&quot;</span>)</span></code></pre></div>
<p>如果想隐藏某些特定行而非 R 代码中完整的表达式，则必须将 <code>x</code> 分割成单独的行。可以考虑使用函数 <code>xfun::split_lines()</code>，这样的话钩子函数会变成：</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="rmarkdown-operation.html#cb439-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">split_lines</span>(x)  <span class="co"># 分为单独的行</span></span>
<span id="cb439-2"><a href="rmarkdown-operation.html#cb439-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&#39;# SECRET!!$&#39;</span>, x)]</span>
<span id="cb439-3"><a href="rmarkdown-operation.html#cb439-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)  <span class="co"># 组合成单个字符串</span></span>
<span id="cb439-4"><a href="rmarkdown-operation.html#cb439-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hook_source</span>(x, options)</span></code></pre></div>
<p>第 <a href="rmarkdown-operation.html#source-index">6.4.2</a> 节介绍了 <code>grepl()</code> 函数之外更多操作操作字符串的选择。</p>
</div>
<div id="source-index" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> 向源代码中添加行号<a href="rmarkdown-operation.html#source-index" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有的时候，为了方便读者阅读或讨论代码，需要给源代码添加行号。本节将展示一个定义 <code>source</code> 钩子的例子，该钩子会将行号作为注释添加到源代码中。例如，对于下面这个代码块：</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb440-1"><a href="rmarkdown-operation.html#cb440-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb440-2"><a href="rmarkdown-operation.html#cb440-2" aria-hidden="true" tabindex="-1"></a>if (TRUE) {</span>
<span id="cb440-3"><a href="rmarkdown-operation.html#cb440-3" aria-hidden="true" tabindex="-1"></a>  x &lt;- 1:10</span>
<span id="cb440-4"><a href="rmarkdown-operation.html#cb440-4" aria-hidden="true" tabindex="-1"></a>  x + 1</span>
<span id="cb440-5"><a href="rmarkdown-operation.html#cb440-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb440-6"><a href="rmarkdown-operation.html#cb440-6" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>希望得到如下的输出：</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="rmarkdown-operation.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">TRUE</span>) {    <span class="co"># 1</span></span>
<span id="cb441-2"><a href="rmarkdown-operation.html#cb441-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>    <span class="co"># 2</span></span>
<span id="cb441-3"><a href="rmarkdown-operation.html#cb441-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> <span class="dv">1</span>        <span class="co"># 3</span></span>
<span id="cb441-4"><a href="rmarkdown-operation.html#cb441-4" aria-hidden="true" tabindex="-1"></a>}              <span class="co"># 4</span></span></code></pre></div>
<p>那么可以定义相应的 <code>source</code> 钩子，完整的例子如下：</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb442-1"><a href="rmarkdown-operation.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb442-2"><a href="rmarkdown-operation.html#cb442-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 向源代码中添加行号</span></span>
<span id="cb442-3"><a href="rmarkdown-operation.html#cb442-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb442-4"><a href="rmarkdown-operation.html#cb442-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-5"><a href="rmarkdown-operation.html#cb442-5" aria-hidden="true" tabindex="-1"></a>本例设置了一个 <span class="in">`source`</span> 钩子来向源代码中添加行号，行号会出现在每行末尾的注释中。</span>
<span id="cb442-6"><a href="rmarkdown-operation.html#cb442-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-7"><a href="rmarkdown-operation.html#cb442-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb442-8"><a href="rmarkdown-operation.html#cb442-8" aria-hidden="true" tabindex="-1"></a><span class="in">local({</span></span>
<span id="cb442-9"><a href="rmarkdown-operation.html#cb442-9" aria-hidden="true" tabindex="-1"></a><span class="in">  hook_source &lt;- knitr::knit_hooks$get(&#39;source&#39;)</span></span>
<span id="cb442-10"><a href="rmarkdown-operation.html#cb442-10" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::knit_hooks$set(source = function(x, options) {</span></span>
<span id="cb442-11"><a href="rmarkdown-operation.html#cb442-11" aria-hidden="true" tabindex="-1"></a><span class="in">    x &lt;- xfun::split_lines(x)</span></span>
<span id="cb442-12"><a href="rmarkdown-operation.html#cb442-12" aria-hidden="true" tabindex="-1"></a><span class="in">    n &lt;- nchar(x, &#39;width&#39;)</span></span>
<span id="cb442-13"><a href="rmarkdown-operation.html#cb442-13" aria-hidden="true" tabindex="-1"></a><span class="in">    i &lt;- seq_along(x)  # 行号</span></span>
<span id="cb442-14"><a href="rmarkdown-operation.html#cb442-14" aria-hidden="true" tabindex="-1"></a><span class="in">    n &lt;- n + nchar(i)</span></span>
<span id="cb442-15"><a href="rmarkdown-operation.html#cb442-15" aria-hidden="true" tabindex="-1"></a><span class="in">    s &lt;- knitr:::v_spaces(max(n) - n)</span></span>
<span id="cb442-16"><a href="rmarkdown-operation.html#cb442-16" aria-hidden="true" tabindex="-1"></a><span class="in">    x &lt;- paste(x, s, &#39;  # &#39;, i, sep = &#39;&#39;, collapse = &#39;\n&#39;)</span></span>
<span id="cb442-17"><a href="rmarkdown-operation.html#cb442-17" aria-hidden="true" tabindex="-1"></a><span class="in">    hook_source(x, options)</span></span>
<span id="cb442-18"><a href="rmarkdown-operation.html#cb442-18" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb442-19"><a href="rmarkdown-operation.html#cb442-19" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb442-20"><a href="rmarkdown-operation.html#cb442-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb442-21"><a href="rmarkdown-operation.html#cb442-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-22"><a href="rmarkdown-operation.html#cb442-22" aria-hidden="true" tabindex="-1"></a>现在可以测试这个新钩子了。编译此文档时，将在每行末尾的注释中看到行号：</span>
<span id="cb442-23"><a href="rmarkdown-operation.html#cb442-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-24"><a href="rmarkdown-operation.html#cb442-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb442-25"><a href="rmarkdown-operation.html#cb442-25" aria-hidden="true" tabindex="-1"></a><span class="in">if (TRUE) {</span></span>
<span id="cb442-26"><a href="rmarkdown-operation.html#cb442-26" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- 1:10</span></span>
<span id="cb442-27"><a href="rmarkdown-operation.html#cb442-27" aria-hidden="true" tabindex="-1"></a><span class="in">  x + 1</span></span>
<span id="cb442-28"><a href="rmarkdown-operation.html#cb442-28" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb442-29"><a href="rmarkdown-operation.html#cb442-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>上面这个例子中使用的主要技巧是确定每行注释之前需要的空格数，以便注释可以在右边对齐。该空格数取决于每行代码的宽度，本节将钩子函数中的代码留给读者来理解。需要注意的是，函数 <code>knitr:::v_spaces()</code> 用于生成指定长度的空格，例如：</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="rmarkdown-operation.html#cb443-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">:::</span><span class="fu">v_spaces</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] &quot; &quot;      &quot;   &quot;    &quot;      &quot; &quot;&quot;</code></pre>
<p>在实际中，如果想要在源代码或文本输出中添加行号的话，直接在块选项部分添加<code>attr.source = ".numberLines"</code> 或 <code>attr.output = ".numberLines"</code> 来实现，该语法更简洁，并且适用于源代码和文本输出块。本节中介绍 <code>source</code> 钩子的主要目的是展示一种使用自定义函数操作源代码的可能性。</p>
</div>
<div id="scrollable-output" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> 可滚动的文本输出<a href="rmarkdown-operation.html#scrollable-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在通过 HTML 进行展示的时候，当代码块或者文本输出过长时，可以对其高度进行压缩，并设置成可滚动的形式。第 <a href="rmarkdown-document.html#html-code-scroll">3.1.2.7</a>节展示了如何通过 CSS 来实现上述功能。实际上，有一个更简单的方法，可以使用块选项的 <code>attr.source</code> 和 <code>attr.output</code> 来将 <code>style</code> 属性添加 Markdown 输出中的分离代码块中（有关这些选项的更多信息，请参阅第 <a href="rmarkdown-operation.html#chunk-property">6.2.6</a> 节）。例如，对于这个带有 <code>attr.output</code> 选项的代码块：</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb445-1"><a href="rmarkdown-operation.html#cb445-1" aria-hidden="true" tabindex="-1"></a>```{r, attr.output=&#39;style=&quot;max-height: 100px;&quot;&#39;}</span>
<span id="cb445-2"><a href="rmarkdown-operation.html#cb445-2" aria-hidden="true" tabindex="-1"></a>1:300</span>
<span id="cb445-3"><a href="rmarkdown-operation.html#cb445-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>它的 Markdown 输出为：</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb446-1"><a href="rmarkdown-operation.html#cb446-1" aria-hidden="true" tabindex="-1"></a>```r</span>
<span id="cb446-2"><a href="rmarkdown-operation.html#cb446-2" aria-hidden="true" tabindex="-1"></a>1:300</span>
<span id="cb446-3"><a href="rmarkdown-operation.html#cb446-3" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb446-4"><a href="rmarkdown-operation.html#cb446-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-5"><a href="rmarkdown-operation.html#cb446-5" aria-hidden="true" tabindex="-1"></a>```{style=&quot;max-height: 100px;&quot;}</span>
<span id="cb446-6"><a href="rmarkdown-operation.html#cb446-6" aria-hidden="true" tabindex="-1"></a>##   [1]   1   2   3   4   5   6   7   8   9  10</span>
<span id="cb446-7"><a href="rmarkdown-operation.html#cb446-7" aria-hidden="true" tabindex="-1"></a>##  [11]  11  12  13  14  15  16  17  18  19  20</span>
<span id="cb446-8"><a href="rmarkdown-operation.html#cb446-8" aria-hidden="true" tabindex="-1"></a>##  ... ...</span>
<span id="cb446-9"><a href="rmarkdown-operation.html#cb446-9" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>随后文本输出块将被 Pandoc 转换为 HTML：</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb447-1"><a href="rmarkdown-operation.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;pre</span> <span class="er">style</span><span class="ot">=</span><span class="st">&quot;max-height: 100px;&quot;</span><span class="kw">&gt;</span></span>
<span id="cb447-2"><a href="rmarkdown-operation.html#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;code&gt;</span>##   [1]   1   2   3   4   5   6   7   8   9  10</span>
<span id="cb447-3"><a href="rmarkdown-operation.html#cb447-3" aria-hidden="true" tabindex="-1"></a>##  [11]  11  12  13  14  15  16  17  18  19  20</span>
<span id="cb447-4"><a href="rmarkdown-operation.html#cb447-4" aria-hidden="true" tabindex="-1"></a>##  ... ...<span class="kw">&lt;/code&gt;</span></span>
<span id="cb447-5"><a href="rmarkdown-operation.html#cb447-5" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/pre&gt;</span></span></code></pre></div>
<p>更多有关 Pandoc 中分离代码块的信息，可参阅其阅读手册：<a href="https://pandoc.org/MANUAL.html#fenced-code-blocks" class="uri">https://pandoc.org/MANUAL.html#fenced-code-blocks</a>。</p>
<p><code>attr.source</code> 和 <code>attr.output</code> 选项让使用者能够指定每个代码块的最大高度，但是对应的语法有点笨拙，需要更好地理解 CSS 和 Pandoc 的 Markdown 语法。下面的例子展示如何使用自定义块选项 <code>max.height</code> 来自定义输出钩子，这样只需要设置块选项，如 <code>max.height = "100px"</code> 而非 <code>attr.output = 'style="max-height: 100px;"'</code>。本例只操作 <code>options</code> 参数，而不操作 <code>x</code> 参数：</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb448-1"><a href="rmarkdown-operation.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb448-2"><a href="rmarkdown-operation.html#cb448-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 可滚动的代码块</span></span>
<span id="cb448-3"><a href="rmarkdown-operation.html#cb448-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> </span></span>
<span id="cb448-4"><a href="rmarkdown-operation.html#cb448-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html_document: </span></span>
<span id="cb448-5"><a href="rmarkdown-operation.html#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight: tango</span></span>
<span id="cb448-6"><a href="rmarkdown-operation.html#cb448-6" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb448-7"><a href="rmarkdown-operation.html#cb448-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-8"><a href="rmarkdown-operation.html#cb448-8" aria-hidden="true" tabindex="-1"></a>本例设置了一个输出钩子，可以当块选项 <span class="in">`max.height`</span> 已被设置时，向文本输出添加 <span class="in">`style`</span> 属性：</span>
<span id="cb448-9"><a href="rmarkdown-operation.html#cb448-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-10"><a href="rmarkdown-operation.html#cb448-10" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb448-11"><a href="rmarkdown-operation.html#cb448-11" aria-hidden="true" tabindex="-1"></a><span class="in">options(width = 60)</span></span>
<span id="cb448-12"><a href="rmarkdown-operation.html#cb448-12" aria-hidden="true" tabindex="-1"></a><span class="in">local({</span></span>
<span id="cb448-13"><a href="rmarkdown-operation.html#cb448-13" aria-hidden="true" tabindex="-1"></a><span class="in">  hook_output &lt;- knitr::knit_hooks$get(&#39;output&#39;)</span></span>
<span id="cb448-14"><a href="rmarkdown-operation.html#cb448-14" aria-hidden="true" tabindex="-1"></a><span class="in">  knitr::knit_hooks$set(output = function(x, options) {</span></span>
<span id="cb448-15"><a href="rmarkdown-operation.html#cb448-15" aria-hidden="true" tabindex="-1"></a><span class="in">    if (!is.null(options$max.height)) options$attr.output &lt;- c(</span></span>
<span id="cb448-16"><a href="rmarkdown-operation.html#cb448-16" aria-hidden="true" tabindex="-1"></a><span class="in">      options$attr.output,</span></span>
<span id="cb448-17"><a href="rmarkdown-operation.html#cb448-17" aria-hidden="true" tabindex="-1"></a><span class="in">      sprintf(&#39;style=&quot;max-height: %s;&quot;&#39;, options$max.height)</span></span>
<span id="cb448-18"><a href="rmarkdown-operation.html#cb448-18" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb448-19"><a href="rmarkdown-operation.html#cb448-19" aria-hidden="true" tabindex="-1"></a><span class="in">    hook_output(x, options)</span></span>
<span id="cb448-20"><a href="rmarkdown-operation.html#cb448-20" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb448-21"><a href="rmarkdown-operation.html#cb448-21" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb448-22"><a href="rmarkdown-operation.html#cb448-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb448-23"><a href="rmarkdown-operation.html#cb448-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-24"><a href="rmarkdown-operation.html#cb448-24" aria-hidden="true" tabindex="-1"></a>如果没有 <span class="in">`max.height`</span>，可以看到完整的输出，即：</span>
<span id="cb448-25"><a href="rmarkdown-operation.html#cb448-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-26"><a href="rmarkdown-operation.html#cb448-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb448-27"><a href="rmarkdown-operation.html#cb448-27" aria-hidden="true" tabindex="-1"></a><span class="in">1:100</span></span>
<span id="cb448-28"><a href="rmarkdown-operation.html#cb448-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb448-29"><a href="rmarkdown-operation.html#cb448-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-30"><a href="rmarkdown-operation.html#cb448-30" aria-hidden="true" tabindex="-1"></a>现在设置 <span class="in">`max.height`</span> 为 <span class="in">`100px`</span>，这样可以在文本输出中看到一个滚动条，因为它的高度大于 100px。</span>
<span id="cb448-31"><a href="rmarkdown-operation.html#cb448-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-32"><a href="rmarkdown-operation.html#cb448-32" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, max.height=&#39;100px&#39;}</span></span>
<span id="cb448-33"><a href="rmarkdown-operation.html#cb448-33" aria-hidden="true" tabindex="-1"></a><span class="in">1:100</span></span>
<span id="cb448-34"><a href="rmarkdown-operation.html#cb448-34" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb448-35"><a href="rmarkdown-operation.html#cb448-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-36"><a href="rmarkdown-operation.html#cb448-36" aria-hidden="true" tabindex="-1"></a>本质上，<span class="in">`max.height`</span> 选项被转换为 <span class="in">`attr.output`</span> 选项，并且即 <span class="in">`attr.output`</span> 选项是存在的，这一转换也是有效的，也就是说，它不会覆盖 <span class="in">`attr.output`</span> 选项，例如，可以通过 <span class="in">`.numberLines`</span> 属性在文本输出的左侧显示行号：</span>
<span id="cb448-37"><a href="rmarkdown-operation.html#cb448-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-38"><a href="rmarkdown-operation.html#cb448-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, max.height=&#39;100px&#39;, attr.output=&#39;.numberLines&#39;}</span></span>
<span id="cb448-39"><a href="rmarkdown-operation.html#cb448-39" aria-hidden="true" tabindex="-1"></a><span class="in">1:100</span></span>
<span id="cb448-40"><a href="rmarkdown-operation.html#cb448-40" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>图 <a href="rmarkdown-operation.html#fig:hook-scroll">6.7</a> 展示了代码的输出结果。需要注意的是，在最后一个代码块中使用块选项 <code>attr.output</code> 时，该选项将不会被 <code>max.height</code> 覆盖，因为这里将现有的属性与 <code>max.height</code> 生成的 <code>style</code> 属性组合在了一起：</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="rmarkdown-operation.html#cb449-1" aria-hidden="true" tabindex="-1"></a>options<span class="sc">$</span>attr.output <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb449-2"><a href="rmarkdown-operation.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  options<span class="sc">$</span>attr.output,</span>
<span id="cb449-3"><a href="rmarkdown-operation.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&#39;style=&quot;max-height: %s;&quot;&#39;</span>, options<span class="sc">$</span>max.height)</span>
<span id="cb449-4"><a href="rmarkdown-operation.html#cb449-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hook-scroll"></span>
<img src="images/hook-scroll.png" alt="一个可滚动文本输出的例子，其高度通过块选项`max.height`来给定"  />
<p class="caption">
图 6.7: 一个可滚动文本输出的例子，其高度通过块选项<code>max.height</code>来给定
</p>
</div>
<p>同样地，<code>source</code> 钩子中也可以使用相似的技巧来限制源代码块的高度。</p>
</div>
<div id="truncated-output" class="section level3 hasAnchor" number="6.4.4">
<h3><span class="header-section-number">6.4.4</span> 截断文本输出<a href="rmarkdown-operation.html#truncated-output" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当代码块的文本输出很长时，除了希望设置为滚动之外，可能还希望只显示前几行。例如，当输出一个几千行数据框时，显示完整的数据可能没有什么帮助，仅显示前几行可能就足够了。本节会重新定义输出钩子，以便使用者可以通过自定义块选项 <code>out.lines</code> 来控制最大行数：</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="rmarkdown-operation.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 保存内置的 output 钩子</span></span>
<span id="cb450-2"><a href="rmarkdown-operation.html#cb450-2" aria-hidden="true" tabindex="-1"></a>hook_output <span class="ot">=</span> knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">get</span>(<span class="st">&quot;output&quot;</span>)</span>
<span id="cb450-3"><a href="rmarkdown-operation.html#cb450-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-4"><a href="rmarkdown-operation.html#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置一个新的 output 钩子来截断文本输出</span></span>
<span id="cb450-5"><a href="rmarkdown-operation.html#cb450-5" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">output =</span> <span class="cf">function</span>(x, options) {</span>
<span id="cb450-6"><a href="rmarkdown-operation.html#cb450-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(n <span class="ot">&lt;-</span> options<span class="sc">$</span>out.lines)) {</span>
<span id="cb450-7"><a href="rmarkdown-operation.html#cb450-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> xfun<span class="sc">::</span><span class="fu">split_lines</span>(x)</span>
<span id="cb450-8"><a href="rmarkdown-operation.html#cb450-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(x) <span class="sc">&gt;</span> n) {</span>
<span id="cb450-9"><a href="rmarkdown-operation.html#cb450-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 截断文本输出</span></span>
<span id="cb450-10"><a href="rmarkdown-operation.html#cb450-10" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">head</span>(x, n), <span class="st">&#39;....</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb450-11"><a href="rmarkdown-operation.html#cb450-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb450-12"><a href="rmarkdown-operation.html#cb450-12" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</span>
<span id="cb450-13"><a href="rmarkdown-operation.html#cb450-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb450-14"><a href="rmarkdown-operation.html#cb450-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hook_output</span>(x, options)</span>
<span id="cb450-15"><a href="rmarkdown-operation.html#cb450-15" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>上述钩子函数的基本思想是，如果文本输出的行数大于块选项 <code>out.lines</code> 设置的阈值（存储在变量 <code>n</code> 中），只保留前 <code>n</code> 行，并添加省略号（<code>....</code>）来表示输出被截断。</p>
<p>现在可以通过设置块选项 <code>out.lines = 4</code> 来测试新的输出钩子，读者将会看到四行输出：</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="rmarkdown-operation.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cars)</span></code></pre></div>
<pre><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
....</code></pre>
<p>由于已经将原始的输出钩子存储在 <code>output</code> 中，故可以通过再次调用 <code>set()</code> 来恢复它：</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="rmarkdown-operation.html#cb453-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>knit_hooks<span class="sc">$</span><span class="fu">set</span>(<span class="at">output =</span> hook_output)</span></code></pre></div>
<p>作为进一步的练习，可以尝试以不同的方式截断输出：给定块选项’ <code>out.lines</code> 来确定最大行数，能在中间而不是末尾截断输出吗？例如，如果设定 <code>out.lines = 10</code>，提取前 5 行和后 5 行，并在中间添加 <code>....</code> 的输出是这样的：</p>
<pre class="text"><code>##    speed dist
## 1      4    2
## 2      4   10
## 3      7    4
## 4      7   22
....
## 46    24   70
## 47    24   92
## 48    24   93
## 49    24  120
## 50    25   85</code></pre>
<p>需要注意的是，输出的最后一行（即钩子函数的参数 <code>x</code>）可能是空行，所以可能需要设定 <code>c(head(x, n/2), '....', tail(x, n/2 + 1))</code>，其中 <code>+ 1</code> 将最后的空行也纳入考虑。</p>
</div>
<div id="html5-plot" class="section level3 hasAnchor" number="6.4.5">
<h3><span class="header-section-number">6.4.5</span> 以 HTML5 格式输出图像<a href="rmarkdown-operation.html#html5-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>默认情况下，R Markdown 的 HTML 输出中的图包含在标签 <code>&lt;p&gt;</code> 或 <code>&lt;div&gt;</code> 下的 <code>&lt;img src="..." /&gt;</code> 中，但很多时候使用者可能想输出以 HTML5<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a> 格式来输出图像。</p>
<p>下面的例子展示了如何使用 HTML5 的标签 <code>&lt;figure&gt;</code> 来显示图像。</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb455-1"><a href="rmarkdown-operation.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb455-2"><a href="rmarkdown-operation.html#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> 在标签 `&lt;figure&gt;` 中输出图像</span></span>
<span id="cb455-3"><a href="rmarkdown-operation.html#cb455-3" aria-hidden="true" tabindex="-1"></a><span class="an">output:</span><span class="co"> html_document</span></span>
<span id="cb455-4"><a href="rmarkdown-operation.html#cb455-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb455-5"><a href="rmarkdown-operation.html#cb455-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-6"><a href="rmarkdown-operation.html#cb455-6" aria-hidden="true" tabindex="-1"></a>在块选项 <span class="in">`options$fig.cap`</span> 中给定图像文件路径 <span class="in">`x`</span> 和图像标题（caption），希望使用如下形式把图像写入 HTML5 的标签之中：</span>
<span id="cb455-7"><a href="rmarkdown-operation.html#cb455-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-8"><a href="rmarkdown-operation.html#cb455-8" aria-hidden="true" tabindex="-1"></a><span class="in">```html</span></span>
<span id="cb455-9"><a href="rmarkdown-operation.html#cb455-9" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;figure&gt;</span></span>
<span id="cb455-10"><a href="rmarkdown-operation.html#cb455-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;PATH&quot;</span> <span class="er">alt</span><span class="ot">=</span><span class="st">&quot;CAPTION&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb455-11"><a href="rmarkdown-operation.html#cb455-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;figcaption&gt;</span>CAPTION<span class="kw">&lt;/figcaption&gt;</span></span>
<span id="cb455-12"><a href="rmarkdown-operation.html#cb455-12" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/figure&gt;</span></span>
<span id="cb455-13"><a href="rmarkdown-operation.html#cb455-13" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb455-14"><a href="rmarkdown-operation.html#cb455-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-15"><a href="rmarkdown-operation.html#cb455-15" aria-hidden="true" tabindex="-1"></a>现在重新定义 <span class="in">`plot`</span> 钩子（仅当输出格式为 HTML 时）:</span>
<span id="cb455-16"><a href="rmarkdown-operation.html#cb455-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-17"><a href="rmarkdown-operation.html#cb455-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb455-18"><a href="rmarkdown-operation.html#cb455-18" aria-hidden="true" tabindex="-1"></a><span class="in">if (knitr::is_html_output()) knitr::knit_hooks$set(</span></span>
<span id="cb455-19"><a href="rmarkdown-operation.html#cb455-19" aria-hidden="true" tabindex="-1"></a><span class="in">  plot = function(x, options) {</span></span>
<span id="cb455-20"><a href="rmarkdown-operation.html#cb455-20" aria-hidden="true" tabindex="-1"></a><span class="in">    cap  &lt;- options$fig.cap  # 图像标题</span></span>
<span id="cb455-21"><a href="rmarkdown-operation.html#cb455-21" aria-hidden="true" tabindex="-1"></a><span class="in">    tags &lt;- htmltools::tags</span></span>
<span id="cb455-22"><a href="rmarkdown-operation.html#cb455-22" aria-hidden="true" tabindex="-1"></a><span class="in">    as.character(tags$figure(</span></span>
<span id="cb455-23"><a href="rmarkdown-operation.html#cb455-23" aria-hidden="true" tabindex="-1"></a><span class="in">      tags$img(src = x, alt = cap),</span></span>
<span id="cb455-24"><a href="rmarkdown-operation.html#cb455-24" aria-hidden="true" tabindex="-1"></a><span class="in">      tags$figcaption(cap)</span></span>
<span id="cb455-25"><a href="rmarkdown-operation.html#cb455-25" aria-hidden="true" tabindex="-1"></a><span class="in">    ))</span></span>
<span id="cb455-26"><a href="rmarkdown-operation.html#cb455-26" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb455-27"><a href="rmarkdown-operation.html#cb455-27" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb455-28"><a href="rmarkdown-operation.html#cb455-28" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb455-29"><a href="rmarkdown-operation.html#cb455-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-30"><a href="rmarkdown-operation.html#cb455-30" aria-hidden="true" tabindex="-1"></a>代码块中的图像将被放置在 <span class="in">`&lt;figure&gt;`</span> 标签之中：</span>
<span id="cb455-31"><a href="rmarkdown-operation.html#cb455-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-32"><a href="rmarkdown-operation.html#cb455-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-33"><a href="rmarkdown-operation.html#cb455-33" aria-hidden="true" tabindex="-1"></a>``<span class="in">`{r, fig.cap=&#39;一个`</span>cars`数据的散点图&#39;}</span>
<span id="cb455-34"><a href="rmarkdown-operation.html#cb455-34" aria-hidden="true" tabindex="-1"></a>par(mar = c(4.5, 4.5, .2, .2))</span>
<span id="cb455-35"><a href="rmarkdown-operation.html#cb455-35" aria-hidden="true" tabindex="-1"></a>plot(cars, pch = 19, col = &#39;red&#39;)</span>
<span id="cb455-36"><a href="rmarkdown-operation.html#cb455-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb455-37"><a href="rmarkdown-operation.html#cb455-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-38"><a href="rmarkdown-operation.html#cb455-38" aria-hidden="true" tabindex="-1"></a><span class="in">可以进一步添加一些 CSS 样式来让 `&lt;figure&gt;` 和 `&lt;figcaption&gt;` 标签“看”起来更好一些（`figure` 有虚线边框，图像标题有浅粉色背景）：</span></span>
<span id="cb455-39"><a href="rmarkdown-operation.html#cb455-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb455-40"><a href="rmarkdown-operation.html#cb455-40" aria-hidden="true" tabindex="-1"></a><span class="in">```{css, echo=FALSE}</span></span>
<span id="cb455-41"><a href="rmarkdown-operation.html#cb455-41" aria-hidden="true" tabindex="-1"></a><span class="in">figure {</span></span>
<span id="cb455-42"><a href="rmarkdown-operation.html#cb455-42" aria-hidden="true" tabindex="-1"></a><span class="in">  border: 2px dashed red;</span></span>
<span id="cb455-43"><a href="rmarkdown-operation.html#cb455-43" aria-hidden="true" tabindex="-1"></a><span class="in">  margin: 1em 0;</span></span>
<span id="cb455-44"><a href="rmarkdown-operation.html#cb455-44" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb455-45"><a href="rmarkdown-operation.html#cb455-45" aria-hidden="true" tabindex="-1"></a><span class="in">figcaption {</span></span>
<span id="cb455-46"><a href="rmarkdown-operation.html#cb455-46" aria-hidden="true" tabindex="-1"></a><span class="in">  padding: .5em;</span></span>
<span id="cb455-47"><a href="rmarkdown-operation.html#cb455-47" aria-hidden="true" tabindex="-1"></a><span class="in">  background: lightpink;</span></span>
<span id="cb455-48"><a href="rmarkdown-operation.html#cb455-48" aria-hidden="true" tabindex="-1"></a><span class="in">  font-size: 1.3em;</span></span>
<span id="cb455-49"><a href="rmarkdown-operation.html#cb455-49" aria-hidden="true" tabindex="-1"></a><span class="in">  font-variant: small-caps;</span></span>
<span id="cb455-50"><a href="rmarkdown-operation.html#cb455-50" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb455-51"><a href="rmarkdown-operation.html#cb455-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
<p>图像的输出如图 <a href="rmarkdown-operation.html#fig:hook-html5">6.8</a> 所示。注意，这个例子实际上覆盖了默认的 <code>plot</code> 钩子，而本节的大多数其他例子都是在默认钩子的基础上构建自定义钩子。只有当确定要忽略默认钩子的一些内置特性时，才应该完全覆盖默认钩子。例如，在本例中，<code>plot</code> 钩子函数没有考虑像 <code>out.width = '100%'</code> 或 <code>fig.show = 'animate'</code> 这样的块选项。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:hook-html5"></span>
<img src="images/hook-html5.png" alt="一个在HTML5 `figure` 标签中的图像"  />
<p class="caption">
图 6.8: 一个在HTML5 <code>figure</code> 标签中的图像
</p>
</div>
<p>上例展示了在 <code>plot</code> 钩子 中使用图像文件路径 <code>x</code> 可以进行的操作。如果所需要的只是自定义图像的样式，则不必使用 HTML5 标签。通常情况下，默认的 <code>plot</code> 钩子会以如下的 HTML 代码输出图像：</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb456-1"><a href="rmarkdown-operation.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;div</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;figure&quot;</span><span class="kw">&gt;</span></span>
<span id="cb456-2"><a href="rmarkdown-operation.html#cb456-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;img</span> <span class="er">src</span><span class="ot">=</span><span class="st">&quot;PATH&quot;</span> <span class="kw">/&gt;</span></span>
<span id="cb456-3"><a href="rmarkdown-operation.html#cb456-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;p</span> <span class="er">class</span><span class="ot">=</span><span class="st">&quot;caption&quot;</span><span class="kw">&gt;</span>CAPTION<span class="kw">&lt;/p&gt;</span></span>
<span id="cb456-4"><a href="rmarkdown-operation.html#cb456-4" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>所以可以仅为 <code>div.figure</code> 和 <code>p.caption</code> 定义 CSS 规则。</p>
</div>
</div>
<div id="cache" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> 缓存 (*)<a href="rmarkdown-operation.html#cache" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="chunk-cache" class="section level3 hasAnchor" number="6.5.1">
<h3><span class="header-section-number">6.5.1</span> 缓存耗时的代码块<a href="rmarkdown-operation.html#chunk-cache" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在一个报告中，往往会有一些运行起来很费时且很关键的代码块（如数据预处理等）。为了节省时间，可以考虑通过块选项 <code>cache = TRUE</code> 来缓存该代码块的结果。当启用缓存时，如果一个代码块之前被执行过且之后没有任何变化时，<strong>knitr</strong> 将跳过这个代码块的执行，从而大大缩短编译所需的时间。而当再次修改代码块时（如修改代码或块选项），之前的缓存将自动失效，并且 <strong>knitr</strong> 将再次运行并缓存该代码块。</p>
<p>对于一个被缓存了的代码块，它的输出以及变量对象将从上一次的运行中自动加载，就像该代码块被再次执行了一样。当加载结果比计算结果快得多时，缓存操作通常是有用的。然而，天下没有免费的午餐，有的时候 <strong>knitr</strong> 会令缓存失效或是部分失效，如外部文件内容的改变可能没有体现在报告中等等。更多关于如何缓存，特别是缓存失效的相关知识可参见：<a href="https://yihui.org/en/2018/06/cache-invalidation/" class="uri">https://yihui.org/en/2018/06/cache-invalidation/</a>。</p>
<p>缓存的一个典型应用场景是保存和重新加载那些需要很长时间才能在代码块中计算的 R 对象。需要注意的是，代码需要没有任何“副产物”，否则建议不要进行缓存。例如在使用 <code>options()</code> 更改全局 R 选项时，产生的更改不会被缓存。</p>
<p>正如前文提到的，缓存依赖于代码或块选项。如果改变了任何块选项（除了 <code>include</code> 选项），缓存将会失效。此特性可用于解决一个常见的问题，即当代码需要读取外部数据文件时，应在更新数据文件时使缓存失效，那仅仅像下面这样简单地使用 <code>cache = TRUE</code> 是不够的：</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb457-1"><a href="rmarkdown-operation.html#cb457-1" aria-hidden="true" tabindex="-1"></a>```{r import-data, cache=TRUE}</span>
<span id="cb457-2"><a href="rmarkdown-operation.html#cb457-2" aria-hidden="true" tabindex="-1"></a>d &lt;- read.csv(&#39;数据.csv&#39;)</span>
<span id="cb457-3"><a href="rmarkdown-operation.html#cb457-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>必须要让 <strong>knitr</strong> 知道数据文件是否已被更改。一种方法是添加另一个块选项 <code>cache.extra = file.mtime('数据.csv')</code>，或者更严格的方式：<code>cache.extra = tools::md5sum('数据.csv')</code>。前者意味着如果文件的修改时间发生了变化，就需要使缓存失效；而后者的意思是，如果文件的内容被修改，就更新缓存。需要注意的是，<code>cache.extra</code>不是一个内置的 <strong>knitr</strong> 代码选项，可以为该选项使用任何其他名称，只要它不与内置选项名称冲突。</p>
<p>类似地，还可以将缓存与其他信息相关联，比如R的版本（<code>cache.extra = getRversion()</code>）、时间（<code>cache.extra = Sys.Date()</code>）或是操作系统（<code>cache.extra = Sys.info()[['sysname']]</code>），当这些条件改变时，可以使缓存正确地失效。</p>
<p>需要注意的是，本书不建议在文档中设置全局块选项 <code>cache = TRUE</code>，因为缓存可能相当棘手。相反的，可以只在个别耗时很久的代码块上启用缓存，这样并不会产生副产物。</p>
<p>如果对 <strong>knitr</strong> 的缓存设计不满意，还可以选择自己缓存对象，下面是一个简单的例子：</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="rmarkdown-operation.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">&#39;结果.rds&#39;</span>)) {</span>
<span id="cb458-2"><a href="rmarkdown-operation.html#cb458-2" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">&#39;结果.rds&#39;</span>)</span>
<span id="cb458-3"><a href="rmarkdown-operation.html#cb458-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb458-4"><a href="rmarkdown-operation.html#cb458-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">compute_it</span>()  <span class="co"># 一个很耗时的函数</span></span>
<span id="cb458-5"><a href="rmarkdown-operation.html#cb458-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(res, <span class="st">&#39;结果.rds&#39;</span>)</span>
<span id="cb458-6"><a href="rmarkdown-operation.html#cb458-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>在这一例子中，使缓存失效的唯一（也是简单的）方法就是删除文件<code>results.rds</code>。如果对这个简单的缓存机制感兴趣，可以使用在<a href="rmarkdown-operation.html#cache-rds">6.5.4</a>节中介绍的函数<code>xfun::cache_rds()</code>。</p>
</div>
<div id="cache-path" class="section level3 hasAnchor" number="6.5.2">
<h3><span class="header-section-number">6.5.2</span> 为多种输出格式缓存代码块<a href="rmarkdown-operation.html#cache-path" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当通过块选项 <code>cache = TRUE</code>启用缓存时，<strong>knitr</strong> 将把在代码块中生成的 R 对象写入缓存数据库，以便下次重新加载它们。缓存数据库的路径由块选项 <code>cache.path</code> 决定。默认情况下，R Markdown 对不同的输出格式会使用不同的缓存路径，这意味着对于每种输出格式都将完全执行一次这个（耗时的）代码块。这可能很不方便，但这种默认的行为是有原因的，即代码块的输出可能依赖于特定的输出格式。例如，生成图像，当输出格式为<code>word_document</code>时，图像的输出可能是像 <code>![text](path/to/image.png)</code> 这样的标记代码；而或者当输出格式为 <code>html_document</code> 时，输出的HTML代码则类似 <code>&lt;img src="path/to/image.png" /&gt;</code>。</p>
<p>当代码块没有任何副产物（如图像）时，对所有输出格式使用相同的缓存数据库是安全的，还可以节省时间。例如，当读取一个大型数据对象或运行一个比较耗时的模型时，若结果不依赖于输出格式，就可以使用相同的缓存数据库。可以通过块选项 <code>cache.path</code> ，例如：</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb459-1"><a href="rmarkdown-operation.html#cb459-1" aria-hidden="true" tabindex="-1"></a>```{r important-computing, cache=TRUE, cache.path=&quot;cache/&quot;}</span>
<span id="cb459-2"><a href="rmarkdown-operation.html#cb459-2" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>实际上，在 R Markdown 中，<code>cache.path</code> 的默认设置为 <code>cache.path = "INPUT_cache/FORMAT/"</code>，其中 <code>INPUT</code> 代表输入的文件名，<code>FORMAT</code> 为输出格式（如 <code>html</code>、<code>latex</code> 或 <code>docx</code>），这就导致了不同的输出格式对应不同的缓存路径。</p>
</div>
<div id="cache-lazy" class="section level3 hasAnchor" number="6.5.3">
<h3><span class="header-section-number">6.5.3</span> 缓存大型的对象<a href="rmarkdown-operation.html#cache-lazy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当设定块选项 <code>cache = TRUE</code> 时，缓存的对象将被延迟加载到 R 中，这意味着对象将不会从缓存数据库中读取，直到它在代码中被实际使用。当不是所有对象都在文档中稍后被使用时，这一操作可以节省一些内存。例如，如果读取了一个大型的数据对象，但在后续的分析中只使用了其中的一个子集，那么原始的数据对象将不会从缓存数据库中加载：</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb460-1"><a href="rmarkdown-operation.html#cb460-1" aria-hidden="true" tabindex="-1"></a>```{r, read-data, cache=TRUE}</span>
<span id="cb460-2"><a href="rmarkdown-operation.html#cb460-2" aria-hidden="true" tabindex="-1"></a>full &lt;- read.csv(&quot;大型数据集.csv&quot;)</span>
<span id="cb460-3"><a href="rmarkdown-operation.html#cb460-3" aria-hidden="true" tabindex="-1"></a>rows &lt;- subset(full, price &gt; 100)</span>
<span id="cb460-4"><a href="rmarkdown-operation.html#cb460-4" aria-hidden="true" tabindex="-1"></a># 之后只使用 `rows` 数据集</span>
<span id="cb460-5"><a href="rmarkdown-operation.html#cb460-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb460-6"><a href="rmarkdown-operation.html#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="rmarkdown-operation.html#cb460-7" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb460-8"><a href="rmarkdown-operation.html#cb460-8" aria-hidden="true" tabindex="-1"></a>plot(rows)</span>
<span id="cb460-9"><a href="rmarkdown-operation.html#cb460-9" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>然而，当一个对象太大时，可能会遇到这样的报错：</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="rmarkdown-operation.html#cb461-1" aria-hidden="true" tabindex="-1"></a>Error <span class="cf">in</span> <span class="fu">lazyLoadDBinsertVariable</span>(vars[i], ...</span>
<span id="cb461-2"><a href="rmarkdown-operation.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  long vectors not supported yet<span class="sc">:</span> ...</span>
<span id="cb461-3"><a href="rmarkdown-operation.html#cb461-3" aria-hidden="true" tabindex="-1"></a>Execution halted</span></code></pre></div>
<p>如果出现这个问题，可以尝试通过块选项 <code>cache.lazy = FALSE</code> 来关闭延迟加载，这样该代码块中的所有对象都将立即被加载到内存中。</p>
</div>
<div id="cache-rds" class="section level3 hasAnchor" number="6.5.4">
<h3><span class="header-section-number">6.5.4</span> 一个更透明的缓存机制<a href="rmarkdown-operation.html#cache-rds" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>如果在使用的过程中，觉得前文介绍的基于 <strong>knitr</strong> 的缓存机过于复杂，可以考虑使用基于函数 <code>xfun::cache_rds()</code> 的一个更简单的缓存机制，例如：</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="rmarkdown-operation.html#cb462-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb462-2"><a href="rmarkdown-operation.html#cb462-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 在这里编写耗时的代码</span></span>
<span id="cb462-3"><a href="rmarkdown-operation.html#cb462-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>关于 <strong>knitr</strong> 缓存，其棘手之处在于如何决定何时使缓存失效，而使用 <code>xfun::cache_rds()</code> 则要清楚得多：第一次将 R 表达式传递给这个函数时，它会计算表达式并将结果保存到 <code>.rds</code> 文件中；下次再次运行 <code>cache_rds()</code> 时，它会读取 <code>.rds</code> 文件，并立即返回结果，而不再次计算表达式。使缓存无效的最明显的方法是删除 <code>.rds</code> 的文件。如果不想手动删除它，则可以用参数 <code>rerun = TRUE</code> 来调用 <code>xfun::cache_rds()</code>。</p>
<p>当 <code>xfun::cache_rds()</code> 在 <strong>knitr</strong> 源文档的一个代码块中被调用时，<code>.rds</code> 文件的路径由块选项 <code>cache.path</code> 和块标签决定。例如，对于在 Rmd 文档 <code>input.Rmd</code> 中带有块标签 <code>foo</code> 的代码块：</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb463-1"><a href="rmarkdown-operation.html#cb463-1" aria-hidden="true" tabindex="-1"></a>```{r, foo}</span>
<span id="cb463-2"><a href="rmarkdown-operation.html#cb463-2" aria-hidden="true" tabindex="-1"></a>res &lt;- xfun::cache_rds({</span>
<span id="cb463-3"><a href="rmarkdown-operation.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  Sys.sleep(3)</span>
<span id="cb463-4"><a href="rmarkdown-operation.html#cb463-4" aria-hidden="true" tabindex="-1"></a>  1:10</span>
<span id="cb463-5"><a href="rmarkdown-operation.html#cb463-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb463-6"><a href="rmarkdown-operation.html#cb463-6" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><code>.rds</code> 文件的路径格式为 <code>input_cache/FORMAT/foo_HASH.rds</code>，其中 <code>FORMAT</code> 是 Pandoc 输出格式名称（例如 <code>html</code> 或 <code>latex</code>）， <code>HASH</code> 是一个MD5哈希值，包含了 32 个十六进制数字（a-f 和 0-9），例如 <code>input_cache/html/foo_7a3f22c4309d400eff95de0e8bddac71.rds</code>。</p>
<p>如帮助页面 <code>?xfun::cache_rds</code> 所述，通常在两种的情况下可能想要使缓存失效：（1）待求值表达式中的代码发生了变化；（2）代码使用了一个外部变量，并且该变量的值已经改变。本节接下来将解释这两种情况下缓存是如何失效的，以及如何将缓存的多个副本保存到对应于不同版本的代码中。</p>
<div id="通过更改表达式中的代码使缓存失效" class="section level4 hasAnchor" number="6.5.4.1">
<h4><span class="header-section-number">6.5.4.1</span> 通过更改表达式中的代码使缓存失效<a href="rmarkdown-operation.html#通过更改表达式中的代码使缓存失效" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>当改变 <code>cache_rds()</code>中的代码时（例如，从 <code>cache_rds({x + 1})</code> 改为 <code>cache_rds({x + 2})</code>），缓存将自动失效，表达式将被重新计算。但是需要注意的是，空格或注释的变化是不重要的，或者一般来说，只要更改不影响已解析的表达式，缓存就不会失效。例如，下面传递给 <code>cache_rds()</code> 的两个表达式在本质上是相同的：</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="rmarkdown-operation.html#cb464-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb464-2"><a href="rmarkdown-operation.html#cb464-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>);</span>
<span id="cb464-3"><a href="rmarkdown-operation.html#cb464-3" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>;  <span class="co"># 分号不影响</span></span>
<span id="cb464-4"><a href="rmarkdown-operation.html#cb464-4" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">+</span><span class="dv">1</span>;</span>
<span id="cb464-5"><a href="rmarkdown-operation.html#cb464-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb464-6"><a href="rmarkdown-operation.html#cb464-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb464-7"><a href="rmarkdown-operation.html#cb464-7" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb464-8"><a href="rmarkdown-operation.html#cb464-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb464-9"><a href="rmarkdown-operation.html#cb464-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>  <span class="co"># 一个注释</span></span>
<span id="cb464-10"><a href="rmarkdown-operation.html#cb464-10" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span></span>
<span id="cb464-11"><a href="rmarkdown-operation.html#cb464-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="co"># 可以随意修改空格部分</span></span>
<span id="cb464-12"><a href="rmarkdown-operation.html#cb464-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>因此，如果对第一个表达式执行 <code>cache_rds()</code> ，那么第二个表达式将能够调用缓存的结果。这一特性非常有用，因为其允许在代码中进行修饰性更改，而不会使缓存失效。</p>
<p>如果不确定两个版本的代码是否相等，则可以尝试下面的 <code>parse_code()</code> 函数：</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="rmarkdown-operation.html#cb465-1" aria-hidden="true" tabindex="-1"></a>parse_code <span class="ot">&lt;-</span> <span class="cf">function</span>(expr) {</span>
<span id="cb465-2"><a href="rmarkdown-operation.html#cb465-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deparse</span>(<span class="fu">substitute</span>(expr))</span>
<span id="cb465-3"><a href="rmarkdown-operation.html#cb465-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb465-4"><a href="rmarkdown-operation.html#cb465-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb465-5"><a href="rmarkdown-operation.html#cb465-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 空格或分号不影响</span></span>
<span id="cb465-6"><a href="rmarkdown-operation.html#cb465-6" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_code</span>({x<span class="sc">+</span><span class="dv">1</span>})</span></code></pre></div>
<pre><code>## [1] &quot;{&quot;         &quot;    x + 1&quot; &quot;}&quot;</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="rmarkdown-operation.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse_code</span>({ x   <span class="sc">+</span>    <span class="dv">1</span>; })</span></code></pre></div>
<pre><code>## [1] &quot;{&quot;         &quot;    x + 1&quot; &quot;}&quot;</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="rmarkdown-operation.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 左箭头和右箭头是等价的</span></span>
<span id="cb469-2"><a href="rmarkdown-operation.html#cb469-2" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">parse_code</span>({x <span class="ot">&lt;-</span> <span class="dv">1</span>}), <span class="fu">parse_code</span>({<span class="dv">1</span> <span class="ot">-&gt;</span> x}))</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="通过更改全局变量使缓存失效" class="section level4 hasAnchor" number="6.5.4.2">
<h4><span class="header-section-number">6.5.4.2</span> 通过更改全局变量使缓存失效<a href="rmarkdown-operation.html#通过更改全局变量使缓存失效" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>通常情况下，表达式中有两种类型的变量：全局变量和局部变量。全局变量是在表达式外部创建的，局部变量则是在表达式内部创建的。如果表达式中全局变量的值发生了变化，那么缓存的结果和再次运行的结果之间可能会产生差异。例如，在下面的表达式中，如果 <code>y</code> 发生了变化，需要想要使缓存失效并重新运行表达式，否则仍然会得到根据 <code>y</code> 之前的值计算得到的结果：</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="rmarkdown-operation.html#cb471-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb471-2"><a href="rmarkdown-operation.html#cb471-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb471-3"><a href="rmarkdown-operation.html#cb471-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb471-4"><a href="rmarkdown-operation.html#cb471-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb471-5"><a href="rmarkdown-operation.html#cb471-5" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb471-6"><a href="rmarkdown-operation.html#cb471-6" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>如果要使缓存在 <code>y</code> 发生变化时失效，则需要通过 <code>hash</code> 参数，让 <code>cache_rds()</code> 在决定缓存是否应该失效时知道需要考虑 <code>y</code>：</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="rmarkdown-operation.html#cb472-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb472-2"><a href="rmarkdown-operation.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb472-3"><a href="rmarkdown-operation.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb472-4"><a href="rmarkdown-operation.html#cb472-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y))</span></code></pre></div>
<p>当 <code>hash</code> 参数的值改变时，缓存文件名中的 32 位哈希值（如前所述）会相应地改变，导致缓存失效。这提供了一种方法来指定缓存与其他 R 对象的依赖关系。例如，如果想要使缓存依赖于 <code>y</code> 以及 R 的版本，可以这样指定依赖：</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="rmarkdown-operation.html#cb473-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb473-2"><a href="rmarkdown-operation.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb473-3"><a href="rmarkdown-operation.html#cb473-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y</span>
<span id="cb473-4"><a href="rmarkdown-operation.html#cb473-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y, <span class="fu">getRversion</span>()))</span></code></pre></div>
<p>或者如果想让缓存依赖于 <code>y</code> 以及数据文件最后一次修改的时间，可以这样做：</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="rmarkdown-operation.html#cb474-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb474-2"><a href="rmarkdown-operation.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;数据.csv&quot;</span>)</span>
<span id="cb474-3"><a href="rmarkdown-operation.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  x[[<span class="dv">1</span>]] <span class="sc">+</span> y</span>
<span id="cb474-4"><a href="rmarkdown-operation.html#cb474-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(y, <span class="fu">file.mtime</span>(<span class="st">&quot;数据.csv&quot;</span>)))</span></code></pre></div>
<p>如果不想为 <code>hash</code> 参数提供全局变量的列表，则可以尝试 <code>hash = "auto"</code>，它将使 <code>cache_rds()</code> 自动找出所有的全局变量，并将它们作为 <code>hash</code> 参数的值，例如：</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="rmarkdown-operation.html#cb475-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb475-2"><a href="rmarkdown-operation.html#cb475-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb475-3"><a href="rmarkdown-operation.html#cb475-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y <span class="sc">+</span> z  <span class="co"># y 和 z 是全局变量</span></span>
<span id="cb475-4"><a href="rmarkdown-operation.html#cb475-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="st">&quot;auto&quot;</span>)</span></code></pre></div>
<p>这等价于：</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="rmarkdown-operation.html#cb476-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb476-2"><a href="rmarkdown-operation.html#cb476-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb476-3"><a href="rmarkdown-operation.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> y <span class="sc">+</span> z  <span class="co"># y 和 z 是全局变量</span></span>
<span id="cb476-4"><a href="rmarkdown-operation.html#cb476-4" aria-hidden="true" tabindex="-1"></a>}, <span class="at">hash =</span> <span class="fu">list</span>(<span class="at">y =</span> y, <span class="at">z =</span> z))</span></code></pre></div>
<p>当 <code>hash = "auto"</code> 时，全局变量由 <code>codetools::findGlobals()</code> 识别，这可能不是完全可靠的，所以如果需要完全确定哪些变量可以使缓存失效，本书建议在 <code>hash</code> 参数中亲自给定变量列表。</p>
</div>
<div id="保留缓存的多个副本" class="section level4 hasAnchor" number="6.5.4.3">
<h4><span class="header-section-number">6.5.4.3</span> 保留缓存的多个副本<a href="rmarkdown-operation.html#保留缓存的多个副本" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>由于缓存通常用于非常耗时的代码，在使其失效时应当保守一些。有的时候可能会因过早或主动地使缓存失效而后悔，因为如果再次需要一个旧版本的缓存时，则将不得不等待很长的时间才能重新完成计算。</p>
<p>若将 <code>cache_rds()</code> 中的 <code>clean</code> 参数设置为 <code>FALSE</code>，则将允许保留旧的缓存副本。也可以设置全局 R 选项 <code>options(xfun.cache_rds.clean = FALSE)</code> 来使其成为文档的默认行为。在默认情况下，<code>clean = TRUE</code> 和 <code>cache_rds()</code> 每次都会尝试删除旧的缓存。如果还在进行代码测试，那么设置 <code>clean = FALSE</code> 会很有用。例如，可以缓存一个线性模型的两个版本：</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="rmarkdown-operation.html#cb477-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb477-2"><a href="rmarkdown-operation.html#cb477-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(dist <span class="sc">~</span> speed, <span class="at">data =</span> cars)</span>
<span id="cb477-3"><a href="rmarkdown-operation.html#cb477-3" aria-hidden="true" tabindex="-1"></a>}, <span class="at">clean =</span> <span class="cn">FALSE</span>)</span>
<span id="cb477-4"><a href="rmarkdown-operation.html#cb477-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-5"><a href="rmarkdown-operation.html#cb477-5" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb477-6"><a href="rmarkdown-operation.html#cb477-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(dist <span class="sc">~</span> speed <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> cars)</span>
<span id="cb477-7"><a href="rmarkdown-operation.html#cb477-7" aria-hidden="true" tabindex="-1"></a>}, <span class="at">clean =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>在决定使用哪个模型之后，可以再次设置 <code>clean = TRUE</code>，或者删除 <code>clean</code> 参数（默认为 <code>TRUE</code>）。</p>
</div>
<div id="与-knitr-的缓存比较" class="section level4 hasAnchor" number="6.5.4.4">
<h4><span class="header-section-number">6.5.4.4</span> 与 <strong>knitr</strong> 的缓存比较<a href="rmarkdown-operation.html#与-knitr-的缓存比较" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>那么什么时候使用 <strong>knitr</strong> 的缓存（例如，设置块选项 <code>cache = TRUE</code>），什么时候在 <strong>knitr</strong> 源文档中使用 <code>xfun::cache_rds()</code>呢？后者最大的缺点是它不缓存副产物（而只缓存表达式的值），而 <strong>knitr</strong> 却可以。有的时候，一些副产物是有用的，比如打印的输出或图像。例如，在下面的代码中，当使用 <code>cache_rds()</code> 加载缓存时，文本输出和图像将会丢失，只会返回 <code>1:10</code>：</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="rmarkdown-operation.html#cb478-1" aria-hidden="true" tabindex="-1"></a>xfun<span class="sc">::</span><span class="fu">cache_rds</span>({</span>
<span id="cb478-2"><a href="rmarkdown-operation.html#cb478-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Hello world!&quot;</span>)</span>
<span id="cb478-3"><a href="rmarkdown-operation.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(cars)</span>
<span id="cb478-4"><a href="rmarkdown-operation.html#cb478-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb478-5"><a href="rmarkdown-operation.html#cb478-5" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>相比之下，对于设定选项为 <code>cache = TRUE</code> 的代码块，所有的内容都将被缓存：</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb479-1"><a href="rmarkdown-operation.html#cb479-1" aria-hidden="true" tabindex="-1"></a>```{r, cache=TRUE}</span>
<span id="cb479-2"><a href="rmarkdown-operation.html#cb479-2" aria-hidden="true" tabindex="-1"></a>print(&quot;Hello world!&quot;)</span>
<span id="cb479-3"><a href="rmarkdown-operation.html#cb479-3" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb479-4"><a href="rmarkdown-operation.html#cb479-4" aria-hidden="true" tabindex="-1"></a>1:10</span>
<span id="cb479-5"><a href="rmarkdown-operation.html#cb479-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>但 <strong>knitr</strong> 的缓存最大的缺点（同时也是用户最常抱怨的）是缓存可能会在不经意间失效，因为缓存由太多的因素所决定。例如，任何块选项的改变都会使缓存失效<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a>，但有些块选项可能与计算无关。例如在下面的代码块中，改变块选项 <code>fig.width = 6</code> 到 <code>fig.width = 10</code> 会导致缓存失效，但实际上却不需要重新运行一次代码：</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb480-1"><a href="rmarkdown-operation.html#cb480-1" aria-hidden="true" tabindex="-1"></a>```{r, cache=TRUE, fig.width=6}</span>
<span id="cb480-2"><a href="rmarkdown-operation.html#cb480-2" aria-hidden="true" tabindex="-1"></a># 这个块没有生成图像</span>
<span id="cb480-3"><a href="rmarkdown-operation.html#cb480-3" aria-hidden="true" tabindex="-1"></a>x &lt;- rnorm(1000)</span>
<span id="cb480-4"><a href="rmarkdown-operation.html#cb480-4" aria-hidden="true" tabindex="-1"></a>mean(x)</span>
<span id="cb480-5"><a href="rmarkdown-operation.html#cb480-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>实际上，<strong>knitr</strong> 的缓存非常强大且灵活，它的行为可以通过多种方式进行调整。它的作者也经常怀疑是否值得介绍这些不太为人所知的特性，因为可能会导致用户花更多的时间来学习和理解缓存如何工作，而非运行实际的代码。</p>
<p>在不清楚用哪个的情况下，<code>xfun::cache_rds()</code> 是缓存计算结果的通用方法，它可以在任何地方使用，而 <strong>knitr</strong> 的缓存只能在 <strong>knitr</strong> 文档中使用。</p>
</div>
</div>
</div>
<div id="other-trick" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> 其它使用 knitr 的小技巧 (*)<a href="rmarkdown-operation.html#other-trick" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>除了块选项（第 <a href="rmarkdown-operation.html#chunk-options">6.2</a> 节）和输出钩子（第 <a href="rmarkdown-operation.html#output-hook">6.4</a> 节）之外，在 <strong>knitr</strong> 中还有很多有用的函数和技巧。本节将介绍这些技巧，例如重复使用代码块（第 <a href="rmarkdown-operation.html#reuse-chunk">6.6.1</a> 节）、提前退出编译（第 <a href="rmarkdown-operation.html#compile-exit">6.6.3</a> 节）、生成一个图像并在其他地方显示（第 <a href="rmarkdown-operation.html#plot-show-else">6.6.4</a> 节）等等。</p>
<div id="reuse-chunk" class="section level3 hasAnchor" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> 重复使用代码块<a href="rmarkdown-operation.html#reuse-chunk" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有的时候，使用者需要在源文档中重复使用某些代码块，例如在详细讲解某一段代码、重复生成一些数据或者需要在附录中呈现所有代码时。这当然可以通过复制粘贴实现，但通常会很麻烦，甚至会在改一段代码时忘记修改对应的另一段代码。实际上，还有更简便的方法实现重复使用代码块的功能，这其中的关键点在于标记代码块，从而在其它地方用标签的形式引用它们。本节将介绍三种重复使用代码块的方法。</p>
<div id="embed-chunk" class="section level4 hasAnchor" number="6.6.1.1">
<h4><span class="header-section-number">6.6.1.1</span> 嵌入代码块 (*)<a href="rmarkdown-operation.html#embed-chunk" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>R Markdown 支持在 R 函数中使用 <code>&lt;&lt; label &gt;&gt;</code> 作为占位符，随后以 <code>label</code> 为标签的代码块中的内容会被嵌入该函数中。例如，可以这样创建一个 R 函数：</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb481-1"><a href="rmarkdown-operation.html#cb481-1" aria-hidden="true" tabindex="-1"></a>F2C <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb481-2"><a href="rmarkdown-operation.html#cb481-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">&lt;</span><span class="er">&lt;</span>check<span class="sc">-</span>arg<span class="sc">&gt;</span><span class="er">&gt;</span></span>
<span id="cb481-3"><a href="rmarkdown-operation.html#cb481-3" aria-hidden="true" tabindex="-1"></a>  <span class="er">&lt;&lt;</span>convert<span class="sc">&gt;</span><span class="er">&gt;</span></span>
<span id="cb481-4"><a href="rmarkdown-operation.html#cb481-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>随后，分别用两个标签为 <code>check-arg</code> 和 <code>convert</code> 的代码块实现 <code>F2C</code> 函数的功能：</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb482-1"><a href="rmarkdown-operation.html#cb482-1" aria-hidden="true" tabindex="-1"></a>首先，检查输入值是否为数字：</span>
<span id="cb482-2"><a href="rmarkdown-operation.html#cb482-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-3"><a href="rmarkdown-operation.html#cb482-3" aria-hidden="true" tabindex="-1"></a>```{r, check-arg, eval=FALSE}</span>
<span id="cb482-4"><a href="rmarkdown-operation.html#cb482-4" aria-hidden="true" tabindex="-1"></a>  if (!is.numeric(x)) stop(&quot;The input must be numeric!&quot;)</span>
<span id="cb482-5"><a href="rmarkdown-operation.html#cb482-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb482-6"><a href="rmarkdown-operation.html#cb482-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-7"><a href="rmarkdown-operation.html#cb482-7" aria-hidden="true" tabindex="-1"></a>然后进行转换：</span>
<span id="cb482-8"><a href="rmarkdown-operation.html#cb482-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb482-9"><a href="rmarkdown-operation.html#cb482-9" aria-hidden="true" tabindex="-1"></a>```{r, convert, eval=FALSE}</span>
<span id="cb482-10"><a href="rmarkdown-operation.html#cb482-10" aria-hidden="true" tabindex="-1"></a>  (x - 32) * 5/ 9</span>
<span id="cb482-11"><a href="rmarkdown-operation.html#cb482-11" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>编译时，<strong>knitr</strong> 将自动将 <code>&lt;&lt;check-arg&gt;&gt;</code> 和 <code>&lt;&lt;convert&gt;&gt;</code> 扩展为 <code>check-arg</code> 和 <code>convert</code> 两个代码块的内容，生成：</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="rmarkdown-operation.html#cb483-1" aria-hidden="true" tabindex="-1"></a>F2C <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb483-2"><a href="rmarkdown-operation.html#cb483-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(x)) <span class="fu">stop</span>(<span class="st">&quot;The input must be numeric!&quot;</span>)</span>
<span id="cb483-3"><a href="rmarkdown-operation.html#cb483-3" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="dv">32</span>) <span class="sc">*</span> <span class="dv">5</span><span class="sc">/</span> <span class="dv">9</span></span>
<span id="cb483-4"><a href="rmarkdown-operation.html#cb483-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>这是唐纳德·克努特（Donald Knuth）提出的<a href="https://en.wikipedia.org/wiki/Literate_programming">文学编程</a>中的主要思想之一。这种技术的优点在于，使用者可以将（复杂的）代码分割成更小的部分，将每个部分写入单独的代码块中，并使用文字叙述来解释它们。所有的部分都可以被放入要执行的主代码块中。</p>
<p>一个代码块中可以嵌入任意数量的其他代码块，并且嵌入也可以是递归的。例如，可以将块 A 嵌入到块 B 中，将块 B 嵌入到块 C 中，这样块 C 将借由块 B 包含块 A 中的代码。</p>
<p>另外，标记符 <code>&lt;&lt;label&gt;&gt;</code> 不必单独写成一行，它可以嵌入到代码块的任何地方。</p>
</div>
<div id="same-label" class="section level4 hasAnchor" number="6.6.1.2">
<h4><span class="header-section-number">6.6.1.2</span> 在另一个块中使用相同的块标签<a href="rmarkdown-operation.html#same-label" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>如果想要重复多次使用完全相同的代码块，则可以用一个标签来定义块，并使用相同的标签创建更多的代码块，但需要保留块的内容为空，例如：</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb484-1"><a href="rmarkdown-operation.html#cb484-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-2"><a href="rmarkdown-operation.html#cb484-2" aria-hidden="true" tabindex="-1"></a>下面是一个没有被运行的代码块：</span>
<span id="cb484-3"><a href="rmarkdown-operation.html#cb484-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-4"><a href="rmarkdown-operation.html#cb484-4" aria-hidden="true" tabindex="-1"></a>```{r, chunk-one, eval=FALSE}</span>
<span id="cb484-5"><a href="rmarkdown-operation.html#cb484-5" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb484-6"><a href="rmarkdown-operation.html#cb484-6" aria-hidden="true" tabindex="-1"></a>2 + 2</span>
<span id="cb484-7"><a href="rmarkdown-operation.html#cb484-7" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb484-8"><a href="rmarkdown-operation.html#cb484-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-9"><a href="rmarkdown-operation.html#cb484-9" aria-hidden="true" tabindex="-1"></a>现在运行该代码块：</span>
<span id="cb484-10"><a href="rmarkdown-operation.html#cb484-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-11"><a href="rmarkdown-operation.html#cb484-11" aria-hidden="true" tabindex="-1"></a>```{r, chunk-one, eval=TRUE}</span>
<span id="cb484-12"><a href="rmarkdown-operation.html#cb484-12" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>上面的例子使用了两次块标签 <code>chunk-one</code>，第二个块只是重复使用了第一个块的代码。</p>
<p>但是最好不要多次（多于一次）使用此方法多次运行代码块来生成图像或其他文件，因为从后面的块创建的图像文件可能会覆盖前一个块创建的文件。如果只有一个块使用块选项 <code>eval = TRUE</code>，而所有其他块使用 <code>eval = FALSE</code> 的话是可以的。</p>
</div>
<div id="ref-label" class="section level4 hasAnchor" number="6.6.1.3">
<h4><span class="header-section-number">6.6.1.3</span> 引用代码块标签 (*)<a href="rmarkdown-operation.html#ref-label" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>除了块之间的嵌入以及使用块标签外，还可以通过引用标签的方法来重复使用代码块。该方法的核心在于块选项 <code>ref.label</code>，该选项利用一个由块标签组成的向量来检索这些块的内容。例如在下例中，标签为 <code>chunk-a</code> 的代码块是 <code>chunk-c</code> 和 <code>chunk-b</code> 的组合：</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb485-1"><a href="rmarkdown-operation.html#cb485-1" aria-hidden="true" tabindex="-1"></a>```{r chunk-a, ref.label=c(&#39;chunk-c&#39;, &#39;chunk-b&#39;)}</span>
<span id="cb485-2"><a href="rmarkdown-operation.html#cb485-2" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb485-3"><a href="rmarkdown-operation.html#cb485-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-4"><a href="rmarkdown-operation.html#cb485-4" aria-hidden="true" tabindex="-1"></a>```{r chunk-b}</span>
<span id="cb485-5"><a href="rmarkdown-operation.html#cb485-5" aria-hidden="true" tabindex="-1"></a># 这是块 b</span>
<span id="cb485-6"><a href="rmarkdown-operation.html#cb485-6" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb485-7"><a href="rmarkdown-operation.html#cb485-7" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb485-8"><a href="rmarkdown-operation.html#cb485-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb485-9"><a href="rmarkdown-operation.html#cb485-9" aria-hidden="true" tabindex="-1"></a>```{r chunk-c}</span>
<span id="cb485-10"><a href="rmarkdown-operation.html#cb485-10" aria-hidden="true" tabindex="-1"></a># 这是块 c</span>
<span id="cb485-11"><a href="rmarkdown-operation.html#cb485-11" aria-hidden="true" tabindex="-1"></a>2 + 2</span>
<span id="cb485-12"><a href="rmarkdown-operation.html#cb485-12" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><code>chunk-a</code> 的内容在编译时被替换为：</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb486-1"><a href="rmarkdown-operation.html#cb486-1" aria-hidden="true" tabindex="-1"></a>```{r chunk-a}</span>
<span id="cb486-2"><a href="rmarkdown-operation.html#cb486-2" aria-hidden="true" tabindex="-1"></a># 这是块 c</span>
<span id="cb486-3"><a href="rmarkdown-operation.html#cb486-3" aria-hidden="true" tabindex="-1"></a>2 + 2</span>
<span id="cb486-4"><a href="rmarkdown-operation.html#cb486-4" aria-hidden="true" tabindex="-1"></a># 这是块 b</span>
<span id="cb486-5"><a href="rmarkdown-operation.html#cb486-5" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb486-6"><a href="rmarkdown-operation.html#cb486-6" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p><code>ref.label</code> 提供了一种在文档中灵活组织代码块的方法，而无需复制粘贴。需要注意的是，被引用的代码块在使用 <code>ref.label</code> 的代码块之前还是之后并不重要，文档中出现在前的代码块同样引用后面的代码块。</p>
</div>
</div>
<div id="use-creat" class="section level3 hasAnchor" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> 在创建对象之前使用它 (*)<a href="rmarkdown-operation.html#use-creat" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>一个 <strong>knitr</strong> 文档中的所有代码，包括代码块和行内 R 表达式中的代码，从开始到结束都是按先后顺序执行的。从理论上讲，在给变量赋值之前不能使用它。但是，在某些情况下，使用者可能需要在文档前面提到一个变量的值。例如，通常在文章的摘要中需要显示结果，但结果实际上是在文档的后面计算的。下面的例子说明了这个想法，但无法编译：</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb487-1"><a href="rmarkdown-operation.html#cb487-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb487-2"><a href="rmarkdown-operation.html#cb487-2" aria-hidden="true" tabindex="-1"></a>题目：一个重要的报告</span>
<span id="cb487-3"><a href="rmarkdown-operation.html#cb487-3" aria-hidden="true" tabindex="-1"></a>摘要： &gt;</span>
<span id="cb487-4"><a href="rmarkdown-operation.html#cb487-4" aria-hidden="true" tabindex="-1"></a>  在本文的分析中，`x` 的平均值是 `r knitr::inline_expr(&#39;mx&#39;)`...</span>
<span id="cb487-5"><a href="rmarkdown-operation.html#cb487-5" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb487-6"><a href="rmarkdown-operation.html#cb487-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-7"><a href="rmarkdown-operation.html#cb487-7" aria-hidden="true" tabindex="-1"></a>在下面的块中创建对象 `mx`：</span>
<span id="cb487-8"><a href="rmarkdown-operation.html#cb487-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb487-9"><a href="rmarkdown-operation.html#cb487-9" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb487-10"><a href="rmarkdown-operation.html#cb487-10" aria-hidden="true" tabindex="-1"></a>x &lt;- 1:100</span>
<span id="cb487-11"><a href="rmarkdown-operation.html#cb487-11" aria-hidden="true" tabindex="-1"></a>mx &lt;- mean(x)</span>
<span id="cb487-12"><a href="rmarkdown-operation.html#cb487-12" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>要解决这个问题，对象的值必须先保存在某个地方，并在下一次编译文档时加载。需要注意的是，这一操作意味着文档至少需要被编译两次。下面的例子介绍了一种可能的解决方案，即使用 <code>saveRDS()</code> 函数：</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb488-1"><a href="rmarkdown-operation.html#cb488-1" aria-hidden="true" tabindex="-1"></a>```{r, include=FALSE}</span>
<span id="cb488-2"><a href="rmarkdown-operation.html#cb488-2" aria-hidden="true" tabindex="-1"></a>mx &lt;- if (file.exists(&#39;mean.rds&#39;)) {</span>
<span id="cb488-3"><a href="rmarkdown-operation.html#cb488-3" aria-hidden="true" tabindex="-1"></a>  readRDS(&#39;mean.rds&#39;)</span>
<span id="cb488-4"><a href="rmarkdown-operation.html#cb488-4" aria-hidden="true" tabindex="-1"></a>} else {</span>
<span id="cb488-5"><a href="rmarkdown-operation.html#cb488-5" aria-hidden="true" tabindex="-1"></a>  &quot;The value of `mx` is not available yet&quot;</span>
<span id="cb488-6"><a href="rmarkdown-operation.html#cb488-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb488-7"><a href="rmarkdown-operation.html#cb488-7" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb488-8"><a href="rmarkdown-operation.html#cb488-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-9"><a href="rmarkdown-operation.html#cb488-9" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb488-10"><a href="rmarkdown-operation.html#cb488-10" aria-hidden="true" tabindex="-1"></a>题目：一个重要的报告</span>
<span id="cb488-11"><a href="rmarkdown-operation.html#cb488-11" aria-hidden="true" tabindex="-1"></a>摘要： &gt;</span>
<span id="cb488-12"><a href="rmarkdown-operation.html#cb488-12" aria-hidden="true" tabindex="-1"></a>  在本文的分析中，`x` 的平均值是</span>
<span id="cb488-13"><a href="rmarkdown-operation.html#cb488-13" aria-hidden="true" tabindex="-1"></a>  `r knitr::inline_expr(&#39;mx&#39;)`...</span>
<span id="cb488-14"><a href="rmarkdown-operation.html#cb488-14" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb488-15"><a href="rmarkdown-operation.html#cb488-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-16"><a href="rmarkdown-operation.html#cb488-16" aria-hidden="true" tabindex="-1"></a>在下面的块中创建对象 `mx`：</span>
<span id="cb488-17"><a href="rmarkdown-operation.html#cb488-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-18"><a href="rmarkdown-operation.html#cb488-18" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb488-19"><a href="rmarkdown-operation.html#cb488-19" aria-hidden="true" tabindex="-1"></a>x &lt;- 1:100</span>
<span id="cb488-20"><a href="rmarkdown-operation.html#cb488-20" aria-hidden="true" tabindex="-1"></a>mx &lt;- mean(x)</span>
<span id="cb488-21"><a href="rmarkdown-operation.html#cb488-21" aria-hidden="true" tabindex="-1"></a>saveRDS(mx, &#39;mean.rds&#39;)</span>
<span id="cb488-22"><a href="rmarkdown-operation.html#cb488-22" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>第一次编译本文档时，将会在摘要中看到短语 “The value of <code>mx</code> is not available yet”。之后当再次编译它时，将会看到 <code>mx</code> 的值。</p>
<p>函数 <code>knitr::load_cache()</code> 是一个替代的解决方案，它允许在特定的代码块已经被缓存了之后从该代码块加载对象的值。这个想法与上面的例子类似，但它将减少手动保存和加载对象的工作，因为对象会自动保存到缓存数据库，只需要通过 <code>load_cache()</code> 加载它即可，例如：</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb489-1"><a href="rmarkdown-operation.html#cb489-1" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb489-2"><a href="rmarkdown-operation.html#cb489-2" aria-hidden="true" tabindex="-1"></a>题目：一个重要的报告</span>
<span id="cb489-3"><a href="rmarkdown-operation.html#cb489-3" aria-hidden="true" tabindex="-1"></a>摘要： &gt;</span>
<span id="cb489-4"><a href="rmarkdown-operation.html#cb489-4" aria-hidden="true" tabindex="-1"></a>  在本文的分析中，`x` 的平均值是</span>
<span id="cb489-5"><a href="rmarkdown-operation.html#cb489-5" aria-hidden="true" tabindex="-1"></a>  `r knitr::inline_expr(&quot;knitr::load_cache(&#39;mean-x&#39;, &#39;mx&#39;)&quot;)`.</span>
<span id="cb489-6"><a href="rmarkdown-operation.html#cb489-6" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb489-7"><a href="rmarkdown-operation.html#cb489-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-8"><a href="rmarkdown-operation.html#cb489-8" aria-hidden="true" tabindex="-1"></a>在下面的块中创建对象 `mx`：</span>
<span id="cb489-9"><a href="rmarkdown-operation.html#cb489-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-10"><a href="rmarkdown-operation.html#cb489-10" aria-hidden="true" tabindex="-1"></a>```{r mean-x, cache=TRUE}</span>
<span id="cb489-11"><a href="rmarkdown-operation.html#cb489-11" aria-hidden="true" tabindex="-1"></a>x &lt;- 1:100</span>
<span id="cb489-12"><a href="rmarkdown-operation.html#cb489-12" aria-hidden="true" tabindex="-1"></a>mx &lt;- mean(x)</span>
<span id="cb489-13"><a href="rmarkdown-operation.html#cb489-13" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>这个例子中，R 代码块被添加了一个块标签 <code>mean-x</code>（被传递给 <code>load_cache()</code> 函数），并通过块选项 <code>cache = TRUE</code> 来缓存它。此代码块中的所有对象都将被保存到缓存数据库中。同样的，必须至少编译该文档两次，这样才能正确地从缓存数据库加载对象 <code>mx</code>。如果 <code>mx</code> 的值今后不会被更改，则不需要再次编译该文档。</p>
<p>如果在 <code>load_cache()</code> 的第二个参数中没有指定对象名，整个缓存数据库都将被加载到当前环境中。然后，可以从缓存数据库中调用这些本应在后续的文档中被创建的对象，例如：</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="rmarkdown-operation.html#cb490-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">load_cache</span>(<span class="st">&#39;mean-x&#39;</span>)</span>
<span id="cb490-2"><a href="rmarkdown-operation.html#cb490-2" aria-hidden="true" tabindex="-1"></a>x   <span class="co"># 对象 `x`</span></span>
<span id="cb490-3"><a href="rmarkdown-operation.html#cb490-3" aria-hidden="true" tabindex="-1"></a>mx  <span class="co"># 对象 `mx`</span></span></code></pre></div>
</div>
<div id="compile-exit" class="section level3 hasAnchor" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> 提前退出编译<a href="rmarkdown-operation.html#compile-exit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>有的时候，使用者可能需要提前退出编译，而不是在文档的末尾退出。例如，可能只希望分享结果的前半部分，或者可能文档末尾的一些代码尚未完成。在这些情况下，可以考虑在一个代码块中使用 <code>knit_exit()</code> 函数，它将在该代码块之后结束编译过程。</p>
<p>下面的例子先给出了一个非常简单的块，并紧跟着有一个更耗时的块：</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb491-1"><a href="rmarkdown-operation.html#cb491-1" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb491-2"><a href="rmarkdown-operation.html#cb491-2" aria-hidden="true" tabindex="-1"></a>1 + 1</span>
<span id="cb491-3"><a href="rmarkdown-operation.html#cb491-3" aria-hidden="true" tabindex="-1"></a>knitr::knit_exit()</span>
<span id="cb491-4"><a href="rmarkdown-operation.html#cb491-4" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb491-5"><a href="rmarkdown-operation.html#cb491-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-6"><a href="rmarkdown-operation.html#cb491-6" aria-hidden="true" tabindex="-1"></a>在输出中将只会看到上面的内容。</span>
<span id="cb491-7"><a href="rmarkdown-operation.html#cb491-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-8"><a href="rmarkdown-operation.html#cb491-8" aria-hidden="true" tabindex="-1"></a>```{r}</span>
<span id="cb491-9"><a href="rmarkdown-operation.html#cb491-9" aria-hidden="true" tabindex="-1"></a>Sys.sleep(100)</span>
<span id="cb491-10"><a href="rmarkdown-operation.html#cb491-10" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>一般情况下，需要等待 100 秒来编译整个文档，但由于调用了 <code>knit_exit()</code>，文档的剩余部分将不会被编译。</p>
</div>
<div id="plot-show-else" class="section level3 hasAnchor" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> 控制图像显示位置<a href="rmarkdown-operation.html#plot-show-else" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>通常情况下，由代码块中生成的图像会显示在代码块下面，但也可以让它显示在任意位置，例如：</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb492-1"><a href="rmarkdown-operation.html#cb492-1" aria-hidden="true" tabindex="-1"></a>在这个代码块中生成了一个图像，但是没有显示出来：</span>
<span id="cb492-2"><a href="rmarkdown-operation.html#cb492-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-3"><a href="rmarkdown-operation.html#cb492-3" aria-hidden="true" tabindex="-1"></a>```{r cars-plot, dev=&#39;png&#39;, fig.show=&#39;hide&#39;}</span>
<span id="cb492-4"><a href="rmarkdown-operation.html#cb492-4" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb492-5"><a href="rmarkdown-operation.html#cb492-5" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb492-6"><a href="rmarkdown-operation.html#cb492-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-7"><a href="rmarkdown-operation.html#cb492-7" aria-hidden="true" tabindex="-1"></a>在另一段之后介绍了该图像：</span>
<span id="cb492-8"><a href="rmarkdown-operation.html#cb492-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb492-9"><a href="rmarkdown-operation.html#cb492-9" aria-hidden="true" tabindex="-1"></a>![一张好看的图](`r knitr::inline_expr(&quot;knitr::fig_chunk(&#39;cars-plot&#39;, &#39;png&#39;)&quot;)`)</span></code></pre></div>
<p>上述代码块中使用了块选项 <code>fig.show='hide'</code> 来把图像暂时隐藏起来。然后在另一段中，通过函数 <code>knitr::fig_chunk()</code> 来检索得到绘图文件的路径，例如 <code>test_files/figure-html/cars-plot-1.png</code>。使用者需要将块标签和图像设备名称传递给 <code>fig_chunk()</code>，以便它更好地得到图像文件路径。</p>
<p><a href="https://stackoverflow.com/a/46305297/559676" class="uri">https://stackoverflow.com/a/46305297/559676</a> 介绍了 <code>fig_chunk()</code> 在 <strong>blogdown</strong> 网站中的应用。这个函数适用于任何 R Markdown 的输出格式，并且它对于在幻灯片上显示图像特别有用，因为幻灯片页上的屏幕空间通常是有限的，可以在一张幻灯片上展示代码，然后在另一张幻灯片上展示图像。</p>
</div>
<div id="modify-before" class="section level3 hasAnchor" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> 修改之前代码块中的图像<a href="rmarkdown-operation.html#modify-before" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>在默认情况的下，<strong>knitr</strong> 会打开一个新的图像设备来记录每个新代码块产生的图像。这就带来了一个问题：不能轻易地修改之前代码块产生的图像，因为之前的图像设备已经关闭了。这对于基础的 R 图形通常是有问题的（但不会影响从 <strong>ggplot2</strong> <span class="citation">(<a href="#ref-R-ggplot2" role="doc-biblioref">Hadley Wickham et al. 2021</a>)</span> 创建的网格图像，因为其可以被保存为 R 对象）。例如，如果在一个代码块中绘制一个图，并在后面的代码块中添加一条线，R 将发出一个错误信号，表示还没有创建这个图，因此不能添加线。</p>
<p>如果想让图像设备对所有代码块均保持打开的状态，可以在文档的开头设置一个 <strong>knitr</strong> 包的选项 ：</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb493-1"><a href="rmarkdown-operation.html#cb493-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">global.device =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>需要注意的是，这里使用的是 <code>opts_knit</code> 而非更常用的 <code>opts_chunk</code>。相关例子可参见 <a href="https://stackoverflow.com/q/17502050" class="uri">https://stackoverflow.com/q/17502050</a>。下面是一个完整的例子：</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb494-1"><a href="rmarkdown-operation.html#cb494-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb494-2"><a href="rmarkdown-operation.html#cb494-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &quot;使用全局图像设备记录图像&quot;</span></span>
<span id="cb494-3"><a href="rmarkdown-operation.html#cb494-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb494-4"><a href="rmarkdown-operation.html#cb494-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-5"><a href="rmarkdown-operation.html#cb494-5" aria-hidden="true" tabindex="-1"></a>首先，开启全局图像设备：</span>
<span id="cb494-6"><a href="rmarkdown-operation.html#cb494-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-7"><a href="rmarkdown-operation.html#cb494-7" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb494-8"><a href="rmarkdown-operation.html#cb494-8" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_knit$set(global.device = TRUE)</span></span>
<span id="cb494-9"><a href="rmarkdown-operation.html#cb494-9" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb494-10"><a href="rmarkdown-operation.html#cb494-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-11"><a href="rmarkdown-operation.html#cb494-11" aria-hidden="true" tabindex="-1"></a>画一张图：</span>
<span id="cb494-12"><a href="rmarkdown-operation.html#cb494-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-13"><a href="rmarkdown-operation.html#cb494-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb494-14"><a href="rmarkdown-operation.html#cb494-14" aria-hidden="true" tabindex="-1"></a><span class="in">par(mar = c(4, 4, 0.1, 0.1))</span></span>
<span id="cb494-15"><a href="rmarkdown-operation.html#cb494-15" aria-hidden="true" tabindex="-1"></a><span class="in">plot(cars)</span></span>
<span id="cb494-16"><a href="rmarkdown-operation.html#cb494-16" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb494-17"><a href="rmarkdown-operation.html#cb494-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-18"><a href="rmarkdown-operation.html#cb494-18" aria-hidden="true" tabindex="-1"></a>给之前代码块生成的图添加一条线：</span>
<span id="cb494-19"><a href="rmarkdown-operation.html#cb494-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-20"><a href="rmarkdown-operation.html#cb494-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb494-21"><a href="rmarkdown-operation.html#cb494-21" aria-hidden="true" tabindex="-1"></a><span class="in">fit &lt;- lm(dist ~ speed, data = cars)</span></span>
<span id="cb494-22"><a href="rmarkdown-operation.html#cb494-22" aria-hidden="true" tabindex="-1"></a><span class="in">abline(fit)</span></span>
<span id="cb494-23"><a href="rmarkdown-operation.html#cb494-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb494-24"><a href="rmarkdown-operation.html#cb494-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-25"><a href="rmarkdown-operation.html#cb494-25" aria-hidden="true" tabindex="-1"></a>不再使用全局图像设备了：</span>
<span id="cb494-26"><a href="rmarkdown-operation.html#cb494-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-27"><a href="rmarkdown-operation.html#cb494-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include=FALSE}</span></span>
<span id="cb494-28"><a href="rmarkdown-operation.html#cb494-28" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_knit$set(global.device = FALSE)</span></span>
<span id="cb494-29"><a href="rmarkdown-operation.html#cb494-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb494-30"><a href="rmarkdown-operation.html#cb494-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-31"><a href="rmarkdown-operation.html#cb494-31" aria-hidden="true" tabindex="-1"></a>画另一张图：</span>
<span id="cb494-32"><a href="rmarkdown-operation.html#cb494-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb494-33"><a href="rmarkdown-operation.html#cb494-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb494-34"><a href="rmarkdown-operation.html#cb494-34" aria-hidden="true" tabindex="-1"></a><span class="in">plot(pressure, type = &#39;b&#39;)</span></span>
<span id="cb494-35"><a href="rmarkdown-operation.html#cb494-35" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code></pre></div>
</div>
<div id="reuse-option" class="section level3 hasAnchor" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> 复用块选项 (*)<a href="rmarkdown-operation.html#reuse-option" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>使用者有时需要经常使用一些块选项，例如对一些图像的设置、对一些结果输出方式的设置。这当然可以通过复制粘贴实现，但不妨把它们保存为一个组，然后只使用组的名称来重复使用它们。这可以通过 <code>knitr::opts_template$set(name = list(options))</code> 来实现，之后可以使用 <code>opts.label</code> 来引用组名，从而实现重复使用。例如：</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb495-1"><a href="rmarkdown-operation.html#cb495-1" aria-hidden="true" tabindex="-1"></a>```{r, setup, include=FALSE}</span>
<span id="cb495-2"><a href="rmarkdown-operation.html#cb495-2" aria-hidden="true" tabindex="-1"></a>knitr::opts_template$set(fullwidth = list(</span>
<span id="cb495-3"><a href="rmarkdown-operation.html#cb495-3" aria-hidden="true" tabindex="-1"></a>  fig.width = 10, fig.height = 6,</span>
<span id="cb495-4"><a href="rmarkdown-operation.html#cb495-4" aria-hidden="true" tabindex="-1"></a>  fig.retina = 2, out.width = &#39;100%&#39;</span>
<span id="cb495-5"><a href="rmarkdown-operation.html#cb495-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb495-6"><a href="rmarkdown-operation.html#cb495-6" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb495-7"><a href="rmarkdown-operation.html#cb495-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-8"><a href="rmarkdown-operation.html#cb495-8" aria-hidden="true" tabindex="-1"></a>```{r, opts.label=&#39;fullwidth&#39;}</span>
<span id="cb495-9"><a href="rmarkdown-operation.html#cb495-9" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb495-10"><a href="rmarkdown-operation.html#cb495-10" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>在设定 <code>opts.label = 'fullwidth'</code> 时， <strong>knitr</strong> 将从 <code>knitr::opts_template</code> 中读取块选项，并将它们应用到当前的块中，这样可以节省一些打字的工作量。如果一个块选项要在文档中全局使用，则应该考虑全局地设置它（参见第 <a href="rmarkdown-operation.html#chunk-options">6.2</a> 节）。</p>
<p>另外，还可以覆盖从 <code>opts.label</code> 中读取的选项，例如，如果在下面的块中设置 <code>fig.height = 7</code>，则实际的 <code>fig.height</code> 将变为 <code>7</code> 而非 <code>6</code>，从而可以对单个块进行调整：</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb496-1"><a href="rmarkdown-operation.html#cb496-1" aria-hidden="true" tabindex="-1"></a>```{r, opts.label=&#39;fullwidth&#39;, fig.height=7}</span>
<span id="cb496-2"><a href="rmarkdown-operation.html#cb496-2" aria-hidden="true" tabindex="-1"></a>plot(cars)</span>
<span id="cb496-3"><a href="rmarkdown-operation.html#cb496-3" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>事实上，可以保存任意数量的分组选项，例如 <code>knitr::opts_template$set(group1 = list(...), group2 = list(...))</code>。</p>
</div>
<div id="knit-expand" class="section level3 hasAnchor" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> 使用 <code>knitr::knit_expand()</code> 来生成 Rmd 源代码<a href="rmarkdown-operation.html#knit-expand" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>函数 <code>knitr::knit_expand()</code>可以将 <code>{{ }}</code> 中的表达式“扩展”为它的值（默认），例如，</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="rmarkdown-operation.html#cb497-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">knit_expand</span>(<span class="at">text =</span> <span class="st">&quot;`pi` 的值是  {{pi}}.&quot;</span>)</span>
<span id="cb497-2"><a href="rmarkdown-operation.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;`pi` 的值是  3.14159265358979.&quot;</span></span>
<span id="cb497-3"><a href="rmarkdown-operation.html#cb497-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">knit_expand</span>(</span>
<span id="cb497-4"><a href="rmarkdown-operation.html#cb497-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="st">&quot;`a` 的值是 {{a}}, 所以 `a + 1` 是 {{a+1}}.&quot;</span>,</span>
<span id="cb497-5"><a href="rmarkdown-operation.html#cb497-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>), <span class="dv">4</span>)</span>
<span id="cb497-6"><a href="rmarkdown-operation.html#cb497-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb497-7"><a href="rmarkdown-operation.html#cb497-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;`a` 的值是 2.1198, 所以 `a + 1` 是 3.1198.&quot;</span></span></code></pre></div>
<p>这意味着，如果有一个 R Markdown 文档，其中包含了 <code>{{ }}</code> 中的一些动态部分，那么可以在该文档上应用 <code>knit_expand()</code>，然后调用 <code>knit()</code> 来编译它。例如，下面是一个名为 <code>template.Rmd</code> 的模板文档：</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb498-1"><a href="rmarkdown-operation.html#cb498-1" aria-hidden="true" tabindex="-1"></a># 在 {{i}} 上进行回归</span>
<span id="cb498-2"><a href="rmarkdown-operation.html#cb498-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-3"><a href="rmarkdown-operation.html#cb498-3" aria-hidden="true" tabindex="-1"></a>```{r lm-{{i}}}</span>
<span id="cb498-4"><a href="rmarkdown-operation.html#cb498-4" aria-hidden="true" tabindex="-1"></a>lm(mpg ~ {{i}}, data = mtcars)</span>
<span id="cb498-5"><a href="rmarkdown-operation.html#cb498-5" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>可以用 <code>mpg</code> 来对 <code>mtcars</code> 数据集中的所有其他变量逐个建立线性回归模型：</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb499-1"><a href="rmarkdown-operation.html#cb499-1" aria-hidden="true" tabindex="-1"></a>```{r, echo=FALSE, results=&#39;asis&#39;}</span>
<span id="cb499-2"><a href="rmarkdown-operation.html#cb499-2" aria-hidden="true" tabindex="-1"></a>src = lapply(setdiff(names(mtcars), &#39;mpg&#39;), function(i) {</span>
<span id="cb499-3"><a href="rmarkdown-operation.html#cb499-3" aria-hidden="true" tabindex="-1"></a>  knitr::knit_expand(&#39;template.Rmd&#39;)</span>
<span id="cb499-4"><a href="rmarkdown-operation.html#cb499-4" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb499-5"><a href="rmarkdown-operation.html#cb499-5" aria-hidden="true" tabindex="-1"></a>res = knitr::knit_child(text = unlist(src), quiet = TRUE)</span>
<span id="cb499-6"><a href="rmarkdown-operation.html#cb499-6" aria-hidden="true" tabindex="-1"></a>cat(res, sep = &#39;\n&#39;)</span>
<span id="cb499-7"><a href="rmarkdown-operation.html#cb499-7" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>如果理解这个例子有难度，可参阅第 <a href="rmarkdown-operation.html#results-asis">6.2.3.4</a> 节，以了解块选项 <code>results = 'asis'</code>，以及第 <a href="rmarkdown-project.html#child-document">7.1.4</a> 节来了解 <code>knitr::knit_child()</code> 的用法。</p>
</div>
<div id="repeat-label" class="section level3 hasAnchor" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> 重复代码块标签 (*)<a href="rmarkdown-operation.html#repeat-label" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>默认情况下，<strong>knitr</strong> 不允许在文档中重复代码块标签。在编译文档时，重复的标签将导致错误。这种情况常见于在文档中复制和粘贴代码块的时候，会产生这样的错误信息：</p>
<pre class="text"><code>processing file: myfile.Rmd
Error in parse_block(g[-1], g[1], params.src, markdown_mode) :
  Duplicate chunk label &#39;cars&#39;
Calls: &lt;Anonymous&gt; ... process_file -&gt; split_file -&gt; lapply -&gt;
  FUN -&gt; parse_block
Execution halted</code></pre>
<p>然而，在某些情况下，使用者会希望允许标签可以重复。例如，如果有一个母文档 <code>parent.Rmd</code>，在其中会多次编译子文档，下面的代码会运行失败：</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb501-1"><a href="rmarkdown-operation.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置</span></span>
<span id="cb501-2"><a href="rmarkdown-operation.html#cb501-2" aria-hidden="true" tabindex="-1"></a>settings <span class="ot">=</span> <span class="fu">list</span>(...)</span>
<span id="cb501-3"><a href="rmarkdown-operation.html#cb501-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-4"><a href="rmarkdown-operation.html#cb501-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 第一次运行</span></span>
<span id="cb501-5"><a href="rmarkdown-operation.html#cb501-5" aria-hidden="true" tabindex="-1"></a><span class="fu">knit_child</span>(<span class="st">&#39;useful_analysis.Rmd&#39;</span>)</span>
<span id="cb501-6"><a href="rmarkdown-operation.html#cb501-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-7"><a href="rmarkdown-operation.html#cb501-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 重新设置</span></span>
<span id="cb501-8"><a href="rmarkdown-operation.html#cb501-8" aria-hidden="true" tabindex="-1"></a>settings <span class="ot">=</span> <span class="fu">list</span>(...)</span>
<span id="cb501-9"><a href="rmarkdown-operation.html#cb501-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-10"><a href="rmarkdown-operation.html#cb501-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 再次运行</span></span>
<span id="cb501-11"><a href="rmarkdown-operation.html#cb501-11" aria-hidden="true" tabindex="-1"></a><span class="fu">knit_child</span>(<span class="st">&#39;useful_analysis.Rmd&#39;</span>)</span></code></pre></div>
<p>在这个场景中，可以通过在编译子文档之前在 R 中设置这个全局选项来允许标签可重复：</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="rmarkdown-operation.html#cb502-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">knitr.duplicate.label =</span> <span class="st">&#39;allow&#39;</span>)</span></code></pre></div>
<p>如果想在母文档而不是子文档中允许标签可重复，则必须在 <code>knitr::knit()</code> 被调用之前设置这个选项。一种可能的方法是在 <code>~/.Rprofile</code> 中设置这个选项（更多信息可参见帮助页面 <code>?Rprofile</code>）。</p>
<p>设置此选项时需要很谨慎，与大多数的报错一样，它们的存在是有原因的。允许重复的块可能会在图像和交叉引用方面产生静默问题（silent problem）。例如，理论上，如果两个代码块具有相同的标签，并且两个代码块都生成图像，那么它们的图像文件将互相覆盖（并不会产生错误或警告消息），因为图像的文件名是由块标签决定的。使用选项 <code>knitr.duplicate.label = "allow"</code> 时， <strong>knitr</strong> 将通过添加数字后缀来静默地改变重复标签。例如，对于两个代码块：</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb503-1"><a href="rmarkdown-operation.html#cb503-1" aria-hidden="true" tabindex="-1"></a>```{r, test}</span>
<span id="cb503-2"><a href="rmarkdown-operation.html#cb503-2" aria-hidden="true" tabindex="-1"></a>plot(1:10)</span>
<span id="cb503-3"><a href="rmarkdown-operation.html#cb503-3" aria-hidden="true" tabindex="-1"></a>```</span>
<span id="cb503-4"><a href="rmarkdown-operation.html#cb503-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb503-5"><a href="rmarkdown-operation.html#cb503-5" aria-hidden="true" tabindex="-1"></a>```{r, test}</span>
<span id="cb503-6"><a href="rmarkdown-operation.html#cb503-6" aria-hidden="true" tabindex="-1"></a>plot(10:1)</span>
<span id="cb503-7"><a href="rmarkdown-operation.html#cb503-7" aria-hidden="true" tabindex="-1"></a>```</span></code></pre></div>
<p>第二个标签将被静默地更改为 <code>test-1</code>，这将避免覆盖由标签 <code>test</code> 的块产生的图像，但这也使得块标签不可被预知，所以在交叉引用图像时可能会产生困难（参见 <a href="rmarkdown-base.html#cross-reference">2.8.7</a> 节），因为交叉引用也是基于块标签的。</p>

</div>
</div>
</div>
<h3>参考文献<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-sass" class="csl-entry">
Cheng, Joe, Timothy Mastny, Richard Iannone, Barret Schloerke, and Carson Sievert. 2022. <em>Sass: Syntactically Awesome Style Sheets (Sass)</em>. <a href="https://CRAN.R-project.org/package=sass">https://CRAN.R-project.org/package=sass</a>.
</div>
<div id="ref-R-xtable" class="csl-entry">
Dahl, David B., David Scott, Charles Roosen, Arni Magnusson, and Jonathan Swinton. 2019. <em>Xtable: Export Tables to LaTeX or HTML</em>. <a href="http://xtable.r-forge.r-project.org/">http://xtable.r-forge.r-project.org/</a>.
</div>
<div id="ref-R-pander" class="csl-entry">
Daróczi, Gergely, and Roman Tsegelskyi. 2022. <em>Pander: An r Pandoc Writer</em>. <a href="https://rapporter.github.io/pander/">https://rapporter.github.io/pander/</a>.
</div>
<div id="ref-R-yaml" class="csl-entry">
Garbett, Shawn P, Jeremy Stephens, Kirill Simonov, Yihui Xie, Zhuoer Dong, Hadley Wickham, Jeffrey Horner, et al. 2022. <em>Yaml: Methods to Convert r Data to YAML and Back</em>. <a href="https://github.com/vubiostat/r-yaml/">https://github.com/vubiostat/r-yaml/</a>.
</div>
<div id="ref-R-huxtable" class="csl-entry">
Hugh-Jones, David. 2021. <em>Huxtable: Easily Create and Style Tables for LaTeX, HTML and Other Formats</em>. <a href="https://hughjonesd.github.io/huxtable/">https://hughjonesd.github.io/huxtable/</a>.
</div>
<div id="ref-R-magick" class="csl-entry">
Ooms, Jeroen. 2021. <em>Magick: Advanced Graphics and Image-Processing in r</em>. <a href="https://CRAN.R-project.org/package=magick">https://CRAN.R-project.org/package=magick</a>.
</div>
<div id="ref-R-tikzDevice" class="csl-entry">
Sharpsteen, Charlie, and Cameron Bracken. 2020. <em>tikzDevice: R Graphics Output in LaTeX Format</em>. <a href="https://github.com/daqana/tikzDevice">https://github.com/daqana/tikzDevice</a>.
</div>
<div id="ref-R-reticulate" class="csl-entry">
Ushey, Kevin, JJ Allaire, and Yuan Tang. 2022. <em>Reticulate: Interface to Python</em>. <a href="https://CRAN.R-project.org/package=reticulate">https://CRAN.R-project.org/package=reticulate</a>.
</div>
<div id="ref-R-ggplot2" class="csl-entry">
Wickham, Hadley, Winston Chang, Lionel Henry, Thomas Lin Pedersen, Kohske Takahashi, Claus Wilke, Kara Woo, Hiroaki Yutani, and Dewey Dunnington. 2021. <em>Ggplot2: Create Elegant Data Visualisations Using the Grammar of Graphics</em>. <a href="https://CRAN.R-project.org/package=ggplot2">https://CRAN.R-project.org/package=ggplot2</a>.
</div>
<div id="ref-R-svglite" class="csl-entry">
Wickham, Hadley, Lionel Henry, Thomas Lin Pedersen, T Jake Luciani, Matthieu Decorde, and Vaudor Lise. 2022. <em>Svglite: An SVG Graphics Device</em>. <a href="https://CRAN.R-project.org/package=svglite">https://CRAN.R-project.org/package=svglite</a>.
</div>
<div id="ref-R-formatR" class="csl-entry">
———. 2022b. <em>formatR: Format r Code Automatically</em>. <a href="https://github.com/yihui/formatR">https://github.com/yihui/formatR</a>.
</div>
<div id="ref-R-kableExtra" class="csl-entry">
Zhu, Hao. 2021. <em>kableExtra: Construct Complex Table with Kable and Pipe Syntax</em>. <a href="https://CRAN.R-project.org/package=kableExtra">https://CRAN.R-project.org/package=kableExtra</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="27">
<li id="fn27"><p>细心的读者可以发现，后文例子中， <code>_</code> 实际上被转义为了 <code>\\_</code>，LaTeX 中大于等于号 <code>\ge</code> 也被写为了 <code>\\ge</code>，这是因为 R 中 <code>\</code> 本身也代表转义，所以在 R 中输入文件地址时要将其替换为 <code>\\</code> 或 <code>/</code>。<a href="rmarkdown-operation.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>层叠样式表，是一种用来表现 HTML 等文件样式的计算机语言。<a href="rmarkdown-operation.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>如果需要支持其他输出格式，如 LaTeX 和 Word，<strong>gtsummary</strong> 包<span class="citation">(<a href="#ref-R-gtsummary" role="doc-biblioref"><strong>R-gtsummary?</strong></a>)</span>已经做了一些基于 <strong>gt</strong> 的扩展，可参见：<a href="https://github.com/ddsjoberg/gtsummary" class="uri">https://github.com/ddsjoberg/gtsummary</a>.<a href="rmarkdown-operation.html#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>也可以转换为 <code>&lt;div class="className"&gt;&lt;/div&gt;</code>，可以查看HTML输出文档的源代码来确定<a href="rmarkdown-operation.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>实际工作中读者应使用 R Markdown 内置的 Python 引擎<a href="rmarkdown-operation.html#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>HTML5 是 HTML 更新版本，为原始 HTML 增加了很多功能，极大地提升了用户的使用体验。如果想更多地了解二者的差异，可以参见 <a href="https://www.hostinger.com/tutorials/difference-between-html-and-html5#HTML_vs_HTML5_-_Comparison" class="uri">https://www.hostinger.com/tutorials/difference-between-html-and-html5#HTML_vs_HTML5_-_Comparison</a>。<a href="rmarkdown-operation.html#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p>这是默认的行为，也可以进行调整。如果想了解如何使缓存更精细，而非所有块选项都会影响缓存，请参阅：<a href="https://yihui.org/knitr/demo/cache/" class="uri">https://yihui.org/knitr/demo/cache/</a>。<a href="rmarkdown-operation.html#fnref33" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://rmarkdown-guide.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="rmarkdown-interaction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rmarkdown-project.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cosname/rmarkdown-guide/edit/master/06-operation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
